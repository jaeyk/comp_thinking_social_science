<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.6 Supervised learning | Computational Thinking for Social Scientists</title>
  <meta name="description" content="8.6 Supervised learning | Computational Thinking for Social Scientists. An online textbook for teaching computational tools and techniques to social scientists." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="8.6 Supervised learning | Computational Thinking for Social Scientists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="8.6 Supervised learning | Computational Thinking for Social Scientists. An online textbook for teaching computational tools and techniques to social scientists." />
  <meta name="github-repo" content="jaeyk/PS239T" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.6 Supervised learning | Computational Thinking for Social Scientists" />
  <meta name="twitter:site" content="@JaeJaeykim2" />
  <meta name="twitter:description" content="8.6 Supervised learning | Computational Thinking for Social Scientists. An online textbook for teaching computational tools and techniques to social scientists." />
  

<meta name="author" content="Jae Yeon Kim" />


<meta name="date" content="2025-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pre-processing.html"/>
<link rel="next" href="unsupervised-learning.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Thinking for Social Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello, World</a>
<ul>
<li class="chapter" data-level="1.1" data-path="part-i-fundamentals.html"><a href="part-i-fundamentals.html"><i class="fa fa-check"></i><b>1.1</b> Part I: Fundamentals</a></li>
<li class="chapter" data-level="1.2" data-path="part-ii-applications.html"><a href="part-ii-applications.html"><i class="fa fa-check"></i><b>1.2</b> Part II: Applications</a></li>
<li class="chapter" data-level="1.3" data-path="special-thanks.html"><a href="special-thanks.html"><i class="fa fa-check"></i><b>1.3</b> Special Thanks</a></li>
<li class="chapter" data-level="1.4" data-path="suggestions-questions-or-comments.html"><a href="suggestions-questions-or-comments.html"><i class="fa fa-check"></i><b>1.4</b> Suggestions, Questions, or Comments</a></li>
<li class="chapter" data-level="1.5" data-path="license.html"><a href="license.html"><i class="fa fa-check"></i><b>1.5</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Computational Thinking</a>
<ul>
<li class="chapter" data-level="2.1" data-path="why-computational-thinking.html"><a href="why-computational-thinking.html"><i class="fa fa-check"></i><b>2.1</b> Why computational thinking</a></li>
<li class="chapter" data-level="2.2" data-path="computational-thinking-in-the-age-of-generative-ai.html"><a href="computational-thinking-in-the-age-of-generative-ai.html"><i class="fa fa-check"></i><b>2.2</b> Computational thinking in the age of generative AI</a></li>
<li class="chapter" data-level="2.3" data-path="how-to-teach-and-learn-computational-thinking.html"><a href="how-to-teach-and-learn-computational-thinking.html"><i class="fa fa-check"></i><b>2.3</b> How to teach and learn computational thinking</a></li>
<li class="chapter" data-level="2.4" data-path="computational-thinking-and-a-career-in-computational-social-science.html"><a href="computational-thinking-and-a-career-in-computational-social-science.html"><i class="fa fa-check"></i><b>2.4</b> Computational thinking and a career in computational social science</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="git_bash.html"><a href="git_bash.html"><i class="fa fa-check"></i><b>3</b> Managing data and code</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-command-line.html"><a href="the-command-line.html"><i class="fa fa-check"></i><b>3.1</b> The Command Line</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-command-line.html"><a href="the-command-line.html#the-big-picture"><i class="fa fa-check"></i><b>3.1.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.1.2" data-path="the-command-line.html"><a href="the-command-line.html#why-bother-using-the-command-line"><i class="fa fa-check"></i><b>3.1.2</b> Why bother using the command line?</a></li>
<li class="chapter" data-level="3.1.3" data-path="the-command-line.html"><a href="the-command-line.html#unix-shell"><i class="fa fa-check"></i><b>3.1.3</b> UNIX Shell</a></li>
<li class="chapter" data-level="3.1.4" data-path="the-command-line.html"><a href="the-command-line.html#references"><i class="fa fa-check"></i><b>3.1.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="git-and-github.html"><a href="git-and-github.html"><i class="fa fa-check"></i><b>3.2</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="git-and-github.html"><a href="git-and-github.html#the-big-picture-1"><i class="fa fa-check"></i><b>3.2.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.2.2" data-path="git-and-github.html"><a href="git-and-github.html#version-control-system"><i class="fa fa-check"></i><b>3.2.2</b> Version control system</a></li>
<li class="chapter" data-level="3.2.3" data-path="git-and-github.html"><a href="git-and-github.html#setup"><i class="fa fa-check"></i><b>3.2.3</b> Setup</a></li>
<li class="chapter" data-level="3.2.4" data-path="git-and-github.html"><a href="git-and-github.html#cloning-a-repository"><i class="fa fa-check"></i><b>3.2.4</b> Cloning a repository</a></li>
<li class="chapter" data-level="3.2.5" data-path="git-and-github.html"><a href="git-and-github.html#making-a-repository"><i class="fa fa-check"></i><b>3.2.5</b> Making a repository</a></li>
<li class="chapter" data-level="3.2.6" data-path="git-and-github.html"><a href="git-and-github.html#commit-changes"><i class="fa fa-check"></i><b>3.2.6</b> Commit changes</a></li>
<li class="chapter" data-level="3.2.7" data-path="git-and-github.html"><a href="git-and-github.html#push-and-pull-or-fetch"><i class="fa fa-check"></i><b>3.2.7</b> Push and pull (or fetch)</a></li>
<li class="chapter" data-level="3.2.8" data-path="git-and-github.html"><a href="git-and-github.html#branching"><i class="fa fa-check"></i><b>3.2.8</b> Branching</a></li>
<li class="chapter" data-level="3.2.9" data-path="git-and-github.html"><a href="git-and-github.html#other-useful-commands"><i class="fa fa-check"></i><b>3.2.9</b> Other useful commands</a></li>
<li class="chapter" data-level="3.2.10" data-path="git-and-github.html"><a href="git-and-github.html#collaborations"><i class="fa fa-check"></i><b>3.2.10</b> Collaborations</a></li>
<li class="chapter" data-level="3.2.11" data-path="git-and-github.html"><a href="git-and-github.html#deployment-github-pages"><i class="fa fa-check"></i><b>3.2.11</b> Deployment: GitHub Pages</a></li>
<li class="chapter" data-level="3.2.12" data-path="git-and-github.html"><a href="git-and-github.html#tracking-progress-github-issues"><i class="fa fa-check"></i><b>3.2.12</b> Tracking progress: GitHub Issues</a></li>
<li class="chapter" data-level="3.2.13" data-path="git-and-github.html"><a href="git-and-github.html#project-management-github-dashboards"><i class="fa fa-check"></i><b>3.2.13</b> Project management: GitHub Dashboards</a></li>
<li class="chapter" data-level="3.2.14" data-path="git-and-github.html"><a href="git-and-github.html#using-git-clients"><i class="fa fa-check"></i><b>3.2.14</b> Using Git clients</a></li>
<li class="chapter" data-level="3.2.15" data-path="git-and-github.html"><a href="git-and-github.html#the-big-picture-2"><i class="fa fa-check"></i><b>3.2.15</b> The Big Picture</a></li>
<li class="chapter" data-level="3.2.16" data-path="git-and-github.html"><a href="git-and-github.html#rstudio"><i class="fa fa-check"></i><b>3.2.16</b> RStudio</a></li>
<li class="chapter" data-level="3.2.17" data-path="git-and-github.html"><a href="git-and-github.html#basic-syntax"><i class="fa fa-check"></i><b>3.2.17</b> Basic Syntax</a></li>
<li class="chapter" data-level="3.2.18" data-path="git-and-github.html"><a href="git-and-github.html#environment"><i class="fa fa-check"></i><b>3.2.18</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="project-oriented-research.html"><a href="project-oriented-research.html"><i class="fa fa-check"></i><b>3.3</b> Project-oriented research</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="project-oriented-research.html"><a href="project-oriented-research.html#the-big-picture-3"><i class="fa fa-check"></i><b>3.3.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.3.2" data-path="project-oriented-research.html"><a href="project-oriented-research.html#references-1"><i class="fa fa-check"></i><b>3.3.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="writing-code-how-to-code-like-a-professional.html"><a href="writing-code-how-to-code-like-a-professional.html"><i class="fa fa-check"></i><b>3.4</b> Writing code: How to code like a professional</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="writing-code-how-to-code-like-a-professional.html"><a href="writing-code-how-to-code-like-a-professional.html#the-big-picture-4"><i class="fa fa-check"></i><b>3.4.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.4.2" data-path="writing-code-how-to-code-like-a-professional.html"><a href="writing-code-how-to-code-like-a-professional.html#write-readable-code"><i class="fa fa-check"></i><b>3.4.2</b> Write readable code</a></li>
<li class="chapter" data-level="3.4.3" data-path="writing-code-how-to-code-like-a-professional.html"><a href="writing-code-how-to-code-like-a-professional.html#write-reusable-code"><i class="fa fa-check"></i><b>3.4.3</b> Write reusable code</a></li>
<li class="chapter" data-level="3.4.4" data-path="writing-code-how-to-code-like-a-professional.html"><a href="writing-code-how-to-code-like-a-professional.html#test-your-code-systematically"><i class="fa fa-check"></i><b>3.4.4</b> Test your code systematically</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="run-tests.html"><a href="run-tests.html"><i class="fa fa-check"></i><b>3.5</b> Run tests</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="run-tests.html"><a href="run-tests.html#asking-questions-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.5.1</b> Asking questions: Minimal reproducible example</a></li>
<li class="chapter" data-level="3.5.2" data-path="run-tests.html"><a href="run-tests.html#references-2"><i class="fa fa-check"></i><b>3.5.2</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy_data.html"><a href="tidy_data.html"><i class="fa fa-check"></i><b>4</b> Tidy data and its friends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="setup-2.html"><a href="setup-2.html"><i class="fa fa-check"></i><b>4.1</b> Setup</a></li>
<li class="chapter" data-level="4.2" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html"><i class="fa fa-check"></i><b>4.2</b> Base R data structure</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html#d-data-vectors"><i class="fa fa-check"></i><b>4.2.1</b> 1D data: Vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html#data-structures"><i class="fa fa-check"></i><b>4.2.2</b> Data structures</a></li>
<li class="chapter" data-level="4.2.3" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html#attributes"><i class="fa fa-check"></i><b>4.2.3</b> Attributes</a></li>
<li class="chapter" data-level="4.2.4" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html#d-data-matrices-and-dataframes"><i class="fa fa-check"></i><b>4.2.4</b> 2D data: Matrices and dataframes</a></li>
<li class="chapter" data-level="4.2.5" data-path="base-r-data-structure.html"><a href="base-r-data-structure.html#subset"><i class="fa fa-check"></i><b>4.2.5</b> Subset</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4.3</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="tidyverse.html"><a href="tidyverse.html#the-big-picture-5"><i class="fa fa-check"></i><b>4.3.1</b> The Big Picture</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidying-tidyr.html"><a href="tidying-tidyr.html"><i class="fa fa-check"></i><b>4.4</b> Tidying (tidyr)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="tidying-tidyr.html"><a href="tidying-tidyr.html#reshaping"><i class="fa fa-check"></i><b>4.4.1</b> Reshaping</a></li>
<li class="chapter" data-level="4.4.2" data-path="tidying-tidyr.html"><a href="tidying-tidyr.html#filling"><i class="fa fa-check"></i><b>4.4.2</b> Filling</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html"><i class="fa fa-check"></i><b>4.5</b> Manipulating (dplyr)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#rearranging"><i class="fa fa-check"></i><b>4.5.1</b> Rearranging</a></li>
<li class="chapter" data-level="4.5.2" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#subset-observations-rows"><i class="fa fa-check"></i><b>4.5.2</b> Subset observations (rows)</a></li>
<li class="chapter" data-level="4.5.3" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#subset-variables-columns"><i class="fa fa-check"></i><b>4.5.3</b> Subset variables (columns)</a></li>
<li class="chapter" data-level="4.5.4" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#create-variables"><i class="fa fa-check"></i><b>4.5.4</b> Create variables</a></li>
<li class="chapter" data-level="4.5.5" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#counting"><i class="fa fa-check"></i><b>4.5.5</b> Counting</a></li>
<li class="chapter" data-level="4.5.6" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#summarizing"><i class="fa fa-check"></i><b>4.5.6</b> Summarizing</a></li>
<li class="chapter" data-level="4.5.7" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#grouping"><i class="fa fa-check"></i><b>4.5.7</b> Grouping</a></li>
<li class="chapter" data-level="4.5.8" data-path="manipulating-dplyr.html"><a href="manipulating-dplyr.html#joining"><i class="fa fa-check"></i><b>4.5.8</b> Joining</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="modeling-broom.html"><a href="modeling-broom.html"><i class="fa fa-check"></i><b>4.6</b> Modeling (broom)</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="modeling-broom.html"><a href="modeling-broom.html#nesting"><i class="fa fa-check"></i><b>4.6.1</b> Nesting</a></li>
<li class="chapter" data-level="4.6.2" data-path="modeling-broom.html"><a href="modeling-broom.html#mapping"><i class="fa fa-check"></i><b>4.6.2</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html"><i class="fa fa-check"></i><b>4.7</b> Visualizing (ggplot2)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#motivation-2"><i class="fa fa-check"></i><b>4.7.1</b> Motivation</a></li>
<li class="chapter" data-level="4.7.2" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.7.2</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.7.3" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#mapping-and-geom"><i class="fa fa-check"></i><b>4.7.3</b> mapping and geom</a></li>
<li class="chapter" data-level="4.7.4" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#basic-aes-x-y"><i class="fa fa-check"></i><b>4.7.4</b> basic aes (x , y)</a></li>
<li class="chapter" data-level="4.7.5" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#univariate-distribution"><i class="fa fa-check"></i><b>4.7.5</b> Univariate distribution</a></li>
<li class="chapter" data-level="4.7.6" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#advanced-aes-size-color"><i class="fa fa-check"></i><b>4.7.6</b> Advanced aes (size, color)</a></li>
<li class="chapter" data-level="4.7.7" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#co-ordinates-and-scales"><i class="fa fa-check"></i><b>4.7.7</b> Co-ordinates and scales</a></li>
<li class="chapter" data-level="4.7.8" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#labels-and-guides"><i class="fa fa-check"></i><b>4.7.8</b> Labels and guides</a></li>
<li class="chapter" data-level="4.7.9" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#ggsave"><i class="fa fa-check"></i><b>4.7.9</b> ggsave</a></li>
<li class="chapter" data-level="4.7.10" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#many-plots"><i class="fa fa-check"></i><b>4.7.10</b> Many plots</a></li>
<li class="chapter" data-level="4.7.11" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#transforming"><i class="fa fa-check"></i><b>4.7.11</b> Transforming</a></li>
<li class="chapter" data-level="4.7.12" data-path="visualizing-ggplot2.html"><a href="visualizing-ggplot2.html#ploting-models"><i class="fa fa-check"></i><b>4.7.12</b> Ploting models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functional_programming.html"><a href="functional_programming.html"><i class="fa fa-check"></i><b>5</b> Automating repeated things</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-big-picture-6.html"><a href="the-big-picture-6.html"><i class="fa fa-check"></i><b>5.1</b> The Big Picture</a></li>
<li class="chapter" data-level="5.2" data-path="objectives.html"><a href="objectives.html"><i class="fa fa-check"></i><b>5.2</b> Objectives</a></li>
<li class="chapter" data-level="5.3" data-path="setup-3.html"><a href="setup-3.html"><i class="fa fa-check"></i><b>5.3</b> Setup</a></li>
<li class="chapter" data-level="5.4" data-path="flow.html"><a href="flow.html"><i class="fa fa-check"></i><b>5.4</b> Flow control</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="flow.html"><a href="flow.html#if-one-condition"><i class="fa fa-check"></i><b>5.4.1</b> if (one condition)</a></li>
<li class="chapter" data-level="5.4.2" data-path="flow.html"><a href="flow.html#if-else-two-conditions"><i class="fa fa-check"></i><b>5.4.2</b> if + else (two conditions)</a></li>
<li class="chapter" data-level="5.4.3" data-path="flow.html"><a href="flow.html#if-else-if-else-three-conditions"><i class="fa fa-check"></i><b>5.4.3</b> if + else if + else (three conditions)</a></li>
<li class="chapter" data-level="5.4.4" data-path="flow.html"><a href="flow.html#functions"><i class="fa fa-check"></i><b>5.4.4</b> Functions</a></li>
<li class="chapter" data-level="5.4.5" data-path="flow.html"><a href="flow.html#for-loop"><i class="fa fa-check"></i><b>5.4.5</b> for loop</a></li>
<li class="chapter" data-level="5.4.6" data-path="flow.html"><a href="flow.html#apply-family"><i class="fa fa-check"></i><b>5.4.6</b> apply family</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="purrr.html"><a href="purrr.html"><i class="fa fa-check"></i><b>5.5</b> purrr</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="purrr.html"><a href="purrr.html#why-map"><i class="fa fa-check"></i><b>5.5.1</b> Why map?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="map2.html"><a href="map2.html"><i class="fa fa-check"></i><b>5.6</b> Automate 2 or 2+ tasks</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="map2.html"><a href="map2.html#objectives-2"><i class="fa fa-check"></i><b>5.6.1</b> Objectives</a></li>
<li class="chapter" data-level="5.6.2" data-path="map2.html"><a href="map2.html#problem"><i class="fa fa-check"></i><b>5.6.2</b> Problem</a></li>
<li class="chapter" data-level="5.6.3" data-path="map2.html"><a href="map2.html#for-loop-1"><i class="fa fa-check"></i><b>5.6.3</b> For loop</a></li>
<li class="chapter" data-level="5.6.4" data-path="map2.html"><a href="map2.html#map2-pmap"><i class="fa fa-check"></i><b>5.6.4</b> map2 &amp; pmap</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="glue.html"><a href="glue.html"><i class="fa fa-check"></i><b>5.7</b> Automate plotting</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="glue.html"><a href="glue.html#objective"><i class="fa fa-check"></i><b>5.7.1</b> Objective</a></li>
<li class="chapter" data-level="5.7.2" data-path="glue.html"><a href="glue.html#problem-1"><i class="fa fa-check"></i><b>5.7.2</b> Problem</a></li>
<li class="chapter" data-level="5.7.3" data-path="glue.html"><a href="glue.html#solution"><i class="fa fa-check"></i><b>5.7.3</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="reduce.html"><a href="reduce.html"><i class="fa fa-check"></i><b>5.8</b> Automate joining</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="reduce.html"><a href="reduce.html#objective-1"><i class="fa fa-check"></i><b>5.8.1</b> Objective</a></li>
<li class="chapter" data-level="5.8.2" data-path="reduce.html"><a href="reduce.html#problem-2"><i class="fa fa-check"></i><b>5.8.2</b> Problem</a></li>
<li class="chapter" data-level="5.8.3" data-path="reduce.html"><a href="reduce.html#copy-and-paste"><i class="fa fa-check"></i><b>5.8.3</b> Copy and paste</a></li>
<li class="chapter" data-level="5.8.4" data-path="reduce.html"><a href="reduce.html#reduce-1"><i class="fa fa-check"></i><b>5.8.4</b> reduce</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="speed.html"><a href="speed.html"><i class="fa fa-check"></i><b>5.9</b> Make automation slower or faster</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="speed.html"><a href="speed.html#objectives-3"><i class="fa fa-check"></i><b>5.9.1</b> Objectives</a></li>
<li class="chapter" data-level="5.9.2" data-path="speed.html"><a href="speed.html#how-to-make-automation-slower"><i class="fa fa-check"></i><b>5.9.2</b> How to Make Automation Slower</a></li>
<li class="chapter" data-level="5.9.3" data-path="speed.html"><a href="speed.html#how-to-make-automation-faster"><i class="fa fa-check"></i><b>5.9.3</b> How to Make Automation Faster</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="robustness.html"><a href="robustness.html"><i class="fa fa-check"></i><b>5.10</b> Make error handling easier</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="robustness.html"><a href="robustness.html#learning-objective"><i class="fa fa-check"></i><b>5.10.1</b> Learning objective</a></li>
<li class="chapter" data-level="5.10.2" data-path="robustness.html"><a href="robustness.html#solution-1"><i class="fa fa-check"></i><b>5.10.2</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="products.html"><a href="products.html"><i class="fa fa-check"></i><b>6</b> Developing data products</a>
<ul>
<li class="chapter" data-level="6.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html"><i class="fa fa-check"></i><b>6.1</b> Developing R packages</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#the-big-picture-7"><i class="fa fa-check"></i><b>6.1.1</b> The Big Picture</a></li>
<li class="chapter" data-level="6.1.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#workflow"><i class="fa fa-check"></i><b>6.1.2</b> Workflow</a></li>
<li class="chapter" data-level="6.1.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#required-components"><i class="fa fa-check"></i><b>6.1.3</b> Required Components</a></li>
<li class="chapter" data-level="6.1.4" data-path="developing-r-packages.html"><a href="developing-r-packages.html#optional-components"><i class="fa fa-check"></i><b>6.1.4</b> Optional Components</a></li>
<li class="chapter" data-level="6.1.5" data-path="developing-r-packages.html"><a href="developing-r-packages.html#building-an-r-package"><i class="fa fa-check"></i><b>6.1.5</b> Building an R package</a></li>
<li class="chapter" data-level="6.1.6" data-path="developing-r-packages.html"><a href="developing-r-packages.html#distributing-an-r-package"><i class="fa fa-check"></i><b>6.1.6</b> Distributing an R package</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="developing-shiny-apps.html"><a href="developing-shiny-apps.html"><i class="fa fa-check"></i><b>6.2</b> Developing Shiny apps</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="developing-shiny-apps.html"><a href="developing-shiny-apps.html#workflow-1"><i class="fa fa-check"></i><b>6.2.1</b> Workflow</a></li>
<li class="chapter" data-level="6.2.2" data-path="developing-shiny-apps.html"><a href="developing-shiny-apps.html#app.r"><i class="fa fa-check"></i><b>6.2.2</b> app.r</a></li>
<li class="chapter" data-level="6.2.3" data-path="developing-shiny-apps.html"><a href="developing-shiny-apps.html#deployment"><i class="fa fa-check"></i><b>6.2.3</b> Deployment</a></li>
<li class="chapter" data-level="6.2.4" data-path="developing-shiny-apps.html"><a href="developing-shiny-apps.html#references-3"><i class="fa fa-check"></i><b>6.2.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="other-useful-data-products.html"><a href="other-useful-data-products.html"><i class="fa fa-check"></i><b>6.3</b> Other useful data products</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="semi_structured_data.html"><a href="semi_structured_data.html"><i class="fa fa-check"></i><b>7</b> Semi-structured data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="setup-4.html"><a href="setup-4.html"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="the-big-picture-8.html"><a href="the-big-picture-8.html"><i class="fa fa-check"></i><b>7.2</b> The Big Picture</a></li>
<li class="chapter" data-level="7.3" data-path="what-is-semi-structured-data.html"><a href="what-is-semi-structured-data.html"><i class="fa fa-check"></i><b>7.3</b> What is semi-structured data?</a></li>
<li class="chapter" data-level="7.4" data-path="workflow-2.html"><a href="workflow-2.html"><i class="fa fa-check"></i><b>7.4</b> Workflow</a></li>
<li class="chapter" data-level="7.5" data-path="htmlcss-web-scraping.html"><a href="htmlcss-web-scraping.html"><i class="fa fa-check"></i><b>7.5</b> HTML/CSS: web scraping</a></li>
<li class="chapter" data-level="7.6" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html"><i class="fa fa-check"></i><b>7.6</b> XML/JSON: government database/social media scraping</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#governemnt-database-xml"><i class="fa fa-check"></i><b>7.6.1</b> Governemnt database (XML)</a></li>
<li class="chapter" data-level="7.6.2" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#social-media-api-json"><i class="fa fa-check"></i><b>7.6.2</b> Social media API (JSON)</a></li>
<li class="chapter" data-level="7.6.3" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#next-steps"><i class="fa fa-check"></i><b>7.6.3</b> Next steps</a></li>
<li class="chapter" data-level="7.6.4" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#rtweet"><i class="fa fa-check"></i><b>7.6.4</b> rtweet</a></li>
<li class="chapter" data-level="7.6.5" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#hydrating"><i class="fa fa-check"></i><b>7.6.5</b> Hydrating</a></li>
<li class="chapter" data-level="7.6.6" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#parsing-json"><i class="fa fa-check"></i><b>7.6.6</b> Parsing JSON</a></li>
<li class="chapter" data-level="7.6.7" data-path="xmljson-government-databasesocial-media-scraping.html"><a href="xmljson-government-databasesocial-media-scraping.html#getting-api-data-from-scratch"><i class="fa fa-check"></i><b>7.6.7</b> Getting API data from scratch</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="machine_learning.html"><a href="machine_learning.html"><i class="fa fa-check"></i><b>8</b> High-dimensional data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="the-big-picture-9.html"><a href="the-big-picture-9.html"><i class="fa fa-check"></i><b>8.1</b> The Big Picture</a></li>
<li class="chapter" data-level="8.2" data-path="dataset.html"><a href="dataset.html"><i class="fa fa-check"></i><b>8.2</b> Dataset</a></li>
<li class="chapter" data-level="8.3" data-path="workflow-3.html"><a href="workflow-3.html"><i class="fa fa-check"></i><b>8.3</b> Workflow</a></li>
<li class="chapter" data-level="8.4" data-path="tidymodels.html"><a href="tidymodels.html"><i class="fa fa-check"></i><b>8.4</b> tidymodels</a></li>
<li class="chapter" data-level="8.5" data-path="pre-processing.html"><a href="pre-processing.html"><i class="fa fa-check"></i><b>8.5</b> Pre-processing</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="pre-processing.html"><a href="pre-processing.html#regression-setup"><i class="fa fa-check"></i><b>8.5.1</b> Regression setup</a></li>
<li class="chapter" data-level="8.5.2" data-path="pre-processing.html"><a href="pre-processing.html#classification-setup"><i class="fa fa-check"></i><b>8.5.2</b> Classification setup</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>8.6</b> Supervised learning</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="supervised-learning.html"><a href="supervised-learning.html#ols-and-lasso"><i class="fa fa-check"></i><b>8.6.1</b> OLS and Lasso</a></li>
<li class="chapter" data-level="8.6.2" data-path="supervised-learning.html"><a href="supervised-learning.html#decision-tree"><i class="fa fa-check"></i><b>8.6.2</b> Decision tree</a></li>
<li class="chapter" data-level="8.6.3" data-path="supervised-learning.html"><a href="supervised-learning.html#bagging-random-forest"><i class="fa fa-check"></i><b>8.6.3</b> Bagging (Random forest)</a></li>
<li class="chapter" data-level="8.6.4" data-path="supervised-learning.html"><a href="supervised-learning.html#boosting-xgboost"><i class="fa fa-check"></i><b>8.6.4</b> Boosting (XGboost)</a></li>
<li class="chapter" data-level="8.6.5" data-path="supervised-learning.html"><a href="supervised-learning.html#stacking-superlearner"><i class="fa fa-check"></i><b>8.6.5</b> Stacking (SuperLearner)</a></li>
<li class="chapter" data-level="8.6.6" data-path="supervised-learning.html"><a href="supervised-learning.html#applications-2"><i class="fa fa-check"></i><b>8.6.6</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>8.7</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#dimension-reduction"><i class="fa fa-check"></i><b>8.7.1</b> Dimension reduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#topic-modeling"><i class="fa fa-check"></i><b>8.7.2</b> Topic modeling</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="references-4.html"><a href="references-4.html"><i class="fa fa-check"></i><b>8.8</b> References</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="references-4.html"><a href="references-4.html#books"><i class="fa fa-check"></i><b>8.8.1</b> Books</a></li>
<li class="chapter" data-level="8.8.2" data-path="references-4.html"><a href="references-4.html#lecture-slides"><i class="fa fa-check"></i><b>8.8.2</b> Lecture slides</a></li>
<li class="chapter" data-level="8.8.3" data-path="references-4.html"><a href="references-4.html#blog-posts"><i class="fa fa-check"></i><b>8.8.3</b> Blog posts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big_data.html"><a href="big_data.html"><i class="fa fa-check"></i><b>9</b> Big data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="the-big-picture-10.html"><a href="the-big-picture-10.html"><i class="fa fa-check"></i><b>9.1</b> The Big Picture</a></li>
<li class="chapter" data-level="9.2" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>9.2</b> SQL</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="sql.html"><a href="sql.html#learning-objectives"><i class="fa fa-check"></i><b>9.2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2.2" data-path="sql.html"><a href="sql.html#sql-and-r"><i class="fa fa-check"></i><b>9.2.2</b> SQL and R</a></li>
<li class="chapter" data-level="9.2.3" data-path="sql.html"><a href="sql.html#setup-7"><i class="fa fa-check"></i><b>9.2.3</b> Setup</a></li>
<li class="chapter" data-level="9.2.4" data-path="sql.html"><a href="sql.html#packages-1"><i class="fa fa-check"></i><b>9.2.4</b> Packages</a></li>
<li class="chapter" data-level="9.2.5" data-path="sql.html"><a href="sql.html#nyc-flights-data"><i class="fa fa-check"></i><b>9.2.5</b> NYC flights data</a></li>
<li class="chapter" data-level="9.2.6" data-path="sql.html"><a href="sql.html#workflow-4"><i class="fa fa-check"></i><b>9.2.6</b> Workflow</a></li>
<li class="chapter" data-level="9.2.7" data-path="sql.html"><a href="sql.html#things-we-didnt-cover"><i class="fa fa-check"></i><b>9.2.7</b> Things we didn’t cover</a></li>
<li class="chapter" data-level="9.2.8" data-path="sql.html"><a href="sql.html#references-5"><i class="fa fa-check"></i><b>9.2.8</b> References</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jaeyk/PS239T" target="_blank">
  Published with <code>{bookdown}</code></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Thinking for Social Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="supervised-learning" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Supervised learning<a href="supervised-learning.html#supervised-learning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>x -&gt; f - &gt; y (defined)</p>
<div id="ols-and-lasso" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> OLS and Lasso<a href="supervised-learning.html#ols-and-lasso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip" class="section level4 hasAnchor" number="8.6.1.1">
<h4><span class="header-section-number">8.6.1.1</span> parsnip<a href="supervised-learning.html#parsnip" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build models (<code>parsnip</code>)</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="supervised-learning.html#cb1125-1" tabindex="-1"></a><span class="co"># OLS spec</span></span>
<span id="cb1125-2"><a href="supervised-learning.html#cb1125-2" tabindex="-1"></a>ols_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="co"># Specify a model</span></span>
<span id="cb1125-3"><a href="supervised-learning.html#cb1125-3" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># Specify an engine: lm, glmnet, stan, keras, spark</span></span>
<span id="cb1125-4"><a href="supervised-learning.html#cb1125-4" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="co"># Declare a mode: regression or classification</span></span></code></pre></div>
<div class="float">
<img src="http://ethen8181.github.io/machine-learning/regularization/images/lasso_ridge_coefficients.png" alt="Source: http://ethen8181.github.io" />
<div class="figcaption">Source: <a href="http://ethen8181.github.io" class="uri">http://ethen8181.github.io</a></div>
</div>
<p>Lasso is one of the regularization techniques along with ridge and elastic-net.</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="supervised-learning.html#cb1126-1" tabindex="-1"></a><span class="co"># Lasso spec</span></span>
<span id="cb1126-2"><a href="supervised-learning.html#cb1126-2" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb1126-3"><a href="supervised-learning.html#cb1126-3" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fl">0.1</span>, <span class="co"># tuning hyperparameter</span></span>
<span id="cb1126-4"><a href="supervised-learning.html#cb1126-4" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="dv">1</span></span>
<span id="cb1126-5"><a href="supervised-learning.html#cb1126-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1126-6"><a href="supervised-learning.html#cb1126-6" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1126-7"><a href="supervised-learning.html#cb1126-7" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1126-8"><a href="supervised-learning.html#cb1126-8" tabindex="-1"></a></span>
<span id="cb1126-9"><a href="supervised-learning.html#cb1126-9" tabindex="-1"></a><span class="co"># If you don&#39;t understand parsnip arguments</span></span>
<span id="cb1126-10"><a href="supervised-learning.html#cb1126-10" tabindex="-1"></a>lasso_spec <span class="sc">%&gt;%</span> <span class="fu">translate</span>() <span class="co"># See the documentation</span></span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.1
##   mixture = 1
## 
## Computational engine: glmnet 
## 
## Model fit template:
## glmnet::glmnet(x = missing_arg(), y = missing_arg(), weights = missing_arg(), 
##     alpha = 1, family = &quot;gaussian&quot;)</code></pre>
<ul>
<li>Fit models</li>
</ul>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="supervised-learning.html#cb1128-1" tabindex="-1"></a>ols_fit <span class="ot">&lt;-</span> ols_spec <span class="sc">%&gt;%</span></span>
<span id="cb1128-2"><a href="supervised-learning.html#cb1128-2" tabindex="-1"></a>  <span class="fu">fit_xy</span>(<span class="at">x =</span> train_x_reg, <span class="at">y =</span> train_y_reg)</span>
<span id="cb1128-3"><a href="supervised-learning.html#cb1128-3" tabindex="-1"></a><span class="co"># fit(train_y_reg ~ ., train_x_reg) # When you data are not preprocessed</span></span>
<span id="cb1128-4"><a href="supervised-learning.html#cb1128-4" tabindex="-1"></a></span>
<span id="cb1128-5"><a href="supervised-learning.html#cb1128-5" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> lasso_spec <span class="sc">%&gt;%</span></span>
<span id="cb1128-6"><a href="supervised-learning.html#cb1128-6" tabindex="-1"></a>  <span class="fu">fit_xy</span>(<span class="at">x =</span> train_x_reg, <span class="at">y =</span> train_y_reg)</span></code></pre></div>
</div>
<div id="yardstick" class="section level4 hasAnchor" number="8.6.1.2">
<h4><span class="header-section-number">8.6.1.2</span> yardstick<a href="supervised-learning.html#yardstick" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Visualize model fits</li>
</ul>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="supervised-learning.html#cb1129-1" tabindex="-1"></a><span class="fu">map2</span>(<span class="fu">list</span>(ols_fit, lasso_fit), <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), visualize_fit)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="supervised-learning.html#cb1132-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1132-2"><a href="supervised-learning.html#cb1132-2" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(rmse, mae, rsq)</span>
<span id="cb1132-3"><a href="supervised-learning.html#cb1132-3" tabindex="-1"></a></span>
<span id="cb1132-4"><a href="supervised-learning.html#cb1132-4" tabindex="-1"></a><span class="co"># Evaluate many models</span></span>
<span id="cb1132-5"><a href="supervised-learning.html#cb1132-5" tabindex="-1"></a>evals <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">list</span>(ols_fit, lasso_fit), evaluate_reg) <span class="sc">%&gt;%</span></span>
<span id="cb1132-6"><a href="supervised-learning.html#cb1132-6" tabindex="-1"></a>  <span class="fu">reduce</span>(bind_rows) <span class="sc">%&gt;%</span></span>
<span id="cb1132-7"><a href="supervised-learning.html#cb1132-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>))</span>
<span id="cb1132-8"><a href="supervised-learning.html#cb1132-8" tabindex="-1"></a></span>
<span id="cb1132-9"><a href="supervised-learning.html#cb1132-9" tabindex="-1"></a><span class="co"># Visualize the test results</span></span>
<span id="cb1132-10"><a href="supervised-learning.html#cb1132-10" tabindex="-1"></a>evals <span class="sc">%&gt;%</span></span>
<span id="cb1132-11"><a href="supervised-learning.html#cb1132-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(type, .estimate), <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb1132-12"><a href="supervised-learning.html#cb1132-12" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1132-13"><a href="supervised-learning.html#cb1132-13" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1132-14"><a href="supervised-learning.html#cb1132-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb1132-15"><a href="supervised-learning.html#cb1132-15" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Estimate&quot;</span></span>
<span id="cb1132-16"><a href="supervised-learning.html#cb1132-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1132-17"><a href="supervised-learning.html#cb1132-17" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-20-1.png" width="672" />
- For more information, read <a href="https://www.tmwr.org/">Tidy Modeling with R</a> by Max Kuhn and Julia Silge.</p>
</div>
<div id="tune" class="section level4 hasAnchor" number="8.6.1.3">
<h4><span class="header-section-number">8.6.1.3</span> tune<a href="supervised-learning.html#tune" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Hyper</strong>parameters are parameters that control the learning process.</p>
<div id="tune-ingredients" class="section level5 hasAnchor" number="8.6.1.3.1">
<h5><span class="header-section-number">8.6.1.3.1</span> tune ingredients<a href="supervised-learning.html#tune-ingredients" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Search space for hyperparameters</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Grid search: a grid of hyperparameters</p></li>
<li><p>Random search: random sample points from a bounded domain</p></li>
</ol>
<p><img src="https://www.programmersought.com/images/523/7e44435f20fe514c11ca0d930af8547b.png" /></p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="supervised-learning.html#cb1133-1" tabindex="-1"></a><span class="co"># tune() = placeholder</span></span>
<span id="cb1133-2"><a href="supervised-learning.html#cb1133-2" tabindex="-1"></a></span>
<span id="cb1133-3"><a href="supervised-learning.html#cb1133-3" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb1133-4"><a href="supervised-learning.html#cb1133-4" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="co"># tuning hyperparameter</span></span>
<span id="cb1133-5"><a href="supervised-learning.html#cb1133-5" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="dv">1</span></span>
<span id="cb1133-6"><a href="supervised-learning.html#cb1133-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1133-7"><a href="supervised-learning.html#cb1133-7" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1133-8"><a href="supervised-learning.html#cb1133-8" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1133-9"><a href="supervised-learning.html#cb1133-9" tabindex="-1"></a></span>
<span id="cb1133-10"><a href="supervised-learning.html#cb1133-10" tabindex="-1"></a>tune_spec</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="supervised-learning.html#cb1135-1" tabindex="-1"></a><span class="co"># penalty() searches 50 possible combinations</span></span>
<span id="cb1135-2"><a href="supervised-learning.html#cb1135-2" tabindex="-1"></a></span>
<span id="cb1135-3"><a href="supervised-learning.html#cb1135-3" tabindex="-1"></a>lambda_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="float">
<img src="https://www.googleapis.com/download/storage/v1/b/kaggle-forum-message-attachments/o/inbox%2F4788946%2F82b5a41b6693a313b246f02d79e972d5%2FK%20FOLD.png?generation=1608195745131795&amp;alt=media" alt="Source: Kaggle" />
<div class="figcaption">Source: Kaggle</div>
</div>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="supervised-learning.html#cb1136-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1136-2"><a href="supervised-learning.html#cb1136-2" tabindex="-1"></a></span>
<span id="cb1136-3"><a href="supervised-learning.html#cb1136-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1136-4"><a href="supervised-learning.html#cb1136-4" tabindex="-1"></a></span>
<span id="cb1136-5"><a href="supervised-learning.html#cb1136-5" tabindex="-1"></a>rec_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> train_y_reg)))</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow" class="section level5 hasAnchor" number="8.6.1.3.2">
<h5><span class="header-section-number">8.6.1.3.2</span> Add these elements to a workflow<a href="supervised-learning.html#add-these-elements-to-a-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="supervised-learning.html#cb1137-1" tabindex="-1"></a><span class="co"># Workflow</span></span>
<span id="cb1137-2"><a href="supervised-learning.html#cb1137-2" tabindex="-1"></a>rec_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1137-3"><a href="supervised-learning.html#cb1137-3" tabindex="-1"></a>  <span class="fu">add_model</span>(tune_spec) <span class="sc">%&gt;%</span></span>
<span id="cb1137-4"><a href="supervised-learning.html#cb1137-4" tabindex="-1"></a>  <span class="fu">add_formula</span>(age <span class="sc">~</span> .)</span></code></pre></div>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="supervised-learning.html#cb1138-1" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1138-2"><a href="supervised-learning.html#cb1138-2" tabindex="-1"></a>rec_res <span class="ot">&lt;-</span> rec_wf <span class="sc">%&gt;%</span></span>
<span id="cb1138-3"><a href="supervised-learning.html#cb1138-3" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1138-4"><a href="supervised-learning.html#cb1138-4" tabindex="-1"></a>    <span class="at">resamples =</span> rec_folds,</span>
<span id="cb1138-5"><a href="supervised-learning.html#cb1138-5" tabindex="-1"></a>    <span class="at">grid =</span> lambda_grid</span>
<span id="cb1138-6"><a href="supervised-learning.html#cb1138-6" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="visualize" class="section level5 hasAnchor" number="8.6.1.3.3">
<h5><span class="header-section-number">8.6.1.3.3</span> Visualize<a href="supervised-learning.html#visualize" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="supervised-learning.html#cb1139-1" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb1139-2"><a href="supervised-learning.html#cb1139-2" tabindex="-1"></a></span>
<span id="cb1139-3"><a href="supervised-learning.html#cb1139-3" tabindex="-1"></a>rec_res <span class="sc">%&gt;%</span></span>
<span id="cb1139-4"><a href="supervised-learning.html#cb1139-4" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1139-5"><a href="supervised-learning.html#cb1139-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">col =</span> .metric)) <span class="sc">+</span></span>
<span id="cb1139-6"><a href="supervised-learning.html#cb1139-6" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb1139-7"><a href="supervised-learning.html#cb1139-7" tabindex="-1"></a>    <span class="at">ymin =</span> mean <span class="sc">-</span> std_err,</span>
<span id="cb1139-8"><a href="supervised-learning.html#cb1139-8" tabindex="-1"></a>    <span class="at">ymax =</span> mean <span class="sc">+</span> std_err</span>
<span id="cb1139-9"><a href="supervised-learning.html#cb1139-9" tabindex="-1"></a>  ),</span>
<span id="cb1139-10"><a href="supervised-learning.html#cb1139-10" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb1139-11"><a href="supervised-learning.html#cb1139-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1139-12"><a href="supervised-learning.html#cb1139-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1139-13"><a href="supervised-learning.html#cb1139-13" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1139-14"><a href="supervised-learning.html#cb1139-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(lambda)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1139-15"><a href="supervised-learning.html#cb1139-15" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>),</span>
<span id="cb1139-16"><a href="supervised-learning.html#cb1139-16" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1139-17"><a href="supervised-learning.html#cb1139-17" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1139-18"><a href="supervised-learning.html#cb1139-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1139-19"><a href="supervised-learning.html#cb1139-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="select" class="section level5 hasAnchor" number="8.6.1.3.4">
<h5><span class="header-section-number">8.6.1.3.4</span> Select<a href="supervised-learning.html#select" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="supervised-learning.html#cb1141-1" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Removing existing preference.
## [conflicted] Will prefer dplyr::filter over any other package.</code></pre>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="supervised-learning.html#cb1143-1" tabindex="-1"></a>top_rmse <span class="ot">&lt;-</span> <span class="fu">show_best</span>(rec_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1143-2"><a href="supervised-learning.html#cb1143-2" tabindex="-1"></a></span>
<span id="cb1143-3"><a href="supervised-learning.html#cb1143-3" tabindex="-1"></a>best_rmse <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rec_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1143-4"><a href="supervised-learning.html#cb1143-4" tabindex="-1"></a></span>
<span id="cb1143-5"><a href="supervised-learning.html#cb1143-5" tabindex="-1"></a>best_rmse</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   penalty .config              
##     &lt;dbl&gt; &lt;chr&gt;                
## 1   0.391 Preprocessor1_Model48</code></pre>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="supervised-learning.html#cb1145-1" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&#39;The RMSE of the intiail model is</span></span>
<span id="cb1145-2"><a href="supervised-learning.html#cb1145-2" tabindex="-1"></a><span class="st">     {evals %&gt;%</span></span>
<span id="cb1145-3"><a href="supervised-learning.html#cb1145-3" tabindex="-1"></a><span class="st">  filter(type == &quot;Lasso&quot;, .metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1145-4"><a href="supervised-learning.html#cb1145-4" tabindex="-1"></a><span class="st">  select(.estimate) %&gt;%</span></span>
<span id="cb1145-5"><a href="supervised-learning.html#cb1145-5" tabindex="-1"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the intiail model is
##    7.83</code></pre>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="supervised-learning.html#cb1147-1" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&#39;The RMSE of the tuned model is {rec_res %&gt;%</span></span>
<span id="cb1147-2"><a href="supervised-learning.html#cb1147-2" tabindex="-1"></a><span class="st">  collect_metrics() %&gt;%</span></span>
<span id="cb1147-3"><a href="supervised-learning.html#cb1147-3" tabindex="-1"></a><span class="st">  filter(.metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1147-4"><a href="supervised-learning.html#cb1147-4" tabindex="-1"></a><span class="st">  arrange(mean) %&gt;%</span></span>
<span id="cb1147-5"><a href="supervised-learning.html#cb1147-5" tabindex="-1"></a><span class="st">  dplyr::slice(1) %&gt;%</span></span>
<span id="cb1147-6"><a href="supervised-learning.html#cb1147-6" tabindex="-1"></a><span class="st">  select(mean) %&gt;%</span></span>
<span id="cb1147-7"><a href="supervised-learning.html#cb1147-7" tabindex="-1"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the tuned model is 7.55</code></pre>
<ul>
<li>Finalize your workflow and visualize <a href="https://koalaverse.github.io/vip/articles/vip.html">variable importance</a></li>
</ul>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="supervised-learning.html#cb1149-1" tabindex="-1"></a>finalize_lasso <span class="ot">&lt;-</span> rec_wf <span class="sc">%&gt;%</span></span>
<span id="cb1149-2"><a href="supervised-learning.html#cb1149-2" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_rmse)</span>
<span id="cb1149-3"><a href="supervised-learning.html#cb1149-3" tabindex="-1"></a></span>
<span id="cb1149-4"><a href="supervised-learning.html#cb1149-4" tabindex="-1"></a>finalize_lasso <span class="sc">%&gt;%</span></span>
<span id="cb1149-5"><a href="supervised-learning.html#cb1149-5" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> train_y_reg))) <span class="sc">%&gt;%</span></span>
<span id="cb1149-6"><a href="supervised-learning.html#cb1149-6" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1149-7"><a href="supervised-learning.html#cb1149-7" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<pre><code>## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
## ℹ Please use `extract_fit_parsnip()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="test-fit" class="section level5 hasAnchor" number="8.6.1.3.5">
<h5><span class="header-section-number">8.6.1.3.5</span> Test fit<a href="supervised-learning.html#test-fit" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="supervised-learning.html#cb1151-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_lasso <span class="sc">%&gt;%</span></span>
<span id="cb1151-2"><a href="supervised-learning.html#cb1151-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> test_y_reg)))</span>
<span id="cb1151-3"><a href="supervised-learning.html#cb1151-3" tabindex="-1"></a></span>
<span id="cb1151-4"><a href="supervised-learning.html#cb1151-4" tabindex="-1"></a><span class="fu">evaluate_reg</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       7.04 
## 2 mae     standard       5.78 
## 3 rsq     standard       0.411</code></pre>
</div>
</div>
</div>
<div id="decision-tree" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Decision tree<a href="supervised-learning.html#decision-tree" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip-1" class="section level4 hasAnchor" number="8.6.2.1">
<h4><span class="header-section-number">8.6.2.1</span> parsnip<a href="supervised-learning.html#parsnip-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="supervised-learning.html#cb1153-1" tabindex="-1"></a><span class="co"># workflow</span></span>
<span id="cb1153-2"><a href="supervised-learning.html#cb1153-2" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> <span class="fu">add_formula</span>(target <span class="sc">~</span> .)</span>
<span id="cb1153-3"><a href="supervised-learning.html#cb1153-3" tabindex="-1"></a></span>
<span id="cb1153-4"><a href="supervised-learning.html#cb1153-4" tabindex="-1"></a><span class="co"># spec</span></span>
<span id="cb1153-5"><a href="supervised-learning.html#cb1153-5" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb1153-6"><a href="supervised-learning.html#cb1153-6" tabindex="-1"></a></span>
<span id="cb1153-7"><a href="supervised-learning.html#cb1153-7" tabindex="-1"></a>  <span class="co"># Mode</span></span>
<span id="cb1153-8"><a href="supervised-learning.html#cb1153-8" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1153-9"><a href="supervised-learning.html#cb1153-9" tabindex="-1"></a></span>
<span id="cb1153-10"><a href="supervised-learning.html#cb1153-10" tabindex="-1"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1153-11"><a href="supervised-learning.html#cb1153-11" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="cn">NULL</span>,</span>
<span id="cb1153-12"><a href="supervised-learning.html#cb1153-12" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="cn">NULL</span></span>
<span id="cb1153-13"><a href="supervised-learning.html#cb1153-13" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1153-14"><a href="supervised-learning.html#cb1153-14" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="co"># rpart, c5.0, spark</span></span>
<span id="cb1153-15"><a href="supervised-learning.html#cb1153-15" tabindex="-1"></a></span>
<span id="cb1153-16"><a href="supervised-learning.html#cb1153-16" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">add_model</span>(tree_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="supervised-learning.html#cb1154-1" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-1" class="section level4 hasAnchor" number="8.6.2.2">
<h4><span class="header-section-number">8.6.2.2</span> yardstick<a href="supervised-learning.html#yardstick-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Let’s formally test prediction performance.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Confusion matrix</li>
</ol>
<p>A confusion matrix is often used to describe the performance of a classification model. The below example is based on a binary classification model.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Predicted: YES</th>
<th>Predicted: NO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: YES</strong></td>
<td>True positive (TP)</td>
<td>False negative (FN)</td>
</tr>
<tr class="even">
<td><strong>Actual: NO</strong></td>
<td>False positive (FP)</td>
<td>True negative (TN)</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Metrics</li>
</ol>
<ul>
<li><p><code>accuracy</code>: The proportion of the data predicted correctly (<span class="math inline">\(\frac{TP + TN}{total}\)</span>). 1 - accuracy = misclassification rate.</p></li>
<li><p><code>precision</code>: Positive predictive value. <em>When the model predicts yes, how correct is it?</em> (<span class="math inline">\(\frac{TP}{TP + FP}\)</span>)</p></li>
<li><p><code>recall</code> (sensitivity): True positive rate (e.g., healthy people healthy). <em>When the actual value is yes, how often does the model predict yes?</em> (<span class="math inline">\(\frac{TP}{TP + FN}\)</span>)</p></li>
<li><p><code>F-score</code>: A weighted average between precision and recall.</p></li>
<li><p><code>ROC Curve</code> (receiver operating characteristic curve): a plot that shows the relationship between true and false positive rates at different classification thresholds. y-axis indicates the true positive rate and x-axis indicates the false positive rate. What matters is the AUC (Area under the ROC Curve), which is a cumulative probability function of ranking a random “positive” - “negative” pair (for the probability of AUC, see <a href="https://www.alexejgossmann.com/auc/">this blog post</a>).</p></li>
</ul>
<div class="float">
<img src="https://developers.google.com/machine-learning/crash-course/images/ROCCurve.svg" alt="Source: Google Machine Learning Crash Course" />
<div class="figcaption">Source: Google Machine Learning Crash Course</div>
</div>
<ul>
<li>To learn more about other metrics, check out the yardstick package <a href="https://yardstick.tidymodels.org/reference/index.html">references</a>.</li>
</ul>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="supervised-learning.html#cb1155-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1155-2"><a href="supervised-learning.html#cb1155-2" tabindex="-1"></a></span>
<span id="cb1155-3"><a href="supervised-learning.html#cb1155-3" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1155-4"><a href="supervised-learning.html#cb1155-4" tabindex="-1"></a></span>
<span id="cb1155-5"><a href="supervised-learning.html#cb1155-5" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb1155-6"><a href="supervised-learning.html#cb1155-6" tabindex="-1"></a></span>
<span id="cb1155-7"><a href="supervised-learning.html#cb1155-7" tabindex="-1"></a>tree_fit_viz_metr <span class="ot">&lt;-</span> <span class="fu">visualize_class_eval</span>(tree_fit)</span>
<span id="cb1155-8"><a href="supervised-learning.html#cb1155-8" tabindex="-1"></a></span>
<span id="cb1155-9"><a href="supervised-learning.html#cb1155-9" tabindex="-1"></a>tree_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="supervised-learning.html#cb1156-1" tabindex="-1"></a>tree_fit_viz_mat <span class="ot">&lt;-</span> <span class="fu">visualize_class_conf</span>(tree_fit)</span>
<span id="cb1156-2"><a href="supervised-learning.html#cb1156-2" tabindex="-1"></a></span>
<span id="cb1156-3"><a href="supervised-learning.html#cb1156-3" tabindex="-1"></a>tree_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
</div>
<div id="tune-1" class="section level4 hasAnchor" number="8.6.2.3">
<h4><span class="header-section-number">8.6.2.3</span> tune<a href="supervised-learning.html#tune-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-1" class="section level5 hasAnchor" number="8.6.2.3.1">
<h5><span class="header-section-number">8.6.2.3.1</span> tune ingredients<a href="supervised-learning.html#tune-ingredients-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Decisions trees tend to overfit. We need to consider two things to reduce this problem: how to split and when to stop a tree.</p>
<ul>
<li><p><strong>complexity parameter</strong>: a high CP means a simple decision tree with few splits.</p></li>
<li><p><strong>tree_depth</strong></p></li>
</ul>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="supervised-learning.html#cb1157-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb1157-2"><a href="supervised-learning.html#cb1157-2" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="fu">tune</span>(), <span class="co"># how to split</span></span>
<span id="cb1157-3"><a href="supervised-learning.html#cb1157-3" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="co"># when to stop</span></span>
<span id="cb1157-4"><a href="supervised-learning.html#cb1157-4" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span></span>
<span id="cb1157-5"><a href="supervised-learning.html#cb1157-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1157-6"><a href="supervised-learning.html#cb1157-6" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>)</span>
<span id="cb1157-7"><a href="supervised-learning.html#cb1157-7" tabindex="-1"></a></span>
<span id="cb1157-8"><a href="supervised-learning.html#cb1157-8" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb1157-9"><a href="supervised-learning.html#cb1157-9" tabindex="-1"></a>  <span class="fu">tree_depth</span>(),</span>
<span id="cb1157-10"><a href="supervised-learning.html#cb1157-10" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb1157-11"><a href="supervised-learning.html#cb1157-11" tabindex="-1"></a>) <span class="co"># 2 hyperparameters -&gt; 5*5 = 25 combinations</span></span>
<span id="cb1157-12"><a href="supervised-learning.html#cb1157-12" tabindex="-1"></a></span>
<span id="cb1157-13"><a href="supervised-learning.html#cb1157-13" tabindex="-1"></a>tree_grid <span class="sc">%&gt;%</span></span>
<span id="cb1157-14"><a href="supervised-learning.html#cb1157-14" tabindex="-1"></a>  <span class="fu">count</span>(tree_depth)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   tree_depth     n
##        &lt;int&gt; &lt;int&gt;
## 1          1     5
## 2          4     5
## 3          8     5
## 4         11     5
## 5         15     5</code></pre>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="supervised-learning.html#cb1159-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1159-2"><a href="supervised-learning.html#cb1159-2" tabindex="-1"></a></span>
<span id="cb1159-3"><a href="supervised-learning.html#cb1159-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1159-4"><a href="supervised-learning.html#cb1159-4" tabindex="-1"></a></span>
<span id="cb1159-5"><a href="supervised-learning.html#cb1159-5" tabindex="-1"></a>tree_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1159-6"><a href="supervised-learning.html#cb1159-6" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1159-7"><a href="supervised-learning.html#cb1159-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-1" class="section level5 hasAnchor" number="8.6.2.3.2">
<h5><span class="header-section-number">8.6.2.3.2</span> Add these elements to a workflow<a href="supervised-learning.html#add-these-elements-to-a-workflow-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="supervised-learning.html#cb1160-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1160-2"><a href="supervised-learning.html#cb1160-2" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1160-3"><a href="supervised-learning.html#cb1160-3" tabindex="-1"></a></span>
<span id="cb1160-4"><a href="supervised-learning.html#cb1160-4" tabindex="-1"></a><span class="co"># Determine the number of cores</span></span>
<span id="cb1160-5"><a href="supervised-learning.html#cb1160-5" tabindex="-1"></a>no_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1160-6"><a href="supervised-learning.html#cb1160-6" tabindex="-1"></a></span>
<span id="cb1160-7"><a href="supervised-learning.html#cb1160-7" tabindex="-1"></a><span class="co"># Initiate</span></span>
<span id="cb1160-8"><a href="supervised-learning.html#cb1160-8" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(no_cores)</span>
<span id="cb1160-9"><a href="supervised-learning.html#cb1160-9" tabindex="-1"></a></span>
<span id="cb1160-10"><a href="supervised-learning.html#cb1160-10" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb1160-11"><a href="supervised-learning.html#cb1160-11" tabindex="-1"></a></span>
<span id="cb1160-12"><a href="supervised-learning.html#cb1160-12" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1160-13"><a href="supervised-learning.html#cb1160-13" tabindex="-1"></a>tree_res <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span></span>
<span id="cb1160-14"><a href="supervised-learning.html#cb1160-14" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1160-15"><a href="supervised-learning.html#cb1160-15" tabindex="-1"></a>    <span class="at">resamples =</span> tree_folds,</span>
<span id="cb1160-16"><a href="supervised-learning.html#cb1160-16" tabindex="-1"></a>    <span class="at">grid =</span> tree_grid,</span>
<span id="cb1160-17"><a href="supervised-learning.html#cb1160-17" tabindex="-1"></a>    <span class="at">metrics =</span> metrics</span>
<span id="cb1160-18"><a href="supervised-learning.html#cb1160-18" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: ! tune detected a parallel backend registered with foreach but no backend registered with future.
## ℹ Support for parallel processing with foreach was soft-deprecated in tune 1.2.1.
## ℹ See ?parallelism (`?tune::parallelism()`) to learn more.</code></pre>
</div>
<div id="visualize-1" class="section level5 hasAnchor" number="8.6.2.3.3">
<h5><span class="header-section-number">8.6.2.3.3</span> Visualize<a href="supervised-learning.html#visualize-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>The following plot draws on the <a href="https://www.tidymodels.org/start/tuning/">vignette</a> of the tidymodels package.</li>
</ul>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="supervised-learning.html#cb1162-1" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span></span>
<span id="cb1162-2"><a href="supervised-learning.html#cb1162-2" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1162-3"><a href="supervised-learning.html#cb1162-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tree_depth =</span> <span class="fu">factor</span>(tree_depth)) <span class="sc">%&gt;%</span></span>
<span id="cb1162-4"><a href="supervised-learning.html#cb1162-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cost_complexity, mean, <span class="at">col =</span> .metric)) <span class="sc">+</span></span>
<span id="cb1162-5"><a href="supervised-learning.html#cb1162-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1162-6"><a href="supervised-learning.html#cb1162-6" tabindex="-1"></a>  <span class="co"># Subplots</span></span>
<span id="cb1162-7"><a href="supervised-learning.html#cb1162-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>tree_depth,</span>
<span id="cb1162-8"><a href="supervised-learning.html#cb1162-8" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1162-9"><a href="supervised-learning.html#cb1162-9" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1162-10"><a href="supervised-learning.html#cb1162-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1162-11"><a href="supervised-learning.html#cb1162-11" tabindex="-1"></a>  <span class="co"># Log scale x</span></span>
<span id="cb1162-12"><a href="supervised-learning.html#cb1162-12" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb1162-13"><a href="supervised-learning.html#cb1162-13" tabindex="-1"></a>  <span class="co"># Discrete color scale</span></span>
<span id="cb1162-14"><a href="supervised-learning.html#cb1162-14" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1162-15"><a href="supervised-learning.html#cb1162-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1162-16"><a href="supervised-learning.html#cb1162-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Cost complexity&quot;</span>,</span>
<span id="cb1162-17"><a href="supervised-learning.html#cb1162-17" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;Tree depth&quot;</span>,</span>
<span id="cb1162-18"><a href="supervised-learning.html#cb1162-18" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb1162-19"><a href="supervised-learning.html#cb1162-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1162-20"><a href="supervised-learning.html#cb1162-20" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="select-1" class="section level5 hasAnchor" number="8.6.2.3.4">
<h5><span class="header-section-number">8.6.2.3.4</span> Select<a href="supervised-learning.html#select-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="supervised-learning.html#cb1163-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1163-2"><a href="supervised-learning.html#cb1163-2" tabindex="-1"></a>best_tree <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tree_res, <span class="at">metric =</span> <span class="st">&quot;recall&quot;</span>)</span>
<span id="cb1163-3"><a href="supervised-learning.html#cb1163-3" tabindex="-1"></a></span>
<span id="cb1163-4"><a href="supervised-learning.html#cb1163-4" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1163-5"><a href="supervised-learning.html#cb1163-5" tabindex="-1"></a>finalize_tree <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span></span>
<span id="cb1163-6"><a href="supervised-learning.html#cb1163-6" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="supervised-learning.html#cb1164-1" tabindex="-1"></a>tree_fit_tuned <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1164-2"><a href="supervised-learning.html#cb1164-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1164-3"><a href="supervised-learning.html#cb1164-3" tabindex="-1"></a></span>
<span id="cb1164-4"><a href="supervised-learning.html#cb1164-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1164-5"><a href="supervised-learning.html#cb1164-5" tabindex="-1"></a>(tree_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(tree_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="supervised-learning.html#cb1165-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1165-2"><a href="supervised-learning.html#cb1165-2" tabindex="-1"></a>(tree_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(tree_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="supervised-learning.html#cb1166-1" tabindex="-1"></a>tree_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1166-2"><a href="supervised-learning.html#cb1166-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1166-3"><a href="supervised-learning.html#cb1166-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="test-fit-1" class="section level5 hasAnchor" number="8.6.2.3.5">
<h5><span class="header-section-number">8.6.2.3.5</span> Test fit<a href="supervised-learning.html#test-fit-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="supervised-learning.html#cb1167-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1167-2"><a href="supervised-learning.html#cb1167-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1167-3"><a href="supervised-learning.html#cb1167-3" tabindex="-1"></a></span>
<span id="cb1167-4"><a href="supervised-learning.html#cb1167-4" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.761
## 2 precision binary         0.778
## 3 recall    binary         0.667</code></pre>
<p>In the next subsection, we will learn variants of ensemble models that improve decision tree models by putting models together.</p>
</div>
</div>
</div>
<div id="bagging-random-forest" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Bagging (Random forest)<a href="supervised-learning.html#bagging-random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Key idea applied across all ensemble models (bagging, boosting, and stacking):
single learner -&gt; N learners (N &gt; 1)</p>
<p>Many learners could perform better than a single learner as this approach reduces the <strong>variance</strong> of a single estimate and provides more stability.</p>
<p>Here we focus on the difference between bagging and boosting. In short, boosting may reduce bias while increasing variance. On the other hand, bagging may reduce variance but has nothing to do with bias. Please check out <a href="https://quantdare.com/what-is-the-difference-between-bagging-and-boosting/">What is the difference between Bagging and Boosting?</a> by aporras.</p>
<p><strong>bagging</strong></p>
<ul>
<li><p>Data: Training data will be randomly sampled with replacement (bootstrapping samples + drawing random <strong>subsets</strong> of features for training individual trees)</p></li>
<li><p>Learning: Building models in parallel (independently)</p></li>
<li><p>Prediction: Simple average of the estimated responses (majority vote system)</p></li>
</ul>
<div class="float">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/bagging.png" alt="From Sebastian Raschka’s blog" />
<div class="figcaption">From Sebastian Raschka’s blog</div>
</div>
<p><strong>boosting</strong></p>
<ul>
<li><p>Data: Weighted training data will be random sampled</p></li>
<li><p>Learning: Building models sequentially (mispredicted cases would receive more weights)</p></li>
<li><p>Prediction: Weighted average of the estimated responses</p></li>
</ul>
<div class="float">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/boosting.png" alt="From Sebastian Raschka’s blog" />
<div class="figcaption">From Sebastian Raschka’s blog</div>
</div>
<div id="parsnip-2" class="section level4 hasAnchor" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> parsnip<a href="supervised-learning.html#parsnip-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="supervised-learning.html#cb1169-1" tabindex="-1"></a><span class="co"># workflow</span></span>
<span id="cb1169-2"><a href="supervised-learning.html#cb1169-2" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> <span class="fu">add_formula</span>(target <span class="sc">~</span> .)</span>
<span id="cb1169-3"><a href="supervised-learning.html#cb1169-3" tabindex="-1"></a></span>
<span id="cb1169-4"><a href="supervised-learning.html#cb1169-4" tabindex="-1"></a><span class="co"># spec</span></span>
<span id="cb1169-5"><a href="supervised-learning.html#cb1169-5" tabindex="-1"></a>rand_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb1169-6"><a href="supervised-learning.html#cb1169-6" tabindex="-1"></a></span>
<span id="cb1169-7"><a href="supervised-learning.html#cb1169-7" tabindex="-1"></a>  <span class="co"># Mode</span></span>
<span id="cb1169-8"><a href="supervised-learning.html#cb1169-8" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1169-9"><a href="supervised-learning.html#cb1169-9" tabindex="-1"></a></span>
<span id="cb1169-10"><a href="supervised-learning.html#cb1169-10" tabindex="-1"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1169-11"><a href="supervised-learning.html#cb1169-11" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="cn">NULL</span>, <span class="co"># The number of predictors to available for splitting at each node</span></span>
<span id="cb1169-12"><a href="supervised-learning.html#cb1169-12" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="cn">NULL</span>, <span class="co"># The minimum number of data points needed to keep splitting nodes</span></span>
<span id="cb1169-13"><a href="supervised-learning.html#cb1169-13" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">500</span></span>
<span id="cb1169-14"><a href="supervised-learning.html#cb1169-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># The number of trees</span></span>
<span id="cb1169-15"><a href="supervised-learning.html#cb1169-15" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1169-16"><a href="supervised-learning.html#cb1169-16" tabindex="-1"></a>    <span class="co"># We want the importance of predictors to be assessed.</span></span>
<span id="cb1169-17"><a href="supervised-learning.html#cb1169-17" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1169-18"><a href="supervised-learning.html#cb1169-18" tabindex="-1"></a>    <span class="at">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1169-19"><a href="supervised-learning.html#cb1169-19" tabindex="-1"></a>  )</span>
<span id="cb1169-20"><a href="supervised-learning.html#cb1169-20" tabindex="-1"></a></span>
<span id="cb1169-21"><a href="supervised-learning.html#cb1169-21" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">add_model</span>(rand_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="supervised-learning.html#cb1170-1" tabindex="-1"></a>rand_fit <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-2" class="section level4 hasAnchor" number="8.6.3.2">
<h4><span class="header-section-number">8.6.3.2</span> yardstick<a href="supervised-learning.html#yardstick-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="supervised-learning.html#cb1171-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1171-2"><a href="supervised-learning.html#cb1171-2" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1171-3"><a href="supervised-learning.html#cb1171-3" tabindex="-1"></a></span>
<span id="cb1171-4"><a href="supervised-learning.html#cb1171-4" tabindex="-1"></a>rand_fit_viz_metr <span class="ot">&lt;-</span> <span class="fu">visualize_class_eval</span>(rand_fit)</span>
<span id="cb1171-5"><a href="supervised-learning.html#cb1171-5" tabindex="-1"></a></span>
<span id="cb1171-6"><a href="supervised-learning.html#cb1171-6" tabindex="-1"></a>rand_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="supervised-learning.html#cb1172-1" tabindex="-1"></a>rand_fit_viz_mat <span class="ot">&lt;-</span> <span class="fu">visualize_class_conf</span>(rand_fit)</span>
<span id="cb1172-2"><a href="supervised-learning.html#cb1172-2" tabindex="-1"></a></span>
<span id="cb1172-3"><a href="supervised-learning.html#cb1172-3" tabindex="-1"></a>rand_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="tune-2" class="section level4 hasAnchor" number="8.6.3.3">
<h4><span class="header-section-number">8.6.3.3</span> tune<a href="supervised-learning.html#tune-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-2" class="section level5 hasAnchor" number="8.6.3.3.1">
<h5><span class="header-section-number">8.6.3.3.1</span> tune ingredients<a href="supervised-learning.html#tune-ingredients-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We focus on the following two hyperparameters:</p>
<ul>
<li><p><code>mtry</code>: The number of predictors available for splitting at each node.</p></li>
<li><p><code>min_n</code>: The minimum number of data points needed to keep splitting nodes.</p></li>
</ul>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="supervised-learning.html#cb1173-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span></span>
<span id="cb1173-2"><a href="supervised-learning.html#cb1173-2" tabindex="-1"></a>  <span class="fu">rand_forest</span>(</span>
<span id="cb1173-3"><a href="supervised-learning.html#cb1173-3" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1173-4"><a href="supervised-learning.html#cb1173-4" tabindex="-1"></a></span>
<span id="cb1173-5"><a href="supervised-learning.html#cb1173-5" tabindex="-1"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1173-6"><a href="supervised-learning.html#cb1173-6" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb1173-7"><a href="supervised-learning.html#cb1173-7" tabindex="-1"></a>    <span class="at">min_n =</span> <span class="fu">tune</span>()</span>
<span id="cb1173-8"><a href="supervised-learning.html#cb1173-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1173-9"><a href="supervised-learning.html#cb1173-9" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1173-10"><a href="supervised-learning.html#cb1173-10" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1173-11"><a href="supervised-learning.html#cb1173-11" tabindex="-1"></a>    <span class="at">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1173-12"><a href="supervised-learning.html#cb1173-12" tabindex="-1"></a>  )</span>
<span id="cb1173-13"><a href="supervised-learning.html#cb1173-13" tabindex="-1"></a></span>
<span id="cb1173-14"><a href="supervised-learning.html#cb1173-14" tabindex="-1"></a>rand_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb1173-15"><a href="supervised-learning.html#cb1173-15" tabindex="-1"></a>  <span class="fu">min_n</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)),</span>
<span id="cb1173-16"><a href="supervised-learning.html#cb1173-16" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb1173-17"><a href="supervised-learning.html#cb1173-17" tabindex="-1"></a>)</span>
<span id="cb1173-18"><a href="supervised-learning.html#cb1173-18" tabindex="-1"></a></span>
<span id="cb1173-19"><a href="supervised-learning.html#cb1173-19" tabindex="-1"></a>rand_grid <span class="sc">%&gt;%</span></span>
<span id="cb1173-20"><a href="supervised-learning.html#cb1173-20" tabindex="-1"></a>  <span class="fu">count</span>(min_n)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   min_n     n
##   &lt;int&gt; &lt;int&gt;
## 1     2     5
## 2     4     5
## 3     6     5
## 4     8     5
## 5    10     5</code></pre>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="supervised-learning.html#cb1175-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1175-2"><a href="supervised-learning.html#cb1175-2" tabindex="-1"></a></span>
<span id="cb1175-3"><a href="supervised-learning.html#cb1175-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1175-4"><a href="supervised-learning.html#cb1175-4" tabindex="-1"></a></span>
<span id="cb1175-5"><a href="supervised-learning.html#cb1175-5" tabindex="-1"></a>rand_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1175-6"><a href="supervised-learning.html#cb1175-6" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1175-7"><a href="supervised-learning.html#cb1175-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-2" class="section level5 hasAnchor" number="8.6.3.3.2">
<h5><span class="header-section-number">8.6.3.3.2</span> Add these elements to a workflow<a href="supervised-learning.html#add-these-elements-to-a-workflow-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="supervised-learning.html#cb1176-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1176-2"><a href="supervised-learning.html#cb1176-2" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1176-3"><a href="supervised-learning.html#cb1176-3" tabindex="-1"></a></span>
<span id="cb1176-4"><a href="supervised-learning.html#cb1176-4" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1176-5"><a href="supervised-learning.html#cb1176-5" tabindex="-1"></a>rand_res <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span></span>
<span id="cb1176-6"><a href="supervised-learning.html#cb1176-6" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1176-7"><a href="supervised-learning.html#cb1176-7" tabindex="-1"></a>    <span class="at">resamples =</span> rand_folds,</span>
<span id="cb1176-8"><a href="supervised-learning.html#cb1176-8" tabindex="-1"></a>    <span class="at">grid =</span> rand_grid,</span>
<span id="cb1176-9"><a href="supervised-learning.html#cb1176-9" tabindex="-1"></a>    <span class="at">metrics =</span> metrics</span>
<span id="cb1176-10"><a href="supervised-learning.html#cb1176-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: ! tune detected a parallel backend registered with foreach but no backend registered with future.
## ℹ Support for parallel processing with foreach was soft-deprecated in tune 1.2.1.
## ℹ See ?parallelism (`?tune::parallelism()`) to learn more.</code></pre>
</div>
<div id="visualize-2" class="section level5 hasAnchor" number="8.6.3.3.3">
<h5><span class="header-section-number">8.6.3.3.3</span> Visualize<a href="supervised-learning.html#visualize-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="supervised-learning.html#cb1178-1" tabindex="-1"></a>rand_res <span class="sc">%&gt;%</span></span>
<span id="cb1178-2"><a href="supervised-learning.html#cb1178-2" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1178-3"><a href="supervised-learning.html#cb1178-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_n =</span> <span class="fu">factor</span>(min_n)) <span class="sc">%&gt;%</span></span>
<span id="cb1178-4"><a href="supervised-learning.html#cb1178-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mtry, mean, <span class="at">color =</span> min_n)) <span class="sc">+</span></span>
<span id="cb1178-5"><a href="supervised-learning.html#cb1178-5" tabindex="-1"></a>  <span class="co"># Line + Point plot</span></span>
<span id="cb1178-6"><a href="supervised-learning.html#cb1178-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb1178-7"><a href="supervised-learning.html#cb1178-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1178-8"><a href="supervised-learning.html#cb1178-8" tabindex="-1"></a>  <span class="co"># Subplots</span></span>
<span id="cb1178-9"><a href="supervised-learning.html#cb1178-9" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric,</span>
<span id="cb1178-10"><a href="supervised-learning.html#cb1178-10" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1178-11"><a href="supervised-learning.html#cb1178-11" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1178-12"><a href="supervised-learning.html#cb1178-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1178-13"><a href="supervised-learning.html#cb1178-13" tabindex="-1"></a>  <span class="co"># Log scale x</span></span>
<span id="cb1178-14"><a href="supervised-learning.html#cb1178-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb1178-15"><a href="supervised-learning.html#cb1178-15" tabindex="-1"></a>  <span class="co"># Discrete color scale</span></span>
<span id="cb1178-16"><a href="supervised-learning.html#cb1178-16" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1178-17"><a href="supervised-learning.html#cb1178-17" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1178-18"><a href="supervised-learning.html#cb1178-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;The number of predictors to be sampled&quot;</span>,</span>
<span id="cb1178-19"><a href="supervised-learning.html#cb1178-19" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;The minimum number of data points needed for splitting&quot;</span>,</span>
<span id="cb1178-20"><a href="supervised-learning.html#cb1178-20" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb1178-21"><a href="supervised-learning.html#cb1178-21" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1178-22"><a href="supervised-learning.html#cb1178-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="supervised-learning.html#cb1179-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1179-2"><a href="supervised-learning.html#cb1179-2" tabindex="-1"></a>best_tree <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(rand_res, <span class="at">metric =</span> <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb1179-3"><a href="supervised-learning.html#cb1179-3" tabindex="-1"></a></span>
<span id="cb1179-4"><a href="supervised-learning.html#cb1179-4" tabindex="-1"></a>best_tree</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     1     6 Preprocessor1_Model11</code></pre>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="supervised-learning.html#cb1181-1" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1181-2"><a href="supervised-learning.html#cb1181-2" tabindex="-1"></a>finalize_tree <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span></span>
<span id="cb1181-3"><a href="supervised-learning.html#cb1181-3" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="supervised-learning.html#cb1182-1" tabindex="-1"></a>rand_fit_tuned <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1182-2"><a href="supervised-learning.html#cb1182-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1182-3"><a href="supervised-learning.html#cb1182-3" tabindex="-1"></a></span>
<span id="cb1182-4"><a href="supervised-learning.html#cb1182-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1182-5"><a href="supervised-learning.html#cb1182-5" tabindex="-1"></a>(rand_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(rand_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="supervised-learning.html#cb1183-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1183-2"><a href="supervised-learning.html#cb1183-2" tabindex="-1"></a>(rand_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(rand_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="supervised-learning.html#cb1184-1" tabindex="-1"></a>rand_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1184-2"><a href="supervised-learning.html#cb1184-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1184-3"><a href="supervised-learning.html#cb1184-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="test-fit-2" class="section level5 hasAnchor" number="8.6.3.3.4">
<h5><span class="header-section-number">8.6.3.3.4</span> Test fit<a href="supervised-learning.html#test-fit-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="supervised-learning.html#cb1185-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1185-2"><a href="supervised-learning.html#cb1185-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span></span>
<span id="cb1185-3"><a href="supervised-learning.html#cb1185-3" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1185-4"><a href="supervised-learning.html#cb1185-4" tabindex="-1"></a></span>
<span id="cb1185-5"><a href="supervised-learning.html#cb1185-5" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.902
## 2 precision binary         0.923
## 3 recall    binary         0.857</code></pre>
</div>
</div>
</div>
<div id="boosting-xgboost" class="section level3 hasAnchor" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Boosting (XGboost)<a href="supervised-learning.html#boosting-xgboost" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip-model-specification-and-tuning" class="section level4 hasAnchor" number="8.6.4.1">
<h4><span class="header-section-number">8.6.4.1</span> parsnip: Model specification and tuning<a href="supervised-learning.html#parsnip-model-specification-and-tuning" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Build and tune a model</strong>
<ol style="list-style-type: decimal">
<li>Define a workflow with your formula<br />
</li>
<li>Add a tunable model spec (with <code>tune()</code> placeholders)<br />
</li>
<li>Set the engine and mode<br />
</li>
<li>Create resamples (e.g. stratified 5‑fold CV)<br />
</li>
<li>Design a hyperparameter grid<br />
</li>
<li>Tune across the grid</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="supervised-learning.html#cb1187-1" tabindex="-1"></a><span class="co"># 1) Define the workflow</span></span>
<span id="cb1187-2"><a href="supervised-learning.html#cb1187-2" tabindex="-1"></a>xg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1187-3"><a href="supervised-learning.html#cb1187-3" tabindex="-1"></a>  <span class="fu">add_formula</span>(target <span class="sc">~</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb1187-4"><a href="supervised-learning.html#cb1187-4" tabindex="-1"></a>  <span class="fu">add_model</span>(</span>
<span id="cb1187-5"><a href="supervised-learning.html#cb1187-5" tabindex="-1"></a>    <span class="fu">boost_tree</span>(</span>
<span id="cb1187-6"><a href="supervised-learning.html#cb1187-6" tabindex="-1"></a>      <span class="at">trees      =</span> <span class="fu">tune</span>(),      <span class="co"># to be tuned</span></span>
<span id="cb1187-7"><a href="supervised-learning.html#cb1187-7" tabindex="-1"></a>      <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb1187-8"><a href="supervised-learning.html#cb1187-8" tabindex="-1"></a>      <span class="at">learn_rate =</span> <span class="fu">tune</span>()</span>
<span id="cb1187-9"><a href="supervised-learning.html#cb1187-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1187-10"><a href="supervised-learning.html#cb1187-10" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1187-11"><a href="supervised-learning.html#cb1187-11" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb1187-12"><a href="supervised-learning.html#cb1187-12" tabindex="-1"></a>  )</span>
<span id="cb1187-13"><a href="supervised-learning.html#cb1187-13" tabindex="-1"></a></span>
<span id="cb1187-14"><a href="supervised-learning.html#cb1187-14" tabindex="-1"></a><span class="co"># 2) Create resamples (5-fold CV, stratified by target)</span></span>
<span id="cb1187-15"><a href="supervised-learning.html#cb1187-15" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1187-16"><a href="supervised-learning.html#cb1187-16" tabindex="-1"></a>cv_splits <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(</span>
<span id="cb1187-17"><a href="supervised-learning.html#cb1187-17" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">target =</span> <span class="fu">as.factor</span>(target)),</span>
<span id="cb1187-18"><a href="supervised-learning.html#cb1187-18" tabindex="-1"></a>  <span class="at">v =</span> <span class="dv">5</span>, </span>
<span id="cb1187-19"><a href="supervised-learning.html#cb1187-19" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1187-20"><a href="supervised-learning.html#cb1187-20" tabindex="-1"></a>)</span>
<span id="cb1187-21"><a href="supervised-learning.html#cb1187-21" tabindex="-1"></a></span>
<span id="cb1187-22"><a href="supervised-learning.html#cb1187-22" tabindex="-1"></a><span class="co"># 3) Specify a tuning grid</span></span>
<span id="cb1187-23"><a href="supervised-learning.html#cb1187-23" tabindex="-1"></a>xg_grid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb1187-24"><a href="supervised-learning.html#cb1187-24" tabindex="-1"></a>  <span class="fu">trees</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">500</span>)),</span>
<span id="cb1187-25"><a href="supervised-learning.html#cb1187-25" tabindex="-1"></a>  <span class="fu">tree_depth</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb1187-26"><a href="supervised-learning.html#cb1187-26" tabindex="-1"></a>  <span class="fu">learn_rate</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.3</span>)),</span>
<span id="cb1187-27"><a href="supervised-learning.html#cb1187-27" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb1187-28"><a href="supervised-learning.html#cb1187-28" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: `grid_latin_hypercube()` was deprecated in dials 1.3.0.
## ℹ Please use `grid_space_filling()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="supervised-learning.html#cb1189-1" tabindex="-1"></a><span class="co"># 4) Run tuning</span></span>
<span id="cb1189-2"><a href="supervised-learning.html#cb1189-2" tabindex="-1"></a>xg_res <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb1189-3"><a href="supervised-learning.html#cb1189-3" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1189-4"><a href="supervised-learning.html#cb1189-4" tabindex="-1"></a>    <span class="at">resamples =</span> cv_splits,</span>
<span id="cb1189-5"><a href="supervised-learning.html#cb1189-5" tabindex="-1"></a>    <span class="at">grid      =</span> xg_grid,</span>
<span id="cb1189-6"><a href="supervised-learning.html#cb1189-6" tabindex="-1"></a>    <span class="at">metrics   =</span> <span class="fu">metric_set</span>(accuracy, recall),</span>
<span id="cb1189-7"><a href="supervised-learning.html#cb1189-7" tabindex="-1"></a>    <span class="at">control   =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1189-8"><a href="supervised-learning.html#cb1189-8" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: ! tune detected a parallel backend registered with foreach but no backend registered with future.
## ℹ Support for parallel processing with foreach was soft-deprecated in tune 1.2.1.
## ℹ See ?parallelism (`?tune::parallelism()`) to learn more.</code></pre>
<ul>
<li><p><strong>Fit the final model</strong></p>
<ol style="list-style-type: decimal">
<li>Select the best parameters</li>
<li>Finalize the workflow</li>
<li>Fit to the training set</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="supervised-learning.html#cb1191-1" tabindex="-1"></a><span class="co"># Select best metrics (name the metric argument explicitly)</span></span>
<span id="cb1191-2"><a href="supervised-learning.html#cb1191-2" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xg_res, <span class="at">metric =</span> <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb1191-3"><a href="supervised-learning.html#cb1191-3" tabindex="-1"></a></span>
<span id="cb1191-4"><a href="supervised-learning.html#cb1191-4" tabindex="-1"></a><span class="co"># Finalize the workflow with those parameters</span></span>
<span id="cb1191-5"><a href="supervised-learning.html#cb1191-5" tabindex="-1"></a>xg_wf_final <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(xg_wf, best_params)</span>
<span id="cb1191-6"><a href="supervised-learning.html#cb1191-6" tabindex="-1"></a></span>
<span id="cb1191-7"><a href="supervised-learning.html#cb1191-7" tabindex="-1"></a><span class="co"># Fit the finalized workflow</span></span>
<span id="cb1191-8"><a href="supervised-learning.html#cb1191-8" tabindex="-1"></a>xg_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb1191-9"><a href="supervised-learning.html#cb1191-9" tabindex="-1"></a>  xg_wf_final,</span>
<span id="cb1191-10"><a href="supervised-learning.html#cb1191-10" tabindex="-1"></a>  train_x_class <span class="sc">%&gt;%</span></span>
<span id="cb1191-11"><a href="supervised-learning.html#cb1191-11" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class))</span>
<span id="cb1191-12"><a href="supervised-learning.html#cb1191-12" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="yardstick-3" class="section level4 hasAnchor" number="8.6.4.2">
<h4><span class="header-section-number">8.6.4.2</span> yardstick<a href="supervised-learning.html#yardstick-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="supervised-learning.html#cb1192-1" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(</span>
<span id="cb1192-2"><a href="supervised-learning.html#cb1192-2" tabindex="-1"></a>  yardstick<span class="sc">::</span>accuracy,</span>
<span id="cb1192-3"><a href="supervised-learning.html#cb1192-3" tabindex="-1"></a>  yardstick<span class="sc">::</span>precision,</span>
<span id="cb1192-4"><a href="supervised-learning.html#cb1192-4" tabindex="-1"></a>  yardstick<span class="sc">::</span>recall</span>
<span id="cb1192-5"><a href="supervised-learning.html#cb1192-5" tabindex="-1"></a>)</span>
<span id="cb1192-6"><a href="supervised-learning.html#cb1192-6" tabindex="-1"></a></span>
<span id="cb1192-7"><a href="supervised-learning.html#cb1192-7" tabindex="-1"></a><span class="fu">evaluate_class</span>(xg_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.739
## 2 precision binary         0.725
## 3 recall    binary         0.690</code></pre>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="supervised-learning.html#cb1194-1" tabindex="-1"></a>xg_fit_viz_metr <span class="ot">&lt;-</span></span>
<span id="cb1194-2"><a href="supervised-learning.html#cb1194-2" tabindex="-1"></a>  <span class="fu">visualize_class_eval</span>(xg_fit)</span>
<span id="cb1194-3"><a href="supervised-learning.html#cb1194-3" tabindex="-1"></a></span>
<span id="cb1194-4"><a href="supervised-learning.html#cb1194-4" tabindex="-1"></a>xg_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="supervised-learning.html#cb1195-1" tabindex="-1"></a>xg_fit_viz_mat <span class="ot">&lt;-</span></span>
<span id="cb1195-2"><a href="supervised-learning.html#cb1195-2" tabindex="-1"></a>  <span class="fu">visualize_class_conf</span>(xg_fit)</span>
<span id="cb1195-3"><a href="supervised-learning.html#cb1195-3" tabindex="-1"></a></span>
<span id="cb1195-4"><a href="supervised-learning.html#cb1195-4" tabindex="-1"></a>xg_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="tune-3" class="section level4 hasAnchor" number="8.6.4.3">
<h4><span class="header-section-number">8.6.4.3</span> tune<a href="supervised-learning.html#tune-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-3" class="section level5 hasAnchor" number="8.6.4.3.1">
<h5><span class="header-section-number">8.6.4.3.1</span> tune ingredients<a href="supervised-learning.html#tune-ingredients-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>We focus on the following hyperparameters: <code>trees,</code> <code>tree_depth,</code> <code>learn_rate,</code> <code>min_n,</code> <code>mtry,</code> <code>loss_reduction,</code> and <code>sample_size</code></li>
</ul>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="supervised-learning.html#cb1196-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span></span>
<span id="cb1196-2"><a href="supervised-learning.html#cb1196-2" tabindex="-1"></a>  xg_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(</span>
<span id="cb1196-3"><a href="supervised-learning.html#cb1196-3" tabindex="-1"></a></span>
<span id="cb1196-4"><a href="supervised-learning.html#cb1196-4" tabindex="-1"></a>    <span class="co"># Mode</span></span>
<span id="cb1196-5"><a href="supervised-learning.html#cb1196-5" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1196-6"><a href="supervised-learning.html#cb1196-6" tabindex="-1"></a></span>
<span id="cb1196-7"><a href="supervised-learning.html#cb1196-7" tabindex="-1"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1196-8"><a href="supervised-learning.html#cb1196-8" tabindex="-1"></a></span>
<span id="cb1196-9"><a href="supervised-learning.html#cb1196-9" tabindex="-1"></a>    <span class="co"># The number of trees to fit, aka boosting iterations</span></span>
<span id="cb1196-10"><a href="supervised-learning.html#cb1196-10" tabindex="-1"></a>    <span class="at">trees =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-11"><a href="supervised-learning.html#cb1196-11" tabindex="-1"></a>    <span class="co"># The depth of the decision tree (how many levels of splits).</span></span>
<span id="cb1196-12"><a href="supervised-learning.html#cb1196-12" tabindex="-1"></a>    <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-13"><a href="supervised-learning.html#cb1196-13" tabindex="-1"></a>    <span class="co"># Learning rate: lower means the ensemble will adapt more slowly.</span></span>
<span id="cb1196-14"><a href="supervised-learning.html#cb1196-14" tabindex="-1"></a>    <span class="at">learn_rate =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-15"><a href="supervised-learning.html#cb1196-15" tabindex="-1"></a>    <span class="co"># Stop splitting a tree if we only have this many obs in a tree node.</span></span>
<span id="cb1196-16"><a href="supervised-learning.html#cb1196-16" tabindex="-1"></a>    <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-17"><a href="supervised-learning.html#cb1196-17" tabindex="-1"></a>    <span class="at">loss_reduction =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-18"><a href="supervised-learning.html#cb1196-18" tabindex="-1"></a>    <span class="co"># The number of randomly selected hyperparameters</span></span>
<span id="cb1196-19"><a href="supervised-learning.html#cb1196-19" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb1196-20"><a href="supervised-learning.html#cb1196-20" tabindex="-1"></a>    <span class="co"># The size of the data set used for modeling within an iteration</span></span>
<span id="cb1196-21"><a href="supervised-learning.html#cb1196-21" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">tune</span>()</span>
<span id="cb1196-22"><a href="supervised-learning.html#cb1196-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1196-23"><a href="supervised-learning.html#cb1196-23" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span>
<span id="cb1196-24"><a href="supervised-learning.html#cb1196-24" tabindex="-1"></a></span>
<span id="cb1196-25"><a href="supervised-learning.html#cb1196-25" tabindex="-1"></a><span class="co"># Space-filling hyperparameter grids</span></span>
<span id="cb1196-26"><a href="supervised-learning.html#cb1196-26" tabindex="-1"></a>xg_grid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb1196-27"><a href="supervised-learning.html#cb1196-27" tabindex="-1"></a>  <span class="fu">trees</span>(),</span>
<span id="cb1196-28"><a href="supervised-learning.html#cb1196-28" tabindex="-1"></a>  <span class="fu">tree_depth</span>(),</span>
<span id="cb1196-29"><a href="supervised-learning.html#cb1196-29" tabindex="-1"></a>  <span class="fu">learn_rate</span>(),</span>
<span id="cb1196-30"><a href="supervised-learning.html#cb1196-30" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb1196-31"><a href="supervised-learning.html#cb1196-31" tabindex="-1"></a>  <span class="fu">loss_reduction</span>(),</span>
<span id="cb1196-32"><a href="supervised-learning.html#cb1196-32" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">sample_prop</span>(),</span>
<span id="cb1196-33"><a href="supervised-learning.html#cb1196-33" tabindex="-1"></a>  <span class="fu">finalize</span>(<span class="fu">mtry</span>(), train_x_class),</span>
<span id="cb1196-34"><a href="supervised-learning.html#cb1196-34" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">30</span></span>
<span id="cb1196-35"><a href="supervised-learning.html#cb1196-35" tabindex="-1"></a>)</span>
<span id="cb1196-36"><a href="supervised-learning.html#cb1196-36" tabindex="-1"></a></span>
<span id="cb1196-37"><a href="supervised-learning.html#cb1196-37" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1196-38"><a href="supervised-learning.html#cb1196-38" tabindex="-1"></a></span>
<span id="cb1196-39"><a href="supervised-learning.html#cb1196-39" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1196-40"><a href="supervised-learning.html#cb1196-40" tabindex="-1"></a></span>
<span id="cb1196-41"><a href="supervised-learning.html#cb1196-41" tabindex="-1"></a>xg_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1196-42"><a href="supervised-learning.html#cb1196-42" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1196-43"><a href="supervised-learning.html#cb1196-43" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-3" class="section level5 hasAnchor" number="8.6.4.3.2">
<h5><span class="header-section-number">8.6.4.3.2</span> Add these elements to a workflow<a href="supervised-learning.html#add-these-elements-to-a-workflow-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="supervised-learning.html#cb1197-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1197-2"><a href="supervised-learning.html#cb1197-2" tabindex="-1"></a>xg_wf <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1197-3"><a href="supervised-learning.html#cb1197-3" tabindex="-1"></a></span>
<span id="cb1197-4"><a href="supervised-learning.html#cb1197-4" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1197-5"><a href="supervised-learning.html#cb1197-5" tabindex="-1"></a>xg_res <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb1197-6"><a href="supervised-learning.html#cb1197-6" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1197-7"><a href="supervised-learning.html#cb1197-7" tabindex="-1"></a>    <span class="at">resamples =</span> xg_folds,</span>
<span id="cb1197-8"><a href="supervised-learning.html#cb1197-8" tabindex="-1"></a>    <span class="at">grid =</span> xg_grid,</span>
<span id="cb1197-9"><a href="supervised-learning.html#cb1197-9" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1197-10"><a href="supervised-learning.html#cb1197-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: ! tune detected a parallel backend registered with foreach but no backend registered with future.
## ℹ Support for parallel processing with foreach was soft-deprecated in tune 1.2.1.
## ℹ See ?parallelism (`?tune::parallelism()`) to learn more.</code></pre>
</div>
<div id="visualize-3" class="section level5 hasAnchor" number="8.6.4.3.3">
<h5><span class="header-section-number">8.6.4.3.3</span> Visualize<a href="supervised-learning.html#visualize-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="supervised-learning.html#cb1199-1" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Removing existing preference.
## [conflicted] Will prefer dplyr::filter over any other package.</code></pre>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="supervised-learning.html#cb1201-1" tabindex="-1"></a>xg_res <span class="sc">%&gt;%</span></span>
<span id="cb1201-2"><a href="supervised-learning.html#cb1201-2" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1201-3"><a href="supervised-learning.html#cb1201-3" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;roc_auc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1201-4"><a href="supervised-learning.html#cb1201-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mtry<span class="sc">:</span>sample_size,</span>
<span id="cb1201-5"><a href="supervised-learning.html#cb1201-5" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb1201-6"><a href="supervised-learning.html#cb1201-6" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span></span>
<span id="cb1201-7"><a href="supervised-learning.html#cb1201-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1201-8"><a href="supervised-learning.html#cb1201-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> mean, <span class="at">color =</span> parameter)) <span class="sc">+</span></span>
<span id="cb1201-9"><a href="supervised-learning.html#cb1201-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1201-10"><a href="supervised-learning.html#cb1201-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1201-11"><a href="supervised-learning.html#cb1201-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1201-12"><a href="supervised-learning.html#cb1201-12" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb1201-13"><a href="supervised-learning.html#cb1201-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span></span>
<span id="cb1201-14"><a href="supervised-learning.html#cb1201-14" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1202-1"><a href="supervised-learning.html#cb1202-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1202-2"><a href="supervised-learning.html#cb1202-2" tabindex="-1"></a>best_xg <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xg_res, <span class="at">metric =</span> <span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb1202-3"><a href="supervised-learning.html#cb1202-3" tabindex="-1"></a></span>
<span id="cb1202-4"><a href="supervised-learning.html#cb1202-4" tabindex="-1"></a>best_xg</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##    mtry trees min_n tree_depth learn_rate loss_reduction sample_size .config    
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;      
## 1     2  1267     2         13    0.00866           5.02       0.668 Preprocess…</code></pre>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="supervised-learning.html#cb1204-1" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1204-2"><a href="supervised-learning.html#cb1204-2" tabindex="-1"></a>finalize_xg <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb1204-3"><a href="supervised-learning.html#cb1204-3" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_xg)</span></code></pre></div>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1205-1"><a href="supervised-learning.html#cb1205-1" tabindex="-1"></a>xg_fit_tuned <span class="ot">&lt;-</span> finalize_xg <span class="sc">%&gt;%</span></span>
<span id="cb1205-2"><a href="supervised-learning.html#cb1205-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1205-3"><a href="supervised-learning.html#cb1205-3" tabindex="-1"></a></span>
<span id="cb1205-4"><a href="supervised-learning.html#cb1205-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1205-5"><a href="supervised-learning.html#cb1205-5" tabindex="-1"></a>(xg_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(xg_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="supervised-learning.html#cb1206-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1206-2"><a href="supervised-learning.html#cb1206-2" tabindex="-1"></a>(xg_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(xg_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="supervised-learning.html#cb1207-1" tabindex="-1"></a>xg_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1207-2"><a href="supervised-learning.html#cb1207-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1207-3"><a href="supervised-learning.html#cb1207-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="test-fit-3" class="section level5 hasAnchor" number="8.6.4.3.4">
<h5><span class="header-section-number">8.6.4.3.4</span> Test fit<a href="supervised-learning.html#test-fit-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="supervised-learning.html#cb1208-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_xg <span class="sc">%&gt;%</span></span>
<span id="cb1208-2"><a href="supervised-learning.html#cb1208-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1208-3"><a href="supervised-learning.html#cb1208-3" tabindex="-1"></a></span>
<span id="cb1208-4"><a href="supervised-learning.html#cb1208-4" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.826
## 2 precision binary         0.810
## 3 recall    binary         0.810</code></pre>
</div>
</div>
</div>
<div id="stacking-superlearner" class="section level3 hasAnchor" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Stacking (SuperLearner)<a href="supervised-learning.html#stacking-superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This stacking part of the book heavily relies on <a href="https://github.com/dlab-berkeley/Machine-Learning-in-R/blob/master/07-ensembles.Rmd">Chris Kennedy’s notebook</a>.</p>
<div id="overview" class="section level4 hasAnchor" number="8.6.5.1">
<h4><span class="header-section-number">8.6.5.1</span> Overview<a href="supervised-learning.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="stacking" class="section level5 hasAnchor" number="8.6.5.1.1">
<h5><span class="header-section-number">8.6.5.1.1</span> Stacking<a href="supervised-learning.html#stacking" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Wolpert, D.H., 1992. <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.56.1533">Stacked generalization</a>. <em>Neural networks</em>, 5(2), pp.241-259.</p>
<p>Breiman, L., 1996. [Stacked regressions]((<a href="https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf" class="uri">https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf</a>). <em>Machine learning</em>, 24(1), pp.49-64.</p>
</div>
<div id="superlearner" class="section level5 hasAnchor" number="8.6.5.1.2">
<h5><span class="header-section-number">8.6.5.1.2</span> SuperLearner<a href="supervised-learning.html#superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <a href="https://cran.r-project.org/web/packages/SuperLearner/index.html">“SuperLearner” R package</a> is a method that simplifies ensemble learning by allowing you to simultaneously evaluate the cross-validated performance of multiple algorithms and/or a single algorithm with differently tuned hyperparameters. This is a generally advisable approach to machine learning instead of fitting single algorithms.</p>
<p>Let’s see how the four classification algorithms you learned in this workshop (1-lasso, 2-decision tree, 3-random forest, and 4-gradient boosted trees) compare to each other and also to 5-binary logistic regression (<code>glm</code>) and the 6-mean of Y as a benchmark algorithm, in terms of their cross-validated error!</p>
<p>A “wrapper” is a short function that adapts an algorithm for the SuperLearner package. Check out the different algorithm wrappers offered by SuperLearner:</p>
</div>
</div>
<div id="choose-algorithms" class="section level4 hasAnchor" number="8.6.5.2">
<h4><span class="header-section-number">8.6.5.2</span> Choose algorithms<a href="supervised-learning.html#choose-algorithms" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="supervised-learning.html#cb1210-1" tabindex="-1"></a><span class="co"># Review available models</span></span>
<span id="cb1210-2"><a href="supervised-learning.html#cb1210-2" tabindex="-1"></a>SuperLearner<span class="sc">::</span><span class="fu">listWrappers</span>()</span></code></pre></div>
<pre><code>## All prediction algorithm wrappers in SuperLearner:</code></pre>
<pre><code>##  [1] &quot;SL.bartMachine&quot;      &quot;SL.bayesglm&quot;         &quot;SL.biglasso&quot;        
##  [4] &quot;SL.caret&quot;            &quot;SL.caret.rpart&quot;      &quot;SL.cforest&quot;         
##  [7] &quot;SL.earth&quot;            &quot;SL.gam&quot;              &quot;SL.gbm&quot;             
## [10] &quot;SL.glm&quot;              &quot;SL.glm.interaction&quot;  &quot;SL.glmnet&quot;          
## [13] &quot;SL.ipredbagg&quot;        &quot;SL.kernelKnn&quot;        &quot;SL.knn&quot;             
## [16] &quot;SL.ksvm&quot;             &quot;SL.lda&quot;              &quot;SL.leekasso&quot;        
## [19] &quot;SL.lm&quot;               &quot;SL.loess&quot;            &quot;SL.logreg&quot;          
## [22] &quot;SL.mean&quot;             &quot;SL.nnet&quot;             &quot;SL.nnls&quot;            
## [25] &quot;SL.polymars&quot;         &quot;SL.qda&quot;              &quot;SL.randomForest&quot;    
## [28] &quot;SL.ranger&quot;           &quot;SL.ridge&quot;            &quot;SL.rpart&quot;           
## [31] &quot;SL.rpartPrune&quot;       &quot;SL.speedglm&quot;         &quot;SL.speedlm&quot;         
## [34] &quot;SL.step&quot;             &quot;SL.step.forward&quot;     &quot;SL.step.interaction&quot;
## [37] &quot;SL.stepAIC&quot;          &quot;SL.svm&quot;              &quot;SL.template&quot;        
## [40] &quot;SL.xgboost&quot;</code></pre>
<pre><code>## 
## All screening algorithm wrappers in SuperLearner:</code></pre>
<pre><code>## [1] &quot;All&quot;
## [1] &quot;screen.corP&quot;           &quot;screen.corRank&quot;        &quot;screen.glmnet&quot;        
## [4] &quot;screen.randomForest&quot;   &quot;screen.SIS&quot;            &quot;screen.template&quot;      
## [7] &quot;screen.ttest&quot;          &quot;write.screen.template&quot;</code></pre>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="supervised-learning.html#cb1215-1" tabindex="-1"></a><span class="co"># Compile the algorithm wrappers to be used.</span></span>
<span id="cb1215-2"><a href="supervised-learning.html#cb1215-2" tabindex="-1"></a>sl_lib <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1215-3"><a href="supervised-learning.html#cb1215-3" tabindex="-1"></a>  <span class="st">&quot;SL.mean&quot;</span>, <span class="co"># Marginal mean of the outcome ()</span></span>
<span id="cb1215-4"><a href="supervised-learning.html#cb1215-4" tabindex="-1"></a>  <span class="st">&quot;SL.glmnet&quot;</span>, <span class="co"># GLM with lasso/elasticnet regularization</span></span>
<span id="cb1215-5"><a href="supervised-learning.html#cb1215-5" tabindex="-1"></a>  <span class="st">&quot;SL.rpart&quot;</span>, <span class="co"># Decision tree</span></span>
<span id="cb1215-6"><a href="supervised-learning.html#cb1215-6" tabindex="-1"></a>  <span class="st">&quot;SL.ranger&quot;</span>, <span class="co"># Random forest</span></span>
<span id="cb1215-7"><a href="supervised-learning.html#cb1215-7" tabindex="-1"></a>  <span class="st">&quot;SL.xgboost&quot;</span></span>
<span id="cb1215-8"><a href="supervised-learning.html#cb1215-8" tabindex="-1"></a>) <span class="co"># Xgbboost</span></span></code></pre></div>
</div>
<div id="fit-model" class="section level4 hasAnchor" number="8.6.5.3">
<h4><span class="header-section-number">8.6.5.3</span> Fit model<a href="supervised-learning.html#fit-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Fit the ensemble!</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="supervised-learning.html#cb1216-1" tabindex="-1"></a><span class="co"># This is a seed that is compatible with multicore parallel processing.</span></span>
<span id="cb1216-2"><a href="supervised-learning.html#cb1216-2" tabindex="-1"></a><span class="co"># See ?set.seed for more information.</span></span>
<span id="cb1216-3"><a href="supervised-learning.html#cb1216-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">&quot;L&#39;Ecuyer-CMRG&quot;</span>)</span>
<span id="cb1216-4"><a href="supervised-learning.html#cb1216-4" tabindex="-1"></a></span>
<span id="cb1216-5"><a href="supervised-learning.html#cb1216-5" tabindex="-1"></a><span class="co"># This will take a few minutes to execute - take a look at the .html file to see the output!</span></span>
<span id="cb1216-6"><a href="supervised-learning.html#cb1216-6" tabindex="-1"></a>cv_sl <span class="ot">&lt;-</span> SuperLearner<span class="sc">::</span><span class="fu">CV.SuperLearner</span>(</span>
<span id="cb1216-7"><a href="supervised-learning.html#cb1216-7" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(train_y_class)),</span>
<span id="cb1216-8"><a href="supervised-learning.html#cb1216-8" tabindex="-1"></a>  <span class="at">X =</span> train_x_class,</span>
<span id="cb1216-9"><a href="supervised-learning.html#cb1216-9" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb1216-10"><a href="supervised-learning.html#cb1216-10" tabindex="-1"></a>  <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb1216-11"><a href="supervised-learning.html#cb1216-11" tabindex="-1"></a>  <span class="at">cvControl =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="dv">5</span><span class="dt">L</span>, <span class="at">stratifyCV =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1216-12"><a href="supervised-learning.html#cb1216-12" tabindex="-1"></a>  <span class="at">SL.library =</span> sl_lib,</span>
<span id="cb1216-13"><a href="supervised-learning.html#cb1216-13" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb1216-14"><a href="supervised-learning.html#cb1216-14" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="risk" class="section level4 hasAnchor" number="8.6.5.4">
<h4><span class="header-section-number">8.6.5.4</span> Risk<a href="supervised-learning.html#risk" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Risk is the average loss, and loss is how far off the prediction was for an individual observation. The lower the risk, the fewer errors the model makes in its prediction. SuperLearner’s default loss metric is squared error <span class="math inline">\((y_{actual} - y_{predicted})^2\)</span>, so the risk is the mean-squared error (just like in ordinary least <em>squares</em> regression). View the summary, plot results, and compute the Area Under the ROC Curve (AUC)!</p>
<div id="summary" class="section level5 hasAnchor" number="8.6.5.4.1">
<h5><span class="header-section-number">8.6.5.4.1</span> Summary<a href="supervised-learning.html#summary" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li><code>Discrete SL</code> chooses the best single learner (in this case, <code>SL.glmnet</code> or <code>lasso</code>).</li>
<li><code>SuperLearner</code> takes a weighted average of the <strong>models</strong> using the coefficients (importance of each learner in the overall ensemble). Coefficient 0 means that learner is not used at all.</li>
<li><code>SL.mean_All</code> (the weighted mean of <span class="math inline">\(Y\)</span>) is a benchmark algorithm (ignoring features).</li>
</ul>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="supervised-learning.html#cb1217-1" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code></pre></div>
<pre><code>## 
## Call:  
## SuperLearner::CV.SuperLearner(Y = as.numeric(as.character(train_y_class)),  
##     X = train_x_class, family = binomial(), SL.library = sl_lib, verbose = FALSE,  
##     cvControl = list(V = 5L, stratifyCV = TRUE)) 
## 
## Risk is based on: Mean Squared Error
## 
## All risk estimates are based on V =  5 
## 
##       Algorithm     Ave        se      Min     Max
##   Super Learner 0.11429 0.0136821 0.077962 0.14726
##     Discrete SL 0.10835 0.0137552 0.075192 0.14726
##     SL.mean_All 0.24798 0.0030968 0.247743 0.24895
##   SL.glmnet_All 0.10835 0.0137552 0.075192 0.14726
##    SL.rpart_All 0.17800 0.0193394 0.134548 0.22803
##   SL.ranger_All 0.12690 0.0118683 0.098966 0.15981
##  SL.xgboost_All 0.13570 0.0152786 0.105404 0.16393</code></pre>
</div>
<div id="plot" class="section level5 hasAnchor" number="8.6.5.4.2">
<h5><span class="header-section-number">8.6.5.4.2</span> Plot<a href="supervised-learning.html#plot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="supervised-learning.html#cb1219-1" tabindex="-1"></a><span class="co"># Plot the cross-validated risk estimate with 95% CIs.</span></span>
<span id="cb1219-2"><a href="supervised-learning.html#cb1219-2" tabindex="-1"></a></span>
<span id="cb1219-3"><a href="supervised-learning.html#cb1219-3" tabindex="-1"></a><span class="fu">plot</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/cvsl_review-1.png" width="672" /></p>
</div>
</div>
<div id="compute-auc-for-all-estimators" class="section level4 hasAnchor" number="8.6.5.5">
<h4><span class="header-section-number">8.6.5.5</span> Compute AUC for all estimators<a href="supervised-learning.html#compute-auc-for-all-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>ROC</strong></p>
<p>ROC: a ROC (receiver operating characteristic curve) plots the relationship between True Positive Rate (Y-axis) and FALSE Positive Rate (X-axis).</p>
<div class="float">
<img src="https://developers.google.com/machine-learning/crash-course/images/AUC.svg" alt="Area Under the ROC Curve" />
<div class="figcaption">Area Under the ROC Curve</div>
</div>
<p><strong>AUC</strong></p>
<p>AUC: Area Under the ROC Curve</p>
<p>1 = perfect</p>
<p>0.5 = no better than chance</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="supervised-learning.html#cb1220-1" tabindex="-1"></a>ck37r<span class="sc">::</span><span class="fu">auc_table</span>(cv_sl)</span></code></pre></div>
<pre><code>##                      auc         se  ci_lower  ci_upper      p-value
## SL.mean_All    0.5000000 0.06912305 0.3645213 0.6354787 5.907224e-10
## SL.rpart_All   0.8226545 0.04111475 0.7420710 0.9032379 8.684877e-03
## SL.xgboost_All 0.8805950 0.02442463 0.8327236 0.9284664 5.133242e-02
## SL.ranger_All  0.9075744 0.02036176 0.8676660 0.9474827 2.634583e-01
## SuperLearner   0.9127002 0.01992026 0.8736572 0.9517432 3.484810e-01
## SL.glmnet_All  0.9204577 0.01925326 0.8827220 0.9581934 5.000000e-01
## DiscreteSL     0.9204577 0.01925326 0.8827220 0.9581934 5.000000e-01</code></pre>
<div id="plot-the-roc-curve-for-the-best-estimator-discretsl" class="section level5 hasAnchor" number="8.6.5.5.1">
<h5><span class="header-section-number">8.6.5.5.1</span> Plot the ROC curve for the best estimator (DiscretSL)<a href="supervised-learning.html#plot-the-roc-curve-for-the-best-estimator-discretsl" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="supervised-learning.html#cb1222-1" tabindex="-1"></a>ck37r<span class="sc">::</span><span class="fu">plot_roc</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="review-weight-distribution-for-the-superlearner" class="section level5 hasAnchor" number="8.6.5.5.2">
<h5><span class="header-section-number">8.6.5.5.2</span> Review weight distribution for the SuperLearner<a href="supervised-learning.html#review-weight-distribution-for-the-superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="supervised-learning.html#cb1223-1" tabindex="-1"></a><span class="fu">print</span>(ck37r<span class="sc">::</span><span class="fu">cvsl_weights</span>(cv_sl), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##  # Learner    Mean      SD    Min     Max
##  1  glmnet 0.77895 0.21717 0.4948 1.00000
##  2 xgboost 0.12662 0.17591 0.0000 0.41316
##  3  ranger 0.08619 0.16578 0.0000 0.38013
##  4   rpart 0.00824 0.01843 0.0000 0.04121
##  5    mean 0.00000 0.00000 0.0000 0.00000</code></pre>
<p>The general stacking approach is available in the tidymodels framework through <a href="https://github.com/tidymodels/stacks"><code>stacks</code></a> package (developmental stage).</p>
<p>However, SuperLearner is currently not available in the tidymodels framework. You can easily build and add a parsnip model if you’d like to. If you are interested in knowing more about it, please look at <a href="https://www.tidymodels.org/learn/develop/models/">this vignette</a> of the tidymodels.</p>
</div>
</div>
</div>
<div id="applications-2" class="section level3 hasAnchor" number="8.6.6">
<h3><span class="header-section-number">8.6.6</span> Applications<a href="supervised-learning.html#applications-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="bandit-algorithm-optimizing-an-experiment" class="section level4 hasAnchor" number="8.6.6.1">
<h4><span class="header-section-number">8.6.6.1</span> Bandit algorithm (optimizing an experiment)<a href="supervised-learning.html#bandit-algorithm-optimizing-an-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="causal-forest-estimating-heterogeneous-treatment-effect" class="section level4 hasAnchor" number="8.6.6.2">
<h4><span class="header-section-number">8.6.6.2</span> Causal forest (estimating heterogeneous treatment effect)<a href="supervised-learning.html#causal-forest-estimating-heterogeneous-treatment-effect" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pre-processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="unsupervised-learning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jaeyk/PS239T/edit/main/07_high_dimensional_data.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": [
    ["pdf", "PS239T.pdf"],
    ["epub", "PS239T.epub"]
  ],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  },
  "toolbar": {
    "position": "fixed"
  },
  "code_copy": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
