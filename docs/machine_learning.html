<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 High-dimensional data | Computational Thinking for Social Scientists</title>
  <meta name="description" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  <meta name="github-repo" content="jaeyk/PS239T" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists" />
  <meta name="twitter:site" content="@JaeJaeykim2" />
  <meta name="twitter:description" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  

<meta name="author" content="Jae Yeon Kim" />


<meta name="date" content="2022-01-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="semi_structured_data.html"/>
<link rel="next" href="big_data.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Thinking for Social Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello World</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#part-i-fundamentals"><i class="fa fa-check"></i><b>1.1</b> Part I Fundamentals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#part-ii-applications"><i class="fa fa-check"></i><b>1.2</b> Part II Applications</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#special-thanks"><i class="fa fa-check"></i><b>1.3</b> Special thanks</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#suggestions-questions-or-comments"><i class="fa fa-check"></i><b>1.4</b> Suggestions, questions, or comments</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.5</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Computational thinking</a>
<ul>
<li class="chapter" data-level="2.1" data-path="motivation.html"><a href="motivation.html#why-computational-thinking"><i class="fa fa-check"></i><b>2.1</b> Why computational thinking</a></li>
<li class="chapter" data-level="2.2" data-path="motivation.html"><a href="motivation.html#how-to-teach-and-learn-computational-thinking"><i class="fa fa-check"></i><b>2.2</b> How to teach and learn computational thinking</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="git_bash.html"><a href="git_bash.html"><i class="fa fa-check"></i><b>3</b> Managing data and code</a>
<ul>
<li class="chapter" data-level="3.1" data-path="git_bash.html"><a href="git_bash.html#the-command-line"><i class="fa fa-check"></i><b>3.1</b> The Command Line</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="git_bash.html"><a href="git_bash.html#the-big-picture"><i class="fa fa-check"></i><b>3.1.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.1.2" data-path="git_bash.html"><a href="git_bash.html#why-bother-using-the-command-line"><i class="fa fa-check"></i><b>3.1.2</b> Why bother using the command line?</a></li>
<li class="chapter" data-level="3.1.3" data-path="git_bash.html"><a href="git_bash.html#unix-shell"><i class="fa fa-check"></i><b>3.1.3</b> UNIX Shell</a></li>
<li class="chapter" data-level="3.1.4" data-path="git_bash.html"><a href="git_bash.html#references"><i class="fa fa-check"></i><b>3.1.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="git_bash.html"><a href="git_bash.html#git-and-github"><i class="fa fa-check"></i><b>3.2</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="git_bash.html"><a href="git_bash.html#the-big-picture-1"><i class="fa fa-check"></i><b>3.2.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.2.2" data-path="git_bash.html"><a href="git_bash.html#version-control-system"><i class="fa fa-check"></i><b>3.2.2</b> Version control system</a></li>
<li class="chapter" data-level="3.2.3" data-path="git_bash.html"><a href="git_bash.html#setup"><i class="fa fa-check"></i><b>3.2.3</b> Setup</a></li>
<li class="chapter" data-level="3.2.4" data-path="git_bash.html"><a href="git_bash.html#cloning-a-repository"><i class="fa fa-check"></i><b>3.2.4</b> Cloning a repository</a></li>
<li class="chapter" data-level="3.2.5" data-path="git_bash.html"><a href="git_bash.html#making-a-repository"><i class="fa fa-check"></i><b>3.2.5</b> Making a repository</a></li>
<li class="chapter" data-level="3.2.6" data-path="git_bash.html"><a href="git_bash.html#commit-changes"><i class="fa fa-check"></i><b>3.2.6</b> Commit changes</a></li>
<li class="chapter" data-level="3.2.7" data-path="git_bash.html"><a href="git_bash.html#push-and-pull-or-fetch"><i class="fa fa-check"></i><b>3.2.7</b> Push and pull (or fetch)</a></li>
<li class="chapter" data-level="3.2.8" data-path="git_bash.html"><a href="git_bash.html#branching"><i class="fa fa-check"></i><b>3.2.8</b> Branching</a></li>
<li class="chapter" data-level="3.2.9" data-path="git_bash.html"><a href="git_bash.html#other-useful-commands"><i class="fa fa-check"></i><b>3.2.9</b> Other useful commands</a></li>
<li class="chapter" data-level="3.2.10" data-path="git_bash.html"><a href="git_bash.html#collaborations"><i class="fa fa-check"></i><b>3.2.10</b> Collaborations</a></li>
<li class="chapter" data-level="3.2.11" data-path="git_bash.html"><a href="git_bash.html#deployment-github-pages"><i class="fa fa-check"></i><b>3.2.11</b> Deployment: GitHub Pages</a></li>
<li class="chapter" data-level="3.2.12" data-path="git_bash.html"><a href="git_bash.html#tracking-progress-github-issues"><i class="fa fa-check"></i><b>3.2.12</b> Tracking progress: GitHub Issues</a></li>
<li class="chapter" data-level="3.2.13" data-path="git_bash.html"><a href="git_bash.html#project-management-github-dashboards"><i class="fa fa-check"></i><b>3.2.13</b> Project management: GitHub Dashboards</a></li>
<li class="chapter" data-level="3.2.14" data-path="git_bash.html"><a href="git_bash.html#using-git-clients"><i class="fa fa-check"></i><b>3.2.14</b> Using Git clients</a></li>
<li class="chapter" data-level="3.2.15" data-path="git_bash.html"><a href="git_bash.html#the-big-picture-2"><i class="fa fa-check"></i><b>3.2.15</b> The Big Picture</a></li>
<li class="chapter" data-level="3.2.16" data-path="git_bash.html"><a href="git_bash.html#rstudio"><i class="fa fa-check"></i><b>3.2.16</b> RStudio</a></li>
<li class="chapter" data-level="3.2.17" data-path="git_bash.html"><a href="git_bash.html#basic-syntax"><i class="fa fa-check"></i><b>3.2.17</b> Basic Syntax</a></li>
<li class="chapter" data-level="3.2.18" data-path="git_bash.html"><a href="git_bash.html#environment"><i class="fa fa-check"></i><b>3.2.18</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="git_bash.html"><a href="git_bash.html#project-oriented-research"><i class="fa fa-check"></i><b>3.3</b> Project-oriented research</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="git_bash.html"><a href="git_bash.html#the-big-picture-3"><i class="fa fa-check"></i><b>3.3.1</b> The Big Picture</a></li>
<li class="chapter" data-level="3.3.2" data-path="git_bash.html"><a href="git_bash.html#references-1"><i class="fa fa-check"></i><b>3.3.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="git_bash.html"><a href="git_bash.html#writing-code-how-to-code-like-a-professional"><i class="fa fa-check"></i><b>3.4</b> Writing code: How to code like a professional</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="git_bash.html"><a href="git_bash.html#the-bic-piture"><i class="fa fa-check"></i><b>3.4.1</b> The Bic Piture</a></li>
<li class="chapter" data-level="3.4.2" data-path="git_bash.html"><a href="git_bash.html#write-readable-code"><i class="fa fa-check"></i><b>3.4.2</b> Write readable code</a></li>
<li class="chapter" data-level="3.4.3" data-path="git_bash.html"><a href="git_bash.html#write-reusable-code"><i class="fa fa-check"></i><b>3.4.3</b> Write reusable code</a></li>
<li class="chapter" data-level="3.4.4" data-path="git_bash.html"><a href="git_bash.html#test-your-code-systematically"><i class="fa fa-check"></i><b>3.4.4</b> Test your code systematically</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="git_bash.html"><a href="git_bash.html#run-tests"><i class="fa fa-check"></i><b>3.5</b> Run tests</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="git_bash.html"><a href="git_bash.html#asking-questions-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.5.1</b> Asking questions: Minimal reproducible example</a></li>
<li class="chapter" data-level="3.5.2" data-path="git_bash.html"><a href="git_bash.html#references-2"><i class="fa fa-check"></i><b>3.5.2</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy_data.html"><a href="tidy_data.html"><i class="fa fa-check"></i><b>4</b> Tidy data and its friends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidy_data.html"><a href="tidy_data.html#setup-2"><i class="fa fa-check"></i><b>4.1</b> Setup</a></li>
<li class="chapter" data-level="4.2" data-path="tidy_data.html"><a href="tidy_data.html#base-r-data-structure"><i class="fa fa-check"></i><b>4.2</b> Base R data structure</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tidy_data.html"><a href="tidy_data.html#d-data-vectors"><i class="fa fa-check"></i><b>4.2.1</b> 1D data: Vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="tidy_data.html"><a href="tidy_data.html#data-structures"><i class="fa fa-check"></i><b>4.2.2</b> Data structures</a></li>
<li class="chapter" data-level="4.2.3" data-path="tidy_data.html"><a href="tidy_data.html#attributes"><i class="fa fa-check"></i><b>4.2.3</b> Attributes</a></li>
<li class="chapter" data-level="4.2.4" data-path="tidy_data.html"><a href="tidy_data.html#d-data-matrices-and-dataframes"><i class="fa fa-check"></i><b>4.2.4</b> 2D data: Matrices and dataframes</a></li>
<li class="chapter" data-level="4.2.5" data-path="tidy_data.html"><a href="tidy_data.html#subset"><i class="fa fa-check"></i><b>4.2.5</b> Subset</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tidy_data.html"><a href="tidy_data.html#tidyverse"><i class="fa fa-check"></i><b>4.3</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="tidy_data.html"><a href="tidy_data.html#the-big-picture-4"><i class="fa fa-check"></i><b>4.3.1</b> The Big Picture</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidy_data.html"><a href="tidy_data.html#tidying-tidyr"><i class="fa fa-check"></i><b>4.4</b> Tidying (tidyr)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="tidy_data.html"><a href="tidy_data.html#reshaping"><i class="fa fa-check"></i><b>4.4.1</b> Reshaping</a></li>
<li class="chapter" data-level="4.4.2" data-path="tidy_data.html"><a href="tidy_data.html#filling"><i class="fa fa-check"></i><b>4.4.2</b> Filling</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="tidy_data.html"><a href="tidy_data.html#manipulating-dplyr"><i class="fa fa-check"></i><b>4.5</b> Manipulating (dplyr)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="tidy_data.html"><a href="tidy_data.html#rearranging"><i class="fa fa-check"></i><b>4.5.1</b> Rearranging</a></li>
<li class="chapter" data-level="4.5.2" data-path="tidy_data.html"><a href="tidy_data.html#subset-observations-rows"><i class="fa fa-check"></i><b>4.5.2</b> Subset observations (rows)</a></li>
<li class="chapter" data-level="4.5.3" data-path="tidy_data.html"><a href="tidy_data.html#subset-variables-columns"><i class="fa fa-check"></i><b>4.5.3</b> Subset variables (columns)</a></li>
<li class="chapter" data-level="4.5.4" data-path="tidy_data.html"><a href="tidy_data.html#create-variables"><i class="fa fa-check"></i><b>4.5.4</b> Create variables</a></li>
<li class="chapter" data-level="4.5.5" data-path="tidy_data.html"><a href="tidy_data.html#counting"><i class="fa fa-check"></i><b>4.5.5</b> Counting</a></li>
<li class="chapter" data-level="4.5.6" data-path="tidy_data.html"><a href="tidy_data.html#summarizing"><i class="fa fa-check"></i><b>4.5.6</b> Summarizing</a></li>
<li class="chapter" data-level="4.5.7" data-path="tidy_data.html"><a href="tidy_data.html#grouping"><i class="fa fa-check"></i><b>4.5.7</b> Grouping</a></li>
<li class="chapter" data-level="4.5.8" data-path="tidy_data.html"><a href="tidy_data.html#joining"><i class="fa fa-check"></i><b>4.5.8</b> Joining</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="tidy_data.html"><a href="tidy_data.html#modeling-broom"><i class="fa fa-check"></i><b>4.6</b> Modeling (broom)</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="tidy_data.html"><a href="tidy_data.html#nesting"><i class="fa fa-check"></i><b>4.6.1</b> Nesting</a></li>
<li class="chapter" data-level="4.6.2" data-path="tidy_data.html"><a href="tidy_data.html#mapping"><i class="fa fa-check"></i><b>4.6.2</b> Mapping</a></li>
<li class="chapter" data-level="4.6.3" data-path="tidy_data.html"><a href="tidy_data.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.6.3</b> Hypothesis testing</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="tidy_data.html"><a href="tidy_data.html#visualizing-ggplot2"><i class="fa fa-check"></i><b>4.7</b> Visualizing (ggplot2)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="tidy_data.html"><a href="tidy_data.html#motivation-2"><i class="fa fa-check"></i><b>4.7.1</b> Motivation</a></li>
<li class="chapter" data-level="4.7.2" data-path="tidy_data.html"><a href="tidy_data.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.7.2</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.7.3" data-path="tidy_data.html"><a href="tidy_data.html#mapping-and-geom"><i class="fa fa-check"></i><b>4.7.3</b> mapping and geom</a></li>
<li class="chapter" data-level="4.7.4" data-path="tidy_data.html"><a href="tidy_data.html#basic-aes-x-y"><i class="fa fa-check"></i><b>4.7.4</b> basic aes (x , y)</a></li>
<li class="chapter" data-level="4.7.5" data-path="tidy_data.html"><a href="tidy_data.html#univariate-distribution"><i class="fa fa-check"></i><b>4.7.5</b> Univariate distribution</a></li>
<li class="chapter" data-level="4.7.6" data-path="tidy_data.html"><a href="tidy_data.html#advanced-aes-size-color"><i class="fa fa-check"></i><b>4.7.6</b> Advanced aes (size, color)</a></li>
<li class="chapter" data-level="4.7.7" data-path="tidy_data.html"><a href="tidy_data.html#co-ordinates-and-scales"><i class="fa fa-check"></i><b>4.7.7</b> Co-ordinates and scales</a></li>
<li class="chapter" data-level="4.7.8" data-path="tidy_data.html"><a href="tidy_data.html#labels-and-guides"><i class="fa fa-check"></i><b>4.7.8</b> Labels and guides</a></li>
<li class="chapter" data-level="4.7.9" data-path="tidy_data.html"><a href="tidy_data.html#ggsave"><i class="fa fa-check"></i><b>4.7.9</b> ggsave</a></li>
<li class="chapter" data-level="4.7.10" data-path="tidy_data.html"><a href="tidy_data.html#many-plots"><i class="fa fa-check"></i><b>4.7.10</b> Many plots</a></li>
<li class="chapter" data-level="4.7.11" data-path="tidy_data.html"><a href="tidy_data.html#transforming"><i class="fa fa-check"></i><b>4.7.11</b> Transforming</a></li>
<li class="chapter" data-level="4.7.12" data-path="tidy_data.html"><a href="tidy_data.html#ploting-models"><i class="fa fa-check"></i><b>4.7.12</b> Ploting models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functional_programming.html"><a href="functional_programming.html"><i class="fa fa-check"></i><b>5</b> Automating repeated things</a>
<ul>
<li class="chapter" data-level="5.1" data-path="functional_programming.html"><a href="functional_programming.html#the-big-picture-5"><i class="fa fa-check"></i><b>5.1</b> The Big Picture</a></li>
<li class="chapter" data-level="5.2" data-path="functional_programming.html"><a href="functional_programming.html#objectives"><i class="fa fa-check"></i><b>5.2</b> Objectives</a></li>
<li class="chapter" data-level="5.3" data-path="functional_programming.html"><a href="functional_programming.html#setup-3"><i class="fa fa-check"></i><b>5.3</b> Setup</a></li>
<li class="chapter" data-level="5.4" data-path="functional_programming.html"><a href="functional_programming.html#flow"><i class="fa fa-check"></i><b>5.4</b> Flow control</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="functional_programming.html"><a href="functional_programming.html#if-one-condition"><i class="fa fa-check"></i><b>5.4.1</b> if (one condition)</a></li>
<li class="chapter" data-level="5.4.2" data-path="functional_programming.html"><a href="functional_programming.html#if-else-two-conditions"><i class="fa fa-check"></i><b>5.4.2</b> if + else (two conditions)</a></li>
<li class="chapter" data-level="5.4.3" data-path="functional_programming.html"><a href="functional_programming.html#if-else-if-else-three-conditions"><i class="fa fa-check"></i><b>5.4.3</b> if + else if + else (three conditions)</a></li>
<li class="chapter" data-level="5.4.4" data-path="functional_programming.html"><a href="functional_programming.html#functions"><i class="fa fa-check"></i><b>5.4.4</b> Functions</a></li>
<li class="chapter" data-level="5.4.5" data-path="functional_programming.html"><a href="functional_programming.html#for-loop"><i class="fa fa-check"></i><b>5.4.5</b> for loop</a></li>
<li class="chapter" data-level="5.4.6" data-path="functional_programming.html"><a href="functional_programming.html#apply-family"><i class="fa fa-check"></i><b>5.4.6</b> apply family</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="functional_programming.html"><a href="functional_programming.html#purrr"><i class="fa fa-check"></i><b>5.5</b> purrr</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="functional_programming.html"><a href="functional_programming.html#why-map"><i class="fa fa-check"></i><b>5.5.1</b> Why map?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="functional_programming.html"><a href="functional_programming.html#map2"><i class="fa fa-check"></i><b>5.6</b> Automate 2 or 2+ tasks</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="functional_programming.html"><a href="functional_programming.html#objectives-2"><i class="fa fa-check"></i><b>5.6.1</b> Objectives</a></li>
<li class="chapter" data-level="5.6.2" data-path="functional_programming.html"><a href="functional_programming.html#problem"><i class="fa fa-check"></i><b>5.6.2</b> Problem</a></li>
<li class="chapter" data-level="5.6.3" data-path="functional_programming.html"><a href="functional_programming.html#for-loop-1"><i class="fa fa-check"></i><b>5.6.3</b> For loop</a></li>
<li class="chapter" data-level="5.6.4" data-path="functional_programming.html"><a href="functional_programming.html#map2-pmap"><i class="fa fa-check"></i><b>5.6.4</b> map2 &amp; pmap</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="functional_programming.html"><a href="functional_programming.html#glue"><i class="fa fa-check"></i><b>5.7</b> Automate plotting</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="functional_programming.html"><a href="functional_programming.html#objective"><i class="fa fa-check"></i><b>5.7.1</b> Objective</a></li>
<li class="chapter" data-level="5.7.2" data-path="functional_programming.html"><a href="functional_programming.html#problem-1"><i class="fa fa-check"></i><b>5.7.2</b> Problem</a></li>
<li class="chapter" data-level="5.7.3" data-path="functional_programming.html"><a href="functional_programming.html#solution"><i class="fa fa-check"></i><b>5.7.3</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="functional_programming.html"><a href="functional_programming.html#reduce"><i class="fa fa-check"></i><b>5.8</b> Automate joining</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="functional_programming.html"><a href="functional_programming.html#objective-1"><i class="fa fa-check"></i><b>5.8.1</b> Objective</a></li>
<li class="chapter" data-level="5.8.2" data-path="functional_programming.html"><a href="functional_programming.html#problem-2"><i class="fa fa-check"></i><b>5.8.2</b> Problem</a></li>
<li class="chapter" data-level="5.8.3" data-path="functional_programming.html"><a href="functional_programming.html#copy-and-paste"><i class="fa fa-check"></i><b>5.8.3</b> Copy and paste</a></li>
<li class="chapter" data-level="5.8.4" data-path="functional_programming.html"><a href="functional_programming.html#reduce-1"><i class="fa fa-check"></i><b>5.8.4</b> reduce</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="functional_programming.html"><a href="functional_programming.html#speed"><i class="fa fa-check"></i><b>5.9</b> Make automation slower or faster</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="functional_programming.html"><a href="functional_programming.html#objectives-3"><i class="fa fa-check"></i><b>5.9.1</b> Objectives</a></li>
<li class="chapter" data-level="5.9.2" data-path="functional_programming.html"><a href="functional_programming.html#how-to-make-automation-slower"><i class="fa fa-check"></i><b>5.9.2</b> How to Make Automation Slower</a></li>
<li class="chapter" data-level="5.9.3" data-path="functional_programming.html"><a href="functional_programming.html#how-to-make-automation-faster"><i class="fa fa-check"></i><b>5.9.3</b> How to Make Automation Faster</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="functional_programming.html"><a href="functional_programming.html#robustness"><i class="fa fa-check"></i><b>5.10</b> Make error handling easier</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="functional_programming.html"><a href="functional_programming.html#learning-objective"><i class="fa fa-check"></i><b>5.10.1</b> Learning objective</a></li>
<li class="chapter" data-level="5.10.2" data-path="functional_programming.html"><a href="functional_programming.html#solution-1"><i class="fa fa-check"></i><b>5.10.2</b> Solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="products.html"><a href="products.html"><i class="fa fa-check"></i><b>6</b> Developing data products</a>
<ul>
<li class="chapter" data-level="6.1" data-path="products.html"><a href="products.html#developing-r-packages"><i class="fa fa-check"></i><b>6.1</b> Developing R packages</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="products.html"><a href="products.html#the-big-picture-6"><i class="fa fa-check"></i><b>6.1.1</b> The Big Picture</a></li>
<li class="chapter" data-level="6.1.2" data-path="products.html"><a href="products.html#workflow"><i class="fa fa-check"></i><b>6.1.2</b> Workflow</a></li>
<li class="chapter" data-level="6.1.3" data-path="products.html"><a href="products.html#required-components"><i class="fa fa-check"></i><b>6.1.3</b> Required Components</a></li>
<li class="chapter" data-level="6.1.4" data-path="products.html"><a href="products.html#optional-components"><i class="fa fa-check"></i><b>6.1.4</b> Optional Components</a></li>
<li class="chapter" data-level="6.1.5" data-path="products.html"><a href="products.html#building-an-r-package"><i class="fa fa-check"></i><b>6.1.5</b> Building an R package</a></li>
<li class="chapter" data-level="6.1.6" data-path="products.html"><a href="products.html#distributing-an-r-package"><i class="fa fa-check"></i><b>6.1.6</b> Distributing an R package</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="products.html"><a href="products.html#developing-shiny-apps"><i class="fa fa-check"></i><b>6.2</b> Developing Shiny apps</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="products.html"><a href="products.html#workflow-1"><i class="fa fa-check"></i><b>6.2.1</b> Workflow</a></li>
<li class="chapter" data-level="6.2.2" data-path="products.html"><a href="products.html#app.r"><i class="fa fa-check"></i><b>6.2.2</b> app.r</a></li>
<li class="chapter" data-level="6.2.3" data-path="products.html"><a href="products.html#deployment"><i class="fa fa-check"></i><b>6.2.3</b> Deployment</a></li>
<li class="chapter" data-level="6.2.4" data-path="products.html"><a href="products.html#references-3"><i class="fa fa-check"></i><b>6.2.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="products.html"><a href="products.html#other-useful-data-products"><i class="fa fa-check"></i><b>6.3</b> Other useful data products</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="semi_structured_data.html"><a href="semi_structured_data.html"><i class="fa fa-check"></i><b>7</b> Semi-structured data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="semi_structured_data.html"><a href="semi_structured_data.html#setup-4"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="semi_structured_data.html"><a href="semi_structured_data.html#the-big-picture-7"><i class="fa fa-check"></i><b>7.2</b> The Big Picture</a></li>
<li class="chapter" data-level="7.3" data-path="semi_structured_data.html"><a href="semi_structured_data.html#what-is-semi-structured-data"><i class="fa fa-check"></i><b>7.3</b> What is semi-structured data?</a></li>
<li class="chapter" data-level="7.4" data-path="semi_structured_data.html"><a href="semi_structured_data.html#workflow-2"><i class="fa fa-check"></i><b>7.4</b> Workflow</a></li>
<li class="chapter" data-level="7.5" data-path="semi_structured_data.html"><a href="semi_structured_data.html#htmlcss-web-scraping"><i class="fa fa-check"></i><b>7.5</b> HTML/CSS: web scraping</a></li>
<li class="chapter" data-level="7.6" data-path="semi_structured_data.html"><a href="semi_structured_data.html#xmljson-government-databasesocial-media-scraping"><i class="fa fa-check"></i><b>7.6</b> XML/JSON: government database/social media scraping</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="semi_structured_data.html"><a href="semi_structured_data.html#governemnt-database-xml"><i class="fa fa-check"></i><b>7.6.1</b> Governemnt database (XML)</a></li>
<li class="chapter" data-level="7.6.2" data-path="semi_structured_data.html"><a href="semi_structured_data.html#social-media-api-json"><i class="fa fa-check"></i><b>7.6.2</b> Social media API (JSON)</a></li>
<li class="chapter" data-level="7.6.3" data-path="semi_structured_data.html"><a href="semi_structured_data.html#next-steps"><i class="fa fa-check"></i><b>7.6.3</b> Next steps</a></li>
<li class="chapter" data-level="7.6.4" data-path="semi_structured_data.html"><a href="semi_structured_data.html#rtweet"><i class="fa fa-check"></i><b>7.6.4</b> rtweet</a></li>
<li class="chapter" data-level="7.6.5" data-path="semi_structured_data.html"><a href="semi_structured_data.html#hydrating"><i class="fa fa-check"></i><b>7.6.5</b> Hydrating</a></li>
<li class="chapter" data-level="7.6.6" data-path="semi_structured_data.html"><a href="semi_structured_data.html#parsing-json"><i class="fa fa-check"></i><b>7.6.6</b> Parsing JSON</a></li>
<li class="chapter" data-level="7.6.7" data-path="semi_structured_data.html"><a href="semi_structured_data.html#getting-api-data-from-scratch"><i class="fa fa-check"></i><b>7.6.7</b> Getting API data from scratch</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="machine_learning.html"><a href="machine_learning.html"><i class="fa fa-check"></i><b>8</b> High-dimensional data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="machine_learning.html"><a href="machine_learning.html#the-big-picture-8"><i class="fa fa-check"></i><b>8.1</b> The Big Picture</a></li>
<li class="chapter" data-level="8.2" data-path="machine_learning.html"><a href="machine_learning.html#dataset"><i class="fa fa-check"></i><b>8.2</b> Dataset</a></li>
<li class="chapter" data-level="8.3" data-path="machine_learning.html"><a href="machine_learning.html#workflow-3"><i class="fa fa-check"></i><b>8.3</b> Workflow</a></li>
<li class="chapter" data-level="8.4" data-path="machine_learning.html"><a href="machine_learning.html#tidymodels"><i class="fa fa-check"></i><b>8.4</b> tidymodels</a></li>
<li class="chapter" data-level="8.5" data-path="machine_learning.html"><a href="machine_learning.html#pre-processing"><i class="fa fa-check"></i><b>8.5</b> Pre-processing</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="machine_learning.html"><a href="machine_learning.html#regression-setup"><i class="fa fa-check"></i><b>8.5.1</b> Regression setup</a></li>
<li class="chapter" data-level="8.5.2" data-path="machine_learning.html"><a href="machine_learning.html#classification-setup"><i class="fa fa-check"></i><b>8.5.2</b> Classification setup</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="machine_learning.html"><a href="machine_learning.html#supervised-learning"><i class="fa fa-check"></i><b>8.6</b> Supervised learning</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="machine_learning.html"><a href="machine_learning.html#ols-and-lasso"><i class="fa fa-check"></i><b>8.6.1</b> OLS and Lasso</a></li>
<li class="chapter" data-level="8.6.2" data-path="machine_learning.html"><a href="machine_learning.html#decision-tree"><i class="fa fa-check"></i><b>8.6.2</b> Decision tree</a></li>
<li class="chapter" data-level="8.6.3" data-path="machine_learning.html"><a href="machine_learning.html#bagging-random-forest"><i class="fa fa-check"></i><b>8.6.3</b> Bagging (Random forest)</a></li>
<li class="chapter" data-level="8.6.4" data-path="machine_learning.html"><a href="machine_learning.html#boosting-xgboost"><i class="fa fa-check"></i><b>8.6.4</b> Boosting (XGboost)</a></li>
<li class="chapter" data-level="8.6.5" data-path="machine_learning.html"><a href="machine_learning.html#stacking-superlearner"><i class="fa fa-check"></i><b>8.6.5</b> Stacking (SuperLearner)</a></li>
<li class="chapter" data-level="8.6.6" data-path="machine_learning.html"><a href="machine_learning.html#applications-2"><i class="fa fa-check"></i><b>8.6.6</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="machine_learning.html"><a href="machine_learning.html#unsupervised-learning"><i class="fa fa-check"></i><b>8.7</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="machine_learning.html"><a href="machine_learning.html#dimension-reduction"><i class="fa fa-check"></i><b>8.7.1</b> Dimension reduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="machine_learning.html"><a href="machine_learning.html#topic-modeling"><i class="fa fa-check"></i><b>8.7.2</b> Topic modeling</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="machine_learning.html"><a href="machine_learning.html#references-4"><i class="fa fa-check"></i><b>8.8</b> References</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="machine_learning.html"><a href="machine_learning.html#books"><i class="fa fa-check"></i><b>8.8.1</b> Books</a></li>
<li class="chapter" data-level="8.8.2" data-path="machine_learning.html"><a href="machine_learning.html#lecture-slides"><i class="fa fa-check"></i><b>8.8.2</b> Lecture slides</a></li>
<li class="chapter" data-level="8.8.3" data-path="machine_learning.html"><a href="machine_learning.html#blog-posts"><i class="fa fa-check"></i><b>8.8.3</b> Blog posts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big_data.html"><a href="big_data.html"><i class="fa fa-check"></i><b>9</b> Big data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="big_data.html"><a href="big_data.html#the-big-picture-9"><i class="fa fa-check"></i><b>9.1</b> The Big Picture</a></li>
<li class="chapter" data-level="9.2" data-path="big_data.html"><a href="big_data.html#sql"><i class="fa fa-check"></i><b>9.2</b> SQL</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="big_data.html"><a href="big_data.html#learning-objectives"><i class="fa fa-check"></i><b>9.2.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2.2" data-path="big_data.html"><a href="big_data.html#sql-and-r"><i class="fa fa-check"></i><b>9.2.2</b> SQL and R</a></li>
<li class="chapter" data-level="9.2.3" data-path="big_data.html"><a href="big_data.html#setup-7"><i class="fa fa-check"></i><b>9.2.3</b> Setup</a></li>
<li class="chapter" data-level="9.2.4" data-path="big_data.html"><a href="big_data.html#packages-1"><i class="fa fa-check"></i><b>9.2.4</b> Packages</a></li>
<li class="chapter" data-level="9.2.5" data-path="big_data.html"><a href="big_data.html#nyc-flights-data"><i class="fa fa-check"></i><b>9.2.5</b> NYC flights data</a></li>
<li class="chapter" data-level="9.2.6" data-path="big_data.html"><a href="big_data.html#workflow-4"><i class="fa fa-check"></i><b>9.2.6</b> Workflow</a></li>
<li class="chapter" data-level="9.2.7" data-path="big_data.html"><a href="big_data.html#things-we-didnt-cover"><i class="fa fa-check"></i><b>9.2.7</b> Things we didn’t cover</a></li>
<li class="chapter" data-level="9.2.8" data-path="big_data.html"><a href="big_data.html#references-5"><i class="fa fa-check"></i><b>9.2.8</b> References</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jaeyk/PS239T/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Thinking for Social Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="machine_learning" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> High-dimensional data</h1>
<div id="the-big-picture-8" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> The Big Picture</h2>
<ul>
<li><p>The rise of high-dimensional data. The new data frontiers in social sciences—text (<a href="https://web.stanford.edu/~gentzkow/research/text-as-data.pdf">Gentzkow et al. 2019</a>; <a href="https://www.jstor.org/stable/pdf/24572662.pdf?casa_token=SQdSI4R_VdwAAAAA:4QiVLhCXqr9f0qNMM9U75EL5JbDxxnXxUxyIfDf0U8ZzQx9szc0xVqaU6DXG4nHyZiNkvcwGlgD6H0Lxj3y0ULHwgkf1MZt8-9TPVtkEH9I4AHgbTg">Grimmer and Stewart 2013</a>) and and image (<a href="https://arxiv.org/pdf/1810.01544">Joo and Steinert-Threlkeld 2018</a>)—are all high-dimensional data.</p>
<ul>
<li><p>1000 common English words for 30-word tweets: <span class="math inline">\(1000^{30}\)</span> similar to N of atoms in the universe (<a href="https://web.stanford.edu/~gentzkow/research/text-as-data.pdf">Gentzkow et al. 2019</a>)</p></li>
<li><p>Belloni, Alexandre, Victor Chernozhukov, and Christian Hansen. <a href="https://pubs.aeaweb.org/doi/pdfplus/10.1257/jep.28.2.29">“High-dimensional methods and inference on structural and treatment effects.”</a> <em>Journal of Economic Perspectives 28</em>, no. 2 (2014): 29-50.</p></li>
</ul></li>
<li><p>The rise of the new approach: statistics + computer science = machine learning</p></li>
<li><p>Statistical inference</p>
<ul>
<li><p><span class="math inline">\(y\)</span> &lt;- some probability models (e.g., linear regression, logistic regression) &lt;- <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(y\)</span> = <span class="math inline">\(X\beta\)</span> + <span class="math inline">\(\epsilon\)</span></p></li>
<li><p>The goal is to estimate <span class="math inline">\(\beta\)</span></p></li>
</ul></li>
<li><p>Machine learning</p>
<ul>
<li><p><span class="math inline">\(y\)</span> &lt;- unknown &lt;- <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(y\)</span> &lt;-&gt; decision trees, neutral nets &lt;-&gt; <span class="math inline">\(x\)</span></p></li>
<li><p>For the main idea behind prediction modeling, see Breiman, Leo (Berkeley stat faculty who passed away in 2005). <a href="https://projecteuclid.org/euclid.ss/1009213726">“Statistical modeling: The two cultures (with comments and a rejoinder by the author).”</a> <em>Statistical science</em> 16, no. 3 (2001): 199-231.</p></li>
<li><p>“The problem is to find an algorithm <span class="math inline">\(f(x)\)</span> such that for future <span class="math inline">\(x\)</span> in a test set, <span class="math inline">\(f(x)\)</span> will be a good predictor of <span class="math inline">\(y\)</span>.”</p></li>
<li><p>“There are <strong>two cultures</strong> in the use of statistical modeling to reach conclusions from data. One assumes that the data are generated by a <strong>given</strong> <strong>stochastic data model</strong>. The other uses <strong>algorithmic models</strong> and treats the data mechanism as <strong>unknown</strong>.”</p></li>
</ul></li>
<li><p>How ML differs from econometrics?</p></li>
<li><p>A review by Athey, Susan, and Guido W. Imbens. <a href="https://www.annualreviews.org/doi/full/10.1146/annurev-economics-080217-053433">“Machine learning methods that economists should know about.”</a> <em>Annual Review of Economics</em> 11 (2019): 685-725.</p></li>
<li><p>Stat:</p>
<ul>
<li><p>Specifying a target (i.e., an estimand)</p></li>
<li><p>Fitting a model to data using an objective function (e.g., the sum of squared errors)</p></li>
<li><p>Reporting point estimates (effect size) and standard errors (uncertainty)</p></li>
<li><p>Validation by yes-no using goodness-of-fit tests and residual examination</p></li>
</ul></li>
<li><p>ML:</p>
<ul>
<li><p>Developing algorithms (estimating <em>f(x)</em>)</p></li>
<li><p>Prediction power, not structural/causal parameters</p></li>
<li><p>Basically, high-dimensional data statistics (N &lt; P)</p></li>
<li><p>The major problem is to avoid <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">“the curse of dimensionality”</a> (<a href="https://towardsdatascience.com/the-curse-of-dimensionality-50dc6e49aa1e">too many features - &gt; overfitting</a>)</p></li>
<li><p>Validation: out-of-sample comparisons (cross-validation) not in-sample goodness-of-fit measures</p></li>
<li><p>So, it’s curve-fitting, but the primary focus is unseen (test data), not seen data (training data)</p></li>
</ul></li>
<li><p>A quick review on ML lingos for those trained in econometrics</p>
<ul>
<li><p>Sample to estimate parameters = Training sample</p></li>
<li><p>Estimating the model = Being trained</p></li>
<li><p>Regressors, covariates, or predictors = Features</p></li>
<li><p>Regression parameters = weights</p></li>
<li><p>Prediction problems = Supervised (some <span class="math inline">\(y\)</span> are known) + Unsupervised (<span class="math inline">\(y\)</span> unknown)</p></li>
</ul></li>
</ul>
<div class="figure">
<img src="https://i.vas3k.ru/7w9.jpg" alt="" />
<p class="caption">How to teach machines. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a>. Many images in this chapter come from vas3k blog.</p>
</div>
<div class="figure">
<img src="https://i.vas3k.ru/7vz.jpg" alt="" />
<p class="caption">The main types of machine learning. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></p>
</div>
<div class="figure">
<img src="https://i.vas3k.ru/7vx.jpg" alt="" />
<p class="caption">The map of the machine learning universe. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></p>
</div>
<div class="figure">
<img src="https://i.vas3k.ru/7w1.jpg" alt="" />
<p class="caption">Classical machine learning. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></p>
</div>
</div>
<div id="dataset" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Dataset</h2>
<ul>
<li><p><a href="https://archive.ics.uci.edu/ml/datasets/heart+Disease">Heart disease data from UCI</a></p></li>
<li><p>One of the popular datasets used in machine learning competitions</p></li>
</ul>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="machine_learning.html#cb1097-1" aria-hidden="true"></a><span class="co"># Load packages</span></span>
<span id="cb1097-2"><a href="machine_learning.html#cb1097-2" aria-hidden="true"></a></span>
<span id="cb1097-3"><a href="machine_learning.html#cb1097-3" aria-hidden="true"></a><span class="co">## CRAN packages</span></span>
<span id="cb1097-4"><a href="machine_learning.html#cb1097-4" aria-hidden="true"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb1097-5"><a href="machine_learning.html#cb1097-5" aria-hidden="true"></a>  here,</span>
<span id="cb1097-6"><a href="machine_learning.html#cb1097-6" aria-hidden="true"></a>  tidyverse,</span>
<span id="cb1097-7"><a href="machine_learning.html#cb1097-7" aria-hidden="true"></a>  tidymodels,</span>
<span id="cb1097-8"><a href="machine_learning.html#cb1097-8" aria-hidden="true"></a>  doParallel, <span class="co"># parallel processing</span></span>
<span id="cb1097-9"><a href="machine_learning.html#cb1097-9" aria-hidden="true"></a>  patchwork, <span class="co"># arranging ggplots</span></span>
<span id="cb1097-10"><a href="machine_learning.html#cb1097-10" aria-hidden="true"></a>  remotes,</span>
<span id="cb1097-11"><a href="machine_learning.html#cb1097-11" aria-hidden="true"></a>  SuperLearner,</span>
<span id="cb1097-12"><a href="machine_learning.html#cb1097-12" aria-hidden="true"></a>  vip,</span>
<span id="cb1097-13"><a href="machine_learning.html#cb1097-13" aria-hidden="true"></a>  tidymodels,</span>
<span id="cb1097-14"><a href="machine_learning.html#cb1097-14" aria-hidden="true"></a>  glmnet,</span>
<span id="cb1097-15"><a href="machine_learning.html#cb1097-15" aria-hidden="true"></a>  xgboost,</span>
<span id="cb1097-16"><a href="machine_learning.html#cb1097-16" aria-hidden="true"></a>  rpart,</span>
<span id="cb1097-17"><a href="machine_learning.html#cb1097-17" aria-hidden="true"></a>  ranger,</span>
<span id="cb1097-18"><a href="machine_learning.html#cb1097-18" aria-hidden="true"></a>  conflicted</span>
<span id="cb1097-19"><a href="machine_learning.html#cb1097-19" aria-hidden="true"></a>)</span>
<span id="cb1097-20"><a href="machine_learning.html#cb1097-20" aria-hidden="true"></a></span>
<span id="cb1097-21"><a href="machine_learning.html#cb1097-21" aria-hidden="true"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ck37/ck37r&quot;</span>)</span></code></pre></div>
<pre><code>## Skipping install of &#39;ck37r&#39; from a github remote, the SHA1 (87085fff) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="machine_learning.html#cb1099-1" aria-hidden="true"></a>conflicted<span class="op">::</span><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Will prefer dplyr::filter over any other package</code></pre>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="machine_learning.html#cb1101-1" aria-hidden="true"></a><span class="co">## Jae&#39;s custom functions</span></span>
<span id="cb1101-2"><a href="machine_learning.html#cb1101-2" aria-hidden="true"></a><span class="kw">source</span>(<span class="kw">here</span>(<span class="st">&quot;functions&quot;</span>, <span class="st">&quot;ml_utils.r&quot;</span>))</span>
<span id="cb1101-3"><a href="machine_learning.html#cb1101-3" aria-hidden="true"></a></span>
<span id="cb1101-4"><a href="machine_learning.html#cb1101-4" aria-hidden="true"></a><span class="co"># Import the dataset</span></span>
<span id="cb1101-5"><a href="machine_learning.html#cb1101-5" aria-hidden="true"></a></span>
<span id="cb1101-6"><a href="machine_learning.html#cb1101-6" aria-hidden="true"></a>data_original &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;heart.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 303 Columns: 14</code></pre>
<pre><code>## ── Column specification ───────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (14): age, sex, cp, trestbps, chol, fbs, restecg, thalach, exang, oldpea...</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="machine_learning.html#cb1105-1" aria-hidden="true"></a><span class="kw">glimpse</span>(data_original)</span></code></pre></div>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5…
## $ sex      &lt;dbl&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1…
## $ cp       &lt;dbl&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0…
## $ trestbps &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1…
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2…
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1…
## $ thalach  &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1…
## $ exang    &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0…
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0…
## $ slope    &lt;dbl&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1…
## $ ca       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0…
## $ thal     &lt;dbl&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3…
## $ target   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="machine_learning.html#cb1107-1" aria-hidden="true"></a><span class="co"># Createa a copy</span></span>
<span id="cb1107-2"><a href="machine_learning.html#cb1107-2" aria-hidden="true"></a>data &lt;-<span class="st"> </span>data_original</span>
<span id="cb1107-3"><a href="machine_learning.html#cb1107-3" aria-hidden="true"></a></span>
<span id="cb1107-4"><a href="machine_learning.html#cb1107-4" aria-hidden="true"></a><span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</span></code></pre></div>
</div>
<div id="workflow-3" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Workflow</h2>
<ul>
<li><ol style="list-style-type: decimal">
<li>Preprocessing</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Model building</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Model fitting</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>Model evaluation</li>
</ol></li>
<li><ol start="5" style="list-style-type: decimal">
<li>Model tuning</li>
</ol></li>
<li><ol start="6" style="list-style-type: decimal">
<li>Prediction</li>
</ol></li>
</ul>
</div>
<div id="tidymodels" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> tidymodels</h2>
<ul>
<li><p>Like <code>tidyverse</code>, <code>tidymodels</code> is a collection of packages.</p>
<ul>
<li><p><a href="https://rsample.tidymodels.org/"><code>rsample</code></a>: for data splitting</p></li>
<li><p><a href="https://recipes.tidymodels.org/index.html"><code>recipes</code></a>: for pre-processing</p></li>
<li><p><a href="https://www.tidyverse.org/blog/2018/11/parsnip-0-0-1/"><code>parsnip</code></a>: for model building</p>
<ul>
<li><a href="https://github.com/tidymodels/tune"><code>tune</code></a>: hyperparameter tuning</li>
</ul></li>
<li><p><a href="https://github.com/tidymodels/yardstick"><code>yardstick</code></a>: for model evaluations</p></li>
<li><p><a href="https://github.com/tidymodels/workflows"><code>workflows</code></a>: for bundling a pieplne that bundles together preprocessing, modeling, and post-processing requests</p></li>
</ul></li>
<li><p>Why taking a tidyverse approach to machine learning?</p></li>
<li><p>Benefits</p>
<ul>
<li><p>Readable code</p></li>
<li><p>Reusable data structures</p></li>
<li><p>Extendable code</p></li>
</ul></li>
</ul>
<div class="figure">
<img src="https://rviews.rstudio.com/post/2019-06-14-a-gentle-intro-to-tidymodels_files/figure-html/ds.png" alt="" />
<p class="caption">Tidymodels. From RStudio.</p>
</div>
<blockquote>
<p>tidymodels are an <strong>integrated, modular, extensible</strong> set of packages that implement a framework that facilitates creating predicative stochastic models. - Joseph <a href="mailto:Rickert@RStudio" class="email">Rickert@RStudio</a></p>
</blockquote>
<ul>
<li><p>Currently, 238 models are <a href="https://topepo.github.io/caret/available-models.html">available</a></p></li>
<li><p>The following materials are based on <a href="https://github.com/dlab-berkeley/Machine-Learning-with-tidymodels">the machine learning with tidymodels workshop</a> I developed for D-Lab. <a href="https://github.com/dlab-berkeley/Machine-Learning-in-R">The original workshop</a> was designed by <a href="https://ck37.com/">Chris Kennedy</a> and [Evan Muzzall](<a href="https://dlab.berkeley.edu/people/evan-muzzall" class="uri">https://dlab.berkeley.edu/people/evan-muzzall</a>.</p></li>
</ul>
</div>
<div id="pre-processing" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Pre-processing</h2>
<ul>
<li><p><a href="https://recipes.tidymodels.org/index.html"><code>recipes</code></a>: for pre-processing</p></li>
<li><p><a href="https://github.com/tidymodels/textrecipes"><code>textrecipes</code></a> for text pre-processing</p></li>
<li><p>Step 1: <code>recipe()</code> defines target and predictor variables (ingredients).</p></li>
<li><p>Step 2: <code>step_*()</code> defines preprocessing steps to be taken (recipe).</p>
<p>The preprocessing steps list draws on the vignette of the <a href="https://www.tidymodels.org/find/parsnip/"><code>parsnip</code></a> package.</p>
<ul>
<li><p>dummy: Also called one-hot encoding</p></li>
<li><p>zero variance: Removing columns (or features) with a single unique value</p></li>
<li><p>impute: Imputing missing values</p></li>
<li><p>decorrelate: Mitigating correlated predictors (e.g., principal component analysis)</p></li>
<li><p>normalize: Centering and/or scaling predictors (e.g., log scaling). Scaling matters because many algorithms (e.g., lasso) are scale-variant (except tree-based algorithms). Remind you that normalization (sensitive to outliers) = <span class="math inline">\(\frac{X - X_{min}}{X_{max} - X_{min}}\)</span> and standardization (not sensitive to outliers) = <span class="math inline">\(\frac{X - \mu}{\sigma}\)</span></p></li>
<li><p>transform: Making predictors symmetric</p></li>
</ul></li>
<li><p>Step 3: <code>prep()</code> prepares a dataset to base each step on.</p></li>
<li><p>Step 4: <code>bake()</code> applies the preprocessing steps to your datasets.</p></li>
</ul>
<p>In this course, we focus on two preprocessing tasks.</p>
<ul>
<li>One-hot encoding (creating dummy/indicator variables)</li>
</ul>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="machine_learning.html#cb1108-1" aria-hidden="true"></a><span class="co"># Turn selected numeric variables into factor variables</span></span>
<span id="cb1108-2"><a href="machine_learning.html#cb1108-2" aria-hidden="true"></a>data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb1108-3"><a href="machine_learning.html#cb1108-3" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>), as.factor))</span>
<span id="cb1108-4"><a href="machine_learning.html#cb1108-4" aria-hidden="true"></a></span>
<span id="cb1108-5"><a href="machine_learning.html#cb1108-5" aria-hidden="true"></a><span class="kw">glimpse</span>(data)</span></code></pre></div>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5…
## $ sex      &lt;fct&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1…
## $ cp       &lt;fct&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0…
## $ trestbps &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1…
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2…
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1…
## $ thalach  &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1…
## $ exang    &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0…
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0…
## $ slope    &lt;fct&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1…
## $ ca       &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0…
## $ thal     &lt;fct&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3…
## $ target   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<ul>
<li>Imputation</li>
</ul>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="machine_learning.html#cb1110-1" aria-hidden="true"></a><span class="co"># Check missing values</span></span>
<span id="cb1110-2"><a href="machine_learning.html#cb1110-2" aria-hidden="true"></a></span>
<span id="cb1110-3"><a href="machine_learning.html#cb1110-3" aria-hidden="true"></a><span class="kw">map_df</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
## 1     0     0     0        0     0     0       0       0     0       0     0
## # … with 3 more variables: ca &lt;int&gt;, thal &lt;int&gt;, target &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="machine_learning.html#cb1112-1" aria-hidden="true"></a><span class="co"># Add missing values</span></span>
<span id="cb1112-2"><a href="machine_learning.html#cb1112-2" aria-hidden="true"></a></span>
<span id="cb1112-3"><a href="machine_learning.html#cb1112-3" aria-hidden="true"></a>data<span class="op">$</span>oldpeak[<span class="kw">sample</span>(<span class="kw">seq</span>(data), <span class="dt">size =</span> <span class="dv">10</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb1112-4"><a href="machine_learning.html#cb1112-4" aria-hidden="true"></a></span>
<span id="cb1112-5"><a href="machine_learning.html#cb1112-5" aria-hidden="true"></a><span class="co"># Check missing values</span></span>
<span id="cb1112-6"><a href="machine_learning.html#cb1112-6" aria-hidden="true"></a></span>
<span id="cb1112-7"><a href="machine_learning.html#cb1112-7" aria-hidden="true"></a><span class="co"># Check the number of missing values</span></span>
<span id="cb1112-8"><a href="machine_learning.html#cb1112-8" aria-hidden="true"></a>data <span class="op">%&gt;%</span></span>
<span id="cb1112-9"><a href="machine_learning.html#cb1112-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">map_df</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
## 1     0     0     0        0     0     0       0       0     0      10     0
## # … with 3 more variables: ca &lt;int&gt;, thal &lt;int&gt;, target &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="machine_learning.html#cb1114-1" aria-hidden="true"></a><span class="co"># Check the rate of missing values</span></span>
<span id="cb1114-2"><a href="machine_learning.html#cb1114-2" aria-hidden="true"></a>data <span class="op">%&gt;%</span></span>
<span id="cb1114-3"><a href="machine_learning.html#cb1114-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">map_df</span>(<span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     0     0        0     0     0       0       0     0  0.0330     0
## # … with 3 more variables: ca &lt;dbl&gt;, thal &lt;dbl&gt;, target &lt;dbl&gt;</code></pre>
<div id="regression-setup" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Regression setup</h3>
<div id="outcome-variable" class="section level4" number="8.5.1.1">
<h4><span class="header-section-number">8.5.1.1</span> Outcome variable</h4>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="machine_learning.html#cb1116-1" aria-hidden="true"></a><span class="co"># Continuous variable</span></span>
<span id="cb1116-2"><a href="machine_learning.html#cb1116-2" aria-hidden="true"></a>data<span class="op">$</span>age <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
<div id="data-splitting-using-random-sampling" class="section level4" number="8.5.1.2">
<h4><span class="header-section-number">8.5.1.2</span> Data splitting using random sampling</h4>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="machine_learning.html#cb1118-1" aria-hidden="true"></a><span class="co"># for reproducibility</span></span>
<span id="cb1118-2"><a href="machine_learning.html#cb1118-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1118-3"><a href="machine_learning.html#cb1118-3" aria-hidden="true"></a></span>
<span id="cb1118-4"><a href="machine_learning.html#cb1118-4" aria-hidden="true"></a><span class="co"># split</span></span>
<span id="cb1118-5"><a href="machine_learning.html#cb1118-5" aria-hidden="true"></a>split_reg &lt;-<span class="st"> </span><span class="kw">initial_split</span>(data, <span class="dt">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb1118-6"><a href="machine_learning.html#cb1118-6" aria-hidden="true"></a></span>
<span id="cb1118-7"><a href="machine_learning.html#cb1118-7" aria-hidden="true"></a><span class="co"># training set</span></span>
<span id="cb1118-8"><a href="machine_learning.html#cb1118-8" aria-hidden="true"></a>raw_train_x_reg &lt;-<span class="st"> </span><span class="kw">training</span>(split_reg)</span>
<span id="cb1118-9"><a href="machine_learning.html#cb1118-9" aria-hidden="true"></a></span>
<span id="cb1118-10"><a href="machine_learning.html#cb1118-10" aria-hidden="true"></a><span class="co"># test set</span></span>
<span id="cb1118-11"><a href="machine_learning.html#cb1118-11" aria-hidden="true"></a>raw_test_x_reg &lt;-<span class="st"> </span><span class="kw">testing</span>(split_reg)</span></code></pre></div>
</div>
<div id="recipe" class="section level4" number="8.5.1.3">
<h4><span class="header-section-number">8.5.1.3</span> recipe</h4>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="machine_learning.html#cb1119-1" aria-hidden="true"></a><span class="co"># Regression recipe</span></span>
<span id="cb1119-2"><a href="machine_learning.html#cb1119-2" aria-hidden="true"></a>rec_reg &lt;-<span class="st"> </span>raw_train_x_reg <span class="op">%&gt;%</span></span>
<span id="cb1119-3"><a href="machine_learning.html#cb1119-3" aria-hidden="true"></a><span class="st">  </span><span class="co"># Define the outcome variable</span></span>
<span id="cb1119-4"><a href="machine_learning.html#cb1119-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">recipe</span>(age <span class="op">~</span><span class="st"> </span>.) <span class="op">%&gt;%</span></span>
<span id="cb1119-5"><a href="machine_learning.html#cb1119-5" aria-hidden="true"></a><span class="st">  </span><span class="co"># Median impute oldpeak column</span></span>
<span id="cb1119-6"><a href="machine_learning.html#cb1119-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_medianimpute</span>(oldpeak) <span class="op">%&gt;%</span></span>
<span id="cb1119-7"><a href="machine_learning.html#cb1119-7" aria-hidden="true"></a><span class="st">  </span><span class="co"># Expand &quot;sex&quot;, &quot;ca&quot;, &quot;cp&quot;, &quot;slope&quot;, and &quot;thal&quot; features out into dummy variables (indicators).</span></span>
<span id="cb1119-8"><a href="machine_learning.html#cb1119-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: `step_medianimpute()` was deprecated in recipes 0.1.16.
## Please use `step_impute_median()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="machine_learning.html#cb1121-1" aria-hidden="true"></a><span class="co"># Prepare a dataset to base each step on</span></span>
<span id="cb1121-2"><a href="machine_learning.html#cb1121-2" aria-hidden="true"></a>prep_reg &lt;-<span class="st"> </span>rec_reg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">prep</span>(<span class="dt">retain =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="machine_learning.html#cb1122-1" aria-hidden="true"></a><span class="co"># x features</span></span>
<span id="cb1122-2"><a href="machine_learning.html#cb1122-2" aria-hidden="true"></a>train_x_reg &lt;-<span class="st"> </span><span class="kw">juice</span>(prep_reg, <span class="kw">all_predictors</span>())</span>
<span id="cb1122-3"><a href="machine_learning.html#cb1122-3" aria-hidden="true"></a></span>
<span id="cb1122-4"><a href="machine_learning.html#cb1122-4" aria-hidden="true"></a>test_x_reg &lt;-<span class="st"> </span><span class="kw">bake</span>(</span>
<span id="cb1122-5"><a href="machine_learning.html#cb1122-5" aria-hidden="true"></a>  <span class="dt">object =</span> prep_reg,</span>
<span id="cb1122-6"><a href="machine_learning.html#cb1122-6" aria-hidden="true"></a>  <span class="dt">new_data =</span> raw_test_x_reg, <span class="kw">all_predictors</span>()</span>
<span id="cb1122-7"><a href="machine_learning.html#cb1122-7" aria-hidden="true"></a>)</span>
<span id="cb1122-8"><a href="machine_learning.html#cb1122-8" aria-hidden="true"></a></span>
<span id="cb1122-9"><a href="machine_learning.html#cb1122-9" aria-hidden="true"></a><span class="co"># y variables</span></span>
<span id="cb1122-10"><a href="machine_learning.html#cb1122-10" aria-hidden="true"></a>train_y_reg &lt;-<span class="st"> </span><span class="kw">juice</span>(prep_reg, <span class="kw">all_outcomes</span>())<span class="op">$</span>age <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()</span>
<span id="cb1122-11"><a href="machine_learning.html#cb1122-11" aria-hidden="true"></a>test_y_reg &lt;-<span class="st"> </span><span class="kw">bake</span>(prep_reg, raw_test_x_reg, <span class="kw">all_outcomes</span>())<span class="op">$</span>age <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()</span>
<span id="cb1122-12"><a href="machine_learning.html#cb1122-12" aria-hidden="true"></a></span>
<span id="cb1122-13"><a href="machine_learning.html#cb1122-13" aria-hidden="true"></a><span class="co"># Checks</span></span>
<span id="cb1122-14"><a href="machine_learning.html#cb1122-14" aria-hidden="true"></a><span class="kw">names</span>(train_x_reg) <span class="co"># Make sure there&#39;s no age variable!</span></span></code></pre></div>
<pre><code>##  [1] &quot;trestbps&quot; &quot;chol&quot;     &quot;fbs&quot;      &quot;restecg&quot;  &quot;thalach&quot;  &quot;exang&quot;   
##  [7] &quot;oldpeak&quot;  &quot;target&quot;   &quot;sex_X1&quot;   &quot;ca_X1&quot;    &quot;ca_X2&quot;    &quot;ca_X3&quot;   
## [13] &quot;ca_X4&quot;    &quot;cp_X1&quot;    &quot;cp_X2&quot;    &quot;cp_X3&quot;    &quot;slope_X1&quot; &quot;slope_X2&quot;
## [19] &quot;thal_X1&quot;  &quot;thal_X2&quot;  &quot;thal_X3&quot;</code></pre>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="machine_learning.html#cb1124-1" aria-hidden="true"></a><span class="kw">class</span>(train_y_reg) <span class="co"># Make sure this is a continuous variable!</span></span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<ul>
<li>Note that other imputation methods are also available.</li>
</ul>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="machine_learning.html#cb1126-1" aria-hidden="true"></a><span class="kw">grep</span>(<span class="st">&quot;impute&quot;</span>, <span class="kw">ls</span>(<span class="st">&quot;package:recipes&quot;</span>), <span class="dt">value =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;step_bagimpute&quot;     &quot;step_impute_bag&quot;    &quot;step_impute_knn&quot;   
##  [4] &quot;step_impute_linear&quot; &quot;step_impute_lower&quot;  &quot;step_impute_mean&quot;  
##  [7] &quot;step_impute_median&quot; &quot;step_impute_mode&quot;   &quot;step_impute_roll&quot;  
## [10] &quot;step_knnimpute&quot;     &quot;step_lowerimpute&quot;   &quot;step_meanimpute&quot;   
## [13] &quot;step_medianimpute&quot;  &quot;step_modeimpute&quot;    &quot;step_rollimpute&quot;</code></pre>
<ul>
<li>You can also create your own <code>step_</code> functions. For more information, see <a href="https://www.tidymodels.org/learn/develop/recipes/">tidymodels.org</a>.</li>
</ul>
</div>
</div>
<div id="classification-setup" class="section level3" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Classification setup</h3>
<div id="outcome-variable-1" class="section level4" number="8.5.2.1">
<h4><span class="header-section-number">8.5.2.1</span> Outcome variable</h4>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="machine_learning.html#cb1128-1" aria-hidden="true"></a>data<span class="op">$</span>target <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="machine_learning.html#cb1130-1" aria-hidden="true"></a>data<span class="op">$</span>target &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data<span class="op">$</span>target)</span>
<span id="cb1130-2"><a href="machine_learning.html#cb1130-2" aria-hidden="true"></a></span>
<span id="cb1130-3"><a href="machine_learning.html#cb1130-3" aria-hidden="true"></a>data<span class="op">$</span>target <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
<div id="data-splitting-using-stratified-random-sampling" class="section level4" number="8.5.2.2">
<h4><span class="header-section-number">8.5.2.2</span> Data splitting using stratified random sampling</h4>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="machine_learning.html#cb1132-1" aria-hidden="true"></a><span class="co"># split</span></span>
<span id="cb1132-2"><a href="machine_learning.html#cb1132-2" aria-hidden="true"></a>split_class &lt;-<span class="st"> </span><span class="kw">initial_split</span>(data <span class="op">%&gt;%</span></span>
<span id="cb1132-3"><a href="machine_learning.html#cb1132-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">target =</span> <span class="kw">as.factor</span>(target)),</span>
<span id="cb1132-4"><a href="machine_learning.html#cb1132-4" aria-hidden="true"></a><span class="dt">prop =</span> <span class="fl">0.7</span>,</span>
<span id="cb1132-5"><a href="machine_learning.html#cb1132-5" aria-hidden="true"></a><span class="dt">strata =</span> target</span>
<span id="cb1132-6"><a href="machine_learning.html#cb1132-6" aria-hidden="true"></a>)</span>
<span id="cb1132-7"><a href="machine_learning.html#cb1132-7" aria-hidden="true"></a></span>
<span id="cb1132-8"><a href="machine_learning.html#cb1132-8" aria-hidden="true"></a><span class="co"># training set</span></span>
<span id="cb1132-9"><a href="machine_learning.html#cb1132-9" aria-hidden="true"></a>raw_train_x_class &lt;-<span class="st"> </span><span class="kw">training</span>(split_class)</span>
<span id="cb1132-10"><a href="machine_learning.html#cb1132-10" aria-hidden="true"></a></span>
<span id="cb1132-11"><a href="machine_learning.html#cb1132-11" aria-hidden="true"></a><span class="co"># testing set</span></span>
<span id="cb1132-12"><a href="machine_learning.html#cb1132-12" aria-hidden="true"></a>raw_test_x_class &lt;-<span class="st"> </span><span class="kw">testing</span>(split_class)</span></code></pre></div>
</div>
<div id="recipe-1" class="section level4" number="8.5.2.3">
<h4><span class="header-section-number">8.5.2.3</span> recipe</h4>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="machine_learning.html#cb1133-1" aria-hidden="true"></a><span class="co"># Classification recipe</span></span>
<span id="cb1133-2"><a href="machine_learning.html#cb1133-2" aria-hidden="true"></a>rec_class &lt;-<span class="st"> </span>raw_train_x_class <span class="op">%&gt;%</span></span>
<span id="cb1133-3"><a href="machine_learning.html#cb1133-3" aria-hidden="true"></a><span class="st">  </span><span class="co"># Define the outcome variable</span></span>
<span id="cb1133-4"><a href="machine_learning.html#cb1133-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">recipe</span>(target <span class="op">~</span><span class="st"> </span>.) <span class="op">%&gt;%</span></span>
<span id="cb1133-5"><a href="machine_learning.html#cb1133-5" aria-hidden="true"></a><span class="st">  </span><span class="co"># Median impute oldpeak column</span></span>
<span id="cb1133-6"><a href="machine_learning.html#cb1133-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_medianimpute</span>(oldpeak) <span class="op">%&gt;%</span></span>
<span id="cb1133-7"><a href="machine_learning.html#cb1133-7" aria-hidden="true"></a><span class="st">  </span><span class="co"># Expand &quot;sex&quot;, &quot;ca&quot;, &quot;cp&quot;, &quot;slope&quot;, and &quot;thal&quot; features out into dummy variables (indicators).</span></span>
<span id="cb1133-8"><a href="machine_learning.html#cb1133-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_normalize</span>(age) <span class="op">%&gt;%</span></span>
<span id="cb1133-9"><a href="machine_learning.html#cb1133-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>))</span>
<span id="cb1133-10"><a href="machine_learning.html#cb1133-10" aria-hidden="true"></a></span>
<span id="cb1133-11"><a href="machine_learning.html#cb1133-11" aria-hidden="true"></a><span class="co"># Prepare a dataset to base each step on</span></span>
<span id="cb1133-12"><a href="machine_learning.html#cb1133-12" aria-hidden="true"></a>prep_class &lt;-<span class="st"> </span>rec_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">prep</span>(<span class="dt">retain =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="machine_learning.html#cb1134-1" aria-hidden="true"></a><span class="co"># x features</span></span>
<span id="cb1134-2"><a href="machine_learning.html#cb1134-2" aria-hidden="true"></a>train_x_class &lt;-<span class="st"> </span><span class="kw">juice</span>(prep_class, <span class="kw">all_predictors</span>())</span>
<span id="cb1134-3"><a href="machine_learning.html#cb1134-3" aria-hidden="true"></a>test_x_class &lt;-<span class="st"> </span><span class="kw">bake</span>(prep_class, raw_test_x_class, <span class="kw">all_predictors</span>())</span>
<span id="cb1134-4"><a href="machine_learning.html#cb1134-4" aria-hidden="true"></a></span>
<span id="cb1134-5"><a href="machine_learning.html#cb1134-5" aria-hidden="true"></a><span class="co"># y variables</span></span>
<span id="cb1134-6"><a href="machine_learning.html#cb1134-6" aria-hidden="true"></a>train_y_class &lt;-<span class="st"> </span><span class="kw">juice</span>(prep_class, <span class="kw">all_outcomes</span>())<span class="op">$</span>target <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>()</span>
<span id="cb1134-7"><a href="machine_learning.html#cb1134-7" aria-hidden="true"></a>test_y_class &lt;-<span class="st"> </span><span class="kw">bake</span>(prep_class, raw_test_x_class, <span class="kw">all_outcomes</span>())<span class="op">$</span>target <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>()</span>
<span id="cb1134-8"><a href="machine_learning.html#cb1134-8" aria-hidden="true"></a></span>
<span id="cb1134-9"><a href="machine_learning.html#cb1134-9" aria-hidden="true"></a><span class="co"># Checks</span></span>
<span id="cb1134-10"><a href="machine_learning.html#cb1134-10" aria-hidden="true"></a><span class="kw">names</span>(train_x_class) <span class="co"># Make sure there&#39;s no target variable!</span></span></code></pre></div>
<pre><code>##  [1] &quot;age&quot;      &quot;trestbps&quot; &quot;chol&quot;     &quot;fbs&quot;      &quot;restecg&quot;  &quot;thalach&quot; 
##  [7] &quot;exang&quot;    &quot;oldpeak&quot;  &quot;sex_X1&quot;   &quot;ca_X1&quot;    &quot;ca_X2&quot;    &quot;ca_X3&quot;   
## [13] &quot;ca_X4&quot;    &quot;cp_X1&quot;    &quot;cp_X2&quot;    &quot;cp_X3&quot;    &quot;slope_X1&quot; &quot;slope_X2&quot;
## [19] &quot;thal_X1&quot;  &quot;thal_X2&quot;  &quot;thal_X3&quot;</code></pre>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="machine_learning.html#cb1136-1" aria-hidden="true"></a><span class="kw">class</span>(train_y_class) <span class="co"># Make sure this is a factor variable!</span></span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
</div>
</div>
<div id="supervised-learning" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Supervised learning</h2>
<p>x -&gt; f - &gt; y (defined)</p>
<div id="ols-and-lasso" class="section level3" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> OLS and Lasso</h3>
<div id="parsnip" class="section level4" number="8.6.1.1">
<h4><span class="header-section-number">8.6.1.1</span> parsnip</h4>
<ul>
<li>Build models (<code>parsnip</code>)</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="machine_learning.html#cb1138-1" aria-hidden="true"></a><span class="co"># OLS spec</span></span>
<span id="cb1138-2"><a href="machine_learning.html#cb1138-2" aria-hidden="true"></a>ols_spec &lt;-<span class="st"> </span><span class="kw">linear_reg</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Specify a model</span></span>
<span id="cb1138-3"><a href="machine_learning.html#cb1138-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Specify an engine: lm, glmnet, stan, keras, spark</span></span>
<span id="cb1138-4"><a href="machine_learning.html#cb1138-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="co"># Declare a mode: regression or classification</span></span></code></pre></div>
<div class="figure">
<img src="http://ethen8181.github.io/machine-learning/regularization/images/lasso_ridge_coefficients.png" alt="" />
<p class="caption">Source: <a href="http://ethen8181.github.io" class="uri">http://ethen8181.github.io</a></p>
</div>
<p>Lasso is one of the regularization techniques along with ridge and elastic-net.</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="machine_learning.html#cb1139-1" aria-hidden="true"></a><span class="co"># Lasso spec</span></span>
<span id="cb1139-2"><a href="machine_learning.html#cb1139-2" aria-hidden="true"></a>lasso_spec &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(</span>
<span id="cb1139-3"><a href="machine_learning.html#cb1139-3" aria-hidden="true"></a>  <span class="dt">penalty =</span> <span class="fl">0.1</span>, <span class="co"># tuning hyperparameter</span></span>
<span id="cb1139-4"><a href="machine_learning.html#cb1139-4" aria-hidden="true"></a>  <span class="dt">mixture =</span> <span class="dv">1</span></span>
<span id="cb1139-5"><a href="machine_learning.html#cb1139-5" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1139-6"><a href="machine_learning.html#cb1139-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1139-7"><a href="machine_learning.html#cb1139-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1139-8"><a href="machine_learning.html#cb1139-8" aria-hidden="true"></a></span>
<span id="cb1139-9"><a href="machine_learning.html#cb1139-9" aria-hidden="true"></a><span class="co"># If you don&#39;t understand parsnip arguments</span></span>
<span id="cb1139-10"><a href="machine_learning.html#cb1139-10" aria-hidden="true"></a>lasso_spec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">translate</span>() <span class="co"># See the documentation</span></span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.1
##   mixture = 1
## 
## Computational engine: glmnet 
## 
## Model fit template:
## glmnet::glmnet(x = missing_arg(), y = missing_arg(), weights = missing_arg(), 
##     alpha = 1, family = &quot;gaussian&quot;)</code></pre>
<ul>
<li>Fit models</li>
</ul>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="machine_learning.html#cb1141-1" aria-hidden="true"></a>ols_fit &lt;-<span class="st"> </span>ols_spec <span class="op">%&gt;%</span></span>
<span id="cb1141-2"><a href="machine_learning.html#cb1141-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit_xy</span>(<span class="dt">x =</span> train_x_reg, <span class="dt">y =</span> train_y_reg)</span>
<span id="cb1141-3"><a href="machine_learning.html#cb1141-3" aria-hidden="true"></a><span class="co"># fit(train_y_reg ~ ., train_x_reg) # When you data are not preprocessed</span></span>
<span id="cb1141-4"><a href="machine_learning.html#cb1141-4" aria-hidden="true"></a></span>
<span id="cb1141-5"><a href="machine_learning.html#cb1141-5" aria-hidden="true"></a>lasso_fit &lt;-<span class="st"> </span>lasso_spec <span class="op">%&gt;%</span></span>
<span id="cb1141-6"><a href="machine_learning.html#cb1141-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit_xy</span>(<span class="dt">x =</span> train_x_reg, <span class="dt">y =</span> train_y_reg)</span></code></pre></div>
</div>
<div id="yardstick" class="section level4" number="8.6.1.2">
<h4><span class="header-section-number">8.6.1.2</span> yardstick</h4>
<ul>
<li>Visualize model fits</li>
</ul>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="machine_learning.html#cb1142-1" aria-hidden="true"></a><span class="kw">map2</span>(<span class="kw">list</span>(ols_fit, lasso_fit), <span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), visualize_fit)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="machine_learning.html#cb1145-1" aria-hidden="true"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1145-2"><a href="machine_learning.html#cb1145-2" aria-hidden="true"></a>metrics &lt;-<span class="st"> </span>yardstick<span class="op">::</span><span class="kw">metric_set</span>(rmse, mae, rsq)</span>
<span id="cb1145-3"><a href="machine_learning.html#cb1145-3" aria-hidden="true"></a></span>
<span id="cb1145-4"><a href="machine_learning.html#cb1145-4" aria-hidden="true"></a><span class="co"># Evaluate many models</span></span>
<span id="cb1145-5"><a href="machine_learning.html#cb1145-5" aria-hidden="true"></a>evals &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="kw">list</span>(ols_fit, lasso_fit), evaluate_reg) <span class="op">%&gt;%</span></span>
<span id="cb1145-6"><a href="machine_learning.html#cb1145-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">reduce</span>(bind_rows) <span class="op">%&gt;%</span></span>
<span id="cb1145-7"><a href="machine_learning.html#cb1145-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), <span class="dt">each =</span> <span class="dv">3</span>))</span>
<span id="cb1145-8"><a href="machine_learning.html#cb1145-8" aria-hidden="true"></a></span>
<span id="cb1145-9"><a href="machine_learning.html#cb1145-9" aria-hidden="true"></a><span class="co"># Visualize the test results</span></span>
<span id="cb1145-10"><a href="machine_learning.html#cb1145-10" aria-hidden="true"></a>evals <span class="op">%&gt;%</span></span>
<span id="cb1145-11"><a href="machine_learning.html#cb1145-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(type, .estimate), <span class="dt">y =</span> .estimate)) <span class="op">+</span></span>
<span id="cb1145-12"><a href="machine_learning.html#cb1145-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1145-13"><a href="machine_learning.html#cb1145-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1145-14"><a href="machine_learning.html#cb1145-14" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb1145-15"><a href="machine_learning.html#cb1145-15" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Estimate&quot;</span></span>
<span id="cb1145-16"><a href="machine_learning.html#cb1145-16" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1145-17"><a href="machine_learning.html#cb1145-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>), <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-20-1.png" width="672" />
- For more information, read <a href="https://www.tmwr.org/">Tidy Modeling with R</a> by Max Kuhn and Julia Silge.</p>
</div>
<div id="tune" class="section level4" number="8.6.1.3">
<h4><span class="header-section-number">8.6.1.3</span> tune</h4>
<p><strong>Hyper</strong>parameters are parameters that control the learning process.</p>
<div id="tune-ingredients" class="section level5" number="8.6.1.3.1">
<h5><span class="header-section-number">8.6.1.3.1</span> tune ingredients</h5>
<ul>
<li>Search space for hyperparameters</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Grid search: a grid of hyperparameters</p></li>
<li><p>Random search: random sample points from a bounded domain</p></li>
</ol>
<p><img src="https://www.programmersought.com/images/523/7e44435f20fe514c11ca0d930af8547b.png" /></p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="machine_learning.html#cb1146-1" aria-hidden="true"></a><span class="co"># tune() = placeholder</span></span>
<span id="cb1146-2"><a href="machine_learning.html#cb1146-2" aria-hidden="true"></a></span>
<span id="cb1146-3"><a href="machine_learning.html#cb1146-3" aria-hidden="true"></a>tune_spec &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(</span>
<span id="cb1146-4"><a href="machine_learning.html#cb1146-4" aria-hidden="true"></a>  <span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="co"># tuning hyperparameter</span></span>
<span id="cb1146-5"><a href="machine_learning.html#cb1146-5" aria-hidden="true"></a>  <span class="dt">mixture =</span> <span class="dv">1</span></span>
<span id="cb1146-6"><a href="machine_learning.html#cb1146-6" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1146-7"><a href="machine_learning.html#cb1146-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1146-8"><a href="machine_learning.html#cb1146-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1146-9"><a href="machine_learning.html#cb1146-9" aria-hidden="true"></a></span>
<span id="cb1146-10"><a href="machine_learning.html#cb1146-10" aria-hidden="true"></a>tune_spec</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="machine_learning.html#cb1148-1" aria-hidden="true"></a><span class="co"># penalty() searches 50 possible combinations</span></span>
<span id="cb1148-2"><a href="machine_learning.html#cb1148-2" aria-hidden="true"></a></span>
<span id="cb1148-3"><a href="machine_learning.html#cb1148-3" aria-hidden="true"></a>lambda_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">penalty</span>(), <span class="dt">levels =</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="figure">
<img src="https://www.googleapis.com/download/storage/v1/b/kaggle-forum-message-attachments/o/inbox%2F4788946%2F82b5a41b6693a313b246f02d79e972d5%2FK%20FOLD.png?generation=1608195745131795&amp;alt=media" alt="" />
<p class="caption">Source: Kaggle</p>
</div>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="machine_learning.html#cb1149-1" aria-hidden="true"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1149-2"><a href="machine_learning.html#cb1149-2" aria-hidden="true"></a></span>
<span id="cb1149-3"><a href="machine_learning.html#cb1149-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1149-4"><a href="machine_learning.html#cb1149-4" aria-hidden="true"></a></span>
<span id="cb1149-5"><a href="machine_learning.html#cb1149-5" aria-hidden="true"></a>rec_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_x_reg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">age =</span> train_y_reg)))</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow" class="section level5" number="8.6.1.3.2">
<h5><span class="header-section-number">8.6.1.3.2</span> Add these elements to a workflow</h5>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="machine_learning.html#cb1150-1" aria-hidden="true"></a><span class="co"># Workflow</span></span>
<span id="cb1150-2"><a href="machine_learning.html#cb1150-2" aria-hidden="true"></a>rec_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb1150-3"><a href="machine_learning.html#cb1150-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">add_model</span>(tune_spec) <span class="op">%&gt;%</span></span>
<span id="cb1150-4"><a href="machine_learning.html#cb1150-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">add_formula</span>(age <span class="op">~</span><span class="st"> </span>.)</span></code></pre></div>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="machine_learning.html#cb1151-1" aria-hidden="true"></a><span class="co"># Tuning results</span></span>
<span id="cb1151-2"><a href="machine_learning.html#cb1151-2" aria-hidden="true"></a>rec_res &lt;-<span class="st"> </span>rec_wf <span class="op">%&gt;%</span></span>
<span id="cb1151-3"><a href="machine_learning.html#cb1151-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb1151-4"><a href="machine_learning.html#cb1151-4" aria-hidden="true"></a>    <span class="dt">resamples =</span> rec_folds,</span>
<span id="cb1151-5"><a href="machine_learning.html#cb1151-5" aria-hidden="true"></a>    <span class="dt">grid =</span> lambda_grid</span>
<span id="cb1151-6"><a href="machine_learning.html#cb1151-6" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
<div id="visualize" class="section level5" number="8.6.1.3.3">
<h5><span class="header-section-number">8.6.1.3.3</span> Visualize</h5>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1152-1"><a href="machine_learning.html#cb1152-1" aria-hidden="true"></a><span class="co"># Visualize</span></span>
<span id="cb1152-2"><a href="machine_learning.html#cb1152-2" aria-hidden="true"></a></span>
<span id="cb1152-3"><a href="machine_learning.html#cb1152-3" aria-hidden="true"></a>rec_res <span class="op">%&gt;%</span></span>
<span id="cb1152-4"><a href="machine_learning.html#cb1152-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb1152-5"><a href="machine_learning.html#cb1152-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mean, <span class="dt">col =</span> .metric)) <span class="op">+</span></span>
<span id="cb1152-6"><a href="machine_learning.html#cb1152-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(</span>
<span id="cb1152-7"><a href="machine_learning.html#cb1152-7" aria-hidden="true"></a>    <span class="dt">ymin =</span> mean <span class="op">-</span><span class="st"> </span>std_err,</span>
<span id="cb1152-8"><a href="machine_learning.html#cb1152-8" aria-hidden="true"></a>    <span class="dt">ymax =</span> mean <span class="op">+</span><span class="st"> </span>std_err</span>
<span id="cb1152-9"><a href="machine_learning.html#cb1152-9" aria-hidden="true"></a>  ),</span>
<span id="cb1152-10"><a href="machine_learning.html#cb1152-10" aria-hidden="true"></a>  <span class="dt">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb1152-11"><a href="machine_learning.html#cb1152-11" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1152-12"><a href="machine_learning.html#cb1152-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1152-13"><a href="machine_learning.html#cb1152-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1152-14"><a href="machine_learning.html#cb1152-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;log(lambda)&quot;</span>) <span class="op">+</span></span>
<span id="cb1152-15"><a href="machine_learning.html#cb1152-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>),</span>
<span id="cb1152-16"><a href="machine_learning.html#cb1152-16" aria-hidden="true"></a>    <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1152-17"><a href="machine_learning.html#cb1152-17" aria-hidden="true"></a>    <span class="dt">nrow =</span> <span class="dv">2</span></span>
<span id="cb1152-18"><a href="machine_learning.html#cb1152-18" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1152-19"><a href="machine_learning.html#cb1152-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="select" class="section level5" number="8.6.1.3.4">
<h5><span class="header-section-number">8.6.1.3.4</span> Select</h5>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="machine_learning.html#cb1153-1" aria-hidden="true"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer dplyr::filter over any other package</code></pre>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="machine_learning.html#cb1156-1" aria-hidden="true"></a>top_rmse &lt;-<span class="st"> </span><span class="kw">show_best</span>(rec_res, <span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1156-2"><a href="machine_learning.html#cb1156-2" aria-hidden="true"></a></span>
<span id="cb1156-3"><a href="machine_learning.html#cb1156-3" aria-hidden="true"></a>best_rmse &lt;-<span class="st"> </span><span class="kw">select_best</span>(rec_res, <span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1156-4"><a href="machine_learning.html#cb1156-4" aria-hidden="true"></a></span>
<span id="cb1156-5"><a href="machine_learning.html#cb1156-5" aria-hidden="true"></a>best_rmse</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   penalty .config              
##     &lt;dbl&gt; &lt;chr&gt;                
## 1   0.391 Preprocessor1_Model48</code></pre>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="machine_learning.html#cb1158-1" aria-hidden="true"></a><span class="kw">glue</span>(<span class="st">&#39;The RMSE of the intiail model is</span></span>
<span id="cb1158-2"><a href="machine_learning.html#cb1158-2" aria-hidden="true"></a><span class="st">     {evals %&gt;%</span></span>
<span id="cb1158-3"><a href="machine_learning.html#cb1158-3" aria-hidden="true"></a><span class="st">  filter(type == &quot;Lasso&quot;, .metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1158-4"><a href="machine_learning.html#cb1158-4" aria-hidden="true"></a><span class="st">  select(.estimate) %&gt;%</span></span>
<span id="cb1158-5"><a href="machine_learning.html#cb1158-5" aria-hidden="true"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the intiail model is
##    7.81</code></pre>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="machine_learning.html#cb1160-1" aria-hidden="true"></a><span class="kw">glue</span>(<span class="st">&#39;The RMSE of the tuned model is {rec_res %&gt;%</span></span>
<span id="cb1160-2"><a href="machine_learning.html#cb1160-2" aria-hidden="true"></a><span class="st">  collect_metrics() %&gt;%</span></span>
<span id="cb1160-3"><a href="machine_learning.html#cb1160-3" aria-hidden="true"></a><span class="st">  filter(.metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1160-4"><a href="machine_learning.html#cb1160-4" aria-hidden="true"></a><span class="st">  arrange(mean) %&gt;%</span></span>
<span id="cb1160-5"><a href="machine_learning.html#cb1160-5" aria-hidden="true"></a><span class="st">  dplyr::slice(1) %&gt;%</span></span>
<span id="cb1160-6"><a href="machine_learning.html#cb1160-6" aria-hidden="true"></a><span class="st">  select(mean) %&gt;%</span></span>
<span id="cb1160-7"><a href="machine_learning.html#cb1160-7" aria-hidden="true"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the tuned model is 7.55</code></pre>
<ul>
<li>Finalize your workflow and visualize <a href="https://koalaverse.github.io/vip/articles/vip.html">variable importance</a></li>
</ul>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="machine_learning.html#cb1162-1" aria-hidden="true"></a>finalize_lasso &lt;-<span class="st"> </span>rec_wf <span class="op">%&gt;%</span></span>
<span id="cb1162-2"><a href="machine_learning.html#cb1162-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_rmse)</span>
<span id="cb1162-3"><a href="machine_learning.html#cb1162-3" aria-hidden="true"></a></span>
<span id="cb1162-4"><a href="machine_learning.html#cb1162-4" aria-hidden="true"></a>finalize_lasso <span class="op">%&gt;%</span></span>
<span id="cb1162-5"><a href="machine_learning.html#cb1162-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(train_x_reg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">age =</span> train_y_reg))) <span class="op">%&gt;%</span></span>
<span id="cb1162-6"><a href="machine_learning.html#cb1162-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull_workflow_fit</span>() <span class="op">%&gt;%</span></span>
<span id="cb1162-7"><a href="machine_learning.html#cb1162-7" aria-hidden="true"></a><span class="st">  </span>vip<span class="op">::</span><span class="kw">vip</span>()</span></code></pre></div>
<pre><code>## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
## Please use `extract_fit_parsnip()` instead.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="test-fit" class="section level5" number="8.6.1.3.5">
<h5><span class="header-section-number">8.6.1.3.5</span> Test fit</h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="machine_learning.html#cb1164-1" aria-hidden="true"></a>test_fit &lt;-<span class="st"> </span>finalize_lasso <span class="op">%&gt;%</span></span>
<span id="cb1164-2"><a href="machine_learning.html#cb1164-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(test_x_reg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">age =</span> test_y_reg)))</span>
<span id="cb1164-3"><a href="machine_learning.html#cb1164-3" aria-hidden="true"></a></span>
<span id="cb1164-4"><a href="machine_learning.html#cb1164-4" aria-hidden="true"></a><span class="kw">evaluate_reg</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       7.12 
## 2 mae     standard       5.84 
## 3 rsq     standard       0.394</code></pre>
</div>
</div>
</div>
<div id="decision-tree" class="section level3" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Decision tree</h3>
<div id="parsnip-1" class="section level4" number="8.6.2.1">
<h4><span class="header-section-number">8.6.2.1</span> parsnip</h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="machine_learning.html#cb1166-1" aria-hidden="true"></a><span class="co"># workflow</span></span>
<span id="cb1166-2"><a href="machine_learning.html#cb1166-2" aria-hidden="true"></a>tree_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_formula</span>(target <span class="op">~</span><span class="st"> </span>.)</span>
<span id="cb1166-3"><a href="machine_learning.html#cb1166-3" aria-hidden="true"></a></span>
<span id="cb1166-4"><a href="machine_learning.html#cb1166-4" aria-hidden="true"></a><span class="co"># spec</span></span>
<span id="cb1166-5"><a href="machine_learning.html#cb1166-5" aria-hidden="true"></a>tree_spec &lt;-<span class="st"> </span><span class="kw">decision_tree</span>(</span>
<span id="cb1166-6"><a href="machine_learning.html#cb1166-6" aria-hidden="true"></a></span>
<span id="cb1166-7"><a href="machine_learning.html#cb1166-7" aria-hidden="true"></a>  <span class="co"># Mode</span></span>
<span id="cb1166-8"><a href="machine_learning.html#cb1166-8" aria-hidden="true"></a>  <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1166-9"><a href="machine_learning.html#cb1166-9" aria-hidden="true"></a></span>
<span id="cb1166-10"><a href="machine_learning.html#cb1166-10" aria-hidden="true"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1166-11"><a href="machine_learning.html#cb1166-11" aria-hidden="true"></a>  <span class="dt">cost_complexity =</span> <span class="ot">NULL</span>,</span>
<span id="cb1166-12"><a href="machine_learning.html#cb1166-12" aria-hidden="true"></a>  <span class="dt">tree_depth =</span> <span class="ot">NULL</span></span>
<span id="cb1166-13"><a href="machine_learning.html#cb1166-13" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb1166-14"><a href="machine_learning.html#cb1166-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="co"># rpart, c5.0, spark</span></span>
<span id="cb1166-15"><a href="machine_learning.html#cb1166-15" aria-hidden="true"></a></span>
<span id="cb1166-16"><a href="machine_learning.html#cb1166-16" aria-hidden="true"></a>tree_wf &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tree_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="machine_learning.html#cb1167-1" aria-hidden="true"></a>tree_fit &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-1" class="section level4" number="8.6.2.2">
<h4><span class="header-section-number">8.6.2.2</span> yardstick</h4>
<ul>
<li>Let’s formally test prediction performance.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Confusion matrix</li>
</ol>
<p>A confusion matrix is often used to describe the performance of a classification model. The below example is based on a binary classification model.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Predicted: YES</th>
<th>Predicted: NO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: YES</strong></td>
<td>True positive (TP)</td>
<td>False negative (FN)</td>
</tr>
<tr class="even">
<td><strong>Actual: NO</strong></td>
<td>False positive (FP)</td>
<td>True negative (TN)</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Metrics</li>
</ol>
<ul>
<li><p><code>accuracy</code>: The proportion of the data predicted correctly (<span class="math inline">\(\frac{TP + TN}{total}\)</span>). 1 - accuracy = misclassification rate.</p></li>
<li><p><code>precision</code>: Positive predictive value. <em>When the model predicts yes, how correct is it?</em> (<span class="math inline">\(\frac{TP}{TP + FP}\)</span>)</p></li>
<li><p><code>recall</code> (sensitivity): True positive rate (e.g., healthy people healthy). <em>When the actual value is yes, how often does the model predict yes?</em> (<span class="math inline">\(\frac{TP}{TP + FN}\)</span>)</p></li>
<li><p><code>F-score</code>: A weighted average between precision and recall.</p></li>
<li><p><code>ROC Curve</code> (receiver operating characteristic curve): a plot that shows the relationship between true and false positive rates at different classification thresholds. y-axis indicates the true positive rate and x-axis indicates the false positive rate. What matters is the AUC (Area under the ROC Curve), which is a cumulative probability function of ranking a random “positive” - “negative” pair (for the probability of AUC, see <a href="https://www.alexejgossmann.com/auc/">this blog post</a>).</p></li>
</ul>
<div class="figure">
<img src="https://developers.google.com/machine-learning/crash-course/images/ROCCurve.svg" alt="" />
<p class="caption">Source: Google Machine Learning Crash Course</p>
</div>
<ul>
<li>To learn more about other metrics, check out the yardstick package <a href="https://yardstick.tidymodels.org/reference/index.html">references</a>.</li>
</ul>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="machine_learning.html#cb1168-1" aria-hidden="true"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1168-2"><a href="machine_learning.html#cb1168-2" aria-hidden="true"></a></span>
<span id="cb1168-3"><a href="machine_learning.html#cb1168-3" aria-hidden="true"></a>metrics &lt;-<span class="st"> </span>yardstick<span class="op">::</span><span class="kw">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1168-4"><a href="machine_learning.html#cb1168-4" aria-hidden="true"></a></span>
<span id="cb1168-5"><a href="machine_learning.html#cb1168-5" aria-hidden="true"></a><span class="co"># Visualize</span></span>
<span id="cb1168-6"><a href="machine_learning.html#cb1168-6" aria-hidden="true"></a></span>
<span id="cb1168-7"><a href="machine_learning.html#cb1168-7" aria-hidden="true"></a>tree_fit_viz_metr &lt;-<span class="st"> </span><span class="kw">visualize_class_eval</span>(tree_fit)</span>
<span id="cb1168-8"><a href="machine_learning.html#cb1168-8" aria-hidden="true"></a></span>
<span id="cb1168-9"><a href="machine_learning.html#cb1168-9" aria-hidden="true"></a>tree_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="machine_learning.html#cb1169-1" aria-hidden="true"></a>tree_fit_viz_mat &lt;-<span class="st"> </span><span class="kw">visualize_class_conf</span>(tree_fit)</span>
<span id="cb1169-2"><a href="machine_learning.html#cb1169-2" aria-hidden="true"></a></span>
<span id="cb1169-3"><a href="machine_learning.html#cb1169-3" aria-hidden="true"></a>tree_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
</div>
<div id="tune-1" class="section level4" number="8.6.2.3">
<h4><span class="header-section-number">8.6.2.3</span> tune</h4>
<div id="tune-ingredients-1" class="section level5" number="8.6.2.3.1">
<h5><span class="header-section-number">8.6.2.3.1</span> tune ingredients</h5>
<p>Decisions trees tend to overfit. We need to consider two things to reduce this problem: how to split and when to stop a tree.</p>
<ul>
<li><p><strong>complexity parameter</strong>: a high CP means a simple decision tree with few splits.</p></li>
<li><p><strong>tree_depth</strong></p></li>
</ul>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="machine_learning.html#cb1170-1" aria-hidden="true"></a>tune_spec &lt;-<span class="st"> </span><span class="kw">decision_tree</span>(</span>
<span id="cb1170-2"><a href="machine_learning.html#cb1170-2" aria-hidden="true"></a>  <span class="dt">cost_complexity =</span> <span class="kw">tune</span>(), <span class="co"># how to split</span></span>
<span id="cb1170-3"><a href="machine_learning.html#cb1170-3" aria-hidden="true"></a>  <span class="dt">tree_depth =</span> <span class="kw">tune</span>(), <span class="co"># when to stop</span></span>
<span id="cb1170-4"><a href="machine_learning.html#cb1170-4" aria-hidden="true"></a>  <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span></span>
<span id="cb1170-5"><a href="machine_learning.html#cb1170-5" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb1170-6"><a href="machine_learning.html#cb1170-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;rpart&quot;</span>)</span>
<span id="cb1170-7"><a href="machine_learning.html#cb1170-7" aria-hidden="true"></a></span>
<span id="cb1170-8"><a href="machine_learning.html#cb1170-8" aria-hidden="true"></a>tree_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">cost_complexity</span>(),</span>
<span id="cb1170-9"><a href="machine_learning.html#cb1170-9" aria-hidden="true"></a>  <span class="kw">tree_depth</span>(),</span>
<span id="cb1170-10"><a href="machine_learning.html#cb1170-10" aria-hidden="true"></a>  <span class="dt">levels =</span> <span class="dv">5</span></span>
<span id="cb1170-11"><a href="machine_learning.html#cb1170-11" aria-hidden="true"></a>) <span class="co"># 2 hyperparameters -&gt; 5*5 = 25 combinations</span></span>
<span id="cb1170-12"><a href="machine_learning.html#cb1170-12" aria-hidden="true"></a></span>
<span id="cb1170-13"><a href="machine_learning.html#cb1170-13" aria-hidden="true"></a>tree_grid <span class="op">%&gt;%</span></span>
<span id="cb1170-14"><a href="machine_learning.html#cb1170-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">count</span>(tree_depth)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   tree_depth     n
##        &lt;int&gt; &lt;int&gt;
## 1          1     5
## 2          4     5
## 3          8     5
## 4         11     5
## 5         15     5</code></pre>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="machine_learning.html#cb1172-1" aria-hidden="true"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1172-2"><a href="machine_learning.html#cb1172-2" aria-hidden="true"></a></span>
<span id="cb1172-3"><a href="machine_learning.html#cb1172-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1172-4"><a href="machine_learning.html#cb1172-4" aria-hidden="true"></a></span>
<span id="cb1172-5"><a href="machine_learning.html#cb1172-5" aria-hidden="true"></a>tree_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)),</span>
<span id="cb1172-6"><a href="machine_learning.html#cb1172-6" aria-hidden="true"></a>  <span class="dt">strata =</span> target</span>
<span id="cb1172-7"><a href="machine_learning.html#cb1172-7" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-1" class="section level5" number="8.6.2.3.2">
<h5><span class="header-section-number">8.6.2.3.2</span> Add these elements to a workflow</h5>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="machine_learning.html#cb1173-1" aria-hidden="true"></a><span class="co"># Update workflow</span></span>
<span id="cb1173-2"><a href="machine_learning.html#cb1173-2" aria-hidden="true"></a>tree_wf &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">update_model</span>(tune_spec)</span>
<span id="cb1173-3"><a href="machine_learning.html#cb1173-3" aria-hidden="true"></a></span>
<span id="cb1173-4"><a href="machine_learning.html#cb1173-4" aria-hidden="true"></a><span class="co"># Determine the number of cores</span></span>
<span id="cb1173-5"><a href="machine_learning.html#cb1173-5" aria-hidden="true"></a>no_cores &lt;-<span class="st"> </span><span class="kw">detectCores</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1173-6"><a href="machine_learning.html#cb1173-6" aria-hidden="true"></a></span>
<span id="cb1173-7"><a href="machine_learning.html#cb1173-7" aria-hidden="true"></a><span class="co"># Initiate</span></span>
<span id="cb1173-8"><a href="machine_learning.html#cb1173-8" aria-hidden="true"></a>cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(no_cores)</span>
<span id="cb1173-9"><a href="machine_learning.html#cb1173-9" aria-hidden="true"></a></span>
<span id="cb1173-10"><a href="machine_learning.html#cb1173-10" aria-hidden="true"></a><span class="kw">registerDoParallel</span>(cl)</span>
<span id="cb1173-11"><a href="machine_learning.html#cb1173-11" aria-hidden="true"></a></span>
<span id="cb1173-12"><a href="machine_learning.html#cb1173-12" aria-hidden="true"></a><span class="co"># Tuning results</span></span>
<span id="cb1173-13"><a href="machine_learning.html#cb1173-13" aria-hidden="true"></a>tree_res &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span></span>
<span id="cb1173-14"><a href="machine_learning.html#cb1173-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb1173-15"><a href="machine_learning.html#cb1173-15" aria-hidden="true"></a>    <span class="dt">resamples =</span> tree_folds,</span>
<span id="cb1173-16"><a href="machine_learning.html#cb1173-16" aria-hidden="true"></a>    <span class="dt">grid =</span> tree_grid,</span>
<span id="cb1173-17"><a href="machine_learning.html#cb1173-17" aria-hidden="true"></a>    <span class="dt">metrics =</span> metrics</span>
<span id="cb1173-18"><a href="machine_learning.html#cb1173-18" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
<div id="visualize-1" class="section level5" number="8.6.2.3.3">
<h5><span class="header-section-number">8.6.2.3.3</span> Visualize</h5>
<ul>
<li>The following plot draws on the <a href="https://www.tidymodels.org/start/tuning/">vignette</a> of the tidymodels package.</li>
</ul>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="machine_learning.html#cb1174-1" aria-hidden="true"></a>tree_res <span class="op">%&gt;%</span></span>
<span id="cb1174-2"><a href="machine_learning.html#cb1174-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb1174-3"><a href="machine_learning.html#cb1174-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tree_depth =</span> <span class="kw">factor</span>(tree_depth)) <span class="op">%&gt;%</span></span>
<span id="cb1174-4"><a href="machine_learning.html#cb1174-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cost_complexity, mean, <span class="dt">col =</span> .metric)) <span class="op">+</span></span>
<span id="cb1174-5"><a href="machine_learning.html#cb1174-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb1174-6"><a href="machine_learning.html#cb1174-6" aria-hidden="true"></a><span class="st">  </span><span class="co"># Subplots</span></span>
<span id="cb1174-7"><a href="machine_learning.html#cb1174-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>tree_depth,</span>
<span id="cb1174-8"><a href="machine_learning.html#cb1174-8" aria-hidden="true"></a>    <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1174-9"><a href="machine_learning.html#cb1174-9" aria-hidden="true"></a>    <span class="dt">nrow =</span> <span class="dv">2</span></span>
<span id="cb1174-10"><a href="machine_learning.html#cb1174-10" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1174-11"><a href="machine_learning.html#cb1174-11" aria-hidden="true"></a><span class="st">  </span><span class="co"># Log scale x</span></span>
<span id="cb1174-12"><a href="machine_learning.html#cb1174-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_number</span>()) <span class="op">+</span></span>
<span id="cb1174-13"><a href="machine_learning.html#cb1174-13" aria-hidden="true"></a><span class="st">  </span><span class="co"># Discrete color scale</span></span>
<span id="cb1174-14"><a href="machine_learning.html#cb1174-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="dt">begin =</span> <span class="fl">.9</span>, <span class="dt">end =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb1174-15"><a href="machine_learning.html#cb1174-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1174-16"><a href="machine_learning.html#cb1174-16" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Cost complexity&quot;</span>,</span>
<span id="cb1174-17"><a href="machine_learning.html#cb1174-17" aria-hidden="true"></a>    <span class="dt">col =</span> <span class="st">&quot;Tree depth&quot;</span>,</span>
<span id="cb1174-18"><a href="machine_learning.html#cb1174-18" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="ot">NULL</span></span>
<span id="cb1174-19"><a href="machine_learning.html#cb1174-19" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1174-20"><a href="machine_learning.html#cb1174-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="select-1" class="section level5" number="8.6.2.3.4">
<h5><span class="header-section-number">8.6.2.3.4</span> Select</h5>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="machine_learning.html#cb1175-1" aria-hidden="true"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1175-2"><a href="machine_learning.html#cb1175-2" aria-hidden="true"></a>best_tree &lt;-<span class="st"> </span><span class="kw">select_best</span>(tree_res, <span class="st">&quot;recall&quot;</span>)</span>
<span id="cb1175-3"><a href="machine_learning.html#cb1175-3" aria-hidden="true"></a></span>
<span id="cb1175-4"><a href="machine_learning.html#cb1175-4" aria-hidden="true"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1175-5"><a href="machine_learning.html#cb1175-5" aria-hidden="true"></a>finalize_tree &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span></span>
<span id="cb1175-6"><a href="machine_learning.html#cb1175-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="machine_learning.html#cb1176-1" aria-hidden="true"></a>tree_fit_tuned &lt;-<span class="st"> </span>finalize_tree <span class="op">%&gt;%</span></span>
<span id="cb1176-2"><a href="machine_learning.html#cb1176-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span>
<span id="cb1176-3"><a href="machine_learning.html#cb1176-3" aria-hidden="true"></a></span>
<span id="cb1176-4"><a href="machine_learning.html#cb1176-4" aria-hidden="true"></a><span class="co"># Metrics</span></span>
<span id="cb1176-5"><a href="machine_learning.html#cb1176-5" aria-hidden="true"></a>(tree_fit_viz_metr <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_eval</span>(tree_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="machine_learning.html#cb1177-1" aria-hidden="true"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1177-2"><a href="machine_learning.html#cb1177-2" aria-hidden="true"></a>(tree_fit_viz_mat <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_conf</span>(tree_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="machine_learning.html#cb1178-1" aria-hidden="true"></a>tree_fit_tuned <span class="op">%&gt;%</span></span>
<span id="cb1178-2"><a href="machine_learning.html#cb1178-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull_workflow_fit</span>() <span class="op">%&gt;%</span></span>
<span id="cb1178-3"><a href="machine_learning.html#cb1178-3" aria-hidden="true"></a><span class="st">  </span>vip<span class="op">::</span><span class="kw">vip</span>()</span></code></pre></div>
<pre><code>## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
## Please use `extract_fit_parsnip()` instead.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="test-fit-1" class="section level5" number="8.6.2.3.5">
<h5><span class="header-section-number">8.6.2.3.5</span> Test fit</h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="machine_learning.html#cb1180-1" aria-hidden="true"></a>test_fit &lt;-<span class="st"> </span>finalize_tree <span class="op">%&gt;%</span></span>
<span id="cb1180-2"><a href="machine_learning.html#cb1180-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(test_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> test_y_class)))</span>
<span id="cb1180-3"><a href="machine_learning.html#cb1180-3" aria-hidden="true"></a></span>
<span id="cb1180-4"><a href="machine_learning.html#cb1180-4" aria-hidden="true"></a><span class="kw">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.761
## 2 precision binary         0.778
## 3 recall    binary         0.667</code></pre>
<p>In the next subsection, we will learn variants of ensemble models that improve decision tree models by putting models together.</p>
</div>
</div>
</div>
<div id="bagging-random-forest" class="section level3" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Bagging (Random forest)</h3>
<p>Key idea applied across all ensemble models (bagging, boosting, and stacking):
single learner -&gt; N learners (N &gt; 1)</p>
<p>Many learners could perform better than a single learner as this approach reduces the <strong>variance</strong> of a single estimate and provides more stability.</p>
<p>Here we focus on the difference between bagging and boosting. In short, boosting may reduce bias while increasing variance. On the other hand, bagging may reduce variance but has nothing to do with bias. Please check out <a href="https://quantdare.com/what-is-the-difference-between-bagging-and-boosting/">What is the difference between Bagging and Boosting?</a> by aporras.</p>
<p><strong>bagging</strong></p>
<ul>
<li><p>Data: Training data will be randomly sampled with replacement (bootstrapping samples + drawing random <strong>subsets</strong> of features for training individual trees)</p></li>
<li><p>Learning: Building models in parallel (independently)</p></li>
<li><p>Prediction: Simple average of the estimated responses (majority vote system)</p></li>
</ul>
<div class="figure">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/bagging.png" alt="" />
<p class="caption">From Sebastian Raschka’s blog</p>
</div>
<p><strong>boosting</strong></p>
<ul>
<li><p>Data: Weighted training data will be random sampled</p></li>
<li><p>Learning: Building models sequentially (mispredicted cases would receive more weights)</p></li>
<li><p>Prediction: Weighted average of the estimated responses</p></li>
</ul>
<div class="figure">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/boosting.png" alt="" />
<p class="caption">From Sebastian Raschka’s blog</p>
</div>
<div id="parsnip-2" class="section level4" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> parsnip</h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="machine_learning.html#cb1182-1" aria-hidden="true"></a><span class="co"># workflow</span></span>
<span id="cb1182-2"><a href="machine_learning.html#cb1182-2" aria-hidden="true"></a>rand_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_formula</span>(target <span class="op">~</span><span class="st"> </span>.)</span>
<span id="cb1182-3"><a href="machine_learning.html#cb1182-3" aria-hidden="true"></a></span>
<span id="cb1182-4"><a href="machine_learning.html#cb1182-4" aria-hidden="true"></a><span class="co"># spec</span></span>
<span id="cb1182-5"><a href="machine_learning.html#cb1182-5" aria-hidden="true"></a>rand_spec &lt;-<span class="st"> </span><span class="kw">rand_forest</span>(</span>
<span id="cb1182-6"><a href="machine_learning.html#cb1182-6" aria-hidden="true"></a></span>
<span id="cb1182-7"><a href="machine_learning.html#cb1182-7" aria-hidden="true"></a>  <span class="co"># Mode</span></span>
<span id="cb1182-8"><a href="machine_learning.html#cb1182-8" aria-hidden="true"></a>  <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1182-9"><a href="machine_learning.html#cb1182-9" aria-hidden="true"></a></span>
<span id="cb1182-10"><a href="machine_learning.html#cb1182-10" aria-hidden="true"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1182-11"><a href="machine_learning.html#cb1182-11" aria-hidden="true"></a>  <span class="dt">mtry =</span> <span class="ot">NULL</span>, <span class="co"># The number of predictors to available for splitting at each node</span></span>
<span id="cb1182-12"><a href="machine_learning.html#cb1182-12" aria-hidden="true"></a>  <span class="dt">min_n =</span> <span class="ot">NULL</span>, <span class="co"># The minimum number of data points needed to keep splitting nodes</span></span>
<span id="cb1182-13"><a href="machine_learning.html#cb1182-13" aria-hidden="true"></a>  <span class="dt">trees =</span> <span class="dv">500</span></span>
<span id="cb1182-14"><a href="machine_learning.html#cb1182-14" aria-hidden="true"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># The number of trees</span></span>
<span id="cb1182-15"><a href="machine_learning.html#cb1182-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1182-16"><a href="machine_learning.html#cb1182-16" aria-hidden="true"></a>    <span class="co"># We want the importance of predictors to be assessed.</span></span>
<span id="cb1182-17"><a href="machine_learning.html#cb1182-17" aria-hidden="true"></a>    <span class="dt">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1182-18"><a href="machine_learning.html#cb1182-18" aria-hidden="true"></a>    <span class="dt">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1182-19"><a href="machine_learning.html#cb1182-19" aria-hidden="true"></a>  )</span>
<span id="cb1182-20"><a href="machine_learning.html#cb1182-20" aria-hidden="true"></a></span>
<span id="cb1182-21"><a href="machine_learning.html#cb1182-21" aria-hidden="true"></a>rand_wf &lt;-<span class="st"> </span>rand_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(rand_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="machine_learning.html#cb1183-1" aria-hidden="true"></a>rand_fit &lt;-<span class="st"> </span>rand_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-2" class="section level4" number="8.6.3.2">
<h4><span class="header-section-number">8.6.3.2</span> yardstick</h4>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="machine_learning.html#cb1184-1" aria-hidden="true"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1184-2"><a href="machine_learning.html#cb1184-2" aria-hidden="true"></a>metrics &lt;-<span class="st"> </span>yardstick<span class="op">::</span><span class="kw">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1184-3"><a href="machine_learning.html#cb1184-3" aria-hidden="true"></a></span>
<span id="cb1184-4"><a href="machine_learning.html#cb1184-4" aria-hidden="true"></a>rand_fit_viz_metr &lt;-<span class="st"> </span><span class="kw">visualize_class_eval</span>(rand_fit)</span>
<span id="cb1184-5"><a href="machine_learning.html#cb1184-5" aria-hidden="true"></a></span>
<span id="cb1184-6"><a href="machine_learning.html#cb1184-6" aria-hidden="true"></a>rand_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="machine_learning.html#cb1185-1" aria-hidden="true"></a>rand_fit_viz_mat &lt;-<span class="st"> </span><span class="kw">visualize_class_conf</span>(rand_fit)</span>
<span id="cb1185-2"><a href="machine_learning.html#cb1185-2" aria-hidden="true"></a></span>
<span id="cb1185-3"><a href="machine_learning.html#cb1185-3" aria-hidden="true"></a>rand_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="tune-2" class="section level4" number="8.6.3.3">
<h4><span class="header-section-number">8.6.3.3</span> tune</h4>
<div id="tune-ingredients-2" class="section level5" number="8.6.3.3.1">
<h5><span class="header-section-number">8.6.3.3.1</span> tune ingredients</h5>
<p>We focus on the following two hyperparameters:</p>
<ul>
<li><p><code>mtry</code>: The number of predictors available for splitting at each node.</p></li>
<li><p><code>min_n</code>: The minimum number of data points needed to keep splitting nodes.</p></li>
</ul>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="machine_learning.html#cb1186-1" aria-hidden="true"></a>tune_spec &lt;-</span>
<span id="cb1186-2"><a href="machine_learning.html#cb1186-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">rand_forest</span>(</span>
<span id="cb1186-3"><a href="machine_learning.html#cb1186-3" aria-hidden="true"></a>    <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1186-4"><a href="machine_learning.html#cb1186-4" aria-hidden="true"></a></span>
<span id="cb1186-5"><a href="machine_learning.html#cb1186-5" aria-hidden="true"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1186-6"><a href="machine_learning.html#cb1186-6" aria-hidden="true"></a>    <span class="dt">mtry =</span> <span class="kw">tune</span>(),</span>
<span id="cb1186-7"><a href="machine_learning.html#cb1186-7" aria-hidden="true"></a>    <span class="dt">min_n =</span> <span class="kw">tune</span>()</span>
<span id="cb1186-8"><a href="machine_learning.html#cb1186-8" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1186-9"><a href="machine_learning.html#cb1186-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1186-10"><a href="machine_learning.html#cb1186-10" aria-hidden="true"></a>    <span class="dt">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1186-11"><a href="machine_learning.html#cb1186-11" aria-hidden="true"></a>    <span class="dt">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1186-12"><a href="machine_learning.html#cb1186-12" aria-hidden="true"></a>  )</span>
<span id="cb1186-13"><a href="machine_learning.html#cb1186-13" aria-hidden="true"></a></span>
<span id="cb1186-14"><a href="machine_learning.html#cb1186-14" aria-hidden="true"></a>rand_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">mtry</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb1186-15"><a href="machine_learning.html#cb1186-15" aria-hidden="true"></a>  <span class="kw">min_n</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)),</span>
<span id="cb1186-16"><a href="machine_learning.html#cb1186-16" aria-hidden="true"></a>  <span class="dt">levels =</span> <span class="dv">5</span></span>
<span id="cb1186-17"><a href="machine_learning.html#cb1186-17" aria-hidden="true"></a>)</span>
<span id="cb1186-18"><a href="machine_learning.html#cb1186-18" aria-hidden="true"></a></span>
<span id="cb1186-19"><a href="machine_learning.html#cb1186-19" aria-hidden="true"></a>rand_grid <span class="op">%&gt;%</span></span>
<span id="cb1186-20"><a href="machine_learning.html#cb1186-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">count</span>(min_n)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   min_n     n
##   &lt;int&gt; &lt;int&gt;
## 1     2     5
## 2     4     5
## 3     6     5
## 4     8     5
## 5    10     5</code></pre>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="machine_learning.html#cb1188-1" aria-hidden="true"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1188-2"><a href="machine_learning.html#cb1188-2" aria-hidden="true"></a></span>
<span id="cb1188-3"><a href="machine_learning.html#cb1188-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1188-4"><a href="machine_learning.html#cb1188-4" aria-hidden="true"></a></span>
<span id="cb1188-5"><a href="machine_learning.html#cb1188-5" aria-hidden="true"></a>rand_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)),</span>
<span id="cb1188-6"><a href="machine_learning.html#cb1188-6" aria-hidden="true"></a>  <span class="dt">strata =</span> target</span>
<span id="cb1188-7"><a href="machine_learning.html#cb1188-7" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-2" class="section level5" number="8.6.3.3.2">
<h5><span class="header-section-number">8.6.3.3.2</span> Add these elements to a workflow</h5>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="machine_learning.html#cb1189-1" aria-hidden="true"></a><span class="co"># Update workflow</span></span>
<span id="cb1189-2"><a href="machine_learning.html#cb1189-2" aria-hidden="true"></a>rand_wf &lt;-<span class="st"> </span>rand_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">update_model</span>(tune_spec)</span>
<span id="cb1189-3"><a href="machine_learning.html#cb1189-3" aria-hidden="true"></a></span>
<span id="cb1189-4"><a href="machine_learning.html#cb1189-4" aria-hidden="true"></a><span class="co"># Tuning results</span></span>
<span id="cb1189-5"><a href="machine_learning.html#cb1189-5" aria-hidden="true"></a>rand_res &lt;-<span class="st"> </span>rand_wf <span class="op">%&gt;%</span></span>
<span id="cb1189-6"><a href="machine_learning.html#cb1189-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb1189-7"><a href="machine_learning.html#cb1189-7" aria-hidden="true"></a>    <span class="dt">resamples =</span> rand_folds,</span>
<span id="cb1189-8"><a href="machine_learning.html#cb1189-8" aria-hidden="true"></a>    <span class="dt">grid =</span> rand_grid,</span>
<span id="cb1189-9"><a href="machine_learning.html#cb1189-9" aria-hidden="true"></a>    <span class="dt">metrics =</span> metrics</span>
<span id="cb1189-10"><a href="machine_learning.html#cb1189-10" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
<div id="visualize-2" class="section level5" number="8.6.3.3.3">
<h5><span class="header-section-number">8.6.3.3.3</span> Visualize</h5>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="machine_learning.html#cb1190-1" aria-hidden="true"></a>rand_res <span class="op">%&gt;%</span></span>
<span id="cb1190-2"><a href="machine_learning.html#cb1190-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb1190-3"><a href="machine_learning.html#cb1190-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">min_n =</span> <span class="kw">factor</span>(min_n)) <span class="op">%&gt;%</span></span>
<span id="cb1190-4"><a href="machine_learning.html#cb1190-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(mtry, mean, <span class="dt">color =</span> min_n)) <span class="op">+</span></span>
<span id="cb1190-5"><a href="machine_learning.html#cb1190-5" aria-hidden="true"></a><span class="st">  </span><span class="co"># Line + Point plot</span></span>
<span id="cb1190-6"><a href="machine_learning.html#cb1190-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="fl">0.6</span>) <span class="op">+</span></span>
<span id="cb1190-7"><a href="machine_learning.html#cb1190-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1190-8"><a href="machine_learning.html#cb1190-8" aria-hidden="true"></a><span class="st">  </span><span class="co"># Subplots</span></span>
<span id="cb1190-9"><a href="machine_learning.html#cb1190-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.metric,</span>
<span id="cb1190-10"><a href="machine_learning.html#cb1190-10" aria-hidden="true"></a>    <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1190-11"><a href="machine_learning.html#cb1190-11" aria-hidden="true"></a>    <span class="dt">nrow =</span> <span class="dv">2</span></span>
<span id="cb1190-12"><a href="machine_learning.html#cb1190-12" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1190-13"><a href="machine_learning.html#cb1190-13" aria-hidden="true"></a><span class="st">  </span><span class="co"># Log scale x</span></span>
<span id="cb1190-14"><a href="machine_learning.html#cb1190-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">label_number</span>()) <span class="op">+</span></span>
<span id="cb1190-15"><a href="machine_learning.html#cb1190-15" aria-hidden="true"></a><span class="st">  </span><span class="co"># Discrete color scale</span></span>
<span id="cb1190-16"><a href="machine_learning.html#cb1190-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="dt">begin =</span> <span class="fl">.9</span>, <span class="dt">end =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb1190-17"><a href="machine_learning.html#cb1190-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1190-18"><a href="machine_learning.html#cb1190-18" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;The number of predictors to be sampled&quot;</span>,</span>
<span id="cb1190-19"><a href="machine_learning.html#cb1190-19" aria-hidden="true"></a>    <span class="dt">col =</span> <span class="st">&quot;The minimum number of data points needed for splitting&quot;</span>,</span>
<span id="cb1190-20"><a href="machine_learning.html#cb1190-20" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="ot">NULL</span></span>
<span id="cb1190-21"><a href="machine_learning.html#cb1190-21" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1190-22"><a href="machine_learning.html#cb1190-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="machine_learning.html#cb1191-1" aria-hidden="true"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1191-2"><a href="machine_learning.html#cb1191-2" aria-hidden="true"></a>best_tree &lt;-<span class="st"> </span><span class="kw">select_best</span>(rand_res, <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb1191-3"><a href="machine_learning.html#cb1191-3" aria-hidden="true"></a></span>
<span id="cb1191-4"><a href="machine_learning.html#cb1191-4" aria-hidden="true"></a>best_tree</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     1     4 Preprocessor1_Model06</code></pre>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="machine_learning.html#cb1193-1" aria-hidden="true"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1193-2"><a href="machine_learning.html#cb1193-2" aria-hidden="true"></a>finalize_tree &lt;-<span class="st"> </span>rand_wf <span class="op">%&gt;%</span></span>
<span id="cb1193-3"><a href="machine_learning.html#cb1193-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="machine_learning.html#cb1194-1" aria-hidden="true"></a>rand_fit_tuned &lt;-<span class="st"> </span>finalize_tree <span class="op">%&gt;%</span></span>
<span id="cb1194-2"><a href="machine_learning.html#cb1194-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span>
<span id="cb1194-3"><a href="machine_learning.html#cb1194-3" aria-hidden="true"></a></span>
<span id="cb1194-4"><a href="machine_learning.html#cb1194-4" aria-hidden="true"></a><span class="co"># Metrics</span></span>
<span id="cb1194-5"><a href="machine_learning.html#cb1194-5" aria-hidden="true"></a>(rand_fit_viz_metr <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_eval</span>(rand_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="machine_learning.html#cb1195-1" aria-hidden="true"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1195-2"><a href="machine_learning.html#cb1195-2" aria-hidden="true"></a>(rand_fit_viz_mat <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_conf</span>(rand_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="machine_learning.html#cb1196-1" aria-hidden="true"></a>rand_fit_tuned <span class="op">%&gt;%</span></span>
<span id="cb1196-2"><a href="machine_learning.html#cb1196-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull_workflow_fit</span>() <span class="op">%&gt;%</span></span>
<span id="cb1196-3"><a href="machine_learning.html#cb1196-3" aria-hidden="true"></a><span class="st">  </span>vip<span class="op">::</span><span class="kw">vip</span>()</span></code></pre></div>
<pre><code>## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
## Please use `extract_fit_parsnip()` instead.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="test-fit-2" class="section level5" number="8.6.3.3.4">
<h5><span class="header-section-number">8.6.3.3.4</span> Test fit</h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="machine_learning.html#cb1198-1" aria-hidden="true"></a>test_fit &lt;-<span class="st"> </span>finalize_tree <span class="op">%&gt;%</span></span>
<span id="cb1198-2"><a href="machine_learning.html#cb1198-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(test_x_class <span class="op">%&gt;%</span></span>
<span id="cb1198-3"><a href="machine_learning.html#cb1198-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> test_y_class)))</span>
<span id="cb1198-4"><a href="machine_learning.html#cb1198-4" aria-hidden="true"></a></span>
<span id="cb1198-5"><a href="machine_learning.html#cb1198-5" aria-hidden="true"></a><span class="kw">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.913
## 2 precision binary         0.905
## 3 recall    binary         0.905</code></pre>
</div>
</div>
</div>
<div id="boosting-xgboost" class="section level3" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Boosting (XGboost)</h3>
<div id="parsnip-3" class="section level4" number="8.6.4.1">
<h4><span class="header-section-number">8.6.4.1</span> parsnip</h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="machine_learning.html#cb1200-1" aria-hidden="true"></a><span class="co"># workflow</span></span>
<span id="cb1200-2"><a href="machine_learning.html#cb1200-2" aria-hidden="true"></a>xg_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_formula</span>(target <span class="op">~</span><span class="st"> </span>.)</span>
<span id="cb1200-3"><a href="machine_learning.html#cb1200-3" aria-hidden="true"></a></span>
<span id="cb1200-4"><a href="machine_learning.html#cb1200-4" aria-hidden="true"></a><span class="co"># spec</span></span>
<span id="cb1200-5"><a href="machine_learning.html#cb1200-5" aria-hidden="true"></a>xg_spec &lt;-<span class="st"> </span><span class="kw">boost_tree</span>(</span>
<span id="cb1200-6"><a href="machine_learning.html#cb1200-6" aria-hidden="true"></a></span>
<span id="cb1200-7"><a href="machine_learning.html#cb1200-7" aria-hidden="true"></a>  <span class="co"># Mode</span></span>
<span id="cb1200-8"><a href="machine_learning.html#cb1200-8" aria-hidden="true"></a>  <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1200-9"><a href="machine_learning.html#cb1200-9" aria-hidden="true"></a></span>
<span id="cb1200-10"><a href="machine_learning.html#cb1200-10" aria-hidden="true"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1200-11"><a href="machine_learning.html#cb1200-11" aria-hidden="true"></a></span>
<span id="cb1200-12"><a href="machine_learning.html#cb1200-12" aria-hidden="true"></a>  <span class="co"># The number of trees to fit, aka boosting iterations</span></span>
<span id="cb1200-13"><a href="machine_learning.html#cb1200-13" aria-hidden="true"></a>  <span class="dt">trees =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">700</span>, <span class="dv">900</span>),</span>
<span id="cb1200-14"><a href="machine_learning.html#cb1200-14" aria-hidden="true"></a>  <span class="co"># The depth of the decision tree (how many levels of splits).</span></span>
<span id="cb1200-15"><a href="machine_learning.html#cb1200-15" aria-hidden="true"></a>  <span class="dt">tree_depth =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">6</span>),</span>
<span id="cb1200-16"><a href="machine_learning.html#cb1200-16" aria-hidden="true"></a>  <span class="co"># Learning rate: lower means the ensemble will adapt more slowly.</span></span>
<span id="cb1200-17"><a href="machine_learning.html#cb1200-17" aria-hidden="true"></a>  <span class="dt">learn_rate =</span> <span class="kw">c</span>(<span class="fl">0.0001</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>),</span>
<span id="cb1200-18"><a href="machine_learning.html#cb1200-18" aria-hidden="true"></a>  <span class="co"># Stop splitting a tree if we only have this many obs in a tree node.</span></span>
<span id="cb1200-19"><a href="machine_learning.html#cb1200-19" aria-hidden="true"></a>  <span class="dt">min_n =</span> 10L</span>
<span id="cb1200-20"><a href="machine_learning.html#cb1200-20" aria-hidden="true"></a>) <span class="op">%&gt;%</span></span>
<span id="cb1200-21"><a href="machine_learning.html#cb1200-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span>
<span id="cb1200-22"><a href="machine_learning.html#cb1200-22" aria-hidden="true"></a></span>
<span id="cb1200-23"><a href="machine_learning.html#cb1200-23" aria-hidden="true"></a>xg_wf &lt;-<span class="st"> </span>xg_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(xg_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="machine_learning.html#cb1201-1" aria-hidden="true"></a>xg_fit &lt;-<span class="st"> </span>xg_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span></code></pre></div>
<pre><code>## Warning in begin_iteration:end_iteration: numerical expression has 5 elements:
## only the first used</code></pre>
<pre><code>## [05:08:26] WARNING: amalgamation/../src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
</div>
<div id="yardstick-3" class="section level4" number="8.6.4.2">
<h4><span class="header-section-number">8.6.4.2</span> yardstick</h4>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="machine_learning.html#cb1204-1" aria-hidden="true"></a>metrics &lt;-<span class="st"> </span><span class="kw">metric_set</span>(</span>
<span id="cb1204-2"><a href="machine_learning.html#cb1204-2" aria-hidden="true"></a>  yardstick<span class="op">::</span>accuracy,</span>
<span id="cb1204-3"><a href="machine_learning.html#cb1204-3" aria-hidden="true"></a>  yardstick<span class="op">::</span>precision,</span>
<span id="cb1204-4"><a href="machine_learning.html#cb1204-4" aria-hidden="true"></a>  yardstick<span class="op">::</span>recall</span>
<span id="cb1204-5"><a href="machine_learning.html#cb1204-5" aria-hidden="true"></a>)</span>
<span id="cb1204-6"><a href="machine_learning.html#cb1204-6" aria-hidden="true"></a></span>
<span id="cb1204-7"><a href="machine_learning.html#cb1204-7" aria-hidden="true"></a><span class="kw">evaluate_class</span>(xg_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.739
## 2 precision binary         0.705
## 3 recall    binary         0.738</code></pre>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="machine_learning.html#cb1206-1" aria-hidden="true"></a>xg_fit_viz_metr &lt;-</span>
<span id="cb1206-2"><a href="machine_learning.html#cb1206-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">visualize_class_eval</span>(xg_fit)</span>
<span id="cb1206-3"><a href="machine_learning.html#cb1206-3" aria-hidden="true"></a></span>
<span id="cb1206-4"><a href="machine_learning.html#cb1206-4" aria-hidden="true"></a>xg_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="machine_learning.html#cb1207-1" aria-hidden="true"></a>xg_fit_viz_mat &lt;-</span>
<span id="cb1207-2"><a href="machine_learning.html#cb1207-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">visualize_class_conf</span>(xg_fit)</span>
<span id="cb1207-3"><a href="machine_learning.html#cb1207-3" aria-hidden="true"></a></span>
<span id="cb1207-4"><a href="machine_learning.html#cb1207-4" aria-hidden="true"></a>xg_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="tune-3" class="section level4" number="8.6.4.3">
<h4><span class="header-section-number">8.6.4.3</span> tune</h4>
<div id="tune-ingredients-3" class="section level5" number="8.6.4.3.1">
<h5><span class="header-section-number">8.6.4.3.1</span> tune ingredients</h5>
<ul>
<li>We focus on the following hyperparameters: <code>trees,</code> <code>tree_depth,</code> <code>learn_rate,</code> <code>min_n,</code> <code>mtry,</code> <code>loss_reduction,</code> and <code>sample_size</code></li>
</ul>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="machine_learning.html#cb1208-1" aria-hidden="true"></a>tune_spec &lt;-</span>
<span id="cb1208-2"><a href="machine_learning.html#cb1208-2" aria-hidden="true"></a><span class="st">  </span>xg_spec &lt;-<span class="st"> </span><span class="kw">boost_tree</span>(</span>
<span id="cb1208-3"><a href="machine_learning.html#cb1208-3" aria-hidden="true"></a></span>
<span id="cb1208-4"><a href="machine_learning.html#cb1208-4" aria-hidden="true"></a>    <span class="co"># Mode</span></span>
<span id="cb1208-5"><a href="machine_learning.html#cb1208-5" aria-hidden="true"></a>    <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1208-6"><a href="machine_learning.html#cb1208-6" aria-hidden="true"></a></span>
<span id="cb1208-7"><a href="machine_learning.html#cb1208-7" aria-hidden="true"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1208-8"><a href="machine_learning.html#cb1208-8" aria-hidden="true"></a></span>
<span id="cb1208-9"><a href="machine_learning.html#cb1208-9" aria-hidden="true"></a>    <span class="co"># The number of trees to fit, aka boosting iterations</span></span>
<span id="cb1208-10"><a href="machine_learning.html#cb1208-10" aria-hidden="true"></a>    <span class="dt">trees =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-11"><a href="machine_learning.html#cb1208-11" aria-hidden="true"></a>    <span class="co"># The depth of the decision tree (how many levels of splits).</span></span>
<span id="cb1208-12"><a href="machine_learning.html#cb1208-12" aria-hidden="true"></a>    <span class="dt">tree_depth =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-13"><a href="machine_learning.html#cb1208-13" aria-hidden="true"></a>    <span class="co"># Learning rate: lower means the ensemble will adapt more slowly.</span></span>
<span id="cb1208-14"><a href="machine_learning.html#cb1208-14" aria-hidden="true"></a>    <span class="dt">learn_rate =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-15"><a href="machine_learning.html#cb1208-15" aria-hidden="true"></a>    <span class="co"># Stop splitting a tree if we only have this many obs in a tree node.</span></span>
<span id="cb1208-16"><a href="machine_learning.html#cb1208-16" aria-hidden="true"></a>    <span class="dt">min_n =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-17"><a href="machine_learning.html#cb1208-17" aria-hidden="true"></a>    <span class="dt">loss_reduction =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-18"><a href="machine_learning.html#cb1208-18" aria-hidden="true"></a>    <span class="co"># The number of randomly selected hyperparameters</span></span>
<span id="cb1208-19"><a href="machine_learning.html#cb1208-19" aria-hidden="true"></a>    <span class="dt">mtry =</span> <span class="kw">tune</span>(),</span>
<span id="cb1208-20"><a href="machine_learning.html#cb1208-20" aria-hidden="true"></a>    <span class="co"># The size of the data set used for modeling within an iteration</span></span>
<span id="cb1208-21"><a href="machine_learning.html#cb1208-21" aria-hidden="true"></a>    <span class="dt">sample_size =</span> <span class="kw">tune</span>()</span>
<span id="cb1208-22"><a href="machine_learning.html#cb1208-22" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1208-23"><a href="machine_learning.html#cb1208-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span>
<span id="cb1208-24"><a href="machine_learning.html#cb1208-24" aria-hidden="true"></a></span>
<span id="cb1208-25"><a href="machine_learning.html#cb1208-25" aria-hidden="true"></a><span class="co"># Space-filling hyperparameter grids</span></span>
<span id="cb1208-26"><a href="machine_learning.html#cb1208-26" aria-hidden="true"></a>xg_grid &lt;-<span class="st"> </span><span class="kw">grid_latin_hypercube</span>(</span>
<span id="cb1208-27"><a href="machine_learning.html#cb1208-27" aria-hidden="true"></a>  <span class="kw">trees</span>(),</span>
<span id="cb1208-28"><a href="machine_learning.html#cb1208-28" aria-hidden="true"></a>  <span class="kw">tree_depth</span>(),</span>
<span id="cb1208-29"><a href="machine_learning.html#cb1208-29" aria-hidden="true"></a>  <span class="kw">learn_rate</span>(),</span>
<span id="cb1208-30"><a href="machine_learning.html#cb1208-30" aria-hidden="true"></a>  <span class="kw">min_n</span>(),</span>
<span id="cb1208-31"><a href="machine_learning.html#cb1208-31" aria-hidden="true"></a>  <span class="kw">loss_reduction</span>(),</span>
<span id="cb1208-32"><a href="machine_learning.html#cb1208-32" aria-hidden="true"></a>  <span class="dt">sample_size =</span> <span class="kw">sample_prop</span>(),</span>
<span id="cb1208-33"><a href="machine_learning.html#cb1208-33" aria-hidden="true"></a>  <span class="kw">finalize</span>(<span class="kw">mtry</span>(), train_x_class),</span>
<span id="cb1208-34"><a href="machine_learning.html#cb1208-34" aria-hidden="true"></a>  <span class="dt">size =</span> <span class="dv">30</span></span>
<span id="cb1208-35"><a href="machine_learning.html#cb1208-35" aria-hidden="true"></a>)</span>
<span id="cb1208-36"><a href="machine_learning.html#cb1208-36" aria-hidden="true"></a></span>
<span id="cb1208-37"><a href="machine_learning.html#cb1208-37" aria-hidden="true"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1208-38"><a href="machine_learning.html#cb1208-38" aria-hidden="true"></a></span>
<span id="cb1208-39"><a href="machine_learning.html#cb1208-39" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1208-40"><a href="machine_learning.html#cb1208-40" aria-hidden="true"></a></span>
<span id="cb1208-41"><a href="machine_learning.html#cb1208-41" aria-hidden="true"></a>xg_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)),</span>
<span id="cb1208-42"><a href="machine_learning.html#cb1208-42" aria-hidden="true"></a>  <span class="dt">strata =</span> target</span>
<span id="cb1208-43"><a href="machine_learning.html#cb1208-43" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-3" class="section level5" number="8.6.4.3.2">
<h5><span class="header-section-number">8.6.4.3.2</span> Add these elements to a workflow</h5>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1209-1"><a href="machine_learning.html#cb1209-1" aria-hidden="true"></a><span class="co"># Update workflow</span></span>
<span id="cb1209-2"><a href="machine_learning.html#cb1209-2" aria-hidden="true"></a>xg_wf &lt;-<span class="st"> </span>xg_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">update_model</span>(tune_spec)</span>
<span id="cb1209-3"><a href="machine_learning.html#cb1209-3" aria-hidden="true"></a></span>
<span id="cb1209-4"><a href="machine_learning.html#cb1209-4" aria-hidden="true"></a><span class="co"># Tuning results</span></span>
<span id="cb1209-5"><a href="machine_learning.html#cb1209-5" aria-hidden="true"></a>xg_res &lt;-<span class="st"> </span>xg_wf <span class="op">%&gt;%</span></span>
<span id="cb1209-6"><a href="machine_learning.html#cb1209-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb1209-7"><a href="machine_learning.html#cb1209-7" aria-hidden="true"></a>    <span class="dt">resamples =</span> xg_folds,</span>
<span id="cb1209-8"><a href="machine_learning.html#cb1209-8" aria-hidden="true"></a>    <span class="dt">grid =</span> xg_grid,</span>
<span id="cb1209-9"><a href="machine_learning.html#cb1209-9" aria-hidden="true"></a>    <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1209-10"><a href="machine_learning.html#cb1209-10" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
<div id="visualize-3" class="section level5" number="8.6.4.3.3">
<h5><span class="header-section-number">8.6.4.3.3</span> Visualize</h5>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="machine_learning.html#cb1210-1" aria-hidden="true"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer dplyr::filter over any other package</code></pre>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="machine_learning.html#cb1213-1" aria-hidden="true"></a>xg_res <span class="op">%&gt;%</span></span>
<span id="cb1213-2"><a href="machine_learning.html#cb1213-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb1213-3"><a href="machine_learning.html#cb1213-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(.metric <span class="op">==</span><span class="st"> &quot;roc_auc&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1213-4"><a href="machine_learning.html#cb1213-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">pivot_longer</span>(mtry<span class="op">:</span>sample_size,</span>
<span id="cb1213-5"><a href="machine_learning.html#cb1213-5" aria-hidden="true"></a>    <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb1213-6"><a href="machine_learning.html#cb1213-6" aria-hidden="true"></a>    <span class="dt">names_to =</span> <span class="st">&quot;parameter&quot;</span></span>
<span id="cb1213-7"><a href="machine_learning.html#cb1213-7" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1213-8"><a href="machine_learning.html#cb1213-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> mean, <span class="dt">color =</span> parameter)) <span class="op">+</span></span>
<span id="cb1213-9"><a href="machine_learning.html#cb1213-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1213-10"><a href="machine_learning.html#cb1213-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span></span>
<span id="cb1213-11"><a href="machine_learning.html#cb1213-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1213-12"><a href="machine_learning.html#cb1213-12" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb1213-13"><a href="machine_learning.html#cb1213-13" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="ot">NULL</span></span>
<span id="cb1213-14"><a href="machine_learning.html#cb1213-14" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="machine_learning.html#cb1214-1" aria-hidden="true"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1214-2"><a href="machine_learning.html#cb1214-2" aria-hidden="true"></a>best_xg &lt;-<span class="st"> </span><span class="kw">select_best</span>(xg_res, <span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb1214-3"><a href="machine_learning.html#cb1214-3" aria-hidden="true"></a></span>
<span id="cb1214-4"><a href="machine_learning.html#cb1214-4" aria-hidden="true"></a>best_xg</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##    mtry trees min_n tree_depth learn_rate loss_reduction sample_size .config    
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;      
## 1    12  1361     3          7   0.000164    0.000000638       0.159 Preprocess…</code></pre>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="machine_learning.html#cb1216-1" aria-hidden="true"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1216-2"><a href="machine_learning.html#cb1216-2" aria-hidden="true"></a>finalize_xg &lt;-<span class="st"> </span>xg_wf <span class="op">%&gt;%</span></span>
<span id="cb1216-3"><a href="machine_learning.html#cb1216-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_xg)</span></code></pre></div>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="machine_learning.html#cb1217-1" aria-hidden="true"></a>xg_fit_tuned &lt;-<span class="st"> </span>finalize_xg <span class="op">%&gt;%</span></span>
<span id="cb1217-2"><a href="machine_learning.html#cb1217-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(train_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> train_y_class)))</span></code></pre></div>
<pre><code>## [05:10:00] WARNING: amalgamation/../src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="machine_learning.html#cb1219-1" aria-hidden="true"></a><span class="co"># Metrics</span></span>
<span id="cb1219-2"><a href="machine_learning.html#cb1219-2" aria-hidden="true"></a>(xg_fit_viz_metr <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_eval</span>(xg_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="machine_learning.html#cb1220-1" aria-hidden="true"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1220-2"><a href="machine_learning.html#cb1220-2" aria-hidden="true"></a>(xg_fit_viz_mat <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">visualize_class_conf</span>(xg_fit_tuned) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="machine_learning.html#cb1221-1" aria-hidden="true"></a>xg_fit_tuned <span class="op">%&gt;%</span></span>
<span id="cb1221-2"><a href="machine_learning.html#cb1221-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull_workflow_fit</span>() <span class="op">%&gt;%</span></span>
<span id="cb1221-3"><a href="machine_learning.html#cb1221-3" aria-hidden="true"></a><span class="st">  </span>vip<span class="op">::</span><span class="kw">vip</span>()</span></code></pre></div>
<pre><code>## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
## Please use `extract_fit_parsnip()` instead.</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="test-fit-3" class="section level5" number="8.6.4.3.4">
<h5><span class="header-section-number">8.6.4.3.4</span> Test fit</h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="machine_learning.html#cb1223-1" aria-hidden="true"></a>test_fit &lt;-<span class="st"> </span>finalize_xg <span class="op">%&gt;%</span></span>
<span id="cb1223-2"><a href="machine_learning.html#cb1223-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(test_x_class <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">target =</span> test_y_class)))</span></code></pre></div>
<pre><code>## [05:10:01] WARNING: amalgamation/../src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="machine_learning.html#cb1225-1" aria-hidden="true"></a><span class="kw">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## Warning: While computing binary `precision()`, no predicted events were detected (i.e. `true_positive + false_positive = 0`). 
## Precision is undefined in this case, and `NA` will be returned.
## Note that 42 true event(s) actually occured for the problematic event level, &#39;0&#39;.</code></pre>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.543
## 2 precision binary        NA    
## 3 recall    binary         0</code></pre>
</div>
</div>
</div>
<div id="stacking-superlearner" class="section level3" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Stacking (SuperLearner)</h3>
<p>This stacking part of the book heavily relies on <a href="https://github.com/dlab-berkeley/Machine-Learning-in-R/blob/master/07-ensembles.Rmd">Chris Kennedy’s notebook</a>.</p>
<div id="overview" class="section level4" number="8.6.5.1">
<h4><span class="header-section-number">8.6.5.1</span> Overview</h4>
<div id="stacking" class="section level5" number="8.6.5.1.1">
<h5><span class="header-section-number">8.6.5.1.1</span> Stacking</h5>
<p>Wolpert, D.H., 1992. <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.56.1533">Stacked generalization</a>. <em>Neural networks</em>, 5(2), pp.241-259.</p>
<p>Breiman, L., 1996. [Stacked regressions]((<a href="https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf" class="uri">https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf</a>). <em>Machine learning</em>, 24(1), pp.49-64.</p>
</div>
<div id="superlearner" class="section level5" number="8.6.5.1.2">
<h5><span class="header-section-number">8.6.5.1.2</span> SuperLearner</h5>
<p>The <a href="https://cran.r-project.org/web/packages/SuperLearner/index.html">“SuperLearner” R package</a> is a method that simplifies ensemble learning by allowing you to simultaneously evaluate the cross-validated performance of multiple algorithms and/or a single algorithm with differently tuned hyperparameters. This is a generally advisable approach to machine learning instead of fitting single algorithms.</p>
<p>Let’s see how the four classification algorithms you learned in this workshop (1-lasso, 2-decision tree, 3-random forest, and 4-gradient boosted trees) compare to each other and also to 5-binary logistic regression (<code>glm</code>) and the 6-mean of Y as a benchmark algorithm, in terms of their cross-validated error!</p>
<p>A “wrapper” is a short function that adapts an algorithm for the SuperLearner package. Check out the different algorithm wrappers offered by SuperLearner:</p>
</div>
</div>
<div id="choose-algorithms" class="section level4" number="8.6.5.2">
<h4><span class="header-section-number">8.6.5.2</span> Choose algorithms</h4>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1228-1"><a href="machine_learning.html#cb1228-1" aria-hidden="true"></a><span class="co"># Review available models</span></span>
<span id="cb1228-2"><a href="machine_learning.html#cb1228-2" aria-hidden="true"></a>SuperLearner<span class="op">::</span><span class="kw">listWrappers</span>()</span></code></pre></div>
<pre><code>## All prediction algorithm wrappers in SuperLearner:</code></pre>
<pre><code>##  [1] &quot;SL.bartMachine&quot;      &quot;SL.bayesglm&quot;         &quot;SL.biglasso&quot;        
##  [4] &quot;SL.caret&quot;            &quot;SL.caret.rpart&quot;      &quot;SL.cforest&quot;         
##  [7] &quot;SL.earth&quot;            &quot;SL.extraTrees&quot;       &quot;SL.gam&quot;             
## [10] &quot;SL.gbm&quot;              &quot;SL.glm&quot;              &quot;SL.glm.interaction&quot; 
## [13] &quot;SL.glmnet&quot;           &quot;SL.ipredbagg&quot;        &quot;SL.kernelKnn&quot;       
## [16] &quot;SL.knn&quot;              &quot;SL.ksvm&quot;             &quot;SL.lda&quot;             
## [19] &quot;SL.leekasso&quot;         &quot;SL.lm&quot;               &quot;SL.loess&quot;           
## [22] &quot;SL.logreg&quot;           &quot;SL.mean&quot;             &quot;SL.nnet&quot;            
## [25] &quot;SL.nnls&quot;             &quot;SL.polymars&quot;         &quot;SL.qda&quot;             
## [28] &quot;SL.randomForest&quot;     &quot;SL.ranger&quot;           &quot;SL.ridge&quot;           
## [31] &quot;SL.rpart&quot;            &quot;SL.rpartPrune&quot;       &quot;SL.speedglm&quot;        
## [34] &quot;SL.speedlm&quot;          &quot;SL.step&quot;             &quot;SL.step.forward&quot;    
## [37] &quot;SL.step.interaction&quot; &quot;SL.stepAIC&quot;          &quot;SL.svm&quot;             
## [40] &quot;SL.template&quot;         &quot;SL.xgboost&quot;</code></pre>
<pre><code>## 
## All screening algorithm wrappers in SuperLearner:</code></pre>
<pre><code>## [1] &quot;All&quot;
## [1] &quot;screen.corP&quot;           &quot;screen.corRank&quot;        &quot;screen.glmnet&quot;        
## [4] &quot;screen.randomForest&quot;   &quot;screen.SIS&quot;            &quot;screen.template&quot;      
## [7] &quot;screen.ttest&quot;          &quot;write.screen.template&quot;</code></pre>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="machine_learning.html#cb1233-1" aria-hidden="true"></a><span class="co"># Compile the algorithm wrappers to be used.</span></span>
<span id="cb1233-2"><a href="machine_learning.html#cb1233-2" aria-hidden="true"></a>sl_lib &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb1233-3"><a href="machine_learning.html#cb1233-3" aria-hidden="true"></a>  <span class="st">&quot;SL.mean&quot;</span>, <span class="co"># Marginal mean of the outcome ()</span></span>
<span id="cb1233-4"><a href="machine_learning.html#cb1233-4" aria-hidden="true"></a>  <span class="st">&quot;SL.glmnet&quot;</span>, <span class="co"># GLM with lasso/elasticnet regularization</span></span>
<span id="cb1233-5"><a href="machine_learning.html#cb1233-5" aria-hidden="true"></a>  <span class="st">&quot;SL.rpart&quot;</span>, <span class="co"># Decision tree</span></span>
<span id="cb1233-6"><a href="machine_learning.html#cb1233-6" aria-hidden="true"></a>  <span class="st">&quot;SL.ranger&quot;</span>, <span class="co"># Random forest</span></span>
<span id="cb1233-7"><a href="machine_learning.html#cb1233-7" aria-hidden="true"></a>  <span class="st">&quot;SL.xgboost&quot;</span></span>
<span id="cb1233-8"><a href="machine_learning.html#cb1233-8" aria-hidden="true"></a>) <span class="co"># Xgbboost</span></span></code></pre></div>
</div>
<div id="fit-model" class="section level4" number="8.6.5.3">
<h4><span class="header-section-number">8.6.5.3</span> Fit model</h4>
<p>Fit the ensemble!</p>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1234-1"><a href="machine_learning.html#cb1234-1" aria-hidden="true"></a><span class="co"># This is a seed that is compatible with multicore parallel processing.</span></span>
<span id="cb1234-2"><a href="machine_learning.html#cb1234-2" aria-hidden="true"></a><span class="co"># See ?set.seed for more information.</span></span>
<span id="cb1234-3"><a href="machine_learning.html#cb1234-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>, <span class="st">&quot;L&#39;Ecuyer-CMRG&quot;</span>)</span>
<span id="cb1234-4"><a href="machine_learning.html#cb1234-4" aria-hidden="true"></a></span>
<span id="cb1234-5"><a href="machine_learning.html#cb1234-5" aria-hidden="true"></a><span class="co"># This will take a few minutes to execute - take a look at the .html file to see the output!</span></span>
<span id="cb1234-6"><a href="machine_learning.html#cb1234-6" aria-hidden="true"></a>cv_sl &lt;-<span class="st"> </span>SuperLearner<span class="op">::</span><span class="kw">CV.SuperLearner</span>(</span>
<span id="cb1234-7"><a href="machine_learning.html#cb1234-7" aria-hidden="true"></a>  <span class="dt">Y =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(train_y_class)),</span>
<span id="cb1234-8"><a href="machine_learning.html#cb1234-8" aria-hidden="true"></a>  <span class="dt">X =</span> train_x_class,</span>
<span id="cb1234-9"><a href="machine_learning.html#cb1234-9" aria-hidden="true"></a>  <span class="dt">family =</span> <span class="kw">binomial</span>(),</span>
<span id="cb1234-10"><a href="machine_learning.html#cb1234-10" aria-hidden="true"></a>  <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb1234-11"><a href="machine_learning.html#cb1234-11" aria-hidden="true"></a>  <span class="dt">cvControl =</span> <span class="kw">list</span>(<span class="dt">V =</span> 5L, <span class="dt">stratifyCV =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1234-12"><a href="machine_learning.html#cb1234-12" aria-hidden="true"></a>  <span class="dt">SL.library =</span> sl_lib,</span>
<span id="cb1234-13"><a href="machine_learning.html#cb1234-13" aria-hidden="true"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb1234-14"><a href="machine_learning.html#cb1234-14" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="risk" class="section level4" number="8.6.5.4">
<h4><span class="header-section-number">8.6.5.4</span> Risk</h4>
<p>Risk is the average loss, and loss is how far off the prediction was for an individual observation. The lower the risk, the fewer errors the model makes in its prediction. SuperLearner’s default loss metric is squared error <span class="math inline">\((y_{actual} - y_{predicted})^2\)</span>, so the risk is the mean-squared error (just like in ordinary least <em>squares</em> regression). View the summary, plot results, and compute the Area Under the ROC Curve (AUC)!</p>
<div id="summary" class="section level5" number="8.6.5.4.1">
<h5><span class="header-section-number">8.6.5.4.1</span> Summary</h5>
<ul>
<li><code>Discrete SL</code> chooses the best single learner (in this case, <code>SL.glmnet</code> or <code>lasso</code>).</li>
<li><code>SuperLearner</code> takes a weighted average of the <strong>models</strong> using the coefficients (importance of each learner in the overall ensemble). Coefficient 0 means that learner is not used at all.</li>
<li><code>SL.mean_All</code> (the weighted mean of <span class="math inline">\(Y\)</span>) is a benchmark algorithm (ignoring features).</li>
</ul>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="machine_learning.html#cb1235-1" aria-hidden="true"></a><span class="kw">summary</span>(cv_sl)</span></code></pre></div>
<pre><code>## 
## Call:  
## SuperLearner::CV.SuperLearner(Y = as.numeric(as.character(train_y_class)),  
##     X = train_x_class, family = binomial(), SL.library = sl_lib, verbose = FALSE,  
##     cvControl = list(V = 5L, stratifyCV = TRUE)) 
## 
## Risk is based on: Mean Squared Error
## 
## All risk estimates are based on V =  5 
## 
##       Algorithm     Ave        se      Min     Max
##   Super Learner 0.11282 0.0134968 0.076224 0.14230
##     Discrete SL 0.11851 0.0144056 0.075122 0.16281
##     SL.mean_All 0.24798 0.0030968 0.247743 0.24895
##   SL.glmnet_All 0.10730 0.0134988 0.075122 0.14230
##    SL.rpart_All 0.16853 0.0196843 0.107553 0.23162
##   SL.ranger_All 0.12650 0.0120216 0.099022 0.16044
##  SL.xgboost_All 0.13012 0.0149741 0.100833 0.16281</code></pre>
</div>
<div id="plot" class="section level5" number="8.6.5.4.2">
<h5><span class="header-section-number">8.6.5.4.2</span> Plot</h5>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="machine_learning.html#cb1237-1" aria-hidden="true"></a><span class="co"># Plot the cross-validated risk estimate with 95% CIs.</span></span>
<span id="cb1237-2"><a href="machine_learning.html#cb1237-2" aria-hidden="true"></a></span>
<span id="cb1237-3"><a href="machine_learning.html#cb1237-3" aria-hidden="true"></a><span class="kw">plot</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/cvsl_review-1.png" width="672" /></p>
</div>
</div>
<div id="compute-auc-for-all-estimators" class="section level4" number="8.6.5.5">
<h4><span class="header-section-number">8.6.5.5</span> Compute AUC for all estimators</h4>
<p><strong>ROC</strong></p>
<p>ROC: a ROC (receiver operating characteristic curve) plots the relationship between True Positive Rate (Y-axis) and FALSE Positive Rate (X-axis).</p>
<div class="figure">
<img src="https://developers.google.com/machine-learning/crash-course/images/AUC.svg" alt="" />
<p class="caption">Area Under the ROC Curve</p>
</div>
<p><strong>AUC</strong></p>
<p>AUC: Area Under the ROC Curve</p>
<p>1 = perfect</p>
<p>0.5 = no better than chance</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="machine_learning.html#cb1238-1" aria-hidden="true"></a>ck37r<span class="op">::</span><span class="kw">auc_table</span>(cv_sl)</span></code></pre></div>
<pre><code>##                      auc         se  ci_lower  ci_upper      p-value
## SL.mean_All    0.5000000 0.06912305 0.3645213 0.6354787 4.812252e-10
## SL.rpart_All   0.8201030 0.03927866 0.7431182 0.8970877 4.492585e-03
## SL.xgboost_All 0.8823341 0.02454550 0.8342258 0.9304424 4.993591e-02
## SL.ranger_All  0.9062471 0.02029532 0.8664691 0.9460252 2.084499e-01
## DiscreteSL     0.9078490 0.02037110 0.8679224 0.9477756 2.326465e-01
## SuperLearner   0.9149428 0.01971386 0.8763043 0.9535812 3.465460e-01
## SL.glmnet_All  0.9227231 0.01895967 0.8855628 0.9598834 5.000000e-01</code></pre>
<div id="plot-the-roc-curve-for-the-best-estimator-discretsl" class="section level5" number="8.6.5.5.1">
<h5><span class="header-section-number">8.6.5.5.1</span> Plot the ROC curve for the best estimator (DiscretSL)</h5>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="machine_learning.html#cb1240-1" aria-hidden="true"></a>ck37r<span class="op">::</span><span class="kw">plot_roc</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="review-weight-distribution-for-the-superlearner" class="section level5" number="8.6.5.5.2">
<h5><span class="header-section-number">8.6.5.5.2</span> Review weight distribution for the SuperLearner</h5>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="machine_learning.html#cb1241-1" aria-hidden="true"></a><span class="kw">print</span>(ck37r<span class="op">::</span><span class="kw">cvsl_weights</span>(cv_sl), <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>##  # Learner    Mean      SD     Min     Max
##  1  glmnet 0.78712 0.21616 0.48186 1.00000
##  2 xgboost 0.13407 0.19754 0.00000 0.46875
##  3  ranger 0.06893 0.15414 0.00000 0.34466
##  4   rpart 0.00988 0.02208 0.00000 0.04938
##  5    mean 0.00000 0.00000 0.00000 0.00000</code></pre>
<p>The general stacking approach is available in the tidymodels framework through <a href="https://github.com/tidymodels/stacks"><code>stacks</code></a> package (developmental stage).</p>
<p>However, SuperLearner is currently not available in the tidymodels framework. You can easily build and add a parsnip model if you’d like to. If you are interested in knowing more about it, please look at <a href="https://www.tidymodels.org/learn/develop/models/">this vignette</a> of the tidymodels.</p>
</div>
</div>
</div>
<div id="applications-2" class="section level3" number="8.6.6">
<h3><span class="header-section-number">8.6.6</span> Applications</h3>
<div id="bandit-algorithm-optimizing-an-experiment" class="section level4" number="8.6.6.1">
<h4><span class="header-section-number">8.6.6.1</span> Bandit algorithm (optimizing an experiment)</h4>
</div>
<div id="causal-forest-estimating-heterogeneous-treatment-effect" class="section level4" number="8.6.6.2">
<h4><span class="header-section-number">8.6.6.2</span> Causal forest (estimating heterogeneous treatment effect)</h4>
</div>
</div>
</div>
<div id="unsupervised-learning" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Unsupervised learning</h2>
<p>x -&gt; f - &gt; y (not defined)</p>
<div id="dimension-reduction" class="section level3" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> Dimension reduction</h3>
<div class="figure">
<img src="https://i.stack.imgur.com/Q7HIP.gif" alt="" />
<p class="caption">Projecting 2D-data to a line (PCA). From vas3k.com</p>
</div>
<div id="correlation-analysis" class="section level4" number="8.7.1.1">
<h4><span class="header-section-number">8.7.1.1</span> Correlation analysis</h4>
<p>This dataset is a good problem for PCA as some features are highly correlated.</p>
<p>Again, think about what the dataset is about. The following data dictionary comes from <a href="http://rstudio-pubs-static.s3.amazonaws.com/24341_184a58191486470cab97acdbbfe78ed5.html">this site</a>.</p>
<ul>
<li>age - age in years</li>
<li>sex - sex (1 = male; 0 = female)</li>
<li>cp - chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 4 = asymptomatic)</li>
<li>trestbps - resting blood pressure (in mm Hg on admission to the hospital)</li>
<li>chol - serum cholestoral in mg/dl</li>
<li>fbs - fasting blood sugar &gt; 120 mg/dl (1 = true; 0 = false)</li>
<li>restecg - resting electrocardiographic results (0 = normal; 1 = having ST-T; 2 = hypertrophy)</li>
<li>thalach - maximum heart rate achieved</li>
<li>exang - exercise induced angina (1 = yes; 0 = no)</li>
<li>oldpeak - ST depression induced by exercise relative to rest
slope - the slope of the peak exercise ST segment (1 = upsloping; 2 = flat; 3 = downsloping)</li>
<li>ca - number of major vessels (0-3) colored by flourosopy</li>
<li>thal - 3 = normal; 6 = fixed defect; 7 = reversable defect</li>
<li>num - the predicted attribute - diagnosis of heart disease (angiographic disease status) (Value 0 = &lt; 50% diameter narrowing; Value 1 = &gt; 50% diameter narrowing)</li>
</ul>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="machine_learning.html#cb1243-1" aria-hidden="true"></a>data_original <span class="op">%&gt;%</span></span>
<span id="cb1243-2"><a href="machine_learning.html#cb1243-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>target) <span class="op">%&gt;%</span></span>
<span id="cb1243-3"><a href="machine_learning.html#cb1243-3" aria-hidden="true"></a><span class="st">  </span>corrr<span class="op">::</span><span class="kw">correlate</span>()</span></code></pre></div>
<pre><code>## 
## Correlation method: &#39;pearson&#39;
## Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>## # A tibble: 13 × 14
##    term         age     sex      cp trestbps     chol      fbs restecg  thalach
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 age      NA      -0.0984 -0.0687   0.279   0.214    0.121   -0.116  -0.399  
##  2 sex      -0.0984 NA      -0.0494  -0.0568 -0.198    0.0450  -0.0582 -0.0440 
##  3 cp       -0.0687 -0.0494 NA        0.0476 -0.0769   0.0944   0.0444  0.296  
##  4 trestbps  0.279  -0.0568  0.0476  NA       0.123    0.178   -0.114  -0.0467 
##  5 chol      0.214  -0.198  -0.0769   0.123  NA        0.0133  -0.151  -0.00994
##  6 fbs       0.121   0.0450  0.0944   0.178   0.0133  NA       -0.0842 -0.00857
##  7 restecg  -0.116  -0.0582  0.0444  -0.114  -0.151   -0.0842  NA       0.0441 
##  8 thalach  -0.399  -0.0440  0.296   -0.0467 -0.00994 -0.00857  0.0441 NA      
##  9 exang     0.0968  0.142  -0.394    0.0676  0.0670   0.0257  -0.0707 -0.379  
## 10 oldpeak   0.210   0.0961 -0.149    0.193   0.0540   0.00575 -0.0588 -0.344  
## 11 slope    -0.169  -0.0307  0.120   -0.121  -0.00404 -0.0599   0.0930  0.387  
## 12 ca        0.276   0.118  -0.181    0.101   0.0705   0.138   -0.0720 -0.213  
## 13 thal      0.0680  0.210  -0.162    0.0622  0.0988  -0.0320  -0.0120 -0.0964 
## # … with 5 more variables: exang &lt;dbl&gt;, oldpeak &lt;dbl&gt;, slope &lt;dbl&gt;, ca &lt;dbl&gt;,
## #   thal &lt;dbl&gt;</code></pre>
</div>
<div id="descriptive-statistics" class="section level4" number="8.7.1.2">
<h4><span class="header-section-number">8.7.1.2</span> Descriptive statistics</h4>
<p>Notice the scaling issues? PCA is not scale-invariant. So, we need to fix this problem.</p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="machine_learning.html#cb1246-1" aria-hidden="true"></a>min_max &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1246-2"><a href="machine_learning.html#cb1246-2" aria-hidden="true"></a>  <span class="dt">min =</span> <span class="op">~</span><span class="st"> </span><span class="kw">min</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1246-3"><a href="machine_learning.html#cb1246-3" aria-hidden="true"></a>  <span class="dt">max =</span> <span class="op">~</span><span class="st"> </span><span class="kw">max</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1246-4"><a href="machine_learning.html#cb1246-4" aria-hidden="true"></a>)</span>
<span id="cb1246-5"><a href="machine_learning.html#cb1246-5" aria-hidden="true"></a></span>
<span id="cb1246-6"><a href="machine_learning.html#cb1246-6" aria-hidden="true"></a>data_original <span class="op">%&gt;%</span></span>
<span id="cb1246-7"><a href="machine_learning.html#cb1246-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>target) <span class="op">%&gt;%</span></span>
<span id="cb1246-8"><a href="machine_learning.html#cb1246-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric), min_max))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 26
##   age_min age_max sex_min sex_max cp_min cp_max trestbps_min trestbps_max
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1      29      77       0       1      0      3           94          200
## # … with 18 more variables: chol_min &lt;dbl&gt;, chol_max &lt;dbl&gt;, fbs_min &lt;dbl&gt;,
## #   fbs_max &lt;dbl&gt;, restecg_min &lt;dbl&gt;, restecg_max &lt;dbl&gt;, thalach_min &lt;dbl&gt;,
## #   thalach_max &lt;dbl&gt;, exang_min &lt;dbl&gt;, exang_max &lt;dbl&gt;, oldpeak_min &lt;dbl&gt;,
## #   oldpeak_max &lt;dbl&gt;, slope_min &lt;dbl&gt;, slope_max &lt;dbl&gt;, ca_min &lt;dbl&gt;,
## #   ca_max &lt;dbl&gt;, thal_min &lt;dbl&gt;, thal_max &lt;dbl&gt;</code></pre>
</div>
<div id="preprocessing" class="section level4" number="8.7.1.3">
<h4><span class="header-section-number">8.7.1.3</span> Preprocessing</h4>
<p><code>recipe</code> is essential for preprocessing multiple features at once.</p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="machine_learning.html#cb1248-1" aria-hidden="true"></a>pca_recipe &lt;-<span class="st"> </span><span class="kw">recipe</span>(<span class="op">~</span>., <span class="dt">data =</span> data_original) <span class="op">%&gt;%</span></span>
<span id="cb1248-2"><a href="machine_learning.html#cb1248-2" aria-hidden="true"></a><span class="st">  </span><span class="co"># Imputing NAs using mean</span></span>
<span id="cb1248-3"><a href="machine_learning.html#cb1248-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_meanimpute</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></span>
<span id="cb1248-4"><a href="machine_learning.html#cb1248-4" aria-hidden="true"></a><span class="st">  </span><span class="co"># Normalize some numeric variables</span></span>
<span id="cb1248-5"><a href="machine_learning.html#cb1248-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_normalize</span>(<span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;trestbps&quot;</span>, <span class="st">&quot;chol&quot;</span>, <span class="st">&quot;thalach&quot;</span>, <span class="st">&quot;oldpeak&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: `step_meanimpute()` was deprecated in recipes 0.1.16.
## Please use `step_impute_mean()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<div id="pca-analysis" class="section level4" number="8.7.1.4">
<h4><span class="header-section-number">8.7.1.4</span> PCA analysis</h4>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="machine_learning.html#cb1250-1" aria-hidden="true"></a>pca_res &lt;-<span class="st"> </span>pca_recipe <span class="op">%&gt;%</span></span>
<span id="cb1250-2"><a href="machine_learning.html#cb1250-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_pca</span>(<span class="kw">all_predictors</span>(),</span>
<span id="cb1250-3"><a href="machine_learning.html#cb1250-3" aria-hidden="true"></a>    <span class="dt">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1250-4"><a href="machine_learning.html#cb1250-4" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1250-5"><a href="machine_learning.html#cb1250-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">prep</span>()</span>
<span id="cb1250-6"><a href="machine_learning.html#cb1250-6" aria-hidden="true"></a></span>
<span id="cb1250-7"><a href="machine_learning.html#cb1250-7" aria-hidden="true"></a>pca_res <span class="op">%&gt;%</span></span>
<span id="cb1250-8"><a href="machine_learning.html#cb1250-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">id =</span> <span class="st">&quot;pca&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 196 × 4
##    terms        value component id   
##    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
##  1 age      -0.00101  PC1       pca  
##  2 sex       0.216    PC1       pca  
##  3 cp        0.321    PC1       pca  
##  4 trestbps  0.00118  PC1       pca  
##  5 chol     -0.000292 PC1       pca  
##  6 fbs       0.0468   PC1       pca  
##  7 restecg   0.166    PC1       pca  
##  8 thalach   0.0137   PC1       pca  
##  9 exang     0.0962   PC1       pca  
## 10 oldpeak  -0.00863  PC1       pca  
## # … with 186 more rows</code></pre>
<div id="screeplot" class="section level5" number="8.7.1.4.1">
<h5><span class="header-section-number">8.7.1.4.1</span> Screeplot</h5>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="machine_learning.html#cb1252-1" aria-hidden="true"></a><span class="co"># To avoid conflicts</span></span>
<span id="cb1252-2"><a href="machine_learning.html#cb1252-2" aria-hidden="true"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Removing existing preference</code></pre>
<pre><code>## [conflicted] Will prefer dplyr::filter over any other package</code></pre>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="machine_learning.html#cb1255-1" aria-hidden="true"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;select&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## [conflicted] Will prefer dplyr::select over any other package</code></pre>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="machine_learning.html#cb1257-1" aria-hidden="true"></a>pca_recipe <span class="op">%&gt;%</span></span>
<span id="cb1257-2"><a href="machine_learning.html#cb1257-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_pca</span>(<span class="kw">all_predictors</span>(),</span>
<span id="cb1257-3"><a href="machine_learning.html#cb1257-3" aria-hidden="true"></a>    <span class="dt">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1257-4"><a href="machine_learning.html#cb1257-4" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1257-5"><a href="machine_learning.html#cb1257-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span></span>
<span id="cb1257-6"><a href="machine_learning.html#cb1257-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">id =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;variance&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1257-7"><a href="machine_learning.html#cb1257-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(terms <span class="op">==</span><span class="st"> &quot;percent variance&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1257-8"><a href="machine_learning.html#cb1257-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> component, <span class="dt">y =</span> value)) <span class="op">+</span></span>
<span id="cb1257-9"><a href="machine_learning.html#cb1257-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1257-10"><a href="machine_learning.html#cb1257-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1257-11"><a href="machine_learning.html#cb1257-11" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;PCAs of heart disease&quot;</span>,</span>
<span id="cb1257-12"><a href="machine_learning.html#cb1257-12" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;% of variance&quot;</span>,</span>
<span id="cb1257-13"><a href="machine_learning.html#cb1257-13" aria-hidden="true"></a>    <span class="dt">title =</span> <span class="st">&quot;Scree plot&quot;</span></span>
<span id="cb1257-14"><a href="machine_learning.html#cb1257-14" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="view-factor-loadings" class="section level5" number="8.7.1.4.2">
<h5><span class="header-section-number">8.7.1.4.2</span> View factor loadings</h5>
<p>Loadings are the covariances between the features and the principal components (=eigenvectors).</p>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="machine_learning.html#cb1258-1" aria-hidden="true"></a>pca_recipe <span class="op">%&gt;%</span></span>
<span id="cb1258-2"><a href="machine_learning.html#cb1258-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">step_pca</span>(<span class="kw">all_predictors</span>(),</span>
<span id="cb1258-3"><a href="machine_learning.html#cb1258-3" aria-hidden="true"></a>    <span class="dt">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1258-4"><a href="machine_learning.html#cb1258-4" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1258-5"><a href="machine_learning.html#cb1258-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">prep</span>() <span class="op">%&gt;%</span></span>
<span id="cb1258-6"><a href="machine_learning.html#cb1258-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">id =</span> <span class="st">&quot;pca&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1258-7"><a href="machine_learning.html#cb1258-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(component <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1258-8"><a href="machine_learning.html#cb1258-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(</span>
<span id="cb1258-9"><a href="machine_learning.html#cb1258-9" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="kw">fct_reorder</span>(terms, value), <span class="dt">y =</span> value,</span>
<span id="cb1258-10"><a href="machine_learning.html#cb1258-10" aria-hidden="true"></a>    <span class="dt">fill =</span> component</span>
<span id="cb1258-11"><a href="machine_learning.html#cb1258-11" aria-hidden="true"></a>  )) <span class="op">+</span></span>
<span id="cb1258-12"><a href="machine_learning.html#cb1258-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb1258-13"><a href="machine_learning.html#cb1258-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1258-14"><a href="machine_learning.html#cb1258-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1258-15"><a href="machine_learning.html#cb1258-15" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Terms&quot;</span>,</span>
<span id="cb1258-16"><a href="machine_learning.html#cb1258-16" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Contribtutions&quot;</span>,</span>
<span id="cb1258-17"><a href="machine_learning.html#cb1258-17" aria-hidden="true"></a>    <span class="dt">fill =</span> <span class="st">&quot;PCAs&quot;</span></span>
<span id="cb1258-18"><a href="machine_learning.html#cb1258-18" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p><strong>The key lesson</strong></p>
<p>You can use these low-dimensional data to solve the curse of dimensionality problem. Compressing feature space via dimension reduction techniques is called feature extraction. PCA is one way of doing this.</p>
</div>
</div>
</div>
<div id="topic-modeling" class="section level3" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> Topic modeling</h3>
<div id="setup-6" class="section level4" number="8.7.2.1">
<h4><span class="header-section-number">8.7.2.1</span> Setup</h4>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="machine_learning.html#cb1259-1" aria-hidden="true"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb1259-2"><a href="machine_learning.html#cb1259-2" aria-hidden="true"></a>  tidytext, <span class="co"># tidy text analysis</span></span>
<span id="cb1259-3"><a href="machine_learning.html#cb1259-3" aria-hidden="true"></a>  glue, <span class="co"># paste string and objects</span></span>
<span id="cb1259-4"><a href="machine_learning.html#cb1259-4" aria-hidden="true"></a>  stm, <span class="co"># structural topic modeling</span></span>
<span id="cb1259-5"><a href="machine_learning.html#cb1259-5" aria-hidden="true"></a>  gutenbergr</span>
<span id="cb1259-6"><a href="machine_learning.html#cb1259-6" aria-hidden="true"></a>) <span class="co"># toy datasets</span></span></code></pre></div>
</div>
<div id="dataset-1" class="section level4" number="8.7.2.2">
<h4><span class="header-section-number">8.7.2.2</span> Dataset</h4>
<p>The data munging process draws on <a href="https://juliasilge.com/blog/sherlock-holmes-stm/">Julia Silge’s blog post</a>.</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="machine_learning.html#cb1260-1" aria-hidden="true"></a>sherlock_raw &lt;-<span class="st"> </span><span class="kw">gutenberg_download</span>(<span class="dv">1661</span>)</span></code></pre></div>
<pre><code>## Determining mirror for Project Gutenberg from http://www.gutenberg.org/robot/harvest</code></pre>
<pre><code>## Using mirror http://aleph.gutenberg.org</code></pre>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="machine_learning.html#cb1263-1" aria-hidden="true"></a>sherlock &lt;-<span class="st"> </span>sherlock_raw <span class="op">%&gt;%</span></span>
<span id="cb1263-2"><a href="machine_learning.html#cb1263-2" aria-hidden="true"></a><span class="st">  </span><span class="co"># Mutate story using a conditional statement</span></span>
<span id="cb1263-3"><a href="machine_learning.html#cb1263-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1263-4"><a href="machine_learning.html#cb1263-4" aria-hidden="true"></a>    <span class="dt">story =</span> <span class="kw">ifelse</span>(<span class="kw">str_detect</span>(text, <span class="st">&quot;ADVENTURE&quot;</span>), text, <span class="ot">NA</span>)</span>
<span id="cb1263-5"><a href="machine_learning.html#cb1263-5" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1263-6"><a href="machine_learning.html#cb1263-6" aria-hidden="true"></a><span class="st">  </span><span class="co"># Fill in missing values with next value</span></span>
<span id="cb1263-7"><a href="machine_learning.html#cb1263-7" aria-hidden="true"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">fill</span>(story, <span class="dt">.direction =</span> <span class="st">&quot;down&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1263-8"><a href="machine_learning.html#cb1263-8" aria-hidden="true"></a><span class="st">  </span><span class="co"># Filter</span></span>
<span id="cb1263-9"><a href="machine_learning.html#cb1263-9" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(story <span class="op">!=</span><span class="st"> &quot;THE ADVENTURES OF SHERLOCK HOLMES&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1263-10"><a href="machine_learning.html#cb1263-10" aria-hidden="true"></a><span class="st">  </span><span class="co"># Factor</span></span>
<span id="cb1263-11"><a href="machine_learning.html#cb1263-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">story =</span> <span class="kw">factor</span>(story, <span class="dt">levels =</span> <span class="kw">unique</span>(story)))</span>
<span id="cb1263-12"><a href="machine_learning.html#cb1263-12" aria-hidden="true"></a></span>
<span id="cb1263-13"><a href="machine_learning.html#cb1263-13" aria-hidden="true"></a>sherlock &lt;-<span class="st"> </span>sherlock[, <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>] <span class="co"># no id</span></span></code></pre></div>
</div>
<div id="key-ideas" class="section level4" number="8.7.2.3">
<h4><span class="header-section-number">8.7.2.3</span> Key ideas</h4>
<div class="figure">
<img src="https://paperswithcode.com/media/thumbnails/task/task-0000000179-fd3a1d11_fGQkZCJ.jpg" alt="" />
<p class="caption">Source: paperswithcode.com</p>
</div>
<ul>
<li><p>Main papers: See <a href="https://proceedings.neurips.cc/paper/2001/file/296472c9542ad4d4788d543508116cbc-Paper.pdf">Latent Dirichlet Allocation</a> by David M. Blei, Andrew Y. Ng and Michael I. Jordan (then all Berkeley) and this <a href="http://www.cse.cuhk.edu.hk/irwin.king/_media/presentations/latent_dirichlet_allocation.pdf">follow-up paper</a> with the same title.</p></li>
<li><p>Topics as <strong>distributions</strong> of words (<span class="math inline">\(\beta\)</span> distribution)</p></li>
<li><p>Documents as <strong>distributions</strong> of topics (<span class="math inline">\(\alpha\)</span> distribution)</p></li>
<li><p>What distributions?</p>
<ul>
<li><p>Probability</p></li>
<li><p>Multinominal</p></li>
</ul></li>
<li><p>Words lie on a lower-dimensional space (dimension reduction akin to PCA)</p></li>
<li><p>Co-occurrence of words (clustering)</p></li>
<li><p>Bag of words (feature engineering)</p>
<ul>
<li>Upside: easy and fast (also working quite well)</li>
<li>Downside: ignored grammatical structures and rich interactions among words (Alternative: word embeddings. Please check out <a href="http://text2vec.org/">text2vec</a>)</li>
</ul></li>
<li><p>Documents are exchangeable (sequencing won’t matter).</p></li>
<li><p>Topics are independent (uncorrelated). If you don’t think this assumption holds, use Correlated Topics Models by <a href="https://arxiv.org/pdf/0708.3601.pdf#:~:text=The%20correlated%20topic%20model%20(CTM)%20is%20a%20hierarchical%20model%20of,are%20document%2D%20specific%20random%20variables.">Blei and Lafferty (2007)</a>.</p></li>
</ul>
</div>
<div id="exploratory-data-analysis" class="section level4" number="8.7.2.4">
<h4><span class="header-section-number">8.7.2.4</span> Exploratory data analysis</h4>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="machine_learning.html#cb1264-1" aria-hidden="true"></a>sherlock_n &lt;-<span class="st"> </span>sherlock <span class="op">%&gt;%</span></span>
<span id="cb1264-2"><a href="machine_learning.html#cb1264-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(</span>
<span id="cb1264-3"><a href="machine_learning.html#cb1264-3" aria-hidden="true"></a>    <span class="dt">output =</span> word,</span>
<span id="cb1264-4"><a href="machine_learning.html#cb1264-4" aria-hidden="true"></a>    <span class="dt">input =</span> text</span>
<span id="cb1264-5"><a href="machine_learning.html#cb1264-5" aria-hidden="true"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb1264-6"><a href="machine_learning.html#cb1264-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">count</span>(story, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1264-7"><a href="machine_learning.html#cb1264-7" aria-hidden="true"></a></span>
<span id="cb1264-8"><a href="machine_learning.html#cb1264-8" aria-hidden="true"></a>sherlock_total_n &lt;-<span class="st"> </span>sherlock_n <span class="op">%&gt;%</span></span>
<span id="cb1264-9"><a href="machine_learning.html#cb1264-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(story) <span class="op">%&gt;%</span></span>
<span id="cb1264-10"><a href="machine_learning.html#cb1264-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n))</span>
<span id="cb1264-11"><a href="machine_learning.html#cb1264-11" aria-hidden="true"></a></span>
<span id="cb1264-12"><a href="machine_learning.html#cb1264-12" aria-hidden="true"></a>sherlock_words &lt;-<span class="st"> </span>sherlock_n <span class="op">%&gt;%</span></span>
<span id="cb1264-13"><a href="machine_learning.html#cb1264-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>(sherlock_total_n)</span></code></pre></div>
<pre><code>## Joining, by = &quot;story&quot;</code></pre>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="machine_learning.html#cb1266-1" aria-hidden="true"></a>sherlock_words <span class="op">%&gt;%</span></span>
<span id="cb1266-2"><a href="machine_learning.html#cb1266-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">freq =</span> n <span class="op">/</span><span class="st"> </span>total) <span class="op">%&gt;%</span></span>
<span id="cb1266-3"><a href="machine_learning.html#cb1266-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(story) <span class="op">%&gt;%</span></span>
<span id="cb1266-4"><a href="machine_learning.html#cb1266-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb1266-5"><a href="machine_learning.html#cb1266-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(</span>
<span id="cb1266-6"><a href="machine_learning.html#cb1266-6" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="kw">fct_reorder</span>(word, freq),</span>
<span id="cb1266-7"><a href="machine_learning.html#cb1266-7" aria-hidden="true"></a>    <span class="dt">y =</span> freq,</span>
<span id="cb1266-8"><a href="machine_learning.html#cb1266-8" aria-hidden="true"></a>    <span class="dt">fill =</span> story</span>
<span id="cb1266-9"><a href="machine_learning.html#cb1266-9" aria-hidden="true"></a>  )) <span class="op">+</span></span>
<span id="cb1266-10"><a href="machine_learning.html#cb1266-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1266-11"><a href="machine_learning.html#cb1266-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1266-12"><a href="machine_learning.html#cb1266-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>story,</span>
<span id="cb1266-13"><a href="machine_learning.html#cb1266-13" aria-hidden="true"></a>    <span class="dt">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb1266-14"><a href="machine_learning.html#cb1266-14" aria-hidden="true"></a>    <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb1266-15"><a href="machine_learning.html#cb1266-15" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1266-16"><a href="machine_learning.html#cb1266-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span></span>
<span id="cb1266-17"><a href="machine_learning.html#cb1266-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1266-18"><a href="machine_learning.html#cb1266-18" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1266-19"><a href="machine_learning.html#cb1266-19" aria-hidden="true"></a>    <span class="dt">fill =</span> <span class="st">&quot;Story&quot;</span></span>
<span id="cb1266-20"><a href="machine_learning.html#cb1266-20" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1266-21"><a href="machine_learning.html#cb1266-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<pre><code>## Selecting by freq</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
</div>
<div id="stm" class="section level4" number="8.7.2.5">
<h4><span class="header-section-number">8.7.2.5</span> STM</h4>
<p><a href="https://www.structuraltopicmodel.com/">Structural Topic Modeling</a> by Roberts, Stewart, and Tingley helps estimate how topics’ proportions vary by covariates. If you don’t use covariates, this approach is close to CTM. The other useful (and very recent) topic modeling package is Keyword Assisted Topic Models (<a href="https://keyatm.github.io/keyATM/">keyATM</a>) by Shusei, Imai, and Sasaki.</p>
<p>Also, note that we didn’t cover other important techniques in topic modeling, such as dynamic and hierarchical topic modeling.</p>
<p><img src="https://warin.ca/shiny/stm/images/fig02.png" /></p>
<div id="turn-text-into-document-term-matrix" class="section level5" number="8.7.2.5.1">
<h5><span class="header-section-number">8.7.2.5.1</span> Turn text into document-term matrix</h5>
<p><code>stm</code> package has its preprocessing function.</p>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="machine_learning.html#cb1268-1" aria-hidden="true"></a>dtm &lt;-<span class="st"> </span><span class="kw">textProcessor</span>(</span>
<span id="cb1268-2"><a href="machine_learning.html#cb1268-2" aria-hidden="true"></a>  <span class="dt">documents =</span> sherlock<span class="op">$</span>text,</span>
<span id="cb1268-3"><a href="machine_learning.html#cb1268-3" aria-hidden="true"></a>  <span class="dt">metadata =</span> sherlock,</span>
<span id="cb1268-4"><a href="machine_learning.html#cb1268-4" aria-hidden="true"></a>  <span class="dt">removestopwords =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1268-5"><a href="machine_learning.html#cb1268-5" aria-hidden="true"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb1268-6"><a href="machine_learning.html#cb1268-6" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="tuning-k" class="section level5" number="8.7.2.5.2">
<h5><span class="header-section-number">8.7.2.5.2</span> Tuning K</h5>
<ul>
<li>K is the number of topics.</li>
<li>Let’s try K = 5, 10, 15.</li>
</ul>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="machine_learning.html#cb1269-1" aria-hidden="true"></a>test_res &lt;-<span class="st"> </span><span class="kw">searchK</span>(</span>
<span id="cb1269-2"><a href="machine_learning.html#cb1269-2" aria-hidden="true"></a>  dtm<span class="op">$</span>documents,</span>
<span id="cb1269-3"><a href="machine_learning.html#cb1269-3" aria-hidden="true"></a>  dtm<span class="op">$</span>vocab,</span>
<span id="cb1269-4"><a href="machine_learning.html#cb1269-4" aria-hidden="true"></a>  <span class="dt">K =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>),</span>
<span id="cb1269-5"><a href="machine_learning.html#cb1269-5" aria-hidden="true"></a>  <span class="dt">prevalence =</span> <span class="op">~</span>story,</span>
<span id="cb1269-6"><a href="machine_learning.html#cb1269-6" aria-hidden="true"></a>  <span class="dt">data =</span> dtm<span class="op">$</span>meta</span>
<span id="cb1269-7"><a href="machine_learning.html#cb1269-7" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Beginning Spectral Initialization 
##   Calculating the gram matrix...
##   Finding anchor words...
##      .....
##   Recovering initialization...
##      ..............................................
## Initialization complete.
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 1 (approx. per word bound = -7.627) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 2 (approx. per word bound = -7.512, relative change = 1.510e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 3 (approx. per word bound = -7.419, relative change = 1.228e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 4 (approx. per word bound = -7.381, relative change = 5.151e-03) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 5 (approx. per word bound = -7.365, relative change = 2.165e-03) 
## Topic 1: littl, man, see, hand, shall 
##  Topic 2: upon, holm, think, come, take 
##  Topic 3: said, will, just, know, word 
##  Topic 4: one, may, came, tell, ask 
##  Topic 5: time, sherlock, case, saw, face 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 6 (approx. per word bound = -7.358, relative change = 9.504e-04) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 7 (approx. per word bound = -7.355, relative change = 4.015e-04) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 8 (approx. per word bound = -7.354, relative change = 1.580e-04) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Model Converged 
## Beginning Spectral Initialization 
##   Calculating the gram matrix...
##   Finding anchor words...
##      ..........
##   Recovering initialization...
##      ..............................................
## Initialization complete.
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 1 (approx. per word bound = -7.699) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 2 (approx. per word bound = -7.499, relative change = 2.594e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 3 (approx. per word bound = -7.373, relative change = 1.684e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 4 (approx. per word bound = -7.287, relative change = 1.172e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 5 (approx. per word bound = -7.257, relative change = 4.115e-03) 
## Topic 1: miss, littl, came, man, good 
##  Topic 2: said, might, sudden, hous, went 
##  Topic 3: upon, just, never, right, two 
##  Topic 4: upon, will, one, see, may 
##  Topic 5: sherlock, name, think, laugh, holm 
##  Topic 6: see, hard, night, cri, forward 
##  Topic 7: littl, stone, becam, whole, sure 
##  Topic 8: can, know, matter, now, say 
##  Topic 9: man, hand, knew, one, even 
##  Topic 10: holm, ask, sat, “pray, long 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 6 (approx. per word bound = -7.248, relative change = 1.256e-03) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 7 (approx. per word bound = -7.247, relative change = 9.258e-05) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Model Converged 
## Beginning Spectral Initialization 
##   Calculating the gram matrix...
##   Finding anchor words...
##      ...............
##   Recovering initialization...
##      ..............................................
## Initialization complete.
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 1 (approx. per word bound = -7.749) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 2 (approx. per word bound = -7.417, relative change = 4.283e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 3 (approx. per word bound = -7.297, relative change = 1.624e-02) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 4 (approx. per word bound = -7.242, relative change = 7.558e-03) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 5 (approx. per word bound = -7.222, relative change = 2.745e-03) 
## Topic 1: think, holm, turn, now, “ye 
##  Topic 2: might, dress, hous, place, near 
##  Topic 3: know, without, now, “’s, money 
##  Topic 4: open, may, look, much, one 
##  Topic 5: hand, well, see, way, littl 
##  Topic 6: question, salesman, told, companion, close 
##  Topic 7: littl, told, feel, remark, quit 
##  Topic 8: can, matter, “oh, say, away 
##  Topic 9: will, shall, must, come, littl 
##  Topic 10: one, man, light, time, two 
##  Topic 11: upon, holm, miss, man, sherlock 
##  Topic 12: room, came, ask, just, hous 
##  Topic 13: may, tell, sir, find, help 
##  Topic 14: said, holm, believ, laugh, will 
##  Topic 15: littl, now, noth, day, saw 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 6 (approx. per word bound = -7.212, relative change = 1.382e-03) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 7 (approx. per word bound = -7.207, relative change = 5.993e-04) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 8 (approx. per word bound = -7.203, relative change = 5.851e-04) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Completing Iteration 9 (approx. per word bound = -7.202, relative change = 9.837e-05) 
## ....................................................................................................
## Completed E-Step (0 seconds). 
## Completed M-Step. 
## Model Converged</code></pre>
</div>
<div id="evaludating-models" class="section level5" number="8.7.2.5.3">
<h5><span class="header-section-number">8.7.2.5.3</span> Evaludating models</h5>
<p>Several metrics assess topic models’ performance: the held-out likelihood, residuals, semantic coherence, and exclusivity. Here we examine the relationship between semantic coherence and exclusivity to understand the trade-off involved in selecting K.</p>
<ul>
<li><p>Semantic coherence: high probability words for a topic co-occur in documents</p></li>
<li><p>Exclusivity: keywords of one topic are not likely to appear as keywords in other topics.</p></li>
</ul>
<blockquote>
<p>In Roberts et al. 2014 we proposed using the Mimno et al. 2011 semantic coherence metric for helping with topic model selection. However, we found that semantic coherence alone is relatively easy to achieve by having only a couple of topics that dominate the most common words. Thus we also proposed an exclusivity measure.</p>
</blockquote>
<blockquote>
<p>Our exclusivity measure includes some information on word frequency as well. It is based on the FREX labeling metric (calcfrex) with the weight set to .7 in favor of exclusivity by default.</p>
</blockquote>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="machine_learning.html#cb1271-1" aria-hidden="true"></a>test_res<span class="op">$</span>results <span class="op">%&gt;%</span></span>
<span id="cb1271-2"><a href="machine_learning.html#cb1271-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="kw">c</span>(K, exclus, semcoh)) <span class="op">%&gt;%</span></span>
<span id="cb1271-3"><a href="machine_learning.html#cb1271-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(K, exclus, semcoh) <span class="op">%&gt;%</span></span>
<span id="cb1271-4"><a href="machine_learning.html#cb1271-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">K =</span> <span class="kw">as.factor</span>(K)) <span class="op">%&gt;%</span></span>
<span id="cb1271-5"><a href="machine_learning.html#cb1271-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> exclus, <span class="dt">y =</span> semcoh)) <span class="op">+</span></span>
<span id="cb1271-6"><a href="machine_learning.html#cb1271-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1271-7"><a href="machine_learning.html#cb1271-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb1271-8"><a href="machine_learning.html#cb1271-8" aria-hidden="true"></a>    <span class="dt">label =</span> <span class="kw">glue</span>(<span class="st">&quot;K = {test_res$results$K}&quot;</span>),</span>
<span id="cb1271-9"><a href="machine_learning.html#cb1271-9" aria-hidden="true"></a>    <span class="dt">size =</span> <span class="dv">5</span>,</span>
<span id="cb1271-10"><a href="machine_learning.html#cb1271-10" aria-hidden="true"></a>    <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb1271-11"><a href="machine_learning.html#cb1271-11" aria-hidden="true"></a>    <span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">height =</span> <span class="fl">0.05</span>)</span>
<span id="cb1271-12"><a href="machine_learning.html#cb1271-12" aria-hidden="true"></a>  ) <span class="op">+</span></span>
<span id="cb1271-13"><a href="machine_learning.html#cb1271-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1271-14"><a href="machine_learning.html#cb1271-14" aria-hidden="true"></a>    <span class="dt">x =</span> <span class="st">&quot;Exclusivity&quot;</span>,</span>
<span id="cb1271-15"><a href="machine_learning.html#cb1271-15" aria-hidden="true"></a>    <span class="dt">y =</span> <span class="st">&quot;Semantic coherence&quot;</span>,</span>
<span id="cb1271-16"><a href="machine_learning.html#cb1271-16" aria-hidden="true"></a>    <span class="dt">title =</span> <span class="st">&quot;Exclusivity and semantic coherence&quot;</span></span>
<span id="cb1271-17"><a href="machine_learning.html#cb1271-17" aria-hidden="true"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
</div>
<div id="finalize" class="section level5" number="8.7.2.5.4">
<h5><span class="header-section-number">8.7.2.5.4</span> Finalize</h5>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="machine_learning.html#cb1272-1" aria-hidden="true"></a>final_stm &lt;-<span class="st"> </span><span class="kw">stm</span>(dtm<span class="op">$</span>documents,</span>
<span id="cb1272-2"><a href="machine_learning.html#cb1272-2" aria-hidden="true"></a>  dtm<span class="op">$</span>vocab,</span>
<span id="cb1272-3"><a href="machine_learning.html#cb1272-3" aria-hidden="true"></a>  <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">prevalence =</span> <span class="op">~</span>story,</span>
<span id="cb1272-4"><a href="machine_learning.html#cb1272-4" aria-hidden="true"></a>  <span class="dt">max.em.its =</span> <span class="dv">75</span>,</span>
<span id="cb1272-5"><a href="machine_learning.html#cb1272-5" aria-hidden="true"></a>  <span class="dt">data =</span> dtm<span class="op">$</span>meta,</span>
<span id="cb1272-6"><a href="machine_learning.html#cb1272-6" aria-hidden="true"></a>  <span class="dt">init.type =</span> <span class="st">&quot;Spectral&quot;</span>,</span>
<span id="cb1272-7"><a href="machine_learning.html#cb1272-7" aria-hidden="true"></a>  <span class="dt">seed =</span> <span class="dv">1234567</span>,</span>
<span id="cb1272-8"><a href="machine_learning.html#cb1272-8" aria-hidden="true"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb1272-9"><a href="machine_learning.html#cb1272-9" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="explore-the-results" class="section level5" number="8.7.2.5.5">
<h5><span class="header-section-number">8.7.2.5.5</span> Explore the results</h5>
<ul>
<li>Using the <code>stm</code> package.</li>
</ul>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="machine_learning.html#cb1273-1" aria-hidden="true"></a><span class="kw">plot</span>(final_stm)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<ul>
<li>Using ggplot2</li>
</ul>
<p>In LDA distribution, <span class="math inline">\(\alpha\)</span> represents document-topic density and <span class="math inline">\(\beta\)</span> represents topic-word density.</p>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1274-1"><a href="machine_learning.html#cb1274-1" aria-hidden="true"></a><span class="co"># tidy</span></span>
<span id="cb1274-2"><a href="machine_learning.html#cb1274-2" aria-hidden="true"></a>tidy_stm &lt;-<span class="st"> </span><span class="kw">tidy</span>(final_stm)</span>
<span id="cb1274-3"><a href="machine_learning.html#cb1274-3" aria-hidden="true"></a></span>
<span id="cb1274-4"><a href="machine_learning.html#cb1274-4" aria-hidden="true"></a><span class="co"># top terms</span></span>
<span id="cb1274-5"><a href="machine_learning.html#cb1274-5" aria-hidden="true"></a>tidy_stm <span class="op">%&gt;%</span></span>
<span id="cb1274-6"><a href="machine_learning.html#cb1274-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(topic) <span class="op">%&gt;%</span></span>
<span id="cb1274-7"><a href="machine_learning.html#cb1274-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>, beta) <span class="op">%&gt;%</span></span>
<span id="cb1274-8"><a href="machine_learning.html#cb1274-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb1274-9"><a href="machine_learning.html#cb1274-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">fct_reorder</span>(term, beta), beta, <span class="dt">fill =</span> <span class="kw">as.factor</span>(topic))) <span class="op">+</span></span>
<span id="cb1274-10"><a href="machine_learning.html#cb1274-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1274-11"><a href="machine_learning.html#cb1274-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>topic, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></span>
<span id="cb1274-12"><a href="machine_learning.html#cb1274-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1274-13"><a href="machine_learning.html#cb1274-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></span>
<span id="cb1274-14"><a href="machine_learning.html#cb1274-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="references-4" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> References</h2>
<div id="books" class="section level3" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> Books</h3>
<ul>
<li><p><em>An Introduction to Statistical Learning - with Applications in R (2013)</em> by Gareth James, Daniela Witten, Trevor Hastie, Robert Tibshirani. Springer: New York. <a href="https://www.amazon.com/Introduction-Statistical-Learning-Applications-Statistics/dp/1461471370">Amazon</a> or <a href="http://www-bcf.usc.edu/~gareth/ISL/">free PDF</a>.</p></li>
<li><p><em>Hands-On Machine Learning with R (2020)</em> by Bradley Boehmke &amp; Brandon Greenwell. <a href="https://www.routledge.com/Hands-On-Machine-Learning-with-R/Boehmke-Greenwell/p/book/9781138495685">CRC Press</a> or <a href="https://www.amazon.com/gp/product/1138495689?pf_rd_p=ab873d20-a0ca-439b-ac45-cd78f07a84d8&amp;pf_rd_r=JBRX0ZJ1WFSR9T3JPTQE">Amazon</a></p></li>
<li><p><em>Applied Predictive Modeling (2013)</em> by Max Kuhn and Kjell Johnson. Springer: New York. <a href="https://www.amazon.com/Applied-Predictive-Modeling-Max-Kuhn/dp/1461468485?SubscriptionId=0ENGV10E9K9QDNSJ5C82&amp;tag=apm0a-20&amp;linkCode=xm2&amp;camp=2025&amp;creative=165953&amp;creativeASIN=1461468485">Amazon</a></p></li>
<li><p><em>Feature Engineering and Selection: A Practical Approach for Predictive Models (2019)</em> by Kjell Johnson and Max Kuhn. Taylor &amp; Francis. <a href="http://www.feat.engineering/">Amazon</a> or <a href="http://www.feat.engineering/">free HTML</a>.</p></li>
<li><p><em><a href="https://www.tmwr.org/">Tidy Modeling with R</a> (2020)</em> by Max Kuhn and Julia Silge (work-in-progress)</p></li>
</ul>
</div>
<div id="lecture-slides" class="section level3" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Lecture slides</h3>
<ul>
<li><p><a href="https://www.nber.org/econometrics_minicourse_2015/nber_slides11.pdf">An introduction to supervised and unsupervised learning (2015)</a> by Susan Athey and Guido Imbens</p></li>
<li><p><a href="https://education.rstudio.com/blog/2020/02/conf20-intro-ml/">Introduction Machine Learning with the Tidyverse</a> by Alison Hill</p></li>
</ul>
</div>
<div id="blog-posts" class="section level3" number="8.8.3">
<h3><span class="header-section-number">8.8.3</span> Blog posts</h3>
<ul>
<li><a href="http://www.rebeccabarter.com/blog/2019-06-06_pre_processing/">“Using the recipes package for easy pre-processing”</a> by Rebecca Barter</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="semi_structured_data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big_data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["PS239T.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
