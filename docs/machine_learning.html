<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 High-dimensional data | Computational Thinking for Social Scientists</title>
  <meta name="description" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 High-dimensional data | Computational Thinking for Social Scientists" />
  
  
  

<meta name="author" content="Jae Yeon Kim" />


<meta name="date" content="2025-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="semi_structured_data.html"/>
<link rel="next" href="big_data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Thinking for Social Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Computational Thinking</a></li>
<li class="chapter" data-level="3" data-path="git_bash.html"><a href="git_bash.html"><i class="fa fa-check"></i><b>3</b> Managing data and code</a></li>
<li class="chapter" data-level="4" data-path="tidy_data.html"><a href="tidy_data.html"><i class="fa fa-check"></i><b>4</b> Tidy data and its friends</a></li>
<li class="chapter" data-level="5" data-path="functional_programming.html"><a href="functional_programming.html"><i class="fa fa-check"></i><b>5</b> Automating repeated things</a></li>
<li class="chapter" data-level="6" data-path="products.html"><a href="products.html"><i class="fa fa-check"></i><b>6</b> Developing data products</a></li>
<li class="chapter" data-level="7" data-path="semi_structured_data.html"><a href="semi_structured_data.html"><i class="fa fa-check"></i><b>7</b> Semi-structured data</a></li>
<li class="chapter" data-level="8" data-path="machine_learning.html"><a href="machine_learning.html"><i class="fa fa-check"></i><b>8</b> High-dimensional data</a></li>
<li class="chapter" data-level="9" data-path="big_data.html"><a href="big_data.html"><i class="fa fa-check"></i><b>9</b> Big data</a></li>
<li class="divider"></li>
<li>
  <a href="https://github.com/jaeyk/PS239T" target="_blank">
    Published with <code>{bookdown}</code>
  </a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Thinking for Social Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="machine_learning" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> High-dimensional data<a href="machine_learning.html#machine_learning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-big-picture-9" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> The Big Picture<a href="machine_learning.html#the-big-picture-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>The rise of high-dimensional data. The new data frontiers in social sciences—text (<a href="https://web.stanford.edu/~gentzkow/research/text-as-data.pdf">Gentzkow et al. 2019</a>; <a href="https://www.jstor.org/stable/pdf/24572662.pdf?casa_token=SQdSI4R_VdwAAAAA:4QiVLhCXqr9f0qNMM9U75EL5JbDxxnXxUxyIfDf0U8ZzQx9szc0xVqaU6DXG4nHyZiNkvcwGlgD6H0Lxj3y0ULHwgkf1MZt8-9TPVtkEH9I4AHgbTg">Grimmer and Stewart 2013</a>) and and image (<a href="https://arxiv.org/pdf/1810.01544">Joo and Steinert-Threlkeld 2018</a>)—are all high-dimensional data.</p>
<ul>
<li><p>1000 common English words for 30-word tweets: <span class="math inline">\(1000^{30}\)</span> similar to N of atoms in the universe (<a href="https://web.stanford.edu/~gentzkow/research/text-as-data.pdf">Gentzkow et al. 2019</a>)</p></li>
<li><p>Belloni, Alexandre, Victor Chernozhukov, and Christian Hansen. <a href="https://pubs.aeaweb.org/doi/pdfplus/10.1257/jep.28.2.29">“High-dimensional methods and inference on structural and treatment effects.”</a> <em>Journal of Economic Perspectives 28</em>, no. 2 (2014): 29-50.</p></li>
</ul></li>
<li><p>The rise of the new approach: statistics + computer science = machine learning</p></li>
<li><p>Statistical inference</p>
<ul>
<li><p><span class="math inline">\(y\)</span> &lt;- some probability models (e.g., linear regression, logistic regression) &lt;- <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(y\)</span> = <span class="math inline">\(X\beta\)</span> + <span class="math inline">\(\epsilon\)</span></p></li>
<li><p>The goal is to estimate <span class="math inline">\(\beta\)</span></p></li>
</ul></li>
<li><p>Machine learning</p>
<ul>
<li><p><span class="math inline">\(y\)</span> &lt;- unknown &lt;- <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(y\)</span> &lt;-&gt; decision trees, neutral nets &lt;-&gt; <span class="math inline">\(x\)</span></p></li>
<li><p>For the main idea behind prediction modeling, see Breiman, Leo (Berkeley stat faculty who passed away in 2005). <a href="https://projecteuclid.org/euclid.ss/1009213726">“Statistical modeling: The two cultures (with comments and a rejoinder by the author).”</a> <em>Statistical science</em> 16, no. 3 (2001): 199-231.</p></li>
<li><p>“The problem is to find an algorithm <span class="math inline">\(f(x)\)</span> such that for future <span class="math inline">\(x\)</span> in a test set, <span class="math inline">\(f(x)\)</span> will be a good predictor of <span class="math inline">\(y\)</span>.”</p></li>
<li><p>“There are <strong>two cultures</strong> in the use of statistical modeling to reach conclusions from data. One assumes that the data are generated by a <strong>given</strong> <strong>stochastic data model</strong>. The other uses <strong>algorithmic models</strong> and treats the data mechanism as <strong>unknown</strong>.”</p></li>
</ul></li>
<li><p>How ML differs from econometrics?</p></li>
<li><p>A review by Athey, Susan, and Guido W. Imbens. <a href="https://www.annualreviews.org/doi/full/10.1146/annurev-economics-080217-053433">“Machine learning methods that economists should know about.”</a> <em>Annual Review of Economics</em> 11 (2019): 685-725.</p></li>
<li><p>Stat:</p>
<ul>
<li><p>Specifying a target (i.e., an estimand)</p></li>
<li><p>Fitting a model to data using an objective function (e.g., the sum of squared errors)</p></li>
<li><p>Reporting point estimates (effect size) and standard errors (uncertainty)</p></li>
<li><p>Validation by yes-no using goodness-of-fit tests and residual examination</p></li>
</ul></li>
<li><p>ML:</p>
<ul>
<li><p>Developing algorithms (estimating <em>f(x)</em>)</p></li>
<li><p>Prediction power, not structural/causal parameters</p></li>
<li><p>Basically, high-dimensional data statistics (N &lt; P)</p></li>
<li><p>The major problem is to avoid <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">“the curse of dimensionality”</a> (<a href="https://towardsdatascience.com/the-curse-of-dimensionality-50dc6e49aa1e">too many features - &gt; overfitting</a>)</p></li>
<li><p>Validation: out-of-sample comparisons (cross-validation) not in-sample goodness-of-fit measures</p></li>
<li><p>So, it’s curve-fitting, but the primary focus is unseen (test data), not seen data (training data)</p></li>
</ul></li>
<li><p>A quick review on ML lingos for those trained in econometrics</p>
<ul>
<li><p>Sample to estimate parameters = Training sample</p></li>
<li><p>Estimating the model = Being trained</p></li>
<li><p>Regressors, covariates, or predictors = Features</p></li>
<li><p>Regression parameters = weights</p></li>
<li><p>Prediction problems = Supervised (some <span class="math inline">\(y\)</span> are known) + Unsupervised (<span class="math inline">\(y\)</span> unknown)</p></li>
</ul></li>
</ul>
<div class="float">
<img src="https://i.vas3k.ru/7w9.jpg" alt="How to teach machines. Based on vas3k blog. Many images in this chapter come from vas3k blog." />
<div class="figcaption">How to teach machines. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a>. Many images in this chapter come from vas3k blog.</div>
</div>
<div class="float">
<img src="https://i.vas3k.ru/7vz.jpg" alt="The main types of machine learning. Based on vas3k blog" />
<div class="figcaption">The main types of machine learning. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></div>
</div>
<div class="float">
<img src="https://i.vas3k.ru/7vx.jpg" alt="The map of the machine learning universe. Based on vas3k blog" />
<div class="figcaption">The map of the machine learning universe. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></div>
</div>
<div class="float">
<img src="https://i.vas3k.ru/7w1.jpg" alt="Classical machine learning. Based on vas3k blog" />
<div class="figcaption">Classical machine learning. Based on <a href="https://vas3k.com/blog/machine_learning/">vas3k blog</a></div>
</div>
</div>
<div id="dataset" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Dataset<a href="machine_learning.html#dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p><a href="https://archive.ics.uci.edu/ml/datasets/heart+Disease">Heart disease data from UCI</a></p></li>
<li><p>One of the popular datasets used in machine learning competitions</p></li>
</ul>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="machine_learning.html#cb1088-1" tabindex="-1"></a><span class="co"># Install pacman if needed, then load packages</span></span>
<span id="cb1088-2"><a href="machine_learning.html#cb1088-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;pacman&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1088-3"><a href="machine_learning.html#cb1088-3" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span>
<span id="cb1088-4"><a href="machine_learning.html#cb1088-4" tabindex="-1"></a>}</span>
<span id="cb1088-5"><a href="machine_learning.html#cb1088-5" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1088-6"><a href="machine_learning.html#cb1088-6" tabindex="-1"></a>  here,         <span class="co"># Project‐root file paths</span></span>
<span id="cb1088-7"><a href="machine_learning.html#cb1088-7" tabindex="-1"></a>  tidyverse,    <span class="co"># Data manipulation &amp; visualization (dplyr, ggplot2, etc.)</span></span>
<span id="cb1088-8"><a href="machine_learning.html#cb1088-8" tabindex="-1"></a>  tidymodels,   <span class="co"># Modeling ecosystem (parsnip, recipes, yardstick, etc.)</span></span>
<span id="cb1088-9"><a href="machine_learning.html#cb1088-9" tabindex="-1"></a>  doParallel,   <span class="co"># Parallel backend for modeling (foreach, caret, tidymodels)</span></span>
<span id="cb1088-10"><a href="machine_learning.html#cb1088-10" tabindex="-1"></a>  patchwork,    <span class="co"># Compose multiple ggplots into one layout</span></span>
<span id="cb1088-11"><a href="machine_learning.html#cb1088-11" tabindex="-1"></a>  remotes,      <span class="co"># Install packages from GitHub and other remote sources</span></span>
<span id="cb1088-12"><a href="machine_learning.html#cb1088-12" tabindex="-1"></a>  SuperLearner, <span class="co"># Ensemble learning via stacked generalization</span></span>
<span id="cb1088-13"><a href="machine_learning.html#cb1088-13" tabindex="-1"></a>  vip,          <span class="co"># Variable importance plots (model‐agnostic)</span></span>
<span id="cb1088-14"><a href="machine_learning.html#cb1088-14" tabindex="-1"></a>  glmnet,       <span class="co"># Regularized regression (lasso, ridge, elastic net)</span></span>
<span id="cb1088-15"><a href="machine_learning.html#cb1088-15" tabindex="-1"></a>  finetune,     <span class="co"># Advanced hyperparameter tuning (race methods, etc.)</span></span>
<span id="cb1088-16"><a href="machine_learning.html#cb1088-16" tabindex="-1"></a>  glue,         <span class="co"># String interpolation</span></span>
<span id="cb1088-17"><a href="machine_learning.html#cb1088-17" tabindex="-1"></a>  xgboost,      <span class="co"># Gradient boosting (XGBoost)</span></span>
<span id="cb1088-18"><a href="machine_learning.html#cb1088-18" tabindex="-1"></a>  rpart,        <span class="co"># Recursive partitioning trees</span></span>
<span id="cb1088-19"><a href="machine_learning.html#cb1088-19" tabindex="-1"></a>  ranger,       <span class="co"># Fast random forests with C++ backend</span></span>
<span id="cb1088-20"><a href="machine_learning.html#cb1088-20" tabindex="-1"></a>  conflicted    <span class="co"># Explicit conflict resolution for masking functions</span></span>
<span id="cb1088-21"><a href="machine_learning.html#cb1088-21" tabindex="-1"></a>)</span>
<span id="cb1088-22"><a href="machine_learning.html#cb1088-22" tabindex="-1"></a></span>
<span id="cb1088-23"><a href="machine_learning.html#cb1088-23" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ck37/ck37r&quot;</span>)</span>
<span id="cb1088-24"><a href="machine_learning.html#cb1088-24" tabindex="-1"></a></span>
<span id="cb1088-25"><a href="machine_learning.html#cb1088-25" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="machine_learning.html#cb1089-1" tabindex="-1"></a><span class="do">## Jae&#39;s custom functions</span></span>
<span id="cb1089-2"><a href="machine_learning.html#cb1089-2" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">&quot;functions&quot;</span>, <span class="st">&quot;ml_utils.r&quot;</span>))</span>
<span id="cb1089-3"><a href="machine_learning.html#cb1089-3" tabindex="-1"></a></span>
<span id="cb1089-4"><a href="machine_learning.html#cb1089-4" tabindex="-1"></a><span class="co"># Import the dataset</span></span>
<span id="cb1089-5"><a href="machine_learning.html#cb1089-5" tabindex="-1"></a></span>
<span id="cb1089-6"><a href="machine_learning.html#cb1089-6" tabindex="-1"></a>data_original <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;heart.csv&quot;</span>))</span>
<span id="cb1089-7"><a href="machine_learning.html#cb1089-7" tabindex="-1"></a></span>
<span id="cb1089-8"><a href="machine_learning.html#cb1089-8" tabindex="-1"></a><span class="fu">glimpse</span>(data_original)</span></code></pre></div>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5…
## $ sex      &lt;dbl&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1…
## $ cp       &lt;dbl&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0…
## $ trestbps &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1…
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2…
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1…
## $ thalach  &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1…
## $ exang    &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0…
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0…
## $ slope    &lt;dbl&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1…
## $ ca       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0…
## $ thal     &lt;dbl&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3…
## $ target   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="machine_learning.html#cb1091-1" tabindex="-1"></a><span class="co"># Createa a copy</span></span>
<span id="cb1091-2"><a href="machine_learning.html#cb1091-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_original</span>
<span id="cb1091-3"><a href="machine_learning.html#cb1091-3" tabindex="-1"></a></span>
<span id="cb1091-4"><a href="machine_learning.html#cb1091-4" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span></code></pre></div>
</div>
<div id="workflow-3" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Workflow<a href="machine_learning.html#workflow-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><ol style="list-style-type: decimal">
<li>Preprocessing</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Model building</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Model fitting</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>Model evaluation</li>
</ol></li>
<li><ol start="5" style="list-style-type: decimal">
<li>Model tuning</li>
</ol></li>
<li><ol start="6" style="list-style-type: decimal">
<li>Prediction</li>
</ol></li>
</ul>
</div>
<div id="tidymodels" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> tidymodels<a href="machine_learning.html#tidymodels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Like <code>tidyverse</code>, <code>tidymodels</code> is a collection of packages.</p>
<ul>
<li><p><a href="https://rsample.tidymodels.org/"><code>rsample</code></a>: for data splitting</p></li>
<li><p><a href="https://recipes.tidymodels.org/index.html"><code>recipes</code></a>: for pre-processing</p></li>
<li><p><a href="https://www.tidyverse.org/blog/2018/11/parsnip-0-0-1/"><code>parsnip</code></a>: for model building</p>
<ul>
<li><a href="https://github.com/tidymodels/tune"><code>tune</code></a>: hyperparameter tuning</li>
</ul></li>
<li><p><a href="https://github.com/tidymodels/yardstick"><code>yardstick</code></a>: for model evaluations</p></li>
<li><p><a href="https://github.com/tidymodels/workflows"><code>workflows</code></a>: for bundling a pieplne that bundles together preprocessing, modeling, and post-processing requests</p></li>
</ul></li>
<li><p>Why taking a tidyverse approach to machine learning?</p></li>
<li><p>Benefits</p>
<ul>
<li><p>Readable code</p></li>
<li><p>Reusable data structures</p></li>
<li><p>Extendable code</p></li>
</ul></li>
</ul>
<div class="float">
<img src="https://rviews.rstudio.com/post/2019-06-14-a-gentle-intro-to-tidymodels_files/figure-html/ds.png" alt="Tidymodels. From RStudio." />
<div class="figcaption">Tidymodels. From RStudio.</div>
</div>
<blockquote>
<p>tidymodels are an <strong>integrated, modular, extensible</strong> set of packages that implement a framework that facilitates creating predicative stochastic models. - Joseph <a href="mailto:Rickert@RStudio" class="email">Rickert@RStudio</a></p>
</blockquote>
<ul>
<li><p>Currently, 238 models are <a href="https://topepo.github.io/caret/available-models.html">available</a></p></li>
<li><p>The following materials are based on <a href="https://github.com/dlab-berkeley/Machine-Learning-with-tidymodels">the machine learning with tidymodels workshop</a> I developed for D-Lab. <a href="https://github.com/dlab-berkeley/Machine-Learning-in-R">The original workshop</a> was designed by <a href="https://ck37.com/">Chris Kennedy</a> and [Evan Muzzall](<a href="https://dlab.berkeley.edu/people/evan-muzzall" class="uri">https://dlab.berkeley.edu/people/evan-muzzall</a>.</p></li>
</ul>
</div>
<div id="pre-processing" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Pre-processing<a href="machine_learning.html#pre-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p><a href="https://recipes.tidymodels.org/index.html"><code>recipes</code></a>: for pre-processing</p></li>
<li><p><a href="https://github.com/tidymodels/textrecipes"><code>textrecipes</code></a> for text pre-processing</p></li>
<li><p>Step 1: <code>recipe()</code> defines target and predictor variables (ingredients).</p></li>
<li><p>Step 2: <code>step_*()</code> defines preprocessing steps to be taken (recipe).</p>
<p>The preprocessing steps list draws on the vignette of the <a href="https://www.tidymodels.org/find/parsnip/"><code>parsnip</code></a> package.</p>
<ul>
<li><p>dummy: Also called one-hot encoding</p></li>
<li><p>zero variance: Removing columns (or features) with a single unique value</p></li>
<li><p>impute: Imputing missing values</p></li>
<li><p>decorrelate: Mitigating correlated predictors (e.g., principal component analysis)</p></li>
<li><p>normalize: Centering and/or scaling predictors (e.g., log scaling). Scaling matters because many algorithms (e.g., lasso) are scale-variant (except tree-based algorithms). Remind you that normalization (sensitive to outliers) = <span class="math inline">\(\frac{X - X_{min}}{X_{max} - X_{min}}\)</span> and standardization (not sensitive to outliers) = <span class="math inline">\(\frac{X - \mu}{\sigma}\)</span></p></li>
<li><p>transform: Making predictors symmetric</p></li>
</ul></li>
<li><p>Step 3: <code>prep()</code> prepares a dataset to base each step on.</p></li>
<li><p>Step 4: <code>bake()</code> applies the preprocessing steps to your datasets.</p></li>
</ul>
<p>In this course, we focus on two preprocessing tasks.</p>
<ul>
<li>One-hot encoding (creating dummy/indicator variables)</li>
</ul>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="machine_learning.html#cb1092-1" tabindex="-1"></a><span class="co"># Turn selected numeric variables into factor variables</span></span>
<span id="cb1092-2"><a href="machine_learning.html#cb1092-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1092-3"><a href="machine_learning.html#cb1092-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>), as.factor))</span>
<span id="cb1092-4"><a href="machine_learning.html#cb1092-4" tabindex="-1"></a></span>
<span id="cb1092-5"><a href="machine_learning.html#cb1092-5" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code></pre></div>
<pre><code>## Rows: 303
## Columns: 14
## $ age      &lt;dbl&gt; 63, 37, 41, 56, 57, 57, 56, 44, 52, 57, 54, 48, 49, 64, 58, 5…
## $ sex      &lt;fct&gt; 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1…
## $ cp       &lt;fct&gt; 3, 2, 1, 1, 0, 0, 1, 1, 2, 2, 0, 2, 1, 3, 3, 2, 2, 3, 0, 3, 0…
## $ trestbps &lt;dbl&gt; 145, 130, 130, 120, 120, 140, 140, 120, 172, 150, 140, 130, 1…
## $ chol     &lt;dbl&gt; 233, 250, 204, 236, 354, 192, 294, 263, 199, 168, 239, 275, 2…
## $ fbs      &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
## $ restecg  &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1…
## $ thalach  &lt;dbl&gt; 150, 187, 172, 178, 163, 148, 153, 173, 162, 174, 160, 139, 1…
## $ exang    &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0…
## $ oldpeak  &lt;dbl&gt; 2.3, 3.5, 1.4, 0.8, 0.6, 0.4, 1.3, 0.0, 0.5, 1.6, 1.2, 0.2, 0…
## $ slope    &lt;fct&gt; 0, 0, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 0, 2, 2, 1…
## $ ca       &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0…
## $ thal     &lt;fct&gt; 1, 2, 2, 2, 2, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3…
## $ target   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<ul>
<li>Imputation</li>
</ul>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="machine_learning.html#cb1094-1" tabindex="-1"></a><span class="co"># Check missing values</span></span>
<span id="cb1094-2"><a href="machine_learning.html#cb1094-2" tabindex="-1"></a></span>
<span id="cb1094-3"><a href="machine_learning.html#cb1094-3" tabindex="-1"></a><span class="fu">map_df</span>(data, <span class="sc">~</span> <span class="fu">is.na</span>(.) <span class="sc">%&gt;%</span> <span class="fu">sum</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
## 1     0     0     0        0     0     0       0       0     0       0     0
## # ℹ 3 more variables: ca &lt;int&gt;, thal &lt;int&gt;, target &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="machine_learning.html#cb1096-1" tabindex="-1"></a><span class="co"># Add missing values</span></span>
<span id="cb1096-2"><a href="machine_learning.html#cb1096-2" tabindex="-1"></a></span>
<span id="cb1096-3"><a href="machine_learning.html#cb1096-3" tabindex="-1"></a>data<span class="sc">$</span>oldpeak[<span class="fu">sample</span>(<span class="fu">seq</span>(data), <span class="at">size =</span> <span class="dv">10</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1096-4"><a href="machine_learning.html#cb1096-4" tabindex="-1"></a></span>
<span id="cb1096-5"><a href="machine_learning.html#cb1096-5" tabindex="-1"></a><span class="co"># Check missing values</span></span>
<span id="cb1096-6"><a href="machine_learning.html#cb1096-6" tabindex="-1"></a></span>
<span id="cb1096-7"><a href="machine_learning.html#cb1096-7" tabindex="-1"></a><span class="co"># Check the number of missing values</span></span>
<span id="cb1096-8"><a href="machine_learning.html#cb1096-8" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb1096-9"><a href="machine_learning.html#cb1096-9" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">is.na</span>(.) <span class="sc">%&gt;%</span> <span class="fu">sum</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
## 1     0     0     0        0     0     0       0       0     0      10     0
## # ℹ 3 more variables: ca &lt;int&gt;, thal &lt;int&gt;, target &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="machine_learning.html#cb1098-1" tabindex="-1"></a><span class="co"># Check the rate of missing values</span></span>
<span id="cb1098-2"><a href="machine_learning.html#cb1098-2" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb1098-3"><a href="machine_learning.html#cb1098-3" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">is.na</span>(.) <span class="sc">%&gt;%</span> <span class="fu">mean</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 14
##     age   sex    cp trestbps  chol   fbs restecg thalach exang oldpeak slope
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     0     0        0     0     0       0       0     0  0.0330     0
## # ℹ 3 more variables: ca &lt;dbl&gt;, thal &lt;dbl&gt;, target &lt;dbl&gt;</code></pre>
<div id="regression-setup" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Regression setup<a href="machine_learning.html#regression-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="outcome-variable" class="section level4 hasAnchor" number="8.5.1.1">
<h4><span class="header-section-number">8.5.1.1</span> Outcome variable<a href="machine_learning.html#outcome-variable" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="machine_learning.html#cb1100-1" tabindex="-1"></a><span class="co"># Continuous variable</span></span>
<span id="cb1100-2"><a href="machine_learning.html#cb1100-2" tabindex="-1"></a>data<span class="sc">$</span>age <span class="sc">%&gt;%</span> <span class="fu">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
<div id="data-splitting-using-random-sampling" class="section level4 hasAnchor" number="8.5.1.2">
<h4><span class="header-section-number">8.5.1.2</span> Data splitting using random sampling<a href="machine_learning.html#data-splitting-using-random-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="machine_learning.html#cb1102-1" tabindex="-1"></a><span class="co"># for reproducibility</span></span>
<span id="cb1102-2"><a href="machine_learning.html#cb1102-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1102-3"><a href="machine_learning.html#cb1102-3" tabindex="-1"></a></span>
<span id="cb1102-4"><a href="machine_learning.html#cb1102-4" tabindex="-1"></a><span class="co"># split</span></span>
<span id="cb1102-5"><a href="machine_learning.html#cb1102-5" tabindex="-1"></a>split_reg <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(data, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb1102-6"><a href="machine_learning.html#cb1102-6" tabindex="-1"></a></span>
<span id="cb1102-7"><a href="machine_learning.html#cb1102-7" tabindex="-1"></a><span class="co"># training set</span></span>
<span id="cb1102-8"><a href="machine_learning.html#cb1102-8" tabindex="-1"></a>raw_train_x_reg <span class="ot">&lt;-</span> <span class="fu">training</span>(split_reg)</span>
<span id="cb1102-9"><a href="machine_learning.html#cb1102-9" tabindex="-1"></a></span>
<span id="cb1102-10"><a href="machine_learning.html#cb1102-10" tabindex="-1"></a><span class="co"># test set</span></span>
<span id="cb1102-11"><a href="machine_learning.html#cb1102-11" tabindex="-1"></a>raw_test_x_reg <span class="ot">&lt;-</span> <span class="fu">testing</span>(split_reg)</span></code></pre></div>
</div>
<div id="recipe" class="section level4 hasAnchor" number="8.5.1.3">
<h4><span class="header-section-number">8.5.1.3</span> recipe<a href="machine_learning.html#recipe" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="machine_learning.html#cb1103-1" tabindex="-1"></a><span class="co"># Regression recipe</span></span>
<span id="cb1103-2"><a href="machine_learning.html#cb1103-2" tabindex="-1"></a>rec_reg <span class="ot">&lt;-</span> raw_train_x_reg <span class="sc">%&gt;%</span></span>
<span id="cb1103-3"><a href="machine_learning.html#cb1103-3" tabindex="-1"></a>  <span class="co"># Define the outcome variable</span></span>
<span id="cb1103-4"><a href="machine_learning.html#cb1103-4" tabindex="-1"></a>  <span class="fu">recipe</span>(age <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb1103-5"><a href="machine_learning.html#cb1103-5" tabindex="-1"></a>  <span class="co"># Median impute oldpeak column</span></span>
<span id="cb1103-6"><a href="machine_learning.html#cb1103-6" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(oldpeak) <span class="sc">%&gt;%</span></span>
<span id="cb1103-7"><a href="machine_learning.html#cb1103-7" tabindex="-1"></a>  <span class="co"># Expand &quot;sex&quot;, &quot;ca&quot;, &quot;cp&quot;, &quot;slope&quot;, and &quot;thal&quot; features out into dummy variables (indicators).</span></span>
<span id="cb1103-8"><a href="machine_learning.html#cb1103-8" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>))</span>
<span id="cb1103-9"><a href="machine_learning.html#cb1103-9" tabindex="-1"></a></span>
<span id="cb1103-10"><a href="machine_learning.html#cb1103-10" tabindex="-1"></a><span class="co"># Prepare a dataset to base each step on</span></span>
<span id="cb1103-11"><a href="machine_learning.html#cb1103-11" tabindex="-1"></a>prep_reg <span class="ot">&lt;-</span> rec_reg <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">retain =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="machine_learning.html#cb1104-1" tabindex="-1"></a><span class="co"># x features</span></span>
<span id="cb1104-2"><a href="machine_learning.html#cb1104-2" tabindex="-1"></a>train_x_reg <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_reg, <span class="fu">all_predictors</span>())</span>
<span id="cb1104-3"><a href="machine_learning.html#cb1104-3" tabindex="-1"></a></span>
<span id="cb1104-4"><a href="machine_learning.html#cb1104-4" tabindex="-1"></a>test_x_reg <span class="ot">&lt;-</span> <span class="fu">bake</span>(</span>
<span id="cb1104-5"><a href="machine_learning.html#cb1104-5" tabindex="-1"></a>  <span class="at">object =</span> prep_reg,</span>
<span id="cb1104-6"><a href="machine_learning.html#cb1104-6" tabindex="-1"></a>  <span class="at">new_data =</span> raw_test_x_reg, <span class="fu">all_predictors</span>()</span>
<span id="cb1104-7"><a href="machine_learning.html#cb1104-7" tabindex="-1"></a>)</span>
<span id="cb1104-8"><a href="machine_learning.html#cb1104-8" tabindex="-1"></a></span>
<span id="cb1104-9"><a href="machine_learning.html#cb1104-9" tabindex="-1"></a><span class="co"># y variables</span></span>
<span id="cb1104-10"><a href="machine_learning.html#cb1104-10" tabindex="-1"></a>train_y_reg <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_reg, <span class="fu">all_outcomes</span>())<span class="sc">$</span>age <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb1104-11"><a href="machine_learning.html#cb1104-11" tabindex="-1"></a>test_y_reg <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_reg, raw_test_x_reg, <span class="fu">all_outcomes</span>())<span class="sc">$</span>age <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb1104-12"><a href="machine_learning.html#cb1104-12" tabindex="-1"></a></span>
<span id="cb1104-13"><a href="machine_learning.html#cb1104-13" tabindex="-1"></a><span class="co"># Checks</span></span>
<span id="cb1104-14"><a href="machine_learning.html#cb1104-14" tabindex="-1"></a><span class="fu">names</span>(train_x_reg) <span class="co"># Make sure there&#39;s no age variable!</span></span></code></pre></div>
<pre><code>##  [1] &quot;trestbps&quot; &quot;chol&quot;     &quot;fbs&quot;      &quot;restecg&quot;  &quot;thalach&quot;  &quot;exang&quot;   
##  [7] &quot;oldpeak&quot;  &quot;target&quot;   &quot;sex_X1&quot;   &quot;ca_X1&quot;    &quot;ca_X2&quot;    &quot;ca_X3&quot;   
## [13] &quot;ca_X4&quot;    &quot;cp_X1&quot;    &quot;cp_X2&quot;    &quot;cp_X3&quot;    &quot;slope_X1&quot; &quot;slope_X2&quot;
## [19] &quot;thal_X1&quot;  &quot;thal_X2&quot;  &quot;thal_X3&quot;</code></pre>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="machine_learning.html#cb1106-1" tabindex="-1"></a><span class="fu">class</span>(train_y_reg) <span class="co"># Make sure this is a continuous variable!</span></span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<ul>
<li>Note that other imputation methods are also available.</li>
</ul>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="machine_learning.html#cb1108-1" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;impute&quot;</span>, <span class="fu">ls</span>(<span class="st">&quot;package:recipes&quot;</span>), <span class="at">value =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;step_bagimpute&quot;     &quot;step_impute_bag&quot;    &quot;step_impute_knn&quot;   
##  [4] &quot;step_impute_linear&quot; &quot;step_impute_lower&quot;  &quot;step_impute_mean&quot;  
##  [7] &quot;step_impute_median&quot; &quot;step_impute_mode&quot;   &quot;step_impute_roll&quot;  
## [10] &quot;step_knnimpute&quot;     &quot;step_lowerimpute&quot;   &quot;step_meanimpute&quot;   
## [13] &quot;step_medianimpute&quot;  &quot;step_modeimpute&quot;    &quot;step_rollimpute&quot;</code></pre>
<ul>
<li>You can also create your own <code>step_</code> functions. For more information, see <a href="https://www.tidymodels.org/learn/develop/recipes/">tidymodels.org</a>.</li>
</ul>
</div>
</div>
<div id="classification-setup" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Classification setup<a href="machine_learning.html#classification-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="outcome-variable-1" class="section level4 hasAnchor" number="8.5.2.1">
<h4><span class="header-section-number">8.5.2.1</span> Outcome variable<a href="machine_learning.html#outcome-variable-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="machine_learning.html#cb1110-1" tabindex="-1"></a>data<span class="sc">$</span>target <span class="sc">%&gt;%</span> <span class="fu">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="machine_learning.html#cb1112-1" tabindex="-1"></a>data<span class="sc">$</span>target <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>target)</span>
<span id="cb1112-2"><a href="machine_learning.html#cb1112-2" tabindex="-1"></a></span>
<span id="cb1112-3"><a href="machine_learning.html#cb1112-3" tabindex="-1"></a>data<span class="sc">$</span>target <span class="sc">%&gt;%</span> <span class="fu">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
<div id="data-splitting-using-stratified-random-sampling" class="section level4 hasAnchor" number="8.5.2.2">
<h4><span class="header-section-number">8.5.2.2</span> Data splitting using stratified random sampling<a href="machine_learning.html#data-splitting-using-stratified-random-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="machine_learning.html#cb1114-1" tabindex="-1"></a><span class="co"># split</span></span>
<span id="cb1114-2"><a href="machine_learning.html#cb1114-2" tabindex="-1"></a>split_class <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(data <span class="sc">%&gt;%</span></span>
<span id="cb1114-3"><a href="machine_learning.html#cb1114-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">target =</span> <span class="fu">as.factor</span>(target)),</span>
<span id="cb1114-4"><a href="machine_learning.html#cb1114-4" tabindex="-1"></a><span class="at">prop =</span> <span class="fl">0.7</span>,</span>
<span id="cb1114-5"><a href="machine_learning.html#cb1114-5" tabindex="-1"></a><span class="at">strata =</span> target</span>
<span id="cb1114-6"><a href="machine_learning.html#cb1114-6" tabindex="-1"></a>)</span>
<span id="cb1114-7"><a href="machine_learning.html#cb1114-7" tabindex="-1"></a></span>
<span id="cb1114-8"><a href="machine_learning.html#cb1114-8" tabindex="-1"></a><span class="co"># training set</span></span>
<span id="cb1114-9"><a href="machine_learning.html#cb1114-9" tabindex="-1"></a>raw_train_x_class <span class="ot">&lt;-</span> <span class="fu">training</span>(split_class)</span>
<span id="cb1114-10"><a href="machine_learning.html#cb1114-10" tabindex="-1"></a></span>
<span id="cb1114-11"><a href="machine_learning.html#cb1114-11" tabindex="-1"></a><span class="co"># testing set</span></span>
<span id="cb1114-12"><a href="machine_learning.html#cb1114-12" tabindex="-1"></a>raw_test_x_class <span class="ot">&lt;-</span> <span class="fu">testing</span>(split_class)</span></code></pre></div>
</div>
<div id="recipe-1" class="section level4 hasAnchor" number="8.5.2.3">
<h4><span class="header-section-number">8.5.2.3</span> recipe<a href="machine_learning.html#recipe-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="machine_learning.html#cb1115-1" tabindex="-1"></a><span class="co"># Classification recipe</span></span>
<span id="cb1115-2"><a href="machine_learning.html#cb1115-2" tabindex="-1"></a>rec_class <span class="ot">&lt;-</span> raw_train_x_class <span class="sc">%&gt;%</span></span>
<span id="cb1115-3"><a href="machine_learning.html#cb1115-3" tabindex="-1"></a>  <span class="co"># Define the outcome variable</span></span>
<span id="cb1115-4"><a href="machine_learning.html#cb1115-4" tabindex="-1"></a>  <span class="fu">recipe</span>(target <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb1115-5"><a href="machine_learning.html#cb1115-5" tabindex="-1"></a>  <span class="co"># Median impute oldpeak column</span></span>
<span id="cb1115-6"><a href="machine_learning.html#cb1115-6" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(oldpeak) <span class="sc">%&gt;%</span></span>
<span id="cb1115-7"><a href="machine_learning.html#cb1115-7" tabindex="-1"></a>  <span class="co"># Expand &quot;sex&quot;, &quot;ca&quot;, &quot;cp&quot;, &quot;slope&quot;, and &quot;thal&quot; features out into dummy variables (indicators).</span></span>
<span id="cb1115-8"><a href="machine_learning.html#cb1115-8" tabindex="-1"></a>  <span class="fu">step_normalize</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb1115-9"><a href="machine_learning.html#cb1115-9" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ca&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;thal&quot;</span>))</span>
<span id="cb1115-10"><a href="machine_learning.html#cb1115-10" tabindex="-1"></a></span>
<span id="cb1115-11"><a href="machine_learning.html#cb1115-11" tabindex="-1"></a><span class="co"># Prepare a dataset to base each step on</span></span>
<span id="cb1115-12"><a href="machine_learning.html#cb1115-12" tabindex="-1"></a>prep_class <span class="ot">&lt;-</span> rec_class <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">retain =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="machine_learning.html#cb1116-1" tabindex="-1"></a><span class="co"># x features</span></span>
<span id="cb1116-2"><a href="machine_learning.html#cb1116-2" tabindex="-1"></a>train_x_class <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_class, <span class="fu">all_predictors</span>())</span>
<span id="cb1116-3"><a href="machine_learning.html#cb1116-3" tabindex="-1"></a>test_x_class <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_class, raw_test_x_class, <span class="fu">all_predictors</span>())</span>
<span id="cb1116-4"><a href="machine_learning.html#cb1116-4" tabindex="-1"></a></span>
<span id="cb1116-5"><a href="machine_learning.html#cb1116-5" tabindex="-1"></a><span class="co"># y variables</span></span>
<span id="cb1116-6"><a href="machine_learning.html#cb1116-6" tabindex="-1"></a>train_y_class <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_class, <span class="fu">all_outcomes</span>())<span class="sc">$</span>target <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb1116-7"><a href="machine_learning.html#cb1116-7" tabindex="-1"></a>test_y_class <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_class, raw_test_x_class, <span class="fu">all_outcomes</span>())<span class="sc">$</span>target <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb1116-8"><a href="machine_learning.html#cb1116-8" tabindex="-1"></a></span>
<span id="cb1116-9"><a href="machine_learning.html#cb1116-9" tabindex="-1"></a><span class="co"># Checks</span></span>
<span id="cb1116-10"><a href="machine_learning.html#cb1116-10" tabindex="-1"></a><span class="fu">names</span>(train_x_class) <span class="co"># Make sure there&#39;s no target variable!</span></span></code></pre></div>
<pre><code>##  [1] &quot;age&quot;      &quot;trestbps&quot; &quot;chol&quot;     &quot;fbs&quot;      &quot;restecg&quot;  &quot;thalach&quot; 
##  [7] &quot;exang&quot;    &quot;oldpeak&quot;  &quot;sex_X1&quot;   &quot;ca_X1&quot;    &quot;ca_X2&quot;    &quot;ca_X3&quot;   
## [13] &quot;ca_X4&quot;    &quot;cp_X1&quot;    &quot;cp_X2&quot;    &quot;cp_X3&quot;    &quot;slope_X1&quot; &quot;slope_X2&quot;
## [19] &quot;thal_X1&quot;  &quot;thal_X2&quot;  &quot;thal_X3&quot;</code></pre>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="machine_learning.html#cb1118-1" tabindex="-1"></a><span class="fu">class</span>(train_y_class) <span class="co"># Make sure this is a factor variable!</span></span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
</div>
</div>
<div id="supervised-learning" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Supervised learning<a href="machine_learning.html#supervised-learning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>x -&gt; f - &gt; y (defined)</p>
<div id="ols-and-lasso" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> OLS and Lasso<a href="machine_learning.html#ols-and-lasso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip" class="section level4 hasAnchor" number="8.6.1.1">
<h4><span class="header-section-number">8.6.1.1</span> parsnip<a href="machine_learning.html#parsnip" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build models (<code>parsnip</code>)</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="machine_learning.html#cb1120-1" tabindex="-1"></a><span class="co"># OLS spec</span></span>
<span id="cb1120-2"><a href="machine_learning.html#cb1120-2" tabindex="-1"></a>ols_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="co"># Specify a model</span></span>
<span id="cb1120-3"><a href="machine_learning.html#cb1120-3" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># Specify an engine: lm, glmnet, stan, keras, spark</span></span>
<span id="cb1120-4"><a href="machine_learning.html#cb1120-4" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="co"># Declare a mode: regression or classification</span></span></code></pre></div>
<div class="float">
<img src="http://ethen8181.github.io/machine-learning/regularization/images/lasso_ridge_coefficients.png" alt="Source: http://ethen8181.github.io" />
<div class="figcaption">Source: <a href="http://ethen8181.github.io" class="uri">http://ethen8181.github.io</a></div>
</div>
<p>Lasso is one of the regularization techniques along with ridge and elastic-net.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="machine_learning.html#cb1121-1" tabindex="-1"></a><span class="co"># Lasso spec</span></span>
<span id="cb1121-2"><a href="machine_learning.html#cb1121-2" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb1121-3"><a href="machine_learning.html#cb1121-3" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fl">0.1</span>, <span class="co"># tuning hyperparameter</span></span>
<span id="cb1121-4"><a href="machine_learning.html#cb1121-4" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="dv">1</span></span>
<span id="cb1121-5"><a href="machine_learning.html#cb1121-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1121-6"><a href="machine_learning.html#cb1121-6" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1121-7"><a href="machine_learning.html#cb1121-7" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1121-8"><a href="machine_learning.html#cb1121-8" tabindex="-1"></a></span>
<span id="cb1121-9"><a href="machine_learning.html#cb1121-9" tabindex="-1"></a><span class="co"># If you don&#39;t understand parsnip arguments</span></span>
<span id="cb1121-10"><a href="machine_learning.html#cb1121-10" tabindex="-1"></a>lasso_spec <span class="sc">%&gt;%</span> <span class="fu">translate</span>() <span class="co"># See the documentation</span></span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.1
##   mixture = 1
## 
## Computational engine: glmnet 
## 
## Model fit template:
## glmnet::glmnet(x = missing_arg(), y = missing_arg(), weights = missing_arg(), 
##     alpha = 1, family = &quot;gaussian&quot;)</code></pre>
<ul>
<li>Fit models</li>
</ul>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="machine_learning.html#cb1123-1" tabindex="-1"></a>ols_fit <span class="ot">&lt;-</span> ols_spec <span class="sc">%&gt;%</span></span>
<span id="cb1123-2"><a href="machine_learning.html#cb1123-2" tabindex="-1"></a>  <span class="fu">fit_xy</span>(<span class="at">x =</span> train_x_reg, <span class="at">y =</span> train_y_reg)</span>
<span id="cb1123-3"><a href="machine_learning.html#cb1123-3" tabindex="-1"></a><span class="co"># fit(train_y_reg ~ ., train_x_reg) # When you data are not preprocessed</span></span>
<span id="cb1123-4"><a href="machine_learning.html#cb1123-4" tabindex="-1"></a></span>
<span id="cb1123-5"><a href="machine_learning.html#cb1123-5" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> lasso_spec <span class="sc">%&gt;%</span></span>
<span id="cb1123-6"><a href="machine_learning.html#cb1123-6" tabindex="-1"></a>  <span class="fu">fit_xy</span>(<span class="at">x =</span> train_x_reg, <span class="at">y =</span> train_y_reg)</span></code></pre></div>
</div>
<div id="yardstick" class="section level4 hasAnchor" number="8.6.1.2">
<h4><span class="header-section-number">8.6.1.2</span> yardstick<a href="machine_learning.html#yardstick" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Visualize model fits</li>
</ul>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="machine_learning.html#cb1124-1" tabindex="-1"></a><span class="fu">map2</span>(<span class="fu">list</span>(ols_fit, lasso_fit), <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), visualize_fit)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="machine_learning.html#cb1127-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1127-2"><a href="machine_learning.html#cb1127-2" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(rmse, mae, rsq)</span>
<span id="cb1127-3"><a href="machine_learning.html#cb1127-3" tabindex="-1"></a></span>
<span id="cb1127-4"><a href="machine_learning.html#cb1127-4" tabindex="-1"></a><span class="co"># Evaluate many models</span></span>
<span id="cb1127-5"><a href="machine_learning.html#cb1127-5" tabindex="-1"></a>evals <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">list</span>(ols_fit, lasso_fit), evaluate_reg) <span class="sc">%&gt;%</span></span>
<span id="cb1127-6"><a href="machine_learning.html#cb1127-6" tabindex="-1"></a>  <span class="fu">reduce</span>(bind_rows) <span class="sc">%&gt;%</span></span>
<span id="cb1127-7"><a href="machine_learning.html#cb1127-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Lasso&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>))</span>
<span id="cb1127-8"><a href="machine_learning.html#cb1127-8" tabindex="-1"></a></span>
<span id="cb1127-9"><a href="machine_learning.html#cb1127-9" tabindex="-1"></a><span class="co"># Visualize the test results</span></span>
<span id="cb1127-10"><a href="machine_learning.html#cb1127-10" tabindex="-1"></a>evals <span class="sc">%&gt;%</span></span>
<span id="cb1127-11"><a href="machine_learning.html#cb1127-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(type, .estimate), <span class="at">y =</span> .estimate)) <span class="sc">+</span></span>
<span id="cb1127-12"><a href="machine_learning.html#cb1127-12" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1127-13"><a href="machine_learning.html#cb1127-13" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1127-14"><a href="machine_learning.html#cb1127-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb1127-15"><a href="machine_learning.html#cb1127-15" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Estimate&quot;</span></span>
<span id="cb1127-16"><a href="machine_learning.html#cb1127-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1127-17"><a href="machine_learning.html#cb1127-17" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-20-1.png" width="672" />
- For more information, read <a href="https://www.tmwr.org/">Tidy Modeling with R</a> by Max Kuhn and Julia Silge.</p>
</div>
<div id="tune" class="section level4 hasAnchor" number="8.6.1.3">
<h4><span class="header-section-number">8.6.1.3</span> tune<a href="machine_learning.html#tune" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Hyper</strong>parameters are parameters that control the learning process.</p>
<div id="tune-ingredients" class="section level5 hasAnchor" number="8.6.1.3.1">
<h5><span class="header-section-number">8.6.1.3.1</span> tune ingredients<a href="machine_learning.html#tune-ingredients" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Search space for hyperparameters</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Grid search: a grid of hyperparameters</p></li>
<li><p>Random search: random sample points from a bounded domain</p></li>
</ol>
<p><img src="https://www.programmersought.com/images/523/7e44435f20fe514c11ca0d930af8547b.png" /></p>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="machine_learning.html#cb1128-1" tabindex="-1"></a><span class="co"># tune() = placeholder</span></span>
<span id="cb1128-2"><a href="machine_learning.html#cb1128-2" tabindex="-1"></a></span>
<span id="cb1128-3"><a href="machine_learning.html#cb1128-3" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb1128-4"><a href="machine_learning.html#cb1128-4" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="co"># tuning hyperparameter</span></span>
<span id="cb1128-5"><a href="machine_learning.html#cb1128-5" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="dv">1</span></span>
<span id="cb1128-6"><a href="machine_learning.html#cb1128-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># 1 = lasso, 0 = ridge</span></span>
<span id="cb1128-7"><a href="machine_learning.html#cb1128-7" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1128-8"><a href="machine_learning.html#cb1128-8" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb1128-9"><a href="machine_learning.html#cb1128-9" tabindex="-1"></a></span>
<span id="cb1128-10"><a href="machine_learning.html#cb1128-10" tabindex="-1"></a>tune_spec</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="machine_learning.html#cb1130-1" tabindex="-1"></a><span class="co"># penalty() searches 50 possible combinations</span></span>
<span id="cb1130-2"><a href="machine_learning.html#cb1130-2" tabindex="-1"></a></span>
<span id="cb1130-3"><a href="machine_learning.html#cb1130-3" tabindex="-1"></a>lambda_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="float">
<img src="https://www.googleapis.com/download/storage/v1/b/kaggle-forum-message-attachments/o/inbox%2F4788946%2F82b5a41b6693a313b246f02d79e972d5%2FK%20FOLD.png?generation=1608195745131795&amp;alt=media" alt="Source: Kaggle" />
<div class="figcaption">Source: Kaggle</div>
</div>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="machine_learning.html#cb1131-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1131-2"><a href="machine_learning.html#cb1131-2" tabindex="-1"></a></span>
<span id="cb1131-3"><a href="machine_learning.html#cb1131-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1131-4"><a href="machine_learning.html#cb1131-4" tabindex="-1"></a></span>
<span id="cb1131-5"><a href="machine_learning.html#cb1131-5" tabindex="-1"></a>rec_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> train_y_reg)))</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow" class="section level5 hasAnchor" number="8.6.1.3.2">
<h5><span class="header-section-number">8.6.1.3.2</span> Add these elements to a workflow<a href="machine_learning.html#add-these-elements-to-a-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="machine_learning.html#cb1132-1" tabindex="-1"></a><span class="co"># Workflow</span></span>
<span id="cb1132-2"><a href="machine_learning.html#cb1132-2" tabindex="-1"></a>rec_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1132-3"><a href="machine_learning.html#cb1132-3" tabindex="-1"></a>  <span class="fu">add_model</span>(tune_spec) <span class="sc">%&gt;%</span></span>
<span id="cb1132-4"><a href="machine_learning.html#cb1132-4" tabindex="-1"></a>  <span class="fu">add_formula</span>(age <span class="sc">~</span> .)</span></code></pre></div>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="machine_learning.html#cb1133-1" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1133-2"><a href="machine_learning.html#cb1133-2" tabindex="-1"></a>rec_res <span class="ot">&lt;-</span> rec_wf <span class="sc">%&gt;%</span></span>
<span id="cb1133-3"><a href="machine_learning.html#cb1133-3" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1133-4"><a href="machine_learning.html#cb1133-4" tabindex="-1"></a>    <span class="at">resamples =</span> rec_folds,</span>
<span id="cb1133-5"><a href="machine_learning.html#cb1133-5" tabindex="-1"></a>    <span class="at">grid      =</span> lambda_grid,</span>
<span id="cb1133-6"><a href="machine_learning.html#cb1133-6" tabindex="-1"></a>    <span class="at">control   =</span> <span class="fu">control_grid</span>(<span class="at">parallel_over =</span> <span class="st">&quot;resamples&quot;</span>)</span>
<span id="cb1133-7"><a href="machine_learning.html#cb1133-7" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="visualize" class="section level5 hasAnchor" number="8.6.1.3.3">
<h5><span class="header-section-number">8.6.1.3.3</span> Visualize<a href="machine_learning.html#visualize" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="machine_learning.html#cb1134-1" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb1134-2"><a href="machine_learning.html#cb1134-2" tabindex="-1"></a></span>
<span id="cb1134-3"><a href="machine_learning.html#cb1134-3" tabindex="-1"></a>rec_res <span class="sc">%&gt;%</span></span>
<span id="cb1134-4"><a href="machine_learning.html#cb1134-4" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1134-5"><a href="machine_learning.html#cb1134-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">col =</span> .metric)) <span class="sc">+</span></span>
<span id="cb1134-6"><a href="machine_learning.html#cb1134-6" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb1134-7"><a href="machine_learning.html#cb1134-7" tabindex="-1"></a>    <span class="at">ymin =</span> mean <span class="sc">-</span> std_err,</span>
<span id="cb1134-8"><a href="machine_learning.html#cb1134-8" tabindex="-1"></a>    <span class="at">ymax =</span> mean <span class="sc">+</span> std_err</span>
<span id="cb1134-9"><a href="machine_learning.html#cb1134-9" tabindex="-1"></a>  ),</span>
<span id="cb1134-10"><a href="machine_learning.html#cb1134-10" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb1134-11"><a href="machine_learning.html#cb1134-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1134-12"><a href="machine_learning.html#cb1134-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1134-13"><a href="machine_learning.html#cb1134-13" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb1134-14"><a href="machine_learning.html#cb1134-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(lambda)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1134-15"><a href="machine_learning.html#cb1134-15" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;{toupper(.metric)}&quot;</span>),</span>
<span id="cb1134-16"><a href="machine_learning.html#cb1134-16" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1134-17"><a href="machine_learning.html#cb1134-17" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1134-18"><a href="machine_learning.html#cb1134-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1134-19"><a href="machine_learning.html#cb1134-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="select" class="section level5 hasAnchor" number="8.6.1.3.4">
<h5><span class="header-section-number">8.6.1.3.4</span> Select<a href="machine_learning.html#select" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="machine_learning.html#cb1135-1" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1135-2"><a href="machine_learning.html#cb1135-2" tabindex="-1"></a></span>
<span id="cb1135-3"><a href="machine_learning.html#cb1135-3" tabindex="-1"></a>top_rmse <span class="ot">&lt;-</span> <span class="fu">show_best</span>(rec_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1135-4"><a href="machine_learning.html#cb1135-4" tabindex="-1"></a></span>
<span id="cb1135-5"><a href="machine_learning.html#cb1135-5" tabindex="-1"></a>best_rmse <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rec_res, <span class="at">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb1135-6"><a href="machine_learning.html#cb1135-6" tabindex="-1"></a></span>
<span id="cb1135-7"><a href="machine_learning.html#cb1135-7" tabindex="-1"></a>best_rmse</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   penalty .config              
##     &lt;dbl&gt; &lt;chr&gt;                
## 1   0.391 Preprocessor1_Model48</code></pre>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="machine_learning.html#cb1137-1" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&#39;The RMSE of the intiail model is</span></span>
<span id="cb1137-2"><a href="machine_learning.html#cb1137-2" tabindex="-1"></a><span class="st">     {evals %&gt;%</span></span>
<span id="cb1137-3"><a href="machine_learning.html#cb1137-3" tabindex="-1"></a><span class="st">  filter(type == &quot;Lasso&quot;, .metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1137-4"><a href="machine_learning.html#cb1137-4" tabindex="-1"></a><span class="st">  select(.estimate) %&gt;%</span></span>
<span id="cb1137-5"><a href="machine_learning.html#cb1137-5" tabindex="-1"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the intiail model is
##    7.83</code></pre>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="machine_learning.html#cb1139-1" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&#39;The RMSE of the tuned model is {rec_res %&gt;%</span></span>
<span id="cb1139-2"><a href="machine_learning.html#cb1139-2" tabindex="-1"></a><span class="st">  collect_metrics() %&gt;%</span></span>
<span id="cb1139-3"><a href="machine_learning.html#cb1139-3" tabindex="-1"></a><span class="st">  filter(.metric == &quot;rmse&quot;) %&gt;%</span></span>
<span id="cb1139-4"><a href="machine_learning.html#cb1139-4" tabindex="-1"></a><span class="st">  arrange(mean) %&gt;%</span></span>
<span id="cb1139-5"><a href="machine_learning.html#cb1139-5" tabindex="-1"></a><span class="st">  dplyr::slice(1) %&gt;%</span></span>
<span id="cb1139-6"><a href="machine_learning.html#cb1139-6" tabindex="-1"></a><span class="st">  select(mean) %&gt;%</span></span>
<span id="cb1139-7"><a href="machine_learning.html#cb1139-7" tabindex="-1"></a><span class="st">  round(2)}&#39;</span>)</span></code></pre></div>
<pre><code>## The RMSE of the tuned model is 7.55</code></pre>
<ul>
<li>Finalize your workflow and visualize <a href="https://koalaverse.github.io/vip/articles/vip.html">variable importance</a></li>
</ul>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="machine_learning.html#cb1141-1" tabindex="-1"></a>finalize_lasso <span class="ot">&lt;-</span> rec_wf <span class="sc">%&gt;%</span></span>
<span id="cb1141-2"><a href="machine_learning.html#cb1141-2" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_rmse)</span>
<span id="cb1141-3"><a href="machine_learning.html#cb1141-3" tabindex="-1"></a></span>
<span id="cb1141-4"><a href="machine_learning.html#cb1141-4" tabindex="-1"></a>finalize_lasso <span class="sc">%&gt;%</span></span>
<span id="cb1141-5"><a href="machine_learning.html#cb1141-5" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> train_y_reg))) <span class="sc">%&gt;%</span></span>
<span id="cb1141-6"><a href="machine_learning.html#cb1141-6" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1141-7"><a href="machine_learning.html#cb1141-7" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="test-fit" class="section level5 hasAnchor" number="8.6.1.3.5">
<h5><span class="header-section-number">8.6.1.3.5</span> Test fit<a href="machine_learning.html#test-fit" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="machine_learning.html#cb1142-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_lasso <span class="sc">%&gt;%</span></span>
<span id="cb1142-2"><a href="machine_learning.html#cb1142-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_reg <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">age =</span> test_y_reg)))</span>
<span id="cb1142-3"><a href="machine_learning.html#cb1142-3" tabindex="-1"></a></span>
<span id="cb1142-4"><a href="machine_learning.html#cb1142-4" tabindex="-1"></a><span class="fu">evaluate_reg</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       7.06 
## 2 mae     standard       5.80 
## 3 rsq     standard       0.407</code></pre>
</div>
</div>
</div>
<div id="decision-tree" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Decision tree<a href="machine_learning.html#decision-tree" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip-1" class="section level4 hasAnchor" number="8.6.2.1">
<h4><span class="header-section-number">8.6.2.1</span> parsnip<a href="machine_learning.html#parsnip-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="machine_learning.html#cb1144-1" tabindex="-1"></a><span class="co"># workflow</span></span>
<span id="cb1144-2"><a href="machine_learning.html#cb1144-2" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> <span class="fu">add_formula</span>(target <span class="sc">~</span> .)</span>
<span id="cb1144-3"><a href="machine_learning.html#cb1144-3" tabindex="-1"></a></span>
<span id="cb1144-4"><a href="machine_learning.html#cb1144-4" tabindex="-1"></a><span class="co"># spec</span></span>
<span id="cb1144-5"><a href="machine_learning.html#cb1144-5" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb1144-6"><a href="machine_learning.html#cb1144-6" tabindex="-1"></a></span>
<span id="cb1144-7"><a href="machine_learning.html#cb1144-7" tabindex="-1"></a>  <span class="co"># Mode</span></span>
<span id="cb1144-8"><a href="machine_learning.html#cb1144-8" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1144-9"><a href="machine_learning.html#cb1144-9" tabindex="-1"></a></span>
<span id="cb1144-10"><a href="machine_learning.html#cb1144-10" tabindex="-1"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1144-11"><a href="machine_learning.html#cb1144-11" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="cn">NULL</span>,</span>
<span id="cb1144-12"><a href="machine_learning.html#cb1144-12" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="cn">NULL</span></span>
<span id="cb1144-13"><a href="machine_learning.html#cb1144-13" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1144-14"><a href="machine_learning.html#cb1144-14" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="co"># rpart, c5.0, spark</span></span>
<span id="cb1144-15"><a href="machine_learning.html#cb1144-15" tabindex="-1"></a></span>
<span id="cb1144-16"><a href="machine_learning.html#cb1144-16" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">add_model</span>(tree_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="machine_learning.html#cb1145-1" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-1" class="section level4 hasAnchor" number="8.6.2.2">
<h4><span class="header-section-number">8.6.2.2</span> yardstick<a href="machine_learning.html#yardstick-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Let’s formally test prediction performance.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Confusion matrix</li>
</ol>
<p>A confusion matrix is often used to describe the performance of a classification model. The below example is based on a binary classification model.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Predicted: YES</th>
<th>Predicted: NO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Actual: YES</strong></td>
<td>True positive (TP)</td>
<td>False negative (FN)</td>
</tr>
<tr class="even">
<td><strong>Actual: NO</strong></td>
<td>False positive (FP)</td>
<td>True negative (TN)</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Metrics</li>
</ol>
<ul>
<li><p><code>accuracy</code>: The proportion of the data predicted correctly (<span class="math inline">\(\frac{TP + TN}{total}\)</span>). 1 - accuracy = misclassification rate.</p></li>
<li><p><code>precision</code>: Positive predictive value. <em>When the model predicts yes, how correct is it?</em> (<span class="math inline">\(\frac{TP}{TP + FP}\)</span>)</p></li>
<li><p><code>recall</code> (sensitivity): True positive rate (e.g., healthy people healthy). <em>When the actual value is yes, how often does the model predict yes?</em> (<span class="math inline">\(\frac{TP}{TP + FN}\)</span>)</p></li>
<li><p><code>F-score</code>: A weighted average between precision and recall.</p></li>
<li><p><code>ROC Curve</code> (receiver operating characteristic curve): a plot that shows the relationship between true and false positive rates at different classification thresholds. y-axis indicates the true positive rate and x-axis indicates the false positive rate. What matters is the AUC (Area under the ROC Curve), which is a cumulative probability function of ranking a random “positive” - “negative” pair (for the probability of AUC, see <a href="https://www.alexejgossmann.com/auc/">this blog post</a>).</p></li>
</ul>
<div class="float">
<img src="https://developers.google.com/machine-learning/crash-course/images/ROCCurve.svg" alt="Source: Google Machine Learning Crash Course" />
<div class="figcaption">Source: Google Machine Learning Crash Course</div>
</div>
<ul>
<li>To learn more about other metrics, check out the yardstick package <a href="https://yardstick.tidymodels.org/reference/index.html">references</a>.</li>
</ul>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="machine_learning.html#cb1146-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1146-2"><a href="machine_learning.html#cb1146-2" tabindex="-1"></a></span>
<span id="cb1146-3"><a href="machine_learning.html#cb1146-3" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1146-4"><a href="machine_learning.html#cb1146-4" tabindex="-1"></a></span>
<span id="cb1146-5"><a href="machine_learning.html#cb1146-5" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb1146-6"><a href="machine_learning.html#cb1146-6" tabindex="-1"></a></span>
<span id="cb1146-7"><a href="machine_learning.html#cb1146-7" tabindex="-1"></a>tree_fit_viz_metr <span class="ot">&lt;-</span> <span class="fu">visualize_class_eval</span>(tree_fit)</span>
<span id="cb1146-8"><a href="machine_learning.html#cb1146-8" tabindex="-1"></a></span>
<span id="cb1146-9"><a href="machine_learning.html#cb1146-9" tabindex="-1"></a>tree_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="machine_learning.html#cb1147-1" tabindex="-1"></a>tree_fit_viz_mat <span class="ot">&lt;-</span> <span class="fu">visualize_class_conf</span>(tree_fit)</span>
<span id="cb1147-2"><a href="machine_learning.html#cb1147-2" tabindex="-1"></a></span>
<span id="cb1147-3"><a href="machine_learning.html#cb1147-3" tabindex="-1"></a>tree_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
</div>
<div id="tune-1" class="section level4 hasAnchor" number="8.6.2.3">
<h4><span class="header-section-number">8.6.2.3</span> tune<a href="machine_learning.html#tune-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-1" class="section level5 hasAnchor" number="8.6.2.3.1">
<h5><span class="header-section-number">8.6.2.3.1</span> tune ingredients<a href="machine_learning.html#tune-ingredients-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Decisions trees tend to overfit. We need to consider two things to reduce this problem: how to split and when to stop a tree.</p>
<ul>
<li><p><strong>complexity parameter</strong>: a high CP means a simple decision tree with few splits.</p></li>
<li><p><strong>tree_depth</strong></p></li>
</ul>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="machine_learning.html#cb1148-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb1148-2"><a href="machine_learning.html#cb1148-2" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="fu">tune</span>(), <span class="co"># how to split</span></span>
<span id="cb1148-3"><a href="machine_learning.html#cb1148-3" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="co"># when to stop</span></span>
<span id="cb1148-4"><a href="machine_learning.html#cb1148-4" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span></span>
<span id="cb1148-5"><a href="machine_learning.html#cb1148-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1148-6"><a href="machine_learning.html#cb1148-6" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>)</span>
<span id="cb1148-7"><a href="machine_learning.html#cb1148-7" tabindex="-1"></a></span>
<span id="cb1148-8"><a href="machine_learning.html#cb1148-8" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb1148-9"><a href="machine_learning.html#cb1148-9" tabindex="-1"></a>  <span class="fu">tree_depth</span>(),</span>
<span id="cb1148-10"><a href="machine_learning.html#cb1148-10" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb1148-11"><a href="machine_learning.html#cb1148-11" tabindex="-1"></a>) <span class="co"># 2 hyperparameters -&gt; 5*5 = 25 combinations</span></span>
<span id="cb1148-12"><a href="machine_learning.html#cb1148-12" tabindex="-1"></a></span>
<span id="cb1148-13"><a href="machine_learning.html#cb1148-13" tabindex="-1"></a>tree_grid <span class="sc">%&gt;%</span></span>
<span id="cb1148-14"><a href="machine_learning.html#cb1148-14" tabindex="-1"></a>  <span class="fu">count</span>(tree_depth)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   tree_depth     n
##        &lt;int&gt; &lt;int&gt;
## 1          1     5
## 2          4     5
## 3          8     5
## 4         11     5
## 5         15     5</code></pre>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="machine_learning.html#cb1150-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1150-2"><a href="machine_learning.html#cb1150-2" tabindex="-1"></a></span>
<span id="cb1150-3"><a href="machine_learning.html#cb1150-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1150-4"><a href="machine_learning.html#cb1150-4" tabindex="-1"></a></span>
<span id="cb1150-5"><a href="machine_learning.html#cb1150-5" tabindex="-1"></a>tree_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1150-6"><a href="machine_learning.html#cb1150-6" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1150-7"><a href="machine_learning.html#cb1150-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-1" class="section level5 hasAnchor" number="8.6.2.3.2">
<h5><span class="header-section-number">8.6.2.3.2</span> Add these elements to a workflow<a href="machine_learning.html#add-these-elements-to-a-workflow-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="machine_learning.html#cb1151-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1151-2"><a href="machine_learning.html#cb1151-2" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1151-3"><a href="machine_learning.html#cb1151-3" tabindex="-1"></a></span>
<span id="cb1151-4"><a href="machine_learning.html#cb1151-4" tabindex="-1"></a><span class="co"># Determine the number of cores</span></span>
<span id="cb1151-5"><a href="machine_learning.html#cb1151-5" tabindex="-1"></a>no_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1151-6"><a href="machine_learning.html#cb1151-6" tabindex="-1"></a></span>
<span id="cb1151-7"><a href="machine_learning.html#cb1151-7" tabindex="-1"></a><span class="co"># Initiate</span></span>
<span id="cb1151-8"><a href="machine_learning.html#cb1151-8" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(no_cores)</span>
<span id="cb1151-9"><a href="machine_learning.html#cb1151-9" tabindex="-1"></a></span>
<span id="cb1151-10"><a href="machine_learning.html#cb1151-10" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb1151-11"><a href="machine_learning.html#cb1151-11" tabindex="-1"></a></span>
<span id="cb1151-12"><a href="machine_learning.html#cb1151-12" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1151-13"><a href="machine_learning.html#cb1151-13" tabindex="-1"></a>tree_res <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span></span>
<span id="cb1151-14"><a href="machine_learning.html#cb1151-14" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1151-15"><a href="machine_learning.html#cb1151-15" tabindex="-1"></a>    <span class="at">resamples =</span> tree_folds,</span>
<span id="cb1151-16"><a href="machine_learning.html#cb1151-16" tabindex="-1"></a>    <span class="at">grid =</span> tree_grid,</span>
<span id="cb1151-17"><a href="machine_learning.html#cb1151-17" tabindex="-1"></a>    <span class="at">metrics =</span> metrics</span>
<span id="cb1151-18"><a href="machine_learning.html#cb1151-18" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="visualize-1" class="section level5 hasAnchor" number="8.6.2.3.3">
<h5><span class="header-section-number">8.6.2.3.3</span> Visualize<a href="machine_learning.html#visualize-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>The following plot draws on the <a href="https://www.tidymodels.org/start/tuning/">vignette</a> of the tidymodels package.</li>
</ul>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1152-1"><a href="machine_learning.html#cb1152-1" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span></span>
<span id="cb1152-2"><a href="machine_learning.html#cb1152-2" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1152-3"><a href="machine_learning.html#cb1152-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tree_depth =</span> <span class="fu">factor</span>(tree_depth)) <span class="sc">%&gt;%</span></span>
<span id="cb1152-4"><a href="machine_learning.html#cb1152-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cost_complexity, mean, <span class="at">col =</span> .metric)) <span class="sc">+</span></span>
<span id="cb1152-5"><a href="machine_learning.html#cb1152-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1152-6"><a href="machine_learning.html#cb1152-6" tabindex="-1"></a>  <span class="co"># Subplots</span></span>
<span id="cb1152-7"><a href="machine_learning.html#cb1152-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>tree_depth,</span>
<span id="cb1152-8"><a href="machine_learning.html#cb1152-8" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1152-9"><a href="machine_learning.html#cb1152-9" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1152-10"><a href="machine_learning.html#cb1152-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1152-11"><a href="machine_learning.html#cb1152-11" tabindex="-1"></a>  <span class="co"># Log scale x</span></span>
<span id="cb1152-12"><a href="machine_learning.html#cb1152-12" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb1152-13"><a href="machine_learning.html#cb1152-13" tabindex="-1"></a>  <span class="co"># Discrete color scale</span></span>
<span id="cb1152-14"><a href="machine_learning.html#cb1152-14" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1152-15"><a href="machine_learning.html#cb1152-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1152-16"><a href="machine_learning.html#cb1152-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Cost complexity&quot;</span>,</span>
<span id="cb1152-17"><a href="machine_learning.html#cb1152-17" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;Tree depth&quot;</span>,</span>
<span id="cb1152-18"><a href="machine_learning.html#cb1152-18" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb1152-19"><a href="machine_learning.html#cb1152-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1152-20"><a href="machine_learning.html#cb1152-20" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="select-1" class="section level5 hasAnchor" number="8.6.2.3.4">
<h5><span class="header-section-number">8.6.2.3.4</span> Select<a href="machine_learning.html#select-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="machine_learning.html#cb1153-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1153-2"><a href="machine_learning.html#cb1153-2" tabindex="-1"></a>best_tree <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(tree_res, <span class="at">metric =</span> <span class="st">&quot;recall&quot;</span>)</span>
<span id="cb1153-3"><a href="machine_learning.html#cb1153-3" tabindex="-1"></a></span>
<span id="cb1153-4"><a href="machine_learning.html#cb1153-4" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1153-5"><a href="machine_learning.html#cb1153-5" tabindex="-1"></a>finalize_tree <span class="ot">&lt;-</span> tree_wf <span class="sc">%&gt;%</span></span>
<span id="cb1153-6"><a href="machine_learning.html#cb1153-6" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="machine_learning.html#cb1154-1" tabindex="-1"></a>tree_fit_tuned <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1154-2"><a href="machine_learning.html#cb1154-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1154-3"><a href="machine_learning.html#cb1154-3" tabindex="-1"></a></span>
<span id="cb1154-4"><a href="machine_learning.html#cb1154-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1154-5"><a href="machine_learning.html#cb1154-5" tabindex="-1"></a>(tree_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(tree_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="machine_learning.html#cb1155-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1155-2"><a href="machine_learning.html#cb1155-2" tabindex="-1"></a>(tree_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(tree_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="machine_learning.html#cb1156-1" tabindex="-1"></a>tree_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1156-2"><a href="machine_learning.html#cb1156-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1156-3"><a href="machine_learning.html#cb1156-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="test-fit-1" class="section level5 hasAnchor" number="8.6.2.3.5">
<h5><span class="header-section-number">8.6.2.3.5</span> Test fit<a href="machine_learning.html#test-fit-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="machine_learning.html#cb1157-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1157-2"><a href="machine_learning.html#cb1157-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1157-3"><a href="machine_learning.html#cb1157-3" tabindex="-1"></a></span>
<span id="cb1157-4"><a href="machine_learning.html#cb1157-4" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.761
## 2 precision binary         0.778
## 3 recall    binary         0.667</code></pre>
<p>In the next subsection, we will learn variants of ensemble models that improve decision tree models by putting models together.</p>
</div>
</div>
</div>
<div id="bagging-random-forest" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Bagging (Random forest)<a href="machine_learning.html#bagging-random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Key idea applied across all ensemble models (bagging, boosting, and stacking):
single learner -&gt; N learners (N &gt; 1)</p>
<p>Many learners could perform better than a single learner as this approach reduces the <strong>variance</strong> of a single estimate and provides more stability.</p>
<p>Here we focus on the difference between bagging and boosting. In short, boosting may reduce bias while increasing variance. On the other hand, bagging may reduce variance but has nothing to do with bias. Please check out <a href="https://quantdare.com/what-is-the-difference-between-bagging-and-boosting/">What is the difference between Bagging and Boosting?</a> by aporras.</p>
<p><strong>bagging</strong></p>
<ul>
<li><p>Data: Training data will be randomly sampled with replacement (bootstrapping samples + drawing random <strong>subsets</strong> of features for training individual trees)</p></li>
<li><p>Learning: Building models in parallel (independently)</p></li>
<li><p>Prediction: Simple average of the estimated responses (majority vote system)</p></li>
</ul>
<div class="float">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/bagging.png" alt="From Sebastian Raschka’s blog" />
<div class="figcaption">From Sebastian Raschka’s blog</div>
</div>
<p><strong>boosting</strong></p>
<ul>
<li><p>Data: Weighted training data will be random sampled</p></li>
<li><p>Learning: Building models sequentially (mispredicted cases would receive more weights)</p></li>
<li><p>Prediction: Weighted average of the estimated responses</p></li>
</ul>
<div class="float">
<img src="https://sebastianraschka.com/images/faq/bagging-boosting-rf/boosting.png" alt="From Sebastian Raschka’s blog" />
<div class="figcaption">From Sebastian Raschka’s blog</div>
</div>
<div id="parsnip-2" class="section level4 hasAnchor" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> parsnip<a href="machine_learning.html#parsnip-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Build a model</li>
</ul>
<ol style="list-style-type: decimal">
<li>Specify a model</li>
<li>Specify an engine</li>
<li>Specify a mode</li>
</ol>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="machine_learning.html#cb1159-1" tabindex="-1"></a><span class="co"># workflow</span></span>
<span id="cb1159-2"><a href="machine_learning.html#cb1159-2" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> <span class="fu">add_formula</span>(target <span class="sc">~</span> .)</span>
<span id="cb1159-3"><a href="machine_learning.html#cb1159-3" tabindex="-1"></a></span>
<span id="cb1159-4"><a href="machine_learning.html#cb1159-4" tabindex="-1"></a><span class="co"># spec</span></span>
<span id="cb1159-5"><a href="machine_learning.html#cb1159-5" tabindex="-1"></a>rand_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb1159-6"><a href="machine_learning.html#cb1159-6" tabindex="-1"></a></span>
<span id="cb1159-7"><a href="machine_learning.html#cb1159-7" tabindex="-1"></a>  <span class="co"># Mode</span></span>
<span id="cb1159-8"><a href="machine_learning.html#cb1159-8" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1159-9"><a href="machine_learning.html#cb1159-9" tabindex="-1"></a></span>
<span id="cb1159-10"><a href="machine_learning.html#cb1159-10" tabindex="-1"></a>  <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1159-11"><a href="machine_learning.html#cb1159-11" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="cn">NULL</span>, <span class="co"># The number of predictors to available for splitting at each node</span></span>
<span id="cb1159-12"><a href="machine_learning.html#cb1159-12" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="cn">NULL</span>, <span class="co"># The minimum number of data points needed to keep splitting nodes</span></span>
<span id="cb1159-13"><a href="machine_learning.html#cb1159-13" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">500</span></span>
<span id="cb1159-14"><a href="machine_learning.html#cb1159-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># The number of trees</span></span>
<span id="cb1159-15"><a href="machine_learning.html#cb1159-15" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1159-16"><a href="machine_learning.html#cb1159-16" tabindex="-1"></a>    <span class="co"># We want the importance of predictors to be assessed.</span></span>
<span id="cb1159-17"><a href="machine_learning.html#cb1159-17" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1159-18"><a href="machine_learning.html#cb1159-18" tabindex="-1"></a>    <span class="at">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1159-19"><a href="machine_learning.html#cb1159-19" tabindex="-1"></a>  )</span>
<span id="cb1159-20"><a href="machine_learning.html#cb1159-20" tabindex="-1"></a></span>
<span id="cb1159-21"><a href="machine_learning.html#cb1159-21" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">add_model</span>(rand_spec)</span></code></pre></div>
<ul>
<li>Fit a model</li>
</ul>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="machine_learning.html#cb1160-1" tabindex="-1"></a>rand_fit <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span></code></pre></div>
</div>
<div id="yardstick-2" class="section level4 hasAnchor" number="8.6.3.2">
<h4><span class="header-section-number">8.6.3.2</span> yardstick<a href="machine_learning.html#yardstick-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="machine_learning.html#cb1161-1" tabindex="-1"></a><span class="co"># Define performance metrics</span></span>
<span id="cb1161-2"><a href="machine_learning.html#cb1161-2" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(accuracy, precision, recall)</span>
<span id="cb1161-3"><a href="machine_learning.html#cb1161-3" tabindex="-1"></a></span>
<span id="cb1161-4"><a href="machine_learning.html#cb1161-4" tabindex="-1"></a>rand_fit_viz_metr <span class="ot">&lt;-</span> <span class="fu">visualize_class_eval</span>(rand_fit)</span>
<span id="cb1161-5"><a href="machine_learning.html#cb1161-5" tabindex="-1"></a></span>
<span id="cb1161-6"><a href="machine_learning.html#cb1161-6" tabindex="-1"></a>rand_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="machine_learning.html#cb1162-1" tabindex="-1"></a>rand_fit_viz_mat <span class="ot">&lt;-</span> <span class="fu">visualize_class_conf</span>(rand_fit)</span>
<span id="cb1162-2"><a href="machine_learning.html#cb1162-2" tabindex="-1"></a></span>
<span id="cb1162-3"><a href="machine_learning.html#cb1162-3" tabindex="-1"></a>rand_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="tune-2" class="section level4 hasAnchor" number="8.6.3.3">
<h4><span class="header-section-number">8.6.3.3</span> tune<a href="machine_learning.html#tune-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-2" class="section level5 hasAnchor" number="8.6.3.3.1">
<h5><span class="header-section-number">8.6.3.3.1</span> tune ingredients<a href="machine_learning.html#tune-ingredients-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We focus on the following two hyperparameters:</p>
<ul>
<li><p><code>mtry</code>: The number of predictors available for splitting at each node.</p></li>
<li><p><code>min_n</code>: The minimum number of data points needed to keep splitting nodes.</p></li>
</ul>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="machine_learning.html#cb1163-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span></span>
<span id="cb1163-2"><a href="machine_learning.html#cb1163-2" tabindex="-1"></a>  <span class="fu">rand_forest</span>(</span>
<span id="cb1163-3"><a href="machine_learning.html#cb1163-3" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1163-4"><a href="machine_learning.html#cb1163-4" tabindex="-1"></a></span>
<span id="cb1163-5"><a href="machine_learning.html#cb1163-5" tabindex="-1"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1163-6"><a href="machine_learning.html#cb1163-6" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb1163-7"><a href="machine_learning.html#cb1163-7" tabindex="-1"></a>    <span class="at">min_n =</span> <span class="fu">tune</span>()</span>
<span id="cb1163-8"><a href="machine_learning.html#cb1163-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1163-9"><a href="machine_learning.html#cb1163-9" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb1163-10"><a href="machine_learning.html#cb1163-10" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb1163-11"><a href="machine_learning.html#cb1163-11" tabindex="-1"></a>    <span class="at">importance =</span> <span class="st">&quot;permutation&quot;</span></span>
<span id="cb1163-12"><a href="machine_learning.html#cb1163-12" tabindex="-1"></a>  )</span>
<span id="cb1163-13"><a href="machine_learning.html#cb1163-13" tabindex="-1"></a></span>
<span id="cb1163-14"><a href="machine_learning.html#cb1163-14" tabindex="-1"></a>rand_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb1163-15"><a href="machine_learning.html#cb1163-15" tabindex="-1"></a>  <span class="fu">min_n</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)),</span>
<span id="cb1163-16"><a href="machine_learning.html#cb1163-16" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb1163-17"><a href="machine_learning.html#cb1163-17" tabindex="-1"></a>)</span>
<span id="cb1163-18"><a href="machine_learning.html#cb1163-18" tabindex="-1"></a></span>
<span id="cb1163-19"><a href="machine_learning.html#cb1163-19" tabindex="-1"></a>rand_grid <span class="sc">%&gt;%</span></span>
<span id="cb1163-20"><a href="machine_learning.html#cb1163-20" tabindex="-1"></a>  <span class="fu">count</span>(min_n)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   min_n     n
##   &lt;int&gt; &lt;int&gt;
## 1     2     5
## 2     4     5
## 3     6     5
## 4     8     5
## 5    10     5</code></pre>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="machine_learning.html#cb1165-1" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1165-2"><a href="machine_learning.html#cb1165-2" tabindex="-1"></a></span>
<span id="cb1165-3"><a href="machine_learning.html#cb1165-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1165-4"><a href="machine_learning.html#cb1165-4" tabindex="-1"></a></span>
<span id="cb1165-5"><a href="machine_learning.html#cb1165-5" tabindex="-1"></a>rand_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1165-6"><a href="machine_learning.html#cb1165-6" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1165-7"><a href="machine_learning.html#cb1165-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-2" class="section level5 hasAnchor" number="8.6.3.3.2">
<h5><span class="header-section-number">8.6.3.3.2</span> Add these elements to a workflow<a href="machine_learning.html#add-these-elements-to-a-workflow-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="machine_learning.html#cb1166-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1166-2"><a href="machine_learning.html#cb1166-2" tabindex="-1"></a>rand_wf <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1166-3"><a href="machine_learning.html#cb1166-3" tabindex="-1"></a></span>
<span id="cb1166-4"><a href="machine_learning.html#cb1166-4" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1166-5"><a href="machine_learning.html#cb1166-5" tabindex="-1"></a>rand_res <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span></span>
<span id="cb1166-6"><a href="machine_learning.html#cb1166-6" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1166-7"><a href="machine_learning.html#cb1166-7" tabindex="-1"></a>    <span class="at">resamples =</span> rand_folds,</span>
<span id="cb1166-8"><a href="machine_learning.html#cb1166-8" tabindex="-1"></a>    <span class="at">grid =</span> rand_grid,</span>
<span id="cb1166-9"><a href="machine_learning.html#cb1166-9" tabindex="-1"></a>    <span class="at">metrics =</span> metrics</span>
<span id="cb1166-10"><a href="machine_learning.html#cb1166-10" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="visualize-2" class="section level5 hasAnchor" number="8.6.3.3.3">
<h5><span class="header-section-number">8.6.3.3.3</span> Visualize<a href="machine_learning.html#visualize-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="machine_learning.html#cb1167-1" tabindex="-1"></a>rand_res <span class="sc">%&gt;%</span></span>
<span id="cb1167-2"><a href="machine_learning.html#cb1167-2" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1167-3"><a href="machine_learning.html#cb1167-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_n =</span> <span class="fu">factor</span>(min_n)) <span class="sc">%&gt;%</span></span>
<span id="cb1167-4"><a href="machine_learning.html#cb1167-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mtry, mean, <span class="at">color =</span> min_n)) <span class="sc">+</span></span>
<span id="cb1167-5"><a href="machine_learning.html#cb1167-5" tabindex="-1"></a>  <span class="co"># Line + Point plot</span></span>
<span id="cb1167-6"><a href="machine_learning.html#cb1167-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb1167-7"><a href="machine_learning.html#cb1167-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1167-8"><a href="machine_learning.html#cb1167-8" tabindex="-1"></a>  <span class="co"># Subplots</span></span>
<span id="cb1167-9"><a href="machine_learning.html#cb1167-9" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric,</span>
<span id="cb1167-10"><a href="machine_learning.html#cb1167-10" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb1167-11"><a href="machine_learning.html#cb1167-11" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb1167-12"><a href="machine_learning.html#cb1167-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1167-13"><a href="machine_learning.html#cb1167-13" tabindex="-1"></a>  <span class="co"># Log scale x</span></span>
<span id="cb1167-14"><a href="machine_learning.html#cb1167-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb1167-15"><a href="machine_learning.html#cb1167-15" tabindex="-1"></a>  <span class="co"># Discrete color scale</span></span>
<span id="cb1167-16"><a href="machine_learning.html#cb1167-16" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1167-17"><a href="machine_learning.html#cb1167-17" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1167-18"><a href="machine_learning.html#cb1167-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;The number of predictors to be sampled&quot;</span>,</span>
<span id="cb1167-19"><a href="machine_learning.html#cb1167-19" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;The minimum number of data points needed for splitting&quot;</span>,</span>
<span id="cb1167-20"><a href="machine_learning.html#cb1167-20" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb1167-21"><a href="machine_learning.html#cb1167-21" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1167-22"><a href="machine_learning.html#cb1167-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="machine_learning.html#cb1168-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1168-2"><a href="machine_learning.html#cb1168-2" tabindex="-1"></a>best_tree <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">select_best</span>(rand_res, <span class="at">metric =</span> <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb1168-3"><a href="machine_learning.html#cb1168-3" tabindex="-1"></a></span>
<span id="cb1168-4"><a href="machine_learning.html#cb1168-4" tabindex="-1"></a>best_tree</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     1     4 Preprocessor1_Model06</code></pre>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="machine_learning.html#cb1170-1" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1170-2"><a href="machine_learning.html#cb1170-2" tabindex="-1"></a>finalize_tree <span class="ot">&lt;-</span> rand_wf <span class="sc">%&gt;%</span></span>
<span id="cb1170-3"><a href="machine_learning.html#cb1170-3" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_tree)</span></code></pre></div>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="machine_learning.html#cb1171-1" tabindex="-1"></a>rand_fit_tuned <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1171-2"><a href="machine_learning.html#cb1171-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1171-3"><a href="machine_learning.html#cb1171-3" tabindex="-1"></a></span>
<span id="cb1171-4"><a href="machine_learning.html#cb1171-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1171-5"><a href="machine_learning.html#cb1171-5" tabindex="-1"></a>(rand_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(rand_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="machine_learning.html#cb1172-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1172-2"><a href="machine_learning.html#cb1172-2" tabindex="-1"></a>(rand_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(rand_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-48-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="machine_learning.html#cb1173-1" tabindex="-1"></a>rand_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1173-2"><a href="machine_learning.html#cb1173-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1173-3"><a href="machine_learning.html#cb1173-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="test-fit-2" class="section level5 hasAnchor" number="8.6.3.3.4">
<h5><span class="header-section-number">8.6.3.3.4</span> Test fit<a href="machine_learning.html#test-fit-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="machine_learning.html#cb1174-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_tree <span class="sc">%&gt;%</span></span>
<span id="cb1174-2"><a href="machine_learning.html#cb1174-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span></span>
<span id="cb1174-3"><a href="machine_learning.html#cb1174-3" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1174-4"><a href="machine_learning.html#cb1174-4" tabindex="-1"></a></span>
<span id="cb1174-5"><a href="machine_learning.html#cb1174-5" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.946
## 2 precision binary         0.930
## 3 recall    binary         0.952</code></pre>
</div>
</div>
</div>
<div id="boosting-xgboost" class="section level3 hasAnchor" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Boosting (XGboost)<a href="machine_learning.html#boosting-xgboost" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="parsnip-model-specification-and-tuning" class="section level4 hasAnchor" number="8.6.4.1">
<h4><span class="header-section-number">8.6.4.1</span> parsnip: Model specification and tuning<a href="machine_learning.html#parsnip-model-specification-and-tuning" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Build and tune a model</strong>
<ol style="list-style-type: decimal">
<li>Define a workflow with your formula<br />
</li>
<li>Add a tunable model spec (with <code>tune()</code> placeholders)<br />
</li>
<li>Set the engine and mode<br />
</li>
<li>Create resamples (e.g. stratified 5‑fold CV)<br />
</li>
<li>Design a hyperparameter grid<br />
</li>
<li>Tune across the grid</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="machine_learning.html#cb1176-1" tabindex="-1"></a><span class="co"># 1) Define the workflow</span></span>
<span id="cb1176-2"><a href="machine_learning.html#cb1176-2" tabindex="-1"></a>xg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1176-3"><a href="machine_learning.html#cb1176-3" tabindex="-1"></a>  <span class="fu">add_formula</span>(target <span class="sc">~</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-4"><a href="machine_learning.html#cb1176-4" tabindex="-1"></a>  <span class="fu">add_model</span>(</span>
<span id="cb1176-5"><a href="machine_learning.html#cb1176-5" tabindex="-1"></a>    <span class="fu">boost_tree</span>(</span>
<span id="cb1176-6"><a href="machine_learning.html#cb1176-6" tabindex="-1"></a>      <span class="at">trees      =</span> <span class="fu">tune</span>(),      <span class="co"># to be tuned</span></span>
<span id="cb1176-7"><a href="machine_learning.html#cb1176-7" tabindex="-1"></a>      <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb1176-8"><a href="machine_learning.html#cb1176-8" tabindex="-1"></a>      <span class="at">learn_rate =</span> <span class="fu">tune</span>()</span>
<span id="cb1176-9"><a href="machine_learning.html#cb1176-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-10"><a href="machine_learning.html#cb1176-10" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-11"><a href="machine_learning.html#cb1176-11" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb1176-12"><a href="machine_learning.html#cb1176-12" tabindex="-1"></a>  )</span>
<span id="cb1176-13"><a href="machine_learning.html#cb1176-13" tabindex="-1"></a></span>
<span id="cb1176-14"><a href="machine_learning.html#cb1176-14" tabindex="-1"></a><span class="co"># 2) Create resamples (5-fold CV, stratified by target)</span></span>
<span id="cb1176-15"><a href="machine_learning.html#cb1176-15" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1176-16"><a href="machine_learning.html#cb1176-16" tabindex="-1"></a>cv_splits <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(</span>
<span id="cb1176-17"><a href="machine_learning.html#cb1176-17" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">target =</span> <span class="fu">as.factor</span>(target)),</span>
<span id="cb1176-18"><a href="machine_learning.html#cb1176-18" tabindex="-1"></a>  <span class="at">v =</span> <span class="dv">5</span>, </span>
<span id="cb1176-19"><a href="machine_learning.html#cb1176-19" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1176-20"><a href="machine_learning.html#cb1176-20" tabindex="-1"></a>)</span>
<span id="cb1176-21"><a href="machine_learning.html#cb1176-21" tabindex="-1"></a></span>
<span id="cb1176-22"><a href="machine_learning.html#cb1176-22" tabindex="-1"></a><span class="co"># 3) Specify a tuning grid</span></span>
<span id="cb1176-23"><a href="machine_learning.html#cb1176-23" tabindex="-1"></a>xg_grid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb1176-24"><a href="machine_learning.html#cb1176-24" tabindex="-1"></a>  <span class="fu">trees</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">500</span>)),</span>
<span id="cb1176-25"><a href="machine_learning.html#cb1176-25" tabindex="-1"></a>  <span class="fu">tree_depth</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb1176-26"><a href="machine_learning.html#cb1176-26" tabindex="-1"></a>  <span class="fu">learn_rate</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.3</span>)),</span>
<span id="cb1176-27"><a href="machine_learning.html#cb1176-27" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb1176-28"><a href="machine_learning.html#cb1176-28" tabindex="-1"></a>)</span>
<span id="cb1176-29"><a href="machine_learning.html#cb1176-29" tabindex="-1"></a></span>
<span id="cb1176-30"><a href="machine_learning.html#cb1176-30" tabindex="-1"></a><span class="co"># 4) Run tuning</span></span>
<span id="cb1176-31"><a href="machine_learning.html#cb1176-31" tabindex="-1"></a>xg_res <span class="ot">&lt;-</span> <span class="fu">tune_race_anova</span>(</span>
<span id="cb1176-32"><a href="machine_learning.html#cb1176-32" tabindex="-1"></a>  xg_wf, <span class="at">resamples =</span> cv_splits, <span class="at">grid =</span> xg_grid,</span>
<span id="cb1176-33"><a href="machine_learning.html#cb1176-33" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy, recall),</span>
<span id="cb1176-34"><a href="machine_learning.html#cb1176-34" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_race</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">parallel_over =</span> <span class="st">&quot;resamples&quot;</span>)</span>
<span id="cb1176-35"><a href="machine_learning.html#cb1176-35" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li><p><strong>Fit the final model</strong></p>
<ol style="list-style-type: decimal">
<li>Select the best parameters</li>
<li>Finalize the workflow</li>
<li>Fit to the training set</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="machine_learning.html#cb1177-1" tabindex="-1"></a><span class="co"># Select best metrics (name the metric argument explicitly)</span></span>
<span id="cb1177-2"><a href="machine_learning.html#cb1177-2" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xg_res, <span class="at">metric =</span> <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb1177-3"><a href="machine_learning.html#cb1177-3" tabindex="-1"></a></span>
<span id="cb1177-4"><a href="machine_learning.html#cb1177-4" tabindex="-1"></a><span class="co"># Finalize the workflow with those parameters</span></span>
<span id="cb1177-5"><a href="machine_learning.html#cb1177-5" tabindex="-1"></a>xg_wf_final <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(xg_wf, best_params)</span>
<span id="cb1177-6"><a href="machine_learning.html#cb1177-6" tabindex="-1"></a></span>
<span id="cb1177-7"><a href="machine_learning.html#cb1177-7" tabindex="-1"></a><span class="co"># Fit the finalized workflow</span></span>
<span id="cb1177-8"><a href="machine_learning.html#cb1177-8" tabindex="-1"></a>xg_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(</span>
<span id="cb1177-9"><a href="machine_learning.html#cb1177-9" tabindex="-1"></a>  xg_wf_final,</span>
<span id="cb1177-10"><a href="machine_learning.html#cb1177-10" tabindex="-1"></a>  train_x_class <span class="sc">%&gt;%</span></span>
<span id="cb1177-11"><a href="machine_learning.html#cb1177-11" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class))</span>
<span id="cb1177-12"><a href="machine_learning.html#cb1177-12" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="yardstick-3" class="section level4 hasAnchor" number="8.6.4.2">
<h4><span class="header-section-number">8.6.4.2</span> yardstick<a href="machine_learning.html#yardstick-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="machine_learning.html#cb1178-1" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(</span>
<span id="cb1178-2"><a href="machine_learning.html#cb1178-2" tabindex="-1"></a>  yardstick<span class="sc">::</span>accuracy,</span>
<span id="cb1178-3"><a href="machine_learning.html#cb1178-3" tabindex="-1"></a>  yardstick<span class="sc">::</span>precision,</span>
<span id="cb1178-4"><a href="machine_learning.html#cb1178-4" tabindex="-1"></a>  yardstick<span class="sc">::</span>recall</span>
<span id="cb1178-5"><a href="machine_learning.html#cb1178-5" tabindex="-1"></a>)</span>
<span id="cb1178-6"><a href="machine_learning.html#cb1178-6" tabindex="-1"></a></span>
<span id="cb1178-7"><a href="machine_learning.html#cb1178-7" tabindex="-1"></a><span class="fu">evaluate_class</span>(xg_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.783
## 2 precision binary         0.775
## 3 recall    binary         0.738</code></pre>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="machine_learning.html#cb1180-1" tabindex="-1"></a>xg_fit_viz_metr <span class="ot">&lt;-</span></span>
<span id="cb1180-2"><a href="machine_learning.html#cb1180-2" tabindex="-1"></a>  <span class="fu">visualize_class_eval</span>(xg_fit)</span>
<span id="cb1180-3"><a href="machine_learning.html#cb1180-3" tabindex="-1"></a></span>
<span id="cb1180-4"><a href="machine_learning.html#cb1180-4" tabindex="-1"></a>xg_fit_viz_metr</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li>Visualize the confusion matrix.</li>
</ul>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="machine_learning.html#cb1181-1" tabindex="-1"></a>xg_fit_viz_mat <span class="ot">&lt;-</span></span>
<span id="cb1181-2"><a href="machine_learning.html#cb1181-2" tabindex="-1"></a>  <span class="fu">visualize_class_conf</span>(xg_fit)</span>
<span id="cb1181-3"><a href="machine_learning.html#cb1181-3" tabindex="-1"></a></span>
<span id="cb1181-4"><a href="machine_learning.html#cb1181-4" tabindex="-1"></a>xg_fit_viz_mat</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="tune-3" class="section level4 hasAnchor" number="8.6.4.3">
<h4><span class="header-section-number">8.6.4.3</span> tune<a href="machine_learning.html#tune-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="tune-ingredients-3" class="section level5 hasAnchor" number="8.6.4.3.1">
<h5><span class="header-section-number">8.6.4.3.1</span> tune ingredients<a href="machine_learning.html#tune-ingredients-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>We focus on the following hyperparameters: <code>trees,</code> <code>tree_depth,</code> <code>learn_rate,</code> <code>min_n,</code> <code>mtry,</code> <code>loss_reduction,</code> and <code>sample_size</code></li>
</ul>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="machine_learning.html#cb1182-1" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span></span>
<span id="cb1182-2"><a href="machine_learning.html#cb1182-2" tabindex="-1"></a>  xg_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(</span>
<span id="cb1182-3"><a href="machine_learning.html#cb1182-3" tabindex="-1"></a></span>
<span id="cb1182-4"><a href="machine_learning.html#cb1182-4" tabindex="-1"></a>    <span class="co"># Mode</span></span>
<span id="cb1182-5"><a href="machine_learning.html#cb1182-5" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb1182-6"><a href="machine_learning.html#cb1182-6" tabindex="-1"></a></span>
<span id="cb1182-7"><a href="machine_learning.html#cb1182-7" tabindex="-1"></a>    <span class="co"># Tuning hyperparameters</span></span>
<span id="cb1182-8"><a href="machine_learning.html#cb1182-8" tabindex="-1"></a></span>
<span id="cb1182-9"><a href="machine_learning.html#cb1182-9" tabindex="-1"></a>    <span class="co"># The number of trees to fit, aka boosting iterations</span></span>
<span id="cb1182-10"><a href="machine_learning.html#cb1182-10" tabindex="-1"></a>    <span class="at">trees =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-11"><a href="machine_learning.html#cb1182-11" tabindex="-1"></a>    <span class="co"># The depth of the decision tree (how many levels of splits).</span></span>
<span id="cb1182-12"><a href="machine_learning.html#cb1182-12" tabindex="-1"></a>    <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-13"><a href="machine_learning.html#cb1182-13" tabindex="-1"></a>    <span class="co"># Learning rate: lower means the ensemble will adapt more slowly.</span></span>
<span id="cb1182-14"><a href="machine_learning.html#cb1182-14" tabindex="-1"></a>    <span class="at">learn_rate =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-15"><a href="machine_learning.html#cb1182-15" tabindex="-1"></a>    <span class="co"># Stop splitting a tree if we only have this many obs in a tree node.</span></span>
<span id="cb1182-16"><a href="machine_learning.html#cb1182-16" tabindex="-1"></a>    <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-17"><a href="machine_learning.html#cb1182-17" tabindex="-1"></a>    <span class="at">loss_reduction =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-18"><a href="machine_learning.html#cb1182-18" tabindex="-1"></a>    <span class="co"># The number of randomly selected hyperparameters</span></span>
<span id="cb1182-19"><a href="machine_learning.html#cb1182-19" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb1182-20"><a href="machine_learning.html#cb1182-20" tabindex="-1"></a>    <span class="co"># The size of the data set used for modeling within an iteration</span></span>
<span id="cb1182-21"><a href="machine_learning.html#cb1182-21" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">tune</span>()</span>
<span id="cb1182-22"><a href="machine_learning.html#cb1182-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1182-23"><a href="machine_learning.html#cb1182-23" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span>
<span id="cb1182-24"><a href="machine_learning.html#cb1182-24" tabindex="-1"></a></span>
<span id="cb1182-25"><a href="machine_learning.html#cb1182-25" tabindex="-1"></a><span class="co"># Space-filling hyperparameter grids</span></span>
<span id="cb1182-26"><a href="machine_learning.html#cb1182-26" tabindex="-1"></a>xg_grid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb1182-27"><a href="machine_learning.html#cb1182-27" tabindex="-1"></a>  <span class="fu">trees</span>(),</span>
<span id="cb1182-28"><a href="machine_learning.html#cb1182-28" tabindex="-1"></a>  <span class="fu">tree_depth</span>(),</span>
<span id="cb1182-29"><a href="machine_learning.html#cb1182-29" tabindex="-1"></a>  <span class="fu">learn_rate</span>(),</span>
<span id="cb1182-30"><a href="machine_learning.html#cb1182-30" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb1182-31"><a href="machine_learning.html#cb1182-31" tabindex="-1"></a>  <span class="fu">loss_reduction</span>(),</span>
<span id="cb1182-32"><a href="machine_learning.html#cb1182-32" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">sample_prop</span>(),</span>
<span id="cb1182-33"><a href="machine_learning.html#cb1182-33" tabindex="-1"></a>  <span class="fu">finalize</span>(<span class="fu">mtry</span>(), train_x_class),</span>
<span id="cb1182-34"><a href="machine_learning.html#cb1182-34" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">30</span></span>
<span id="cb1182-35"><a href="machine_learning.html#cb1182-35" tabindex="-1"></a>)</span>
<span id="cb1182-36"><a href="machine_learning.html#cb1182-36" tabindex="-1"></a></span>
<span id="cb1182-37"><a href="machine_learning.html#cb1182-37" tabindex="-1"></a><span class="co"># 10-fold cross-validation</span></span>
<span id="cb1182-38"><a href="machine_learning.html#cb1182-38" tabindex="-1"></a></span>
<span id="cb1182-39"><a href="machine_learning.html#cb1182-39" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb1182-40"><a href="machine_learning.html#cb1182-40" tabindex="-1"></a></span>
<span id="cb1182-41"><a href="machine_learning.html#cb1182-41" tabindex="-1"></a>xg_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)),</span>
<span id="cb1182-42"><a href="machine_learning.html#cb1182-42" tabindex="-1"></a>  <span class="at">strata =</span> target</span>
<span id="cb1182-43"><a href="machine_learning.html#cb1182-43" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="add-these-elements-to-a-workflow-3" class="section level5 hasAnchor" number="8.6.4.3.2">
<h5><span class="header-section-number">8.6.4.3.2</span> Add these elements to a workflow<a href="machine_learning.html#add-these-elements-to-a-workflow-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="machine_learning.html#cb1183-1" tabindex="-1"></a><span class="co"># Update workflow</span></span>
<span id="cb1183-2"><a href="machine_learning.html#cb1183-2" tabindex="-1"></a>xg_wf <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span> <span class="fu">update_model</span>(tune_spec)</span>
<span id="cb1183-3"><a href="machine_learning.html#cb1183-3" tabindex="-1"></a></span>
<span id="cb1183-4"><a href="machine_learning.html#cb1183-4" tabindex="-1"></a><span class="co"># Tuning results</span></span>
<span id="cb1183-5"><a href="machine_learning.html#cb1183-5" tabindex="-1"></a>xg_res <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb1183-6"><a href="machine_learning.html#cb1183-6" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb1183-7"><a href="machine_learning.html#cb1183-7" tabindex="-1"></a>    <span class="at">resamples =</span> xg_folds,</span>
<span id="cb1183-8"><a href="machine_learning.html#cb1183-8" tabindex="-1"></a>    <span class="at">grid =</span> xg_grid,</span>
<span id="cb1183-9"><a href="machine_learning.html#cb1183-9" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1183-10"><a href="machine_learning.html#cb1183-10" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="visualize-3" class="section level5 hasAnchor" number="8.6.4.3.3">
<h5><span class="header-section-number">8.6.4.3.3</span> Visualize<a href="machine_learning.html#visualize-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="machine_learning.html#cb1184-1" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1184-2"><a href="machine_learning.html#cb1184-2" tabindex="-1"></a></span>
<span id="cb1184-3"><a href="machine_learning.html#cb1184-3" tabindex="-1"></a>xg_res <span class="sc">%&gt;%</span></span>
<span id="cb1184-4"><a href="machine_learning.html#cb1184-4" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1184-5"><a href="machine_learning.html#cb1184-5" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;roc_auc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1184-6"><a href="machine_learning.html#cb1184-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mtry<span class="sc">:</span>sample_size,</span>
<span id="cb1184-7"><a href="machine_learning.html#cb1184-7" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb1184-8"><a href="machine_learning.html#cb1184-8" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span></span>
<span id="cb1184-9"><a href="machine_learning.html#cb1184-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1184-10"><a href="machine_learning.html#cb1184-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> mean, <span class="at">color =</span> parameter)) <span class="sc">+</span></span>
<span id="cb1184-11"><a href="machine_learning.html#cb1184-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1184-12"><a href="machine_learning.html#cb1184-12" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1184-13"><a href="machine_learning.html#cb1184-13" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1184-14"><a href="machine_learning.html#cb1184-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb1184-15"><a href="machine_learning.html#cb1184-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span></span>
<span id="cb1184-16"><a href="machine_learning.html#cb1184-16" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="machine_learning.html#cb1185-1" tabindex="-1"></a><span class="co"># Optimal hyperparameter</span></span>
<span id="cb1185-2"><a href="machine_learning.html#cb1185-2" tabindex="-1"></a>best_xg <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xg_res, <span class="at">metric =</span> <span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb1185-3"><a href="machine_learning.html#cb1185-3" tabindex="-1"></a></span>
<span id="cb1185-4"><a href="machine_learning.html#cb1185-4" tabindex="-1"></a>best_xg</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##    mtry trees min_n tree_depth learn_rate loss_reduction sample_size .config    
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;      
## 1     5   399     6          7     0.0250        0.00125       0.588 Preprocess…</code></pre>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="machine_learning.html#cb1187-1" tabindex="-1"></a><span class="co"># Add the hyperparameter to the workflow</span></span>
<span id="cb1187-2"><a href="machine_learning.html#cb1187-2" tabindex="-1"></a>finalize_xg <span class="ot">&lt;-</span> xg_wf <span class="sc">%&gt;%</span></span>
<span id="cb1187-3"><a href="machine_learning.html#cb1187-3" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_xg)</span></code></pre></div>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="machine_learning.html#cb1188-1" tabindex="-1"></a>xg_fit_tuned <span class="ot">&lt;-</span> finalize_xg <span class="sc">%&gt;%</span></span>
<span id="cb1188-2"><a href="machine_learning.html#cb1188-2" tabindex="-1"></a>  <span class="fu">fit</span>(train_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> train_y_class)))</span>
<span id="cb1188-3"><a href="machine_learning.html#cb1188-3" tabindex="-1"></a></span>
<span id="cb1188-4"><a href="machine_learning.html#cb1188-4" tabindex="-1"></a><span class="co"># Metrics</span></span>
<span id="cb1188-5"><a href="machine_learning.html#cb1188-5" tabindex="-1"></a>(xg_fit_viz_metr <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_eval</span>(xg_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="machine_learning.html#cb1189-1" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb1189-2"><a href="machine_learning.html#cb1189-2" tabindex="-1"></a>(xg_fit_viz_mat <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Non-tuned&quot;</span>)) <span class="sc">/</span> (<span class="fu">visualize_class_conf</span>(xg_fit_tuned) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tuned&quot;</span>))</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-60-2.png" width="672" /></p>
<ul>
<li>Visualize variable importance</li>
</ul>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="machine_learning.html#cb1190-1" tabindex="-1"></a>xg_fit_tuned <span class="sc">%&gt;%</span></span>
<span id="cb1190-2"><a href="machine_learning.html#cb1190-2" tabindex="-1"></a>  <span class="fu">pull_workflow_fit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1190-3"><a href="machine_learning.html#cb1190-3" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="test-fit-3" class="section level5 hasAnchor" number="8.6.4.3.4">
<h5><span class="header-section-number">8.6.4.3.4</span> Test fit<a href="machine_learning.html#test-fit-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Apply the tuned model to the test dataset</li>
</ul>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="machine_learning.html#cb1191-1" tabindex="-1"></a>test_fit <span class="ot">&lt;-</span> finalize_xg <span class="sc">%&gt;%</span></span>
<span id="cb1191-2"><a href="machine_learning.html#cb1191-2" tabindex="-1"></a>  <span class="fu">fit</span>(test_x_class <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">target =</span> test_y_class)))</span>
<span id="cb1191-3"><a href="machine_learning.html#cb1191-3" tabindex="-1"></a></span>
<span id="cb1191-4"><a href="machine_learning.html#cb1191-4" tabindex="-1"></a><span class="fu">evaluate_class</span>(test_fit)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy  binary         0.707
## 2 precision binary         0.692
## 3 recall    binary         0.643</code></pre>
</div>
</div>
</div>
<div id="stacking-superlearner" class="section level3 hasAnchor" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Stacking (SuperLearner)<a href="machine_learning.html#stacking-superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This stacking part of the book heavily relies on <a href="https://github.com/dlab-berkeley/Machine-Learning-in-R/blob/master/07-ensembles.Rmd">Chris Kennedy’s notebook</a>.</p>
<div id="overview" class="section level4 hasAnchor" number="8.6.5.1">
<h4><span class="header-section-number">8.6.5.1</span> Overview<a href="machine_learning.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="stacking" class="section level5 hasAnchor" number="8.6.5.1.1">
<h5><span class="header-section-number">8.6.5.1.1</span> Stacking<a href="machine_learning.html#stacking" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Wolpert, D.H., 1992. <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.56.1533">Stacked generalization</a>. <em>Neural networks</em>, 5(2), pp.241-259.</p>
<p>Breiman, L., 1996. [Stacked regressions]((<a href="https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf" class="uri">https://statistics.berkeley.edu/sites/default/files/tech-reports/367.pdf</a>). <em>Machine learning</em>, 24(1), pp.49-64.</p>
</div>
<div id="superlearner" class="section level5 hasAnchor" number="8.6.5.1.2">
<h5><span class="header-section-number">8.6.5.1.2</span> SuperLearner<a href="machine_learning.html#superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <a href="https://cran.r-project.org/web/packages/SuperLearner/index.html">“SuperLearner” R package</a> is a method that simplifies ensemble learning by allowing you to simultaneously evaluate the cross-validated performance of multiple algorithms and/or a single algorithm with differently tuned hyperparameters. This is a generally advisable approach to machine learning instead of fitting single algorithms.</p>
<p>Let’s see how the four classification algorithms you learned in this workshop (1-lasso, 2-decision tree, 3-random forest, and 4-gradient boosted trees) compare to each other and also to 5-binary logistic regression (<code>glm</code>) and the 6-mean of Y as a benchmark algorithm, in terms of their cross-validated error!</p>
<p>A “wrapper” is a short function that adapts an algorithm for the SuperLearner package. Check out the different algorithm wrappers offered by SuperLearner:</p>
</div>
</div>
<div id="choose-algorithms" class="section level4 hasAnchor" number="8.6.5.2">
<h4><span class="header-section-number">8.6.5.2</span> Choose algorithms<a href="machine_learning.html#choose-algorithms" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="machine_learning.html#cb1193-1" tabindex="-1"></a><span class="co"># Review available models</span></span>
<span id="cb1193-2"><a href="machine_learning.html#cb1193-2" tabindex="-1"></a>SuperLearner<span class="sc">::</span><span class="fu">listWrappers</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;SL.bartMachine&quot;      &quot;SL.bayesglm&quot;         &quot;SL.biglasso&quot;        
##  [4] &quot;SL.caret&quot;            &quot;SL.caret.rpart&quot;      &quot;SL.cforest&quot;         
##  [7] &quot;SL.earth&quot;            &quot;SL.gam&quot;              &quot;SL.gbm&quot;             
## [10] &quot;SL.glm&quot;              &quot;SL.glm.interaction&quot;  &quot;SL.glmnet&quot;          
## [13] &quot;SL.ipredbagg&quot;        &quot;SL.kernelKnn&quot;        &quot;SL.knn&quot;             
## [16] &quot;SL.ksvm&quot;             &quot;SL.lda&quot;              &quot;SL.leekasso&quot;        
## [19] &quot;SL.lm&quot;               &quot;SL.loess&quot;            &quot;SL.logreg&quot;          
## [22] &quot;SL.mean&quot;             &quot;SL.nnet&quot;             &quot;SL.nnls&quot;            
## [25] &quot;SL.polymars&quot;         &quot;SL.qda&quot;              &quot;SL.randomForest&quot;    
## [28] &quot;SL.ranger&quot;           &quot;SL.ridge&quot;            &quot;SL.rpart&quot;           
## [31] &quot;SL.rpartPrune&quot;       &quot;SL.speedglm&quot;         &quot;SL.speedlm&quot;         
## [34] &quot;SL.step&quot;             &quot;SL.step.forward&quot;     &quot;SL.step.interaction&quot;
## [37] &quot;SL.stepAIC&quot;          &quot;SL.svm&quot;              &quot;SL.template&quot;        
## [40] &quot;SL.xgboost&quot;</code></pre>
<pre><code>## [1] &quot;All&quot;
## [1] &quot;screen.corP&quot;           &quot;screen.corRank&quot;        &quot;screen.glmnet&quot;        
## [4] &quot;screen.randomForest&quot;   &quot;screen.SIS&quot;            &quot;screen.template&quot;      
## [7] &quot;screen.ttest&quot;          &quot;write.screen.template&quot;</code></pre>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="machine_learning.html#cb1196-1" tabindex="-1"></a><span class="co"># Compile the algorithm wrappers to be used.</span></span>
<span id="cb1196-2"><a href="machine_learning.html#cb1196-2" tabindex="-1"></a>sl_lib <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1196-3"><a href="machine_learning.html#cb1196-3" tabindex="-1"></a>  <span class="st">&quot;SL.mean&quot;</span>, <span class="co"># Marginal mean of the outcome ()</span></span>
<span id="cb1196-4"><a href="machine_learning.html#cb1196-4" tabindex="-1"></a>  <span class="st">&quot;SL.glmnet&quot;</span>, <span class="co"># GLM with lasso/elasticnet regularization</span></span>
<span id="cb1196-5"><a href="machine_learning.html#cb1196-5" tabindex="-1"></a>  <span class="st">&quot;SL.rpart&quot;</span>, <span class="co"># Decision tree</span></span>
<span id="cb1196-6"><a href="machine_learning.html#cb1196-6" tabindex="-1"></a>  <span class="st">&quot;SL.ranger&quot;</span>, <span class="co"># Random forest</span></span>
<span id="cb1196-7"><a href="machine_learning.html#cb1196-7" tabindex="-1"></a>  <span class="st">&quot;SL.xgboost&quot;</span></span>
<span id="cb1196-8"><a href="machine_learning.html#cb1196-8" tabindex="-1"></a>) <span class="co"># Xgbboost</span></span></code></pre></div>
</div>
<div id="fit-model" class="section level4 hasAnchor" number="8.6.5.3">
<h4><span class="header-section-number">8.6.5.3</span> Fit model<a href="machine_learning.html#fit-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Fit the ensemble!</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="machine_learning.html#cb1197-1" tabindex="-1"></a><span class="co"># This is a seed that is compatible with multicore parallel processing.</span></span>
<span id="cb1197-2"><a href="machine_learning.html#cb1197-2" tabindex="-1"></a><span class="co"># See ?set.seed for more information.</span></span>
<span id="cb1197-3"><a href="machine_learning.html#cb1197-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">&quot;L&#39;Ecuyer-CMRG&quot;</span>)</span>
<span id="cb1197-4"><a href="machine_learning.html#cb1197-4" tabindex="-1"></a></span>
<span id="cb1197-5"><a href="machine_learning.html#cb1197-5" tabindex="-1"></a><span class="co"># This will take a few minutes to execute - take a look at the .html file to see the output!</span></span>
<span id="cb1197-6"><a href="machine_learning.html#cb1197-6" tabindex="-1"></a>cv_sl <span class="ot">&lt;-</span> SuperLearner<span class="sc">::</span><span class="fu">CV.SuperLearner</span>(</span>
<span id="cb1197-7"><a href="machine_learning.html#cb1197-7" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(train_y_class)),</span>
<span id="cb1197-8"><a href="machine_learning.html#cb1197-8" tabindex="-1"></a>  <span class="at">X =</span> train_x_class,</span>
<span id="cb1197-9"><a href="machine_learning.html#cb1197-9" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb1197-10"><a href="machine_learning.html#cb1197-10" tabindex="-1"></a>  <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb1197-11"><a href="machine_learning.html#cb1197-11" tabindex="-1"></a>  <span class="at">cvControl =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="dv">5</span><span class="dt">L</span>, <span class="at">stratifyCV =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1197-12"><a href="machine_learning.html#cb1197-12" tabindex="-1"></a>  <span class="at">SL.library =</span> sl_lib,</span>
<span id="cb1197-13"><a href="machine_learning.html#cb1197-13" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb1197-14"><a href="machine_learning.html#cb1197-14" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="risk" class="section level4 hasAnchor" number="8.6.5.4">
<h4><span class="header-section-number">8.6.5.4</span> Risk<a href="machine_learning.html#risk" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Risk is the average loss, and loss is how far off the prediction was for an individual observation. The lower the risk, the fewer errors the model makes in its prediction. SuperLearner’s default loss metric is squared error <span class="math inline">\((y_{actual} - y_{predicted})^2\)</span>, so the risk is the mean-squared error (just like in ordinary least <em>squares</em> regression). View the summary, plot results, and compute the Area Under the ROC Curve (AUC)!</p>
<div id="summary" class="section level5 hasAnchor" number="8.6.5.4.1">
<h5><span class="header-section-number">8.6.5.4.1</span> Summary<a href="machine_learning.html#summary" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li><code>Discrete SL</code> chooses the best single learner (in this case, <code>SL.glmnet</code> or <code>lasso</code>).</li>
<li><code>SuperLearner</code> takes a weighted average of the <strong>models</strong> using the coefficients (importance of each learner in the overall ensemble). Coefficient 0 means that learner is not used at all.</li>
<li><code>SL.mean_All</code> (the weighted mean of <span class="math inline">\(Y\)</span>) is a benchmark algorithm (ignoring features).</li>
</ul>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="machine_learning.html#cb1198-1" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code></pre></div>
<pre><code>## 
## Call:  
## SuperLearner::CV.SuperLearner(Y = as.numeric(as.character(train_y_class)),  
##     X = train_x_class, family = binomial(), SL.library = sl_lib, verbose = FALSE,  
##     cvControl = list(V = 5L, stratifyCV = TRUE)) 
## 
## Risk is based on: Mean Squared Error
## 
## All risk estimates are based on V =  5 
## 
##       Algorithm     Ave        se      Min     Max
##   Super Learner 0.11351 0.0135381 0.076355 0.14359
##     Discrete SL 0.11881 0.0144947 0.075055 0.16282
##     SL.mean_All 0.24798 0.0030968 0.247743 0.24895
##   SL.glmnet_All 0.10761 0.0135766 0.075055 0.14412
##    SL.rpart_All 0.16942 0.0196963 0.111990 0.23162
##   SL.ranger_All 0.12469 0.0118153 0.097683 0.15397
##  SL.xgboost_All 0.12971 0.0148822 0.098472 0.16282</code></pre>
</div>
<div id="plot" class="section level5 hasAnchor" number="8.6.5.4.2">
<h5><span class="header-section-number">8.6.5.4.2</span> Plot<a href="machine_learning.html#plot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="machine_learning.html#cb1200-1" tabindex="-1"></a><span class="co"># Plot the cross-validated risk estimate with 95% CIs.</span></span>
<span id="cb1200-2"><a href="machine_learning.html#cb1200-2" tabindex="-1"></a></span>
<span id="cb1200-3"><a href="machine_learning.html#cb1200-3" tabindex="-1"></a><span class="fu">plot</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/cvsl_review-1.png" width="672" /></p>
</div>
</div>
<div id="compute-auc-for-all-estimators" class="section level4 hasAnchor" number="8.6.5.5">
<h4><span class="header-section-number">8.6.5.5</span> Compute AUC for all estimators<a href="machine_learning.html#compute-auc-for-all-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>ROC</strong></p>
<p>ROC: a ROC (receiver operating characteristic curve) plots the relationship between True Positive Rate (Y-axis) and FALSE Positive Rate (X-axis).</p>
<div class="float">
<img src="https://developers.google.com/machine-learning/crash-course/images/AUC.svg" alt="Area Under the ROC Curve" />
<div class="figcaption">Area Under the ROC Curve</div>
</div>
<p><strong>AUC</strong></p>
<p>AUC: Area Under the ROC Curve</p>
<p>1 = perfect</p>
<p>0.5 = no better than chance</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="machine_learning.html#cb1201-1" tabindex="-1"></a>ck37r<span class="sc">::</span><span class="fu">auc_table</span>(cv_sl)</span></code></pre></div>
<pre><code>##                      auc         se  ci_lower  ci_upper      p-value
## SL.mean_All    0.5000000 0.06912305 0.3645213 0.6354787 4.812252e-10
## SL.rpart_All   0.8178146 0.03940971 0.7405730 0.8950563 3.883950e-03
## SL.xgboost_All 0.8850572 0.02439939 0.8372353 0.9328791 6.132768e-02
## DiscreteSL     0.9073913 0.02042505 0.8673590 0.9474237 2.264354e-01
## SL.ranger_All  0.9076201 0.02042003 0.8675976 0.9476427 2.297666e-01
## SuperLearner   0.9167735 0.01949192 0.8785700 0.9549769 3.800928e-01
## SL.glmnet_All  0.9227231 0.01897696 0.8855290 0.9599173 5.000000e-01</code></pre>
<div id="plot-the-roc-curve-for-the-best-estimator-discretsl" class="section level5 hasAnchor" number="8.6.5.5.1">
<h5><span class="header-section-number">8.6.5.5.1</span> Plot the ROC curve for the best estimator (DiscretSL)<a href="machine_learning.html#plot-the-roc-curve-for-the-best-estimator-discretsl" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="machine_learning.html#cb1203-1" tabindex="-1"></a>ck37r<span class="sc">::</span><span class="fu">plot_roc</span>(cv_sl)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="review-weight-distribution-for-the-superlearner" class="section level5 hasAnchor" number="8.6.5.5.2">
<h5><span class="header-section-number">8.6.5.5.2</span> Review weight distribution for the SuperLearner<a href="machine_learning.html#review-weight-distribution-for-the-superlearner" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="machine_learning.html#cb1204-1" tabindex="-1"></a><span class="fu">print</span>(ck37r<span class="sc">::</span><span class="fu">cvsl_weights</span>(cv_sl), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##  # Learner    Mean      SD     Min     Max
##  1  glmnet 0.76420 0.24570 0.44705 0.99058
##  2 xgboost 0.13366 0.20161 0.00000 0.47300
##  3  ranger 0.08615 0.19263 0.00000 0.43074
##  4   rpart 0.01599 0.03575 0.00000 0.07995
##  5    mean 0.00000 0.00000 0.00000 0.00000</code></pre>
<p>The general stacking approach is available in the tidymodels framework through <a href="https://github.com/tidymodels/stacks"><code>stacks</code></a> package (developmental stage).</p>
<p>However, SuperLearner is currently not available in the tidymodels framework. You can easily build and add a parsnip model if you’d like to. If you are interested in knowing more about it, please look at <a href="https://www.tidymodels.org/learn/develop/models/">this vignette</a> of the tidymodels.</p>
</div>
</div>
</div>
<div id="applications-2" class="section level3 hasAnchor" number="8.6.6">
<h3><span class="header-section-number">8.6.6</span> Applications<a href="machine_learning.html#applications-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="bandit-algorithm-optimizing-an-experiment" class="section level4 hasAnchor" number="8.6.6.1">
<h4><span class="header-section-number">8.6.6.1</span> Bandit algorithm (optimizing an experiment)<a href="machine_learning.html#bandit-algorithm-optimizing-an-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="causal-forest-estimating-heterogeneous-treatment-effect" class="section level4 hasAnchor" number="8.6.6.2">
<h4><span class="header-section-number">8.6.6.2</span> Causal forest (estimating heterogeneous treatment effect)<a href="machine_learning.html#causal-forest-estimating-heterogeneous-treatment-effect" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
</div>
<div id="unsupervised-learning" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Unsupervised learning<a href="machine_learning.html#unsupervised-learning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>x -&gt; f - &gt; y (not defined)</p>
<div id="dimension-reduction" class="section level3 hasAnchor" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> Dimension reduction<a href="machine_learning.html#dimension-reduction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="float">
<img src="https://i.stack.imgur.com/Q7HIP.gif" alt="Projecting 2D-data to a line (PCA). From vas3k.com" />
<div class="figcaption">Projecting 2D-data to a line (PCA). From vas3k.com</div>
</div>
<div id="correlation-analysis" class="section level4 hasAnchor" number="8.7.1.1">
<h4><span class="header-section-number">8.7.1.1</span> Correlation analysis<a href="machine_learning.html#correlation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This dataset is a good problem for PCA as some features are highly correlated.</p>
<p>Again, think about what the dataset is about. The following data dictionary comes from <a href="http://rstudio-pubs-static.s3.amazonaws.com/24341_184a58191486470cab97acdbbfe78ed5.html">this site</a>.</p>
<ul>
<li>age - age in years</li>
<li>sex - sex (1 = male; 0 = female)</li>
<li>cp - chest pain type (1 = typical angina; 2 = atypical angina; 3 = non-anginal pain; 4 = asymptomatic)</li>
<li>trestbps - resting blood pressure (in mm Hg on admission to the hospital)</li>
<li>chol - serum cholestoral in mg/dl</li>
<li>fbs - fasting blood sugar &gt; 120 mg/dl (1 = true; 0 = false)</li>
<li>restecg - resting electrocardiographic results (0 = normal; 1 = having ST-T; 2 = hypertrophy)</li>
<li>thalach - maximum heart rate achieved</li>
<li>exang - exercise induced angina (1 = yes; 0 = no)</li>
<li>oldpeak - ST depression induced by exercise relative to rest
slope - the slope of the peak exercise ST segment (1 = upsloping; 2 = flat; 3 = downsloping)</li>
<li>ca - number of major vessels (0-3) colored by flourosopy</li>
<li>thal - 3 = normal; 6 = fixed defect; 7 = reversable defect</li>
<li>num - the predicted attribute - diagnosis of heart disease (angiographic disease status) (Value 0 = &lt; 50% diameter narrowing; Value 1 = &gt; 50% diameter narrowing)</li>
</ul>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="machine_learning.html#cb1206-1" tabindex="-1"></a>data_original <span class="sc">%&gt;%</span></span>
<span id="cb1206-2"><a href="machine_learning.html#cb1206-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>target) <span class="sc">%&gt;%</span></span>
<span id="cb1206-3"><a href="machine_learning.html#cb1206-3" tabindex="-1"></a>  corrr<span class="sc">::</span><span class="fu">correlate</span>()</span></code></pre></div>
<pre><code>## # A tibble: 13 × 14
##    term         age     sex      cp trestbps     chol      fbs restecg  thalach
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 age      NA      -0.0984 -0.0687   0.279   0.214    0.121   -0.116  -0.399  
##  2 sex      -0.0984 NA      -0.0494  -0.0568 -0.198    0.0450  -0.0582 -0.0440 
##  3 cp       -0.0687 -0.0494 NA        0.0476 -0.0769   0.0944   0.0444  0.296  
##  4 trestbps  0.279  -0.0568  0.0476  NA       0.123    0.178   -0.114  -0.0467 
##  5 chol      0.214  -0.198  -0.0769   0.123  NA        0.0133  -0.151  -0.00994
##  6 fbs       0.121   0.0450  0.0944   0.178   0.0133  NA       -0.0842 -0.00857
##  7 restecg  -0.116  -0.0582  0.0444  -0.114  -0.151   -0.0842  NA       0.0441 
##  8 thalach  -0.399  -0.0440  0.296   -0.0467 -0.00994 -0.00857  0.0441 NA      
##  9 exang     0.0968  0.142  -0.394    0.0676  0.0670   0.0257  -0.0707 -0.379  
## 10 oldpeak   0.210   0.0961 -0.149    0.193   0.0540   0.00575 -0.0588 -0.344  
## 11 slope    -0.169  -0.0307  0.120   -0.121  -0.00404 -0.0599   0.0930  0.387  
## 12 ca        0.276   0.118  -0.181    0.101   0.0705   0.138   -0.0720 -0.213  
## 13 thal      0.0680  0.210  -0.162    0.0622  0.0988  -0.0320  -0.0120 -0.0964 
## # ℹ 5 more variables: exang &lt;dbl&gt;, oldpeak &lt;dbl&gt;, slope &lt;dbl&gt;, ca &lt;dbl&gt;,
## #   thal &lt;dbl&gt;</code></pre>
</div>
<div id="descriptive-statistics" class="section level4 hasAnchor" number="8.7.1.2">
<h4><span class="header-section-number">8.7.1.2</span> Descriptive statistics<a href="machine_learning.html#descriptive-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Notice the scaling issues? PCA is not scale-invariant. So, we need to fix this problem.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="machine_learning.html#cb1208-1" tabindex="-1"></a>min_max <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1208-2"><a href="machine_learning.html#cb1208-2" tabindex="-1"></a>  <span class="at">min =</span> <span class="sc">~</span> <span class="fu">min</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1208-3"><a href="machine_learning.html#cb1208-3" tabindex="-1"></a>  <span class="at">max =</span> <span class="sc">~</span> <span class="fu">max</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1208-4"><a href="machine_learning.html#cb1208-4" tabindex="-1"></a>)</span>
<span id="cb1208-5"><a href="machine_learning.html#cb1208-5" tabindex="-1"></a></span>
<span id="cb1208-6"><a href="machine_learning.html#cb1208-6" tabindex="-1"></a>data_original <span class="sc">%&gt;%</span></span>
<span id="cb1208-7"><a href="machine_learning.html#cb1208-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>target) <span class="sc">%&gt;%</span></span>
<span id="cb1208-8"><a href="machine_learning.html#cb1208-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), min_max))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 26
##   age_min age_max sex_min sex_max cp_min cp_max trestbps_min trestbps_max
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1      29      77       0       1      0      3           94          200
## # ℹ 18 more variables: chol_min &lt;dbl&gt;, chol_max &lt;dbl&gt;, fbs_min &lt;dbl&gt;,
## #   fbs_max &lt;dbl&gt;, restecg_min &lt;dbl&gt;, restecg_max &lt;dbl&gt;, thalach_min &lt;dbl&gt;,
## #   thalach_max &lt;dbl&gt;, exang_min &lt;dbl&gt;, exang_max &lt;dbl&gt;, oldpeak_min &lt;dbl&gt;,
## #   oldpeak_max &lt;dbl&gt;, slope_min &lt;dbl&gt;, slope_max &lt;dbl&gt;, ca_min &lt;dbl&gt;,
## #   ca_max &lt;dbl&gt;, thal_min &lt;dbl&gt;, thal_max &lt;dbl&gt;</code></pre>
</div>
<div id="preprocessing" class="section level4 hasAnchor" number="8.7.1.3">
<h4><span class="header-section-number">8.7.1.3</span> Preprocessing<a href="machine_learning.html#preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>recipe</code> is essential for preprocessing multiple features at once.</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="machine_learning.html#cb1210-1" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(<span class="sc">~</span>., <span class="at">data =</span> data_original) <span class="sc">%&gt;%</span></span>
<span id="cb1210-2"><a href="machine_learning.html#cb1210-2" tabindex="-1"></a>  <span class="co"># Imputing NAs using mean</span></span>
<span id="cb1210-3"><a href="machine_learning.html#cb1210-3" tabindex="-1"></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1210-4"><a href="machine_learning.html#cb1210-4" tabindex="-1"></a>  <span class="co"># Normalize some numeric variabless</span></span>
<span id="cb1210-5"><a href="machine_learning.html#cb1210-5" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;trestbps&quot;</span>, <span class="st">&quot;chol&quot;</span>, <span class="st">&quot;thalach&quot;</span>, <span class="st">&quot;oldpeak&quot;</span>))</span></code></pre></div>
</div>
<div id="pca-analysis" class="section level4 hasAnchor" number="8.7.1.4">
<h4><span class="header-section-number">8.7.1.4</span> PCA analysis<a href="machine_learning.html#pca-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="machine_learning.html#cb1211-1" tabindex="-1"></a>pca_res <span class="ot">&lt;-</span> pca_recipe <span class="sc">%&gt;%</span></span>
<span id="cb1211-2"><a href="machine_learning.html#cb1211-2" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>(),</span>
<span id="cb1211-3"><a href="machine_learning.html#cb1211-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1211-4"><a href="machine_learning.html#cb1211-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1211-5"><a href="machine_learning.html#cb1211-5" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb1211-6"><a href="machine_learning.html#cb1211-6" tabindex="-1"></a></span>
<span id="cb1211-7"><a href="machine_learning.html#cb1211-7" tabindex="-1"></a>pca_res <span class="sc">%&gt;%</span></span>
<span id="cb1211-8"><a href="machine_learning.html#cb1211-8" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">&quot;pca&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 196 × 4
##    terms        value component id   
##    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
##  1 age      -0.00101  PC1       pca  
##  2 sex       0.216    PC1       pca  
##  3 cp        0.321    PC1       pca  
##  4 trestbps  0.00118  PC1       pca  
##  5 chol     -0.000292 PC1       pca  
##  6 fbs       0.0468   PC1       pca  
##  7 restecg   0.166    PC1       pca  
##  8 thalach   0.0137   PC1       pca  
##  9 exang     0.0962   PC1       pca  
## 10 oldpeak  -0.00863  PC1       pca  
## # ℹ 186 more rows</code></pre>
<div id="screeplot" class="section level5 hasAnchor" number="8.7.1.4.1">
<h5><span class="header-section-number">8.7.1.4.1</span> Screeplot<a href="machine_learning.html#screeplot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="machine_learning.html#cb1213-1" tabindex="-1"></a><span class="co"># To avoid conflicts</span></span>
<span id="cb1213-2"><a href="machine_learning.html#cb1213-2" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1213-3"><a href="machine_learning.html#cb1213-3" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;select&quot;</span>, <span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1213-4"><a href="machine_learning.html#cb1213-4" tabindex="-1"></a></span>
<span id="cb1213-5"><a href="machine_learning.html#cb1213-5" tabindex="-1"></a>pca_recipe <span class="sc">%&gt;%</span></span>
<span id="cb1213-6"><a href="machine_learning.html#cb1213-6" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>(),</span>
<span id="cb1213-7"><a href="machine_learning.html#cb1213-7" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1213-8"><a href="machine_learning.html#cb1213-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1213-9"><a href="machine_learning.html#cb1213-9" tabindex="-1"></a>  <span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1213-10"><a href="machine_learning.html#cb1213-10" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">&quot;pca&quot;</span>, <span class="at">type =</span> <span class="st">&quot;variance&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1213-11"><a href="machine_learning.html#cb1213-11" tabindex="-1"></a>  <span class="fu">filter</span>(terms <span class="sc">==</span> <span class="st">&quot;percent variance&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1213-12"><a href="machine_learning.html#cb1213-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> component, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1213-13"><a href="machine_learning.html#cb1213-13" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb1213-14"><a href="machine_learning.html#cb1213-14" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1213-15"><a href="machine_learning.html#cb1213-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;PCAs of heart disease&quot;</span>,</span>
<span id="cb1213-16"><a href="machine_learning.html#cb1213-16" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;% of variance&quot;</span>,</span>
<span id="cb1213-17"><a href="machine_learning.html#cb1213-17" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Scree plot&quot;</span></span>
<span id="cb1213-18"><a href="machine_learning.html#cb1213-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="view-factor-loadings" class="section level5 hasAnchor" number="8.7.1.4.2">
<h5><span class="header-section-number">8.7.1.4.2</span> View factor loadings<a href="machine_learning.html#view-factor-loadings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Loadings are the covariances between the features and the principal components (=eigenvectors).</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="machine_learning.html#cb1214-1" tabindex="-1"></a>pca_recipe <span class="sc">%&gt;%</span></span>
<span id="cb1214-2"><a href="machine_learning.html#cb1214-2" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>(),</span>
<span id="cb1214-3"><a href="machine_learning.html#cb1214-3" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">&quot;pca&quot;</span></span>
<span id="cb1214-4"><a href="machine_learning.html#cb1214-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co"># id argument identifies each PCA step</span></span>
<span id="cb1214-5"><a href="machine_learning.html#cb1214-5" tabindex="-1"></a>  <span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1214-6"><a href="machine_learning.html#cb1214-6" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">&quot;pca&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1214-7"><a href="machine_learning.html#cb1214-7" tabindex="-1"></a>  <span class="fu">filter</span>(component <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1214-8"><a href="machine_learning.html#cb1214-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb1214-9"><a href="machine_learning.html#cb1214-9" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">fct_reorder</span>(terms, value), <span class="at">y =</span> value,</span>
<span id="cb1214-10"><a href="machine_learning.html#cb1214-10" tabindex="-1"></a>    <span class="at">fill =</span> component</span>
<span id="cb1214-11"><a href="machine_learning.html#cb1214-11" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb1214-12"><a href="machine_learning.html#cb1214-12" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1214-13"><a href="machine_learning.html#cb1214-13" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1214-14"><a href="machine_learning.html#cb1214-14" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1214-15"><a href="machine_learning.html#cb1214-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Terms&quot;</span>,</span>
<span id="cb1214-16"><a href="machine_learning.html#cb1214-16" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Contribtutions&quot;</span>,</span>
<span id="cb1214-17"><a href="machine_learning.html#cb1214-17" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;PCAs&quot;</span></span>
<span id="cb1214-18"><a href="machine_learning.html#cb1214-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p><strong>The key lesson</strong></p>
<p>You can use these low-dimensional data to solve the curse of dimensionality problem. Compressing feature space via dimension reduction techniques is called feature extraction. PCA is one way of doing this.</p>
</div>
</div>
</div>
<div id="topic-modeling" class="section level3 hasAnchor" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> Topic modeling<a href="machine_learning.html#topic-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="setup-6" class="section level4 hasAnchor" number="8.7.2.1">
<h4><span class="header-section-number">8.7.2.1</span> Setup<a href="machine_learning.html#setup-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="machine_learning.html#cb1215-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1215-2"><a href="machine_learning.html#cb1215-2" tabindex="-1"></a>  janeaustenr, <span class="co"># example text</span></span>
<span id="cb1215-3"><a href="machine_learning.html#cb1215-3" tabindex="-1"></a>  tidytext, <span class="co"># tidy text analysis</span></span>
<span id="cb1215-4"><a href="machine_learning.html#cb1215-4" tabindex="-1"></a>  glue, <span class="co"># paste string and objects</span></span>
<span id="cb1215-5"><a href="machine_learning.html#cb1215-5" tabindex="-1"></a>  stm, <span class="co"># structural topic modeling</span></span>
<span id="cb1215-6"><a href="machine_learning.html#cb1215-6" tabindex="-1"></a>  gutenbergr</span>
<span id="cb1215-7"><a href="machine_learning.html#cb1215-7" tabindex="-1"></a>) <span class="co"># toy datasets</span></span></code></pre></div>
</div>
<div id="dataset-1" class="section level4 hasAnchor" number="8.7.2.2">
<h4><span class="header-section-number">8.7.2.2</span> Dataset<a href="machine_learning.html#dataset-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="machine_learning.html#cb1216-1" tabindex="-1"></a><span class="co"># 1. Load all of Jane Austen&#39;s novels</span></span>
<span id="cb1216-2"><a href="machine_learning.html#cb1216-2" tabindex="-1"></a>austen_raw <span class="ot">&lt;-</span> <span class="fu">austen_books</span>()</span>
<span id="cb1216-3"><a href="machine_learning.html#cb1216-3" tabindex="-1"></a></span>
<span id="cb1216-4"><a href="machine_learning.html#cb1216-4" tabindex="-1"></a><span class="co"># 2. Add a chapter index (so you can facet or group by chapter if desired)</span></span>
<span id="cb1216-5"><a href="machine_learning.html#cb1216-5" tabindex="-1"></a>austen_chapters <span class="ot">&lt;-</span> austen_raw <span class="sc">%&gt;%</span></span>
<span id="cb1216-6"><a href="machine_learning.html#cb1216-6" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span></span>
<span id="cb1216-7"><a href="machine_learning.html#cb1216-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1216-8"><a href="machine_learning.html#cb1216-8" tabindex="-1"></a>    <span class="at">linenumber =</span> <span class="fu">row_number</span>(),</span>
<span id="cb1216-9"><a href="machine_learning.html#cb1216-9" tabindex="-1"></a>    <span class="at">chapter    =</span> <span class="fu">cumsum</span>(<span class="fu">str_detect</span>(text, <span class="fu">regex</span>(<span class="st">&quot;^chapter [0-9ivxlc]+&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb1216-10"><a href="machine_learning.html#cb1216-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1216-11"><a href="machine_learning.html#cb1216-11" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1216-12"><a href="machine_learning.html#cb1216-12" tabindex="-1"></a></span>
<span id="cb1216-13"><a href="machine_learning.html#cb1216-13" tabindex="-1"></a><span class="co"># 3. Tokenize and count words by book</span></span>
<span id="cb1216-14"><a href="machine_learning.html#cb1216-14" tabindex="-1"></a>austen_words <span class="ot">&lt;-</span> austen_chapters <span class="sc">%&gt;%</span></span>
<span id="cb1216-15"><a href="machine_learning.html#cb1216-15" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span></span>
<span id="cb1216-16"><a href="machine_learning.html#cb1216-16" tabindex="-1"></a>  <span class="fu">count</span>(book, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1216-17"><a href="machine_learning.html#cb1216-17" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span></span>
<span id="cb1216-18"><a href="machine_learning.html#cb1216-18" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1216-19"><a href="machine_learning.html#cb1216-19" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n),</span>
<span id="cb1216-20"><a href="machine_learning.html#cb1216-20" tabindex="-1"></a>    <span class="at">freq  =</span> n <span class="sc">/</span> total</span>
<span id="cb1216-21"><a href="machine_learning.html#cb1216-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1216-22"><a href="machine_learning.html#cb1216-22" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1216-23"><a href="machine_learning.html#cb1216-23" tabindex="-1"></a></span>
<span id="cb1216-24"><a href="machine_learning.html#cb1216-24" tabindex="-1"></a><span class="fu">head</span>(austen_words)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   book           word      n  total   freq
##   &lt;fct&gt;          &lt;chr&gt; &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt;
## 1 Mansfield Park the    6206 160460 0.0387
## 2 Mansfield Park to     5475 160460 0.0341
## 3 Mansfield Park and    5438 160460 0.0339
## 4 Emma           to     5239 160996 0.0325
## 5 Emma           the    5201 160996 0.0323
## 6 Emma           and    4896 160996 0.0304</code></pre>
</div>
<div id="key-ideas" class="section level4 hasAnchor" number="8.7.2.3">
<h4><span class="header-section-number">8.7.2.3</span> Key ideas<a href="machine_learning.html#key-ideas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="float">
<img src="https://paperswithcode.com/media/thumbnails/task/task-0000000179-fd3a1d11_fGQkZCJ.jpg" alt="Source: paperswithcode.com" />
<div class="figcaption">Source: paperswithcode.com</div>
</div>
<ul>
<li><p>Main papers: See <a href="https://proceedings.neurips.cc/paper/2001/file/296472c9542ad4d4788d543508116cbc-Paper.pdf">Latent Dirichlet Allocation</a> by David M. Blei, Andrew Y. Ng and Michael I. Jordan (then all Berkeley) and this <a href="http://www.cse.cuhk.edu.hk/irwin.king/_media/presentations/latent_dirichlet_allocation.pdf">follow-up paper</a> with the same title.</p></li>
<li><p>Topics as <strong>distributions</strong> of words (<span class="math inline">\(\beta\)</span> distribution)</p></li>
<li><p>Documents as <strong>distributions</strong> of topics (<span class="math inline">\(\alpha\)</span> distribution)</p></li>
<li><p>What distributions?</p>
<ul>
<li><p>Probability</p></li>
<li><p>Multinominal</p></li>
</ul></li>
<li><p>Words lie on a lower-dimensional space (dimension reduction akin to PCA)</p></li>
<li><p>Co-occurrence of words (clustering)</p></li>
<li><p>Bag of words (feature engineering)</p>
<ul>
<li>Upside: easy and fast (also working quite well)</li>
<li>Downside: ignored grammatical structures and rich interactions among words (Alternative: word embeddings. Please check out <a href="http://text2vec.org/">text2vec</a>)</li>
</ul></li>
<li><p>Documents are exchangeable (sequencing won’t matter).</p></li>
<li><p>Topics are independent (uncorrelated). If you don’t think this assumption holds, use Correlated Topics Models by <a href="https://arxiv.org/pdf/0708.3601.pdf#:~:text=The%20correlated%20topic%20model%20(CTM)%20is%20a%20hierarchical%20model%20of,are%20document%2D%20specific%20random%20variables.">Blei and Lafferty (2007)</a>.</p></li>
</ul>
</div>
<div id="exploratory-data-analysis" class="section level4 hasAnchor" number="8.7.2.4">
<h4><span class="header-section-number">8.7.2.4</span> Exploratory data analysis<a href="machine_learning.html#exploratory-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="machine_learning.html#cb1218-1" tabindex="-1"></a><span class="co"># 1) Tokenize, remove stop words, &amp; count</span></span>
<span id="cb1218-2"><a href="machine_learning.html#cb1218-2" tabindex="-1"></a>austen_words <span class="ot">&lt;-</span> austen_chapters <span class="sc">%&gt;%</span></span>
<span id="cb1218-3"><a href="machine_learning.html#cb1218-3" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span></span>
<span id="cb1218-4"><a href="machine_learning.html#cb1218-4" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>) <span class="sc">%&gt;%</span>   <span class="co"># remove common stop words</span></span>
<span id="cb1218-5"><a href="machine_learning.html#cb1218-5" tabindex="-1"></a>  <span class="fu">count</span>(book, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1218-6"><a href="machine_learning.html#cb1218-6" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span></span>
<span id="cb1218-7"><a href="machine_learning.html#cb1218-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1218-8"><a href="machine_learning.html#cb1218-8" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n),</span>
<span id="cb1218-9"><a href="machine_learning.html#cb1218-9" tabindex="-1"></a>    <span class="at">freq  =</span> n <span class="sc">/</span> total</span>
<span id="cb1218-10"><a href="machine_learning.html#cb1218-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1218-11"><a href="machine_learning.html#cb1218-11" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1218-12"><a href="machine_learning.html#cb1218-12" tabindex="-1"></a></span>
<span id="cb1218-13"><a href="machine_learning.html#cb1218-13" tabindex="-1"></a><span class="co"># 2) Pick top 10 words per book</span></span>
<span id="cb1218-14"><a href="machine_learning.html#cb1218-14" tabindex="-1"></a>top_words <span class="ot">&lt;-</span> austen_words <span class="sc">%&gt;%</span></span>
<span id="cb1218-15"><a href="machine_learning.html#cb1218-15" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span></span>
<span id="cb1218-16"><a href="machine_learning.html#cb1218-16" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> freq, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1218-17"><a href="machine_learning.html#cb1218-17" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1218-18"><a href="machine_learning.html#cb1218-18" tabindex="-1"></a></span>
<span id="cb1218-19"><a href="machine_learning.html#cb1218-19" tabindex="-1"></a><span class="co"># 3) Plot the top words</span></span>
<span id="cb1218-20"><a href="machine_learning.html#cb1218-20" tabindex="-1"></a><span class="fu">ggplot</span>(top_words, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(word, freq), <span class="at">y =</span> freq)) <span class="sc">+</span></span>
<span id="cb1218-21"><a href="machine_learning.html#cb1218-21" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb1218-22"><a href="machine_learning.html#cb1218-22" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>book, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1218-23"><a href="machine_learning.html#cb1218-23" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1218-24"><a href="machine_learning.html#cb1218-24" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1218-25"><a href="machine_learning.html#cb1218-25" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb1218-26"><a href="machine_learning.html#cb1218-26" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span></span>
<span id="cb1218-27"><a href="machine_learning.html#cb1218-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1218-28"><a href="machine_learning.html#cb1218-28" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb1218-29"><a href="machine_learning.html#cb1218-29" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
</div>
<div id="stm" class="section level4 hasAnchor" number="8.7.2.5">
<h4><span class="header-section-number">8.7.2.5</span> STM<a href="machine_learning.html#stm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="https://www.structuraltopicmodel.com/">Structural Topic Modeling</a> by Roberts, Stewart, and Tingley helps estimate how topics’ proportions vary by covariates. If you don’t use covariates, this approach is close to CTM. The other useful (and very recent) topic modeling package is Keyword Assisted Topic Models (<a href="https://keyatm.github.io/keyATM/">keyATM</a>) by Shusei, Imai, and Sasaki.</p>
<p>Also, note that we didn’t cover other important techniques in topic modeling, such as dynamic and hierarchical topic modeling.</p>
<p><img src="https://warin.ca/shiny/stm/images/fig02.png" /></p>
<div id="turn-text-into-document-term-matrix" class="section level5 hasAnchor" number="8.7.2.5.1">
<h5><span class="header-section-number">8.7.2.5.1</span> Turn text into document-term matrix<a href="machine_learning.html#turn-text-into-document-term-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><code>stm</code> package has its preprocessing function.</p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="machine_learning.html#cb1219-1" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">textProcessor</span>(</span>
<span id="cb1219-2"><a href="machine_learning.html#cb1219-2" tabindex="-1"></a>  <span class="at">documents =</span> austen_chapters<span class="sc">$</span>text,</span>
<span id="cb1219-3"><a href="machine_learning.html#cb1219-3" tabindex="-1"></a>  <span class="at">metadata =</span> austen_chapters,</span>
<span id="cb1219-4"><a href="machine_learning.html#cb1219-4" tabindex="-1"></a>  <span class="at">removestopwords =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1219-5"><a href="machine_learning.html#cb1219-5" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb1219-6"><a href="machine_learning.html#cb1219-6" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="tuning-k" class="section level5 hasAnchor" number="8.7.2.5.2">
<h5><span class="header-section-number">8.7.2.5.2</span> Tuning K<a href="machine_learning.html#tuning-k" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>K is the number of topics.</li>
<li>Let’s try K = 5, 10, 15.</li>
</ul>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="machine_learning.html#cb1220-1" tabindex="-1"></a>test_res <span class="ot">&lt;-</span> <span class="fu">searchK</span>(</span>
<span id="cb1220-2"><a href="machine_learning.html#cb1220-2" tabindex="-1"></a>  dtm<span class="sc">$</span>documents,</span>
<span id="cb1220-3"><a href="machine_learning.html#cb1220-3" tabindex="-1"></a>  dtm<span class="sc">$</span>vocab,</span>
<span id="cb1220-4"><a href="machine_learning.html#cb1220-4" tabindex="-1"></a>  <span class="at">K =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb1220-5"><a href="machine_learning.html#cb1220-5" tabindex="-1"></a>  <span class="at">prevalence =</span> <span class="sc">~</span>book,</span>
<span id="cb1220-6"><a href="machine_learning.html#cb1220-6" tabindex="-1"></a>  <span class="at">data =</span> dtm<span class="sc">$</span>meta</span>
<span id="cb1220-7"><a href="machine_learning.html#cb1220-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Beginning Spectral Initialization 
##   Calculating the gram matrix...
##   Using only 10000 most frequent terms during initialization...
##   Finding anchor words...
##      .....
##   Recovering initialization...
##      ...................................................................................................
## Initialization complete.
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 1 (approx. per word bound = -7.638) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 2 (approx. per word bound = -7.517, relative change = 1.595e-02) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 3 (approx. per word bound = -7.472, relative change = 5.930e-03) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 4 (approx. per word bound = -7.439, relative change = 4.387e-03) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 5 (approx. per word bound = -7.417, relative change = 3.013e-03) 
## Topic 1: much, time, soon, without, noth 
##  Topic 2: might, say, littl, good, feel 
##  Topic 3: will, think, everi, can, first 
##  Topic 4: mrs, must, miss, one, never 
##  Topic 5: said, know, well, see, now 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 6 (approx. per word bound = -7.402, relative change = 2.013e-03) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 7 (approx. per word bound = -7.392, relative change = 1.370e-03) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 8 (approx. per word bound = -7.385, relative change = 9.556e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 9 (approx. per word bound = -7.380, relative change = 6.824e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 10 (approx. per word bound = -7.376, relative change = 4.980e-04) 
## Topic 1: much, time, soon, without, made 
##  Topic 2: might, say, littl, good, feel 
##  Topic 3: will, think, everi, can, first 
##  Topic 4: mrs, must, miss, one, never 
##  Topic 5: said, know, well, now, see 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 11 (approx. per word bound = -7.373, relative change = 3.706e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 12 (approx. per word bound = -7.371, relative change = 2.808e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 13 (approx. per word bound = -7.370, relative change = 2.160e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 14 (approx. per word bound = -7.368, relative change = 1.685e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 15 (approx. per word bound = -7.367, relative change = 1.331e-04) 
## Topic 1: much, time, soon, without, made 
##  Topic 2: might, say, littl, good, feel 
##  Topic 3: will, think, everi, can, first 
##  Topic 4: mrs, must, miss, one, never 
##  Topic 5: said, know, well, now, see 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 16 (approx. per word bound = -7.367, relative change = 1.059e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 17 (approx. per word bound = -7.366, relative change = 8.447e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 18 (approx. per word bound = -7.365, relative change = 6.734e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 19 (approx. per word bound = -7.365, relative change = 5.392e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 20 (approx. per word bound = -7.365, relative change = 4.322e-05) 
## Topic 1: much, time, soon, without, made 
##  Topic 2: might, say, littl, good, feel 
##  Topic 3: will, think, everi, can, first 
##  Topic 4: mrs, must, miss, one, never 
##  Topic 5: said, know, now, well, see 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 21 (approx. per word bound = -7.364, relative change = 3.470e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 22 (approx. per word bound = -7.364, relative change = 2.796e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 23 (approx. per word bound = -7.364, relative change = 2.268e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 24 (approx. per word bound = -7.364, relative change = 1.858e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 25 (approx. per word bound = -7.364, relative change = 1.538e-05) 
## Topic 1: much, time, soon, without, give 
##  Topic 2: might, say, littl, good, feel 
##  Topic 3: will, think, everi, can, first 
##  Topic 4: mrs, must, miss, one, never 
##  Topic 5: said, know, now, well, see 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 26 (approx. per word bound = -7.364, relative change = 1.288e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Completing Iteration 27 (approx. per word bound = -7.364, relative change = 1.096e-05) 
## ....................................................................................................
## Completed E-Step (2 seconds). 
## Completed M-Step. 
## Model Converged 
## Beginning Spectral Initialization 
##   Calculating the gram matrix...
##   Using only 10000 most frequent terms during initialization...
##   Finding anchor words...
##      ..........
##   Recovering initialization...
##      ...................................................................................................
## Initialization complete.
## ....................................................................................................
## Completed E-Step (5 seconds). 
## Completed M-Step. 
## Completing Iteration 1 (approx. per word bound = -7.692) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 2 (approx. per word bound = -7.602, relative change = 1.164e-02) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 3 (approx. per word bound = -7.526, relative change = 9.978e-03) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 4 (approx. per word bound = -7.478, relative change = 6.434e-03) 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 5 (approx. per word bound = -7.446, relative change = 4.230e-03) 
## Topic 1: mrs, will, littl, sister, wish 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, walk 
##  Topic 4: now, thought, seem, appear, call 
##  Topic 5: much, thing, fanni, almost, moment 
##  Topic 6: might, without, ladi, emma, long 
##  Topic 7: said, one, know, never, look 
##  Topic 8: see, good, though, friend, well 
##  Topic 9: time, everi, first, day, two 
##  Topic 10: like, certain, parti, well, someth 
## ....................................................................................................
## Completed E-Step (4 seconds). 
## Completed M-Step. 
## Completing Iteration 6 (approx. per word bound = -7.425, relative change = 2.894e-03) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 7 (approx. per word bound = -7.409, relative change = 2.120e-03) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 8 (approx. per word bound = -7.397, relative change = 1.605e-03) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 9 (approx. per word bound = -7.388, relative change = 1.257e-03) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 10 (approx. per word bound = -7.381, relative change = 9.623e-04) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, walk 
##  Topic 4: now, thought, seem, appear, call 
##  Topic 5: much, thing, fanni, moment, almost 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: see, good, well, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, certain, someth, parti, sure 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 11 (approx. per word bound = -7.375, relative change = 7.316e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 12 (approx. per word bound = -7.371, relative change = 5.581e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 13 (approx. per word bound = -7.368, relative change = 4.326e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 14 (approx. per word bound = -7.365, relative change = 3.391e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 15 (approx. per word bound = -7.363, relative change = 2.730e-04) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, walk 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, moment, crawford 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, parti 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 16 (approx. per word bound = -7.362, relative change = 2.236e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 17 (approx. per word bound = -7.360, relative change = 1.824e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 18 (approx. per word bound = -7.359, relative change = 1.483e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 19 (approx. per word bound = -7.358, relative change = 1.221e-04) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 20 (approx. per word bound = -7.358, relative change = 1.034e-04) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, walk 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, moment, crawford 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, parti 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 21 (approx. per word bound = -7.357, relative change = 9.018e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 22 (approx. per word bound = -7.356, relative change = 7.833e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 23 (approx. per word bound = -7.356, relative change = 6.688e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 24 (approx. per word bound = -7.356, relative change = 5.677e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 25 (approx. per word bound = -7.355, relative change = 4.807e-05) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, love 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, believ, moment 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, find 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 26 (approx. per word bound = -7.355, relative change = 4.082e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 27 (approx. per word bound = -7.355, relative change = 3.526e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 28 (approx. per word bound = -7.354, relative change = 3.129e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 29 (approx. per word bound = -7.354, relative change = 2.815e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 30 (approx. per word bound = -7.354, relative change = 2.525e-05) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, love 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, believ, moment 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, find 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 31 (approx. per word bound = -7.354, relative change = 2.240e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 32 (approx. per word bound = -7.354, relative change = 1.999e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 33 (approx. per word bound = -7.354, relative change = 1.820e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 34 (approx. per word bound = -7.353, relative change = 1.659e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 35 (approx. per word bound = -7.353, relative change = 1.515e-05) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, love 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, believ, moment 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, find 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 36 (approx. per word bound = -7.353, relative change = 1.408e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 37 (approx. per word bound = -7.353, relative change = 1.322e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 38 (approx. per word bound = -7.353, relative change = 1.249e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 39 (approx. per word bound = -7.353, relative change = 1.177e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 40 (approx. per word bound = -7.353, relative change = 1.106e-05) 
## Topic 1: mrs, will, littl, sister, make 
##  Topic 2: must, think, say, feel, give 
##  Topic 3: miss, even, soon, quit, love 
##  Topic 4: now, thought, seem, appear, mariann 
##  Topic 5: much, thing, fanni, believ, moment 
##  Topic 6: might, ladi, without, come, emma 
##  Topic 7: said, one, know, never, look 
##  Topic 8: well, see, good, though, friend 
##  Topic 9: time, everi, day, first, two 
##  Topic 10: like, sure, certain, someth, find 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Completing Iteration 41 (approx. per word bound = -7.353, relative change = 1.045e-05) 
## ....................................................................................................
## Completed E-Step (3 seconds). 
## Completed M-Step. 
## Model Converged</code></pre>
</div>
<div id="evaludating-models" class="section level5 hasAnchor" number="8.7.2.5.3">
<h5><span class="header-section-number">8.7.2.5.3</span> Evaludating models<a href="machine_learning.html#evaludating-models" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Several metrics assess topic models’ performance: the held-out likelihood, residuals, semantic coherence, and exclusivity. Here we examine the relationship between semantic coherence and exclusivity to understand the trade-off involved in selecting K.</p>
<ul>
<li><p>Semantic coherence: high probability words for a topic co-occur in documents</p></li>
<li><p>Exclusivity: keywords of one topic are not likely to appear as keywords in other topics.</p></li>
</ul>
<blockquote>
<p>In Roberts et al. (2014), the authors introduce the semantic coherence metric of Mimno et al. (2011) as a criterion for topic‐model selection. They observe, however, that maximizing semantic coherence alone can be trivial—by allowing a small number of topics to capture the most frequent words. To counteract this, they also develop an <strong>exclusivity</strong> measure.</p>
<p>This exclusivity measure incorporates word‐frequency information via the FREX metric (implemented in <code>calcfrex</code>), with a default weight of 0.7 placed on exclusivity.</p>
</blockquote>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="machine_learning.html#cb1222-1" tabindex="-1"></a>test_res<span class="sc">$</span>results <span class="sc">%&gt;%</span></span>
<span id="cb1222-2"><a href="machine_learning.html#cb1222-2" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(K, exclus, semcoh)) <span class="sc">%&gt;%</span></span>
<span id="cb1222-3"><a href="machine_learning.html#cb1222-3" tabindex="-1"></a>  <span class="fu">select</span>(K, exclus, semcoh) <span class="sc">%&gt;%</span></span>
<span id="cb1222-4"><a href="machine_learning.html#cb1222-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> <span class="fu">as.factor</span>(K)) <span class="sc">%&gt;%</span></span>
<span id="cb1222-5"><a href="machine_learning.html#cb1222-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> exclus, <span class="at">y =</span> semcoh)) <span class="sc">+</span></span>
<span id="cb1222-6"><a href="machine_learning.html#cb1222-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1222-7"><a href="machine_learning.html#cb1222-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb1222-8"><a href="machine_learning.html#cb1222-8" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">&quot;K = {test_res$results$K}&quot;</span>),</span>
<span id="cb1222-9"><a href="machine_learning.html#cb1222-9" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb1222-10"><a href="machine_learning.html#cb1222-10" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb1222-11"><a href="machine_learning.html#cb1222-11" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">height =</span> <span class="fl">0.05</span>)</span>
<span id="cb1222-12"><a href="machine_learning.html#cb1222-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1222-13"><a href="machine_learning.html#cb1222-13" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1222-14"><a href="machine_learning.html#cb1222-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Exclusivity&quot;</span>,</span>
<span id="cb1222-15"><a href="machine_learning.html#cb1222-15" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Semantic coherence&quot;</span>,</span>
<span id="cb1222-16"><a href="machine_learning.html#cb1222-16" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Exclusivity and semantic coherence&quot;</span></span>
<span id="cb1222-17"><a href="machine_learning.html#cb1222-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
</div>
<div id="finalize" class="section level5 hasAnchor" number="8.7.2.5.4">
<h5><span class="header-section-number">8.7.2.5.4</span> Finalize<a href="machine_learning.html#finalize" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="machine_learning.html#cb1223-1" tabindex="-1"></a>final_stm <span class="ot">&lt;-</span> <span class="fu">stm</span>(</span>
<span id="cb1223-2"><a href="machine_learning.html#cb1223-2" tabindex="-1"></a>  dtm<span class="sc">$</span>documents, dtm<span class="sc">$</span>vocab,</span>
<span id="cb1223-3"><a href="machine_learning.html#cb1223-3" tabindex="-1"></a>  <span class="at">K          =</span> <span class="dv">5</span>,</span>
<span id="cb1223-4"><a href="machine_learning.html#cb1223-4" tabindex="-1"></a>  <span class="at">prevalence =</span> <span class="sc">~</span>book,</span>
<span id="cb1223-5"><a href="machine_learning.html#cb1223-5" tabindex="-1"></a>  <span class="at">data       =</span> dtm<span class="sc">$</span>meta,</span>
<span id="cb1223-6"><a href="machine_learning.html#cb1223-6" tabindex="-1"></a>  <span class="at">init.type  =</span> <span class="st">&quot;Spectral&quot;</span>,</span>
<span id="cb1223-7"><a href="machine_learning.html#cb1223-7" tabindex="-1"></a>  <span class="at">max.em.its =</span> <span class="dv">75</span>,</span>
<span id="cb1223-8"><a href="machine_learning.html#cb1223-8" tabindex="-1"></a>  <span class="at">seed       =</span> <span class="dv">1234567</span>,</span>
<span id="cb1223-9"><a href="machine_learning.html#cb1223-9" tabindex="-1"></a>  <span class="at">verbose    =</span> <span class="cn">FALSE</span></span>
<span id="cb1223-10"><a href="machine_learning.html#cb1223-10" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="explore-the-results" class="section level5 hasAnchor" number="8.7.2.5.5">
<h5><span class="header-section-number">8.7.2.5.5</span> Explore the results<a href="machine_learning.html#explore-the-results" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>Using the <code>stm</code> package.</li>
</ul>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1224-1"><a href="machine_learning.html#cb1224-1" tabindex="-1"></a><span class="fu">plot</span>(final_stm)</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<ul>
<li>Using ggplot2</li>
</ul>
<p>In LDA distribution, <span class="math inline">\(\alpha\)</span> represents document-topic density and <span class="math inline">\(\beta\)</span> represents topic-word density.</p>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="machine_learning.html#cb1225-1" tabindex="-1"></a><span class="co"># tidy</span></span>
<span id="cb1225-2"><a href="machine_learning.html#cb1225-2" tabindex="-1"></a>tidy_stm <span class="ot">&lt;-</span> <span class="fu">tidy</span>(final_stm)</span>
<span id="cb1225-3"><a href="machine_learning.html#cb1225-3" tabindex="-1"></a></span>
<span id="cb1225-4"><a href="machine_learning.html#cb1225-4" tabindex="-1"></a><span class="co"># top terms</span></span>
<span id="cb1225-5"><a href="machine_learning.html#cb1225-5" tabindex="-1"></a>tidy_stm <span class="sc">%&gt;%</span></span>
<span id="cb1225-6"><a href="machine_learning.html#cb1225-6" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb1225-7"><a href="machine_learning.html#cb1225-7" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">10</span>, beta) <span class="sc">%&gt;%</span></span>
<span id="cb1225-8"><a href="machine_learning.html#cb1225-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1225-9"><a href="machine_learning.html#cb1225-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_reorder</span>(term, beta), beta, <span class="at">fill =</span> <span class="fu">as.factor</span>(topic))) <span class="sc">+</span></span>
<span id="cb1225-10"><a href="machine_learning.html#cb1225-10" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1225-11"><a href="machine_learning.html#cb1225-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>topic, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb1225-12"><a href="machine_learning.html#cb1225-12" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1225-13"><a href="machine_learning.html#cb1225-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb1225-14"><a href="machine_learning.html#cb1225-14" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>()</span></code></pre></div>
<p><img src="07_high_dimensional_data_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
</div>
</div>
</div>
</div>
<div id="references-4" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> References<a href="machine_learning.html#references-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="books" class="section level3 hasAnchor" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> Books<a href="machine_learning.html#books" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><em>An Introduction to Statistical Learning - with Applications in R (2013)</em> by Gareth James, Daniela Witten, Trevor Hastie, Robert Tibshirani. Springer: New York. <a href="https://www.amazon.com/Introduction-Statistical-Learning-Applications-Statistics/dp/1461471370">Amazon</a> or <a href="http://www-bcf.usc.edu/~gareth/ISL/">free PDF</a>.</p></li>
<li><p><em>Hands-On Machine Learning with R (2020)</em> by Bradley Boehmke &amp; Brandon Greenwell. <a href="https://www.routledge.com/Hands-On-Machine-Learning-with-R/Boehmke-Greenwell/p/book/9781138495685">CRC Press</a> or <a href="https://www.amazon.com/gp/product/1138495689?pf_rd_p=ab873d20-a0ca-439b-ac45-cd78f07a84d8&amp;pf_rd_r=JBRX0ZJ1WFSR9T3JPTQE">Amazon</a></p></li>
<li><p><em>Applied Predictive Modeling (2013)</em> by Max Kuhn and Kjell Johnson. Springer: New York. <a href="https://www.amazon.com/Applied-Predictive-Modeling-Max-Kuhn/dp/1461468485?SubscriptionId=0ENGV10E9K9QDNSJ5C82&amp;tag=apm0a-20&amp;linkCode=xm2&amp;camp=2025&amp;creative=165953&amp;creativeASIN=1461468485">Amazon</a></p></li>
<li><p><em>Feature Engineering and Selection: A Practical Approach for Predictive Models (2019)</em> by Kjell Johnson and Max Kuhn. Taylor &amp; Francis. <a href="http://www.feat.engineering/">Amazon</a> or <a href="http://www.feat.engineering/">free HTML</a>.</p></li>
<li><p><em><a href="https://www.tmwr.org/">Tidy Modeling with R</a> (2020)</em> by Max Kuhn and Julia Silge (work-in-progress)</p></li>
</ul>
</div>
<div id="lecture-slides" class="section level3 hasAnchor" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Lecture slides<a href="machine_learning.html#lecture-slides" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><a href="https://www.nber.org/econometrics_minicourse_2015/nber_slides11.pdf">An introduction to supervised and unsupervised learning (2015)</a> by Susan Athey and Guido Imbens</p></li>
<li><p><a href="https://education.rstudio.com/blog/2020/02/conf20-intro-ml/">Introduction Machine Learning with the Tidyverse</a> by Alison Hill</p></li>
</ul>
</div>
<div id="blog-posts" class="section level3 hasAnchor" number="8.8.3">
<h3><span class="header-section-number">8.8.3</span> Blog posts<a href="machine_learning.html#blog-posts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="http://www.rebeccabarter.com/blog/2019-06-06_pre_processing/">“Using the recipes package for easy pre-processing”</a> by Rebecca Barter</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="semi_structured_data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big_data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jaeyk/PS239T/edit/main/07_high_dimensional_data.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": [
    ["pdf", "PS239T.pdf"],
    ["epub", "PS239T.epub"]
  ],
  "search": {
    "engine": "fuse",
    "options": null,
    "enabled": true,
    "highlight": true
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
